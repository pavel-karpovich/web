/*! For license information please see 221.9d1530de.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunk_bpinc_web_agent_desktop_ui=self.webpackChunk_bpinc_web_agent_desktop_ui||[]).push([[221],{2503:(e,t,n)=>{n.r(t);var r=n(2322),a=n(6029),o=n.n(a),i=n(7029),s=n(574),l=n(6607),c=n(8445),u=n(9022),d=n(3830),f=n.n(d),m=n(2122),p=n(3385),v=n(6432),g={interactions:{},chatCenter:{}},h=n(5928),b=n(4264),y=n(2488),S=n(1308),x=n(6702),j=n(4593),I=n(7176),O=n(2234),_={isAttachmentsListReady:function(){return!0},getAttachmentsList:function(){return[]},addAttachment:m.noop,removeAttachment:m.noop,clearAttachmentsList:m.noop,initializeAttachmentsList:m.noop,fileRejections:[],setFileRejections:m.noop},C=n(9008),w=n(9717),N=n(4173);function A(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function E(e,t,n,r,a,o,i){try{var s=e[o](i),l=s.value}catch(c){return void n(c)}s.done?t(l):Promise.resolve(l).then(r,a)}function T(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){E(o,r,a,i,s,"next",e)}function s(e){E(o,r,a,i,s,"throw",e)}i(void 0)}))}}function P(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){P(e,t,n[t])}))}return e}function L(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return A(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return A(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function k(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(s){o=[6,s],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function D(e){var t,n=e.uploadFile,r=e.handleError,o=e.getFormData,i=L((0,a.useState)({}),2),s=i[0],l=i[1],c=L((0,a.useState)([]),2),u=c[0],m=c[1],p=(0,a.useRef)({}),v=(0,a.useRef)({pendingAmount:0,items:[]}),g=(0,a.useCallback)((function(e,t){var n;return null===(n=p.current[e])||void 0===n?void 0:n[t]}),[]),h=(0,a.useCallback)((function(e){delete p.current[e]}),[]),b=(0,a.useCallback)((function(e,t){var n;null===(n=p.current[e])||void 0===n||delete n[t]}),[]),y=(0,a.useCallback)((function(e,t){var n=g(e,t);n&&(n(),b(e,t))}),[g,b]),S=(0,a.useRef)(s),x=(0,C.useSessionState)(["sessionId","domain","loginId"]),j=x.sessionId,I=void 0===j?"":j,O=x.domain,_=void 0===O?"":O,A=x.loginId,E=void 0===A?"":A,P=(0,a.useCallback)((function(e){l((function(t){var n=e(t);return S.current=n,n}))}),[]),D=(0,a.useCallback)((function(e){var t;return e&&Object.values(null!==(t=s[e])&&void 0!==t?t:{})||[]}),[s]),R=(0,a.useCallback)((function(e,t){v.current.items=v.current.items.filter((function(n){return t!==n.id||e!==n.attachmentsGroupId}))}),[]),F=(0,a.useCallback)((function(e,t){var n=(0,N.uuid)();return P(f()((function(r){r[e]||(r[e]={}),r[e][n]=(0,d.castDraft)(M({id:n},t))}))),n}),[P]),B=(0,a.useCallback)((function(e,t,n){P(f()((function(r){r[e]||(r[e]={}),r[e][t]=M({},r[e][t],(0,d.castDraft)(n))})))}),[P]),U=(0,a.useCallback)((function(e,t){y(e,t),R(e,t),P(f()((function(n){n[e]&&delete n[e][t]})))}),[y,R,P]),z=(0,a.useCallback)(T((function(){var e,t,a,i,s,l,c;return k(this,(function(u){switch(u.label){case 0:return(e=v.current).pendingAmount>=1?[2]:(t=e.items.shift())?(e.pendingAmount++,a=t.id,i=t.attachmentsGroupId,s=t.file,(new FormData).append("file",s),l={data:o(t),tenant:_,token:I,user:E,fileName:s.name,fileType:"attachment"},[4,n(l,{onSuccess:function(t){g(i,a)&&(B(i,a,{id:a,file:s,isLoading:!1,fileData:t}),b(i,a)),e.pendingAmount--,z()},onError:function(t){g(i,a)&&(U(i,a),m(f()((function(e){e.push({file:s,errors:[t]})}))),null==r||r(i,t),b(i,a)),e.pendingAmount--,z()}})]):[2];case 1:return c=u.sent(),p.current[i]||(p.current[i]={}),p.current[i][a]=c,[2]}}))})),[_,g,o,r,E,U,b,I,B,n]),H=(0,a.useCallback)((function(e,t){var n=F(e,{isLoading:!0,file:t});v.current.items.push({id:n,attachmentsGroupId:e,file:t}),z()}),[F,z]),V=(0,a.useCallback)((function(e){h(e),P(f()((function(t){t[e]={}})))}),[h,P]),G=(0,a.useCallback)((function(e){h(e),P(f()((function(t){delete t[e]})))}),[h,P]),W=(0,a.useCallback)((function(e){var t=D(e);return!(null==t?void 0:t.length)||t.every((function(e){return!e.isLoading}))}),[D]),q=function(){var e=(0,C.useSessionState)(),t=e.serverOrigin,n=e.sessionId,r=e.loginId,o=e.domain;return{generateUrl:(0,a.useCallback)((function(e){var a={token:n,user:r,tenant:o,id:e,no_disposition:0},i=Object.keys(a).map((function(e){return"".concat(e,"=").concat(a[e])})).join("&");return"".concat(t,"/agentdesktop/agentdesktop/attachmentDownload?").concat(i)}),[t,n,r,o])}}().generateUrl,Y=(0,a.useCallback)((t=T((function(e,t){var n;return k(this,(function(r){return n=t.map(function(){var e=T((function(e){return k(this,(function(t){switch(t.label){case 0:return[4,(0,w.getFileFromUrl)(q(e.id),e.name)];case 1:return[2,t.sent()]}}))}));return function(t){return e.apply(this,arguments)}}()),Promise.all(n).then((function(t){t.forEach((function(t){H(e,t)}))})),[2]}))})),function(e,n){return t.apply(this,arguments)}),[H,q]);return(0,a.useMemo)((function(){return{fileRejections:u,setFileRejections:m,removeAttachmentsList:G,getAttachmentsList:D,removeAttachment:U,clearAttachmentsList:V,addAttachment:H,initializeAttachmentsList:Y,isAttachmentsListReady:W}}),[u,G,D,U,V,H,Y,W])}var R=(0,x.createContext)(_);R.displayName="ChatAttachmentsUIContext";var F=(0,I.createUIStateSelectorHook)(R,"chatAttachmentsUIState").useChatAttachmentsUIState,B=(0,x.createContext)(_);function U(e){var t=e.file,n=e.attachmentsGroupId,r=new FormData;return r.append("file",t),r.append("email",n),r}B.displayName="EmailAttachmentsUIContext";var z=(0,I.createUIStateSelectorHook)(B,"emailAttachmentsUIState").useEmailAttachmentsUIState,H=n(9478),V=n.n(H),G=n(324);function W(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,G.m6)(V()(t))}var q=n(6441),Y=n(5886),Q=n(9464),K=n(3764),$=n(9486);var X=n(6622),J=n(3194);var Z=n(7952);var ee=n(7194);var te=n(8202),ne=n(7421),re=n(7505),ae=n(3346),oe=new URL("http://localhost:9897");oe.searchParams.append("domain",location.hostname);var ie=oe.toString(),se="bpClient/onShowDomainAuthorizationDialog",le=n(8715),ce=n(3650),ue="cursor-pointer text-primary-legacy",de="ext-link",fe="ext-link-firefox",me="plugin-link",pe=function(e){var t=e.isExtAvailable,n=e.install,o=(0,$.useLocalizationState)().t.INSTALLATION_PROCESS,i=(0,ce.useInstallationMethods)(),s=i.installChromeExtension,l=i.installFirefoxExtension,c=i.installBPClientPlugin;(0,a.useEffect)((function(){var e=document.getElementById(de),t=document.getElementById(fe),n=document.getElementById(me);return null==e||e.addEventListener("click",s),null==t||t.addEventListener("click",l),null==n||n.addEventListener("click",c),function(){null==e||e.removeEventListener("click",s),null==t||t.removeEventListener("click",l),null==n||n.removeEventListener("click",c)}}),[s,l,c]);var u=o.install_updateHeader(me,ue);return n&&(u="chrome"===le.platformInfo.browser?t?o.install_installHeader(me,ue):o.install_installHeaderChrome(de,me,ue):"firefox"===le.platformInfo.browser?t?o.install_installHeader(me,ue):o.install_installHeaderFirefox(fe,me,ue):o.install_installHeader(me,ue)),(0,r.jsx)("div",{dangerouslySetInnerHTML:{__html:u}})},ve=n(6508);var ge=function(e){var t=e.browserName,n=(0,$.useLocalizationState)("t").INSTALLATION_PROCESS,a=(0,C.useSessionState)("serverOrigin"),o="chrome"===le.platformInfo.browser,i="firefox"===le.platformInfo.browser,s="safari"===le.platformInfo.browser,l="";return o?l=ce.URL_EXTENSION_INSTALLER_CHROME:i?l=a+ce.URL_EXTENSION_INSTALLER_FIREFOX:s&&(l=a+ce.URL_MAC_PLUGIN),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{children:n.bp_client_old_extension_version(t)}),(o||i||s)&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("br",{}),(0,r.jsx)("br",{}),(0,r.jsx)("span",{children:n.bp_client_update_extension_part1()}),(0,r.jsx)("a",{href:l,rel:"noopener noreferrer",target:"_blank",children:n.bp_client_update_extension_text()}),(0,r.jsx)("span",{children:n.bp_client_update_extension_part2()})]})]})},he=n(4432),be=function(){return location.reload()};var ye=n(1960),Se=5e3;function xe(){var e,t,n,r,o,i;e=(0,C.useSessionState)("emi"),t=(0,$.useLocalizationState)("t").ERROR_MESSAGES,n=(0,K.useNotificationsState)("methods"),r=n.showNotification,o=n.hideNotificationById,i=(0,w.useEvent)((function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";switch(e){case Q.incomingEMIErrorMessageCodes.unable_to_get_access_token:return t.msteams_access_token_error_message()+n;case Q.incomingEMIErrorMessageCodes.refresh_token_expired:return t.communicator_msteams_refresh_token_expired_error_message();case Q.incomingEMIErrorMessageCodes.user_deauthorized:return;case Q.incomingEMIErrorMessageCodes.no_integration_account:case Q.incomingEMIErrorMessageCodes.feature_disabled:case Q.incomingEMIErrorMessageCodes.no_emi_servers:return t.msteams_disabled();case Q.incomingEMIErrorMessageCodes.integration_account_changed:case Q.incomingEMIErrorMessageCodes.mismatched_directory_id:case Q.incomingEMIErrorMessageCodes.mismatched_client_id:return t.communicator_msteams_reset_by_admin_message();case Q.incomingEMIErrorMessageCodes.azure_user_deleted:return t.msteams_user_deleted();case Q.incomingEMIErrorMessageCodes.unsufficient_privileges:return t.msteams_unsufficient_privileges();default:return n}})),(0,a.useEffect)((function(){var t;if(null==e||null===(t=e.msteams)||void 0===t?void 0:t.errorCode){var n=i(e.msteams.errorCode,e.msteams.errorMessage);if(!n)return;r({type:"error",id:K.Notifications.MSTeamsIntegrationError,message:n})}else o("msteams_error_notification_id")}),[r,o,i,null==e?void 0:e.msteams]),function(){var e=(0,J.useInteractionStateConnector)(),t=(0,K.useNotificationsState)("methods").showNotification,n=(0,$.useLocalizationState)("t").GLOBAL,r=(0,w.useEvent)((function(e){var r=e.item;(0,j.isCallWithoutCallId)(r)&&t({type:"warning",id:K.Notifications.CallFailedDueNetworkIssueWarning,message:n.notification_callWithNoAnswer_networkProblem((0,X.formatDate)((new Date).getTime()))})}));(0,a.useEffect)((function(){return e.dispenser.subscribe({onItemCompleted:r}).unsubscribe}),[e,r])}(),function(){var e=(0,ee.useAgentState)(),t=e.notReadyReason,n=e.state,r=e.stateSetDate,o=e.systemNotReadyReasons,i=(0,K.useNotificationsState)("methods"),s=i.showNotification,l=i.hideNotificationById,c=(0,$.useLocalizationState)("t").GLOBAL,u=(0,w.useEvent)((function(){if(o)if("not_ready"===n&&t===o.noAnswer){var e=r&&(0,X.formatDate)(r),a=c.notification_agentInNotReadyNoAnswer('"No answer"',e||"[TIME]");s({type:"warning",id:K.Notifications.IncomingInteractionNotAcceptedError,message:a})}else l(K.Notifications.IncomingInteractionNotAcceptedError)}));(0,a.useEffect)((function(){u()}),[t,u])}(),function(){var e=(0,K.useNotificationsState)("methods"),t=e.showNotification,n=e.hideNotificationById,r=(0,C.useSessionState)("phoneDeviceIn"),o=(0,$.useLocalizationState)("t").ERROR_MESSAGES,i=(0,w.useEvent)((function(){r?(n(K.Notifications.PhoneDeviceNotDetectedError),t({type:"success",id:K.Notifications.PhoneDeviceDetectedMessage,message:o.device_detected(r),duration:5e3})):t({type:"error",id:K.Notifications.PhoneDeviceNotDetectedError,message:o.device_empty(),duration:5e3,showDelay:5e3})}));(0,a.useEffect)((function(){i()}),[r,i,n])}(),function(){var e=(0,K.useNotificationsState)("methods"),t=e.showNotification,n=e.hideNotificationById,r=(0,C.useSessionStateMethods)().startPhoneTypeSelection,o=(0,C.useSessionState)("phoneTypeErrorCode"),i=(0,$.useLocalizationState)("t").AUTHORIZATION_DIALOG_LABELS,s=(0,w.useEvent)((function(){2===o&&(t({type:"error",id:K.Notifications.BadPhoneExtensionError,message:i.auth_message_undefinedExtension()}),r()),o&&0!==o||n(K.Notifications.BadPhoneExtensionError)}));(0,a.useEffect)((function(){s()}),[o,s])}(),function(){var e=(0,K.useNotificationsState)("methods"),t=e.showNotification,n=e.hideNotificationById,r=(0,ee.useAgentState)().reservedForIncomingInteraction,o=(0,C.useSessionState)("isLoggedIn"),i=(0,$.useLocalizationState)("t").GLOBAL,s=(0,w.useEvent)((function(){o&&(r?t({type:"info",id:K.Notifications.ReservedForIncomingInteractionMessage,message:i.callback_reservation_header()}):n(K.Notifications.ReservedForIncomingInteractionMessage))}));(0,a.useEffect)((function(){s()}),[r,s])}(),function(){var e=(0,te.useInteractionChatStateConnector)(),t=(0,K.useNotificationsState)("methods").showNotification,n=(0,$.useLocalizationState)("t").ERROR_MESSAGES,r=(0,w.useEvent)((function(e){var r,a;switch(e){case"invalid_server":r="error",a=n.chat_web_rtc_invalid_ice_server();break;case"answer_timeout":r="info",a=n.chat_web_rtc_answer_timeout();break;case"already_exists":r="warning",a=n.chat_web_rtc_only_1_call_simultaneously()}t({type:r,id:K.Notifications.ChatWebRtcError,message:a,closable:!0,duration:1e4})}));(0,a.useEffect)((function(){return e.dispenser.subscribe({onWebRtcError:r}).unsubscribe}),[e,r])}(),function(){var e=(0,Z.useFavoritesStateConnector)(),t=(0,K.useNotificationsState)("methods").showNotification,n=(0,$.useLocalizationState)("t").FAVORITES,r=(0,w.useEvent)((function(){t({type:"error",id:K.Notifications.CallFailedDueNetworkIssueWarning,closable:!0,tags:["current-view"],message:n.favorites_limit_reached_error()})}));(0,a.useEffect)((function(){return e.dispenser.subscribe({onLimitReachedError:r}).unsubscribe}),[e,r])}()}function je(){var e,t,n,o,i,s,l,c,u,d,f,m;e=(0,ne.useBpClientStateConnector)(),t=(0,ae.useModalsStateMethods)(),n=t.openModal,o=t.closeModal,i=(0,$.useLocalizationState)("t"),s=(0,w.useEvent)((function(){n({id:se,title:i.INSTALLATION_PROCESS.bp_client_not_authorized_header(),body:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{children:i.INSTALLATION_PROCESS.bp_client_not_authorized_message_part1()}),(0,r.jsx)("a",{href:ie,rel:"noopener noreferrer",target:"_blank",children:i.ERROR_MESSAGES.domainAuthentificationErrorAnchor()}),(0,r.jsx)("span",{children:i.INSTALLATION_PROCESS.bp_client_not_authorized_message_part2()})]}),actions:function(e){var t=e.closeModal;return(0,r.jsx)(re.SmButton,{onClick:t,children:i.WINDOW_POPUP_TITLES_AND_MESSAGES.window_buttonOk()})}})})),l=(0,w.useEvent)((function(){o(se)})),(0,a.useEffect)((function(){return e.dispenser.subscribe({onShowDomainAuthorizationDialog:s,onHideDomainAuthorizationDialog:l}).unsubscribe}),[e,s,l]),function(){var e=(0,$.useLocalizationState)("t").WINDOW_POPUP_TITLES_AND_MESSAGES,t=(0,ne.useBpClientState)("isExtensionAvailable"),n=(0,ne.useBpClientStateConnector)(),o=(0,ae.useModalsStateMethods)().openModal,i=(0,w.useEvent)((function(n){o({title:e.window_title_warning(),body:(0,r.jsx)(pe,{install:n,isExtAvailable:t}),actions:{ok:{title:e.window_buttonOk()}}})}));(0,a.useEffect)((function(){return n.dispenser.subscribe({onInstallationRequired:i}).unsubscribe}),[n,i])}(),c=(0,K.useNotificationsState)("methods").showNotification,u=(0,ve.useOfflineStateMethods)().setShowOfflineAlert,d=(0,ve.useOfflineStateDataShowOfflineAlert)(),f=(0,ve.useOfflineErrorMessages)(),m=(0,ve.useIsOffline)(),(0,a.useEffect)((function(){d&&c({type:"error",id:K.Notifications.OfflineStateError,content:f.isOffline,closable:!0,duration:5e3,onHide:function(){return u(!1)}})}),[f.isOffline,u,c,d]),(0,a.useEffect)((function(){m||u(!1)}),[m,u]),function(){var e=(0,ne.useBpClientStateConnector)(),t=(0,$.useLocalizationState)("t").WINDOW_POPUP_TITLES_AND_MESSAGES,n=(0,ae.useModalsStateMethods)().openModal,o=(0,w.useEvent)((function(e){n({title:t.window_title_warning(),body:(0,r.jsx)(ge,{browserName:e}),actions:function(e){var n=e.closeModal;return(0,r.jsx)(re.SmButton,{onClick:n,children:t.window_buttonOk()})}})}));(0,a.useEffect)((function(){return e.dispenser.subscribe({onShowExtensionIsOldDialog:o}).unsubscribe}),[e,o])}(),function(){var e=(0,K.useNotificationsState)("methods"),t=e.showNotification,n=e.hideNotificationById,o=(0,he.useAppConfigState)("isClientOutdated"),i=(0,C.useSessionState)("isLoggedIn"),s=(0,$.useLocalizationState)("t").GLOBAL,l=(0,w.useEvent)((function(){i&&(o?t({type:"error",id:K.Notifications.OutdatedClientAppError,message:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{children:s.reload_confirm_new_msg_part1()}),(0,r.jsx)("a",{href:"#",onClick:be,children:s.reload_confirm_action_button_text()}),(0,r.jsx)("span",{children:s.reload_confirm_new_msg_part2()})]})}):n(K.Notifications.OutdatedClientAppError))}));(0,a.useEffect)((function(){l()}),[o,l])}(),function(){var e=(0,C.useSessionStateConnector)(),t=(0,ne.useBpClientState)("isHelperAppInstanceCreated"),n=(0,K.useNotificationsState)("methods"),r=n.showNotification,o=n.hideNotificationById,i=(0,C.useSessionState)("phoneType"),s=(0,$.useLocalizationState)("t"),l=(0,w.useEvent)((function(e){if(e.canDial||"phone_type_none"===i)ye.bpLogger.info("SIP phone or external line is in service"),o(K.Notifications.PhoneOutOfServiceError);else{var n;switch(ye.bpLogger.warn("SIP phone or external line is out of service"),i){case"phone_type_nailed":n=s.WINDOW_POPUP_TITLES_AND_MESSAGES.window_messages_virtual_phone_not_available();break;case"phone_type_soft_secure":case"phone_type_soft_unsecure":n=t?s.WINDOW_POPUP_TITLES_AND_MESSAGES.window_messages_phone_not_available():s.WINDOW_POPUP_TITLES_AND_MESSAGES.window_messages_helper_app_not_available();break;default:n=s.WINDOW_POPUP_TITLES_AND_MESSAGES.window_messages_phone_not_available()}r({type:"error",id:K.Notifications.PhoneOutOfServiceError,message:n,closable:!1,showDelay:Se})}})),c=(0,w.useEvent)((function(e,t){"agentServer"===e&&4===t&&r({type:"warning",id:K.Notifications.PhoneOutOfServiceError,message:s.ERROR_MESSAGES.phoneIsNotRegistered(),closable:!1,showDelay:Se})})),u=(0,w.useEvent)((function(){r({type:"warning",id:K.Notifications.PhoneOutOfServiceError,message:s.WINDOW_POPUP_TITLES_AND_MESSAGES.window_messages_3pcc_server_connectionLost(),closable:!1,showDelay:Se})})),d=(0,w.useEvent)((function(){o(K.Notifications.PhoneOutOfServiceError)}));(0,a.useEffect)((function(){return e.dispenser.subscribe({onUpdateCapabilities:l,onServerError:c,onThreePCCServerGone:u,onThreePCCServerReady:d}).unsubscribe}),[l,c,u,d,e])}(),function(){var e=(0,K.useNotificationsState)("methods"),t=e.showNotification,n=e.hideNotificationById,r=(0,$.useLocalizationState)("t").WINDOW_POPUP_TITLES_AND_MESSAGES,o=(0,C.useSessionState)("sipServer"),i=(0,w.usePreviousValueRef)(o),s=(0,w.useEvent)((function(){o?n(K.Notifications.SipServerConnectionError):i.current&&t({type:"error",id:K.Notifications.SipServerConnectionError,message:r.window_messages_3pcc_server_connectionLost()})}));(0,a.useEffect)((function(){s()}),[o,s])}(),function(){var e=(0,K.useNotificationsState)("methods"),t=e.showNotification,n=e.hideNotificationById,r=(0,$.useLocalizationState)("t").GLOBAL,o=(0,a.useRef)(0),i=(0,w.useEvent)((function(){0!==o.current||(o.current=(new Date).getTime(),fetch("/",{method:"HEAD",cache:"no-store"}).catch((function(e){return console.error(e)})).finally((function(){var e=(new Date).getTime()-o.current;if(o.current=0,e>800){var a=r.slow_connection();t({type:"error",id:K.Notifications.SlowNetworkConnectionError,message:a}),ye.bpLogger.warn("Slow connection detected")}else n(K.Notifications.SlowNetworkConnectionError)})))}));(0,a.useEffect)((function(){var e=setInterval(i,5e3);return function(){return clearInterval(e)}}),[i])}(),function(){var e=(0,K.useNotificationsState)("methods"),t=e.showNotification,n=e.hideNotificationById,o=(0,ne.useBpClientState)("isDomainAuthorized"),i=(0,$.useLocalizationState)("t").ERROR_MESSAGES,s=(0,w.useEvent)((function(){o?n(K.Notifications.DomainNotAuthorizedForBPClientError):t({type:"error",id:K.Notifications.DomainNotAuthorizedForBPClientError,closable:!1,message:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{children:i.domain_authentication_error_part1()}),(0,r.jsx)("a",{href:ie,rel:"noopener noreferrer",target:"_blank",children:i.domainAuthentificationErrorAnchor()}),(0,r.jsx)("span",{children:i.domain_authentication_error_part2()})]})})}));(0,a.useEffect)((function(){s()}),[o,s])}()}var Ie=function(e){var t=e.baseConnectors,n=e.authorizedConnectors,a=e.children;return je(),(0,r.jsx)(r.Fragment,{children:a(t,n)})},Oe=n(9572),_e=n(5100),Ce=n(7282),we=n(4778),Ne=function(){var e=(0,C.useSessionState)("forceLogoutInfo"),t=(0,C.useSessionStateMethods)().closeForceLogout,n=(0,Ce.useFormatting)().formatFullName,a=(0,$.useLocalizationState)().t;(0,we.assertDefined)(e);var o=n(e.firstName,e.lastName),i=(0,X.formatDate)(e.timestamp);return(0,r.jsx)(re.SmSegment,{padded:!0,className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2   overflow-hidden rounded-none border-none bg-transparent shadow-none",id:"login",children:(0,r.jsxs)(q.Modal,{isOpen:!0,size:"small",className:"max-w-[570px]","aria-describedby":"forceLogoutDialogDescription","data-testid":"forced-logout-modal",children:[(0,r.jsx)(q.Modal.Header,{children:a.WINDOW_POPUP_TITLES_AND_MESSAGES.window_title_information()}),(0,r.jsx)(q.Modal.Content,{children:(0,r.jsx)(q.Modal.Description,{id:"forceLogoutDialogDescription",children:(0,r.jsx)("p",{children:function(){switch(e.errorCode){case Q.incomingErrorMessageCodes.forced_logout_by_another_session:return a.ERROR_MESSAGES.sessionWasOverwritten();case Q.incomingErrorMessageCodes.forced_logout_by_supervisor:return a.ERROR_MESSAGES.forcedLogout(o,i);case Q.incomingErrorMessageCodes.forced_logout_by_disabling_tenant:case Q.incomingErrorMessageCodes.forced_logout_by_disabling_user:return a.ERROR_MESSAGES.account_has_been_disabled()}return e.forceLogoutReason}()})})}),(0,r.jsx)(q.Modal.Actions,{children:(0,r.jsx)(re.SmButton,{onClick:t,primary:!0,"data-testid":"ok-button",children:a.WINDOW_POPUP_TITLES_AND_MESSAGES.window_buttonOk()})})]})})},Ae=function(){var e=(0,Oe.useCurrentTabRole)(),t=(0,C.useSessionState)(["authChecked","isLoggedIn","showLoginDialog","offerForceLogin","forceLogoutInfo"]),n=t.authChecked,a=t.isLoggedIn,o=t.showLoginDialog,i=t.offerForceLogin,s=t.forceLogoutInfo,l=!(0,$.useLocalizationState)("language")||"undecided"===e&&!n,c=!l&&(o||!a),u=!!s&&c,d=i&&!s&&c;return(0,r.jsxs)("div",{className:"mx-auto h-full w-[496px]",children:[l&&(0,r.jsx)(q.Loader,{active:!0,size:"huge",color:"primary"}),c&&(0,r.jsx)(_e.LoginPage,{}),u&&(0,r.jsx)(Ne,{}),d&&(0,r.jsx)(_e.ForceLogin,{})]})},Ee=o().memo((function(e){var t=e.baseConnectors,n=e.children;return(0,C.useSessionState)("isLoggedIn")?(0,r.jsx)(Y.AuthorizedProviders,{baseConnectors:t,children:function(e){return(0,r.jsx)(Ie,{baseConnectors:t,authorizedConnectors:e,children:n})}}):(0,r.jsx)(Ae,{})})),Te=n(1980),Pe=function(e){var t=e.baseConnectors,n=e.children,a=e.BaseConnectorsConsumer;return a?(0,r.jsx)(a,{baseConnectors:t,children:n}):n},Me=function(e){var t=e.app,n=e.platformSpecific,a=e.BaseConnectorsConsumer,o=e.children;return(0,r.jsx)(Y.BaseProviders,{platformSpecific:n,app:t,children:function(e){return(0,r.jsx)(Pe,{baseConnectors:e,BaseConnectorsConsumer:a,children:(0,r.jsx)(Te.Tooltip.Provider,{children:(0,r.jsx)(K.NotificationsStateProvider,{children:o(e)})})})}})},Le=function(e){var t=e.app,n=e.platformSpecific,a=e.children,o=e.BaseConnectorsConsumer,i=e.className,s=e.appRemoteName;return(0,r.jsx)(q.AppStyleSelector,{app:s,children:(0,r.jsx)("div",{className:W("h-full",i),children:(0,r.jsx)(Me,{app:t,platformSpecific:n,BaseConnectorsConsumer:o,children:function(e){return(0,r.jsx)(Ee,{baseConnectors:e,children:a})}})})})},ke=n(5770),De=n(5319),Re=n(7773),Fe=n(2506),Be=n(7500),Ue=n(2469),ze=n(801),He=n(4878),Ve=n(533);function Ge(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function We(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function qe(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Ye(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function Qe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||$e(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ke(e){return function(e){if(Array.isArray(e))return Ge(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||$e(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $e(e,t){if(e){if("string"==typeof e)return Ge(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ge(e,t):void 0}}var Xe=function(e){var t,n=e.onClose,o=e.service,i=e.onSave,s=Ye(e,["onClose","service","onSave"]),l=(0,$.useLocalizationState)().t,c=(0,Ve.useServicesDispositions)()[o],u=(0,Ve.useServicesDispositionsState)((function(e){return e.services[o].requireDispositions})),d=(0,a.useMemo)((function(){return(0,we.truthy)([u&&{text:l.DISPOSITION.disposition_not_selected(),value:""}].concat(Ke(Object.values(null!=c?c:{}).filter((function(e){return"SUCCESS"===e.type&&"Final"===e.group})).map((function(e){return{text:e.name,value:e.id}})))))}),[u,c,l.DISPOSITION]),f=Qe((0,a.useState)(null===(t=d[0])||void 0===t?void 0:t.value),2),m=f[0],p=f[1];return(0,r.jsxs)(q.Modal,qe(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){We(e,t,n[t])}))}return e}({onClose:n,className:"relative max-w-90 overflow-hidden","aria-labelledby":"set_disposition_modal","data-testid":"SetDispositionModal"},s),{children:[(0,r.jsx)(q.Modal.Header,{role:"heading",id:"set_disposition_modal",children:l.GLOBAL.select_disposition_dialog_header()}),(0,r.jsx)(q.Modal.Content,{children:(0,r.jsx)(q.Dropdown,{options:d,value:m,onChange:function(e,t){return"string"==typeof t.value&&p(t.value)},placeholder:l.DISPOSITION.disposition_selectDisposition()})}),(0,r.jsxs)(q.Modal.Actions,{children:[(0,r.jsx)(q.SemanticButton,{onClick:function(){return n()},children:l.WINDOW_POPUP_TITLES_AND_MESSAGES.window_buttonCancel()}),(0,r.jsx)(q.SemanticButton,{primary:!0,onClick:function(){var e=m?c[m]:void 0;i(e&&{id:e.id,name:e.name}),n()},disabled:u&&!m,children:l.WINDOW_POPUP_TITLES_AND_MESSAGES.window_buttonOk()})]})]}))};function Je(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ze(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Je(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Je(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var et=function(e){var t=e.initialStatus,n=e.caseId,o=e.initialPendingReasonId,i=e.service,s=(0,$.useLocalizationState)().t,l=(0,w.useBoolean)(),c=Ze((0,a.useState)(t),2),u=c[0],d=c[1],f=(0,a.useMemo)((function(){return[{text:s.GLOBAL.case_status_open(),value:"Open"},{text:s.GLOBAL.case_status_pending(),value:"Pending"},{text:s.GLOBAL.case_status_resolved(),value:"Resolved"}]}),[s]),m=(0,He.useCaseStateMethods)().setCaseStatus,p=(0,Ve.useServicesDispositionsState)((function(e){return e.services[i].useDispositions})),v=(0,ae.useModalComponentOpener)(Xe),g=Ze((0,a.useState)(o),2),h=g[0],b=g[1],y=(0,He.useCaseState)("casePendingReasons"),S=(0,a.useMemo)((function(){return y.data.map((function(e){var t=e.id;return{text:e.name,value:t}}))}),[y.data]),x="Pending"===u?o===h:t===u;return(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[!!S.length&&(0,r.jsx)(q.Dropdown,{options:S,placeholder:s.GLOBAL.case_pending_reason_selector_no_value(),selection:!0,value:h,onChange:function(e,t){var n=t.value;return"string"==typeof n&&b(n)}}),(0,r.jsxs)("div",{className:"flex h-9 shrink-0 rounded border border-primary-legacy hover:border-primary-hover active:border-primary-active",children:[(0,r.jsx)(q.Popup,{show:l.value,content:(0,r.jsx)(re.SmList,{divided:!0,children:f.map((function(e){var t=e.text,n=e.value;return(0,r.jsx)(re.SmList.Item,{children:(0,r.jsx)(q.Button,{onClick:function(){d(n),l.setFalse()},className:"w-full p-2",children:t})},n)}))}),onClickOutside:l.setFalse,placement:"bottom",children:(0,r.jsx)(q.SemanticButton,{icon:l.value?"chevron up":"chevron down",primary:!0,basic:!0,onClick:l.toggle,className:"rounded-r-none bg-transparent !shadow-none"})}),(0,r.jsxs)(q.SemanticButton,{onClick:function(){return function(e){switch(e){case"Pending":var t=y.data.find((function(e){return e.id===h}));return m({caseId:n,status:e,pendingReason:t});case"Resolved":if(!p)return m({caseId:n,status:e});v({service:i,onSave:function(t){m({caseId:n,status:e,disposition:t})}});break;default:m({caseId:n,status:e})}}(u)},disabled:x,className:"shrink-0 rounded-l-none border-l border-main-border bg-transparent pl-0 font-normal text-primary-legacy",children:["".concat(s.GLOBAL.submitAs(),": ").concat(u),!x&&(0,r.jsx)(re.SmIcon,{className:"ml-1 mr-0",name:"check"})]})]})]})},tt=function(e){var t=e.caseId,n=(0,He.useCaseState)((function(e){var n;return t?null===(n=e.cases[t])||void 0===n?void 0:n.data:void 0})),a=(0,$.useLocalizationState)().t,o=null==n?void 0:n.pendingReasonId,i=null==n?void 0:n.status,s=(0,J.useActiveInteractionStepId)(),l=(0,J.useActiveInteractionProp)(j.getServiceId),c=(0,He.useCaseStateMethods)().createEmailDraft;return l&&i?(0,r.jsxs)("div",{className:"flex w-full flex-wrap justify-between gap-y-2",children:[(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(q.SemanticButton,{icon:"sticky note",basic:!0,tooltip:a.CASE_SEARCH.new_case_notes_button_tooltip()}),(0,r.jsx)(q.SemanticButton,{icon:"envelope",basic:!0,tooltip:a.EMAIL.email_new_email_draft(),onClick:function(){c({interactionStepId:s})}})]}),(0,r.jsx)(et,{caseId:t,initialPendingReasonId:o,service:l,initialStatus:i},t)]}):null},nt=n(9073),rt=n(7422),at=n(5603),ot=function(e,t){return["queue",e,t].filter(Boolean)},it=function(e){return["queueCount",e].filter(Boolean)},st=function(){return["queueCountByService"]},lt=function(e){return["getEmail",e]},ct=function(e){return["searchEmails",e]};function ut(e){var t=(0,C.useSessionState)("serverOrigin");return(0,rt.useQuery)({enabled:!!e,queryKey:lt(e),queryFn:function(){return(0,at.apiRequests)(t).getEmail({emailId:e})},staleTime:5*w.MS_IN_MINUTE})}var dt=n(4915);function ft(e){return{id:e.address,displayText:(0,X.formatEmail)(e),address:e.address,name:e.name}}function mt(e){return{address:e.address,name:e.name}}function pt(e,t){return{emailId:e,html:t.html,text:(0,dt.formatHTMLAsMultiLineString)(t.html),subject:t.subject,attachments:t.attachments,to:t.to.map(mt),cc:t.cc.map(mt),bcc:t.bcc.map(mt)}}function vt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function gt(e){var t=(0,C.useSessionState)("serverOrigin"),n=(0,rt.useQueryClient)(),r=z("getAttachmentsList"),a=(0,w.useAsRef)(r(e));return(0,rt.useMutation)({mutationKey:["saveDraft",e],mutationFn:function(r){return n.setQueryData(lt(e),(function(e){return e&&function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){vt(e,t,n[t])}))}return e}({},e,(t=r,n=a.current,{content:t.html,subject:t.subject,attachments:n.map((function(e){var t=e.id,n=e.file;return{id:t,name:n.name,size:n.size}})),toAddresses:t.to.map(mt),ccAddresses:t.cc.map(mt),bccAddresses:t.bcc.map(mt)}));var t,n})),(0,at.apiRequests)(t).saveEmailDraft({requestBody:pt(e,r)})}})}var ht=function(e){return{value:e.id,text:e.name,"data-testid":"option","data-service":"true"}};function bt(){var e=(0,Ve.useServicesDispositionsState)().services;return(0,a.useMemo)((function(){return Object.values(e).filter((function(e){return"EMAIL"===e.type})).map(ht)}),[e])}function yt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function St(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return yt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return yt(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var xt=function(e){var t=e.itemId,n=e.emailId,i=e.serviceId,s=(0,$.useLocalizationState)().t,l=St(o().useState(i),2),c=l[0],u=l[1];(0,a.useEffect)((function(){u(i)}),[i]);var d=bt(),f=(0,J.useInteractionStateMethods)().changeEmailService;return(0,r.jsx)(q.Dropdown,{options:d,value:c,onChange:function(e,r){var a=r.value;if("string"!=typeof a)throw Error("Invalid type in email service selector");u(a),f({serviceId:a,emailId:n,itemId:t})},placeholder:s.GLOBAL.service_selector_no_value(),selectOnBlur:!1,"data-testid":"service-selector",selection:!0})};function jt(e,t,n,r,a,o,i){try{var s=e[o](i),l=s.value}catch(c){return void n(c)}s.done?t(l):Promise.resolve(l).then(r,a)}function It(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){jt(o,r,a,i,s,"next",e)}function s(e){jt(o,r,a,i,s,"throw",e)}i(void 0)}))}}function Ot(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(s){o=[6,s],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var _t="w-6 p-2.5 shrink-0",Ct=function(e){var t=e.interactionId,n=e.serviceId,o=e.emailId,i=e.form,s=e.className,l=(0,$.useLocalizationState)().t.EMAIL,c=(0,J.useInteractionStateMethods)(),u=c.sendEmailDraft,d=c.saveEmailDraft,f=gt(o).mutateAsync,p=(0,J.useInteractionProp)(t,j.getServiceId),v=(0,J.useInteractionProp)(t,j.getInteractionStepId),g=(0,J.useInteractionProp)(t,(function(e){var t,n;return 1===(null==e||null===(n=e.emailData)||void 0===n||null===(t=n.activeDrafts)||void 0===t?void 0:t.length)})),h=z("addAttachment"),b=(0,He.useCaseStateMethods)().discardEmailDraft,y=(0,a.useCallback)((function(e){var t;(t=function(){var t=e.target;return t.files?Array.from(t.files):[]}())&&t.forEach((0,m.partial)(h,o))}),[h,o]);function S(){return(S=It((function(){return Ot(this,(function(e){switch(e.label){case 0:return[4,f(i.getValues())];case 1:return e.sent(),u({itemId:t,emailId:o}),[2]}}))}))).apply(this,arguments)}function x(){return(x=It((function(){return Ot(this,(function(e){return g?(i.reset(),f(i.getValues()),d({itemId:t,emailId:o})):b({interactionStepId:v,emailId:o}),[2]}))}))).apply(this,arguments)}return(0,r.jsxs)("footer",{className:W("flex w-full items-end gap-3 rounded p-2 pr-4 shadow transition-all",s),children:[(0,r.jsx)(q.SemanticButton,{icon:"paper plane",transparent:!0,disabled:!p,className:_t,onClick:function(){return S.apply(this,arguments)},tooltip:l.email_send_button_tooltip()}),(0,r.jsx)(xt,{itemId:t,serviceId:n,emailId:o}),(0,r.jsx)("div",{className:"flex-auto",id:"email-editor-toolbar-".concat(o)}),(0,r.jsxs)("div",{className:"flex gap-1",children:[(0,r.jsx)(q.AttachButton,{className:_t,handleUploadFiles:y,tooltip:l.email_addAttachment_button_tooltip()}),(0,r.jsx)(q.SemanticButton,{icon:"trash",className:_t,onClick:function(){return x.apply(this,arguments)},tooltip:l.email_deleteDraft_button_tooltip(),transparent:!0})]})]})},wt=n(5733),Nt=n(4225);function At(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Et(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Tt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Et(e,t,n[t])}))}return e}function Pt(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Mt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return At(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return At(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Lt=function(e){var t=e.suggestedItems,n=e.showEmailSuggestions,o=e.selectionInputRootRef,i=e.onSelect,s=Mt((0,a.useState)(null),2),l=s[0],c=s[1],u=Mt((0,a.useState)(void 0),2),d=u[0],f=u[1],p=(0,Nt.usePopper)(d,l,{placement:"bottom-start"}),v=p.styles,g=p.attributes,h=p.update,b=(0,a.useCallback)((function(e){n.setFalse(),i(e)}),[i,n]),y=Mt((0,a.useState)(t[0]),2),S=y[0],x=y[1];return(0,a.useLayoutEffect)((function(){f(function(e){var t=document.activeElement,n=(null==e?void 0:e.contains(t))&&(0,dt.isHTMLInputElement)(t);if(!t||!n)return;return t}(o.current))}),[o]),(0,a.useLayoutEffect)((function(){n.value&&(null==h||h())}),[n.value,h]),(0,a.useEffect)((function(){var e=function(e){if("ArrowDown"===e.key){e.stopPropagation();var n=(t.findIndex((function(e){return e.id===(null==S?void 0:S.id)}))+1)%t.length;x(t[n])}else if("ArrowUp"===e.key){e.stopPropagation();var r=t.findIndex((function(e){return e.id===(null==S?void 0:S.id)})),a=0===r?t.length-1:r-1;x(t[a])}else"Enter"===e.key&&(e.stopPropagation(),b(S))},n=o.current;return S&&(null==n||n.addEventListener("keydown",e)),function(){null==n||n.removeEventListener("keydown",e)}}),[b,o,S,n,t]),(0,r.jsx)(q.ClickOutsideWrapper,{show:n.value,onClickOutside:n.setFalse,children:(0,r.jsx)("div",Pt(Tt({ref:c,className:"bottom-auto right-auto z-[10000] transform-none rounded border bg-primary-contrast p-2 shadow",style:v.popper},g.popper),{children:t.map((function(e,t){return(0,r.jsx)(q.Button,{"data-element":"email-suggestion",className:W("block w-full p-2",{"bg-blue-50":(null==S?void 0:S.id)===e.id}),onClick:(0,m.partial)(b,e),children:e.displayText},t)}))}))})};function kt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Dt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||Ft(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Rt(e){return function(e){if(Array.isArray(e))return kt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Ft(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ft(e,t){if(e){if("string"==typeof e)return kt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?kt(e,t):void 0}}function Bt(e,t){var n=Dt((0,a.useState)(""),2),r=n[0],o=n[1],i=Dt((0,a.useState)(""),2),s=i[0],l=i[1],c=(0,nt.useController)({name:e,control:t,defaultValue:[]}).field;(0,w.useDidUnmount)((function(){c.onChange(void 0)}));var u=(0,a.useRef)((0,m.debounce)(l,200)).current,d=function(e){c.onChange(Rt(c.value).concat([e])),o("")},f=function(e){var t=(0,C.useSessionState)("serverOrigin");return(0,rt.useQuery)({queryKey:ct(e),enabled:e.length>2,queryFn:function(){return(0,at.apiRequests)(t).getContactListByEmail({query:e})}})}(s),p=f.data,v=(0,Ce.useFormatting)().formatFullName,g=(0,a.useMemo)((function(){var e=function(e){return v(e.contactFirstName,e.contactLastName)};return(null==p?void 0:p.filter((function(e){return!!e.email})).map((function(t){return{id:t.email,address:t.email,name:e(t),displayText:(0,X.formatEmail)({address:t.email,name:e(t)}),contactId:t.contactId}})))||[]}),[v,p]);return{value:r,selectedItems:c.value,handleOnChange:function(e){o(e),u(e)},addSelectedItem:d,addCustomEmail:function(e){d({id:e,displayText:e,address:e})},removeSelectedItem:function(e){c.onChange(c.value.filter((function(t){return t.address!==e.address})))},suggestedItems:g}}function Ut(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function zt(e){return function(e){if(Array.isArray(e))return Ut(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Ut(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ut(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Ht=function(e){var t=e.label,n=e.name,o=e.control,i=(0,$.useLocalizationState)().t,s=(0,w.useBoolean)(),l=Bt(n,o),c=l.selectedItems,u=l.suggestedItems,d=l.addCustomEmail,f=l.addSelectedItem,p=l.handleOnChange,v=l.removeSelectedItem,g=l.value;(0,a.useEffect)((function(){s.toggle(!!u.length)}),[u]);var h=(0,nt.useWatch)({name:"to",control:o}),b=(0,nt.useWatch)({name:"cc",control:o}),y=(0,nt.useWatch)({name:"bcc",control:o}),S=(0,a.useMemo)((function(){var e=zt(null!=h?h:[]).concat(zt(null!=b?b:[]),zt(null!=y?y:[]));return(0,m.uniqBy)(u.filter((function(t){return!e.some((function(e){return e.address===t.address}))})),"address")}),[y,b,u,h]),x=(0,a.useRef)(null);return(0,r.jsxs)("div",{ref:x,className:"flex flex-auto overflow-auto",children:[(0,r.jsx)("label",{className:"leading-[34px]",children:t}),(0,r.jsx)(q.SelectionInput,{items:c,className:"w-full border-none",value:g,onChange:p,validateCustomValue:function(e){return e&&!new RegExp(wt.EMAIL_REGEX).test(e)?(s.setFalse(),{valid:!1,message:i.ERROR_MESSAGES.error_email_format()}):{valid:!0}},addCustomValue:d,onItemRemoved:v,autoFocus:!0}),s.value&&(0,r.jsx)(Lt,{showEmailSuggestions:s,suggestedItems:S,onSelect:f,selectionInputRootRef:x})]})};var Vt=".ad-user-footer",Gt=".ad-user-header";function Wt(e,t,n,r,a,o,i){try{var s=e[o](i),l=s.value}catch(c){return void n(c)}s.done?t(l):Promise.resolve(l).then(r,a)}function qt(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){Wt(o,r,a,i,s,"next",e)}function s(e){Wt(o,r,a,i,s,"throw",e)}i(void 0)}))}}function Yt(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function Qt(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(s){o=[6,s],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function Kt(e){var t,n,r,o=e.draft,i=e.form,s=(0,C.useSessionState)("userId"),l=ut(o.emailId),c=l.data,u=l.isFetched,d=ut(null!==(t=o.referencedEmailId)&&void 0!==t?t:"").data,f=null!==(n=null==d?void 0:d.langTag)&&void 0!==n?n:void 0,m=(0,He.useCaseStateMethods)().getEmailTemplate,p=gt(o.emailId).mutate,v=(0,w.useEvent)(p),g=null!==(r=null==c?void 0:c.headerFooterUserId)&&void 0!==r?r:void 0;(0,a.useEffect)((function(){function e(){return(e=qt((function(){var e,t;return Qt(this,(function(n){switch(n.label){case 0:return!u||g&&g===s?[3,2]:[4,m(f)];case 1:if(e=n.sent(),i.setValue("headerFooterUserId",s),!e)return[2];g?function(e){var t=i.getValues("html"),n=(0,w.stringToHTML)(t);if(e.header){var r,a=n.querySelector(Gt);null==a||null===(r=a.parentNode)||void 0===r||r.replaceChild((0,w.stringToHTML)(e.header),a)}if(e.footer){var o,s=n.querySelector(Vt);null==s||null===(o=s.parentNode)||void 0===o||o.replaceChild((0,w.stringToHTML)(e.footer),s)}i.setValue("html",n.innerHTML)}(e):function(e){i.setValue("html",e.header+"<div>".concat(i.getValues("html"),"</div>")+e.footer)}(e),v(i.getValues()),null==(t=function(e){var t,n=document.querySelector('[data-email-editor-id="'.concat(e,'"]>div')),r=null==n||null===(t=n.querySelector(Gt))||void 0===t?void 0:t.nextSibling;if(Yt(r,HTMLElement))return r}(o.emailId))||t.scrollIntoView(),n.label=2;case 2:return[2]}}))}))).apply(this,arguments)}!function(){e.apply(this,arguments)}()}),[o.emailId,u,g,f,s,m,i,v])}function $t(e,t){var n=(0,J.useInteractionStateConnector)(),r=(0,w.useAsRef)(t);(0,a.useEffect)((function(){var t=n.dispenser.subscribe({onPasteFromKB:function(t,n){if(e===t){var a=function(e,t){var n=(0,w.stringToHTML)(e),r=n.querySelector(Vt);if(r)return n.insertBefore((0,w.stringToHTML)(t),r),n.innerHTML;return e+t}(r.current.getValues("html"),n);r.current.setValue("html",a)}}});return function(){t.unsubscribe()}}),[e,n,r])}var Xt=n(9969),Jt={branding:!0,browser_spellcheck:!0,contextmenu:"",convert_urls:!1,default_font_format:{fontFamily:"Arial",fontSize:"14px",color:"#000",defaultFontStyle:"14px Arial"},default_link_target:"_blank",elementpath:!0,end_container_on_empty_block:!1,extended_valid_elements:"altglyph,altglyphdef,altglyphitem,animatecolor,animatemotion,animatetransform,circle,clippath,defs,desc,ellipse,feBlend,feColorMatrix,feComponentTransfer,feComposite,feConvolveMatrix,feDiffuseLighting,feDisplacementMap,feDistantLight,feDropShadow,feFlood,feFuncA,feFuncB,feFuncG,feFuncR,feGaussianBlur,feMerge,feMergeNode,feMorphology,feOffset,fePointLight,feSpecularLighting,feSpotLight,feTile,feTurbulence,filter,font,font-face,font-face-format,font-face-name,g,glyph,glyphref,hkern,image,line,lineargradient,marker,mask,metadata,mpath,path,pattern,polygon,polyline,radialgradient,rect,stop,svg,switch,symbol,text,textpath,title,tref,tspan,use,view,vkern,font[color|face|size],dir",external_plugins:{default_font:"custom_plugins/default_font.js",img_resize_handler:"custom_plugins/img_resize_handler.js",insert_video:"custom_plugins/insert_video.js"},file_picker_types:"image media",font_formats:["Arial","Calibri","Courier New","Cursive","Georgia","Impact","Monospace","Sans Serif","Serif","Times New Roman","Trebuchet MS","Verdana"].map((function(e){return e+"="+e})).join(";"),fontsize_formats:[8,10,12,14,16,18,24,36].map((function(e){return e+"px"})).join(" "),inline:!1,invalid_elements:"applet,area,audio,basefont,data,datalist,details,dialog,embed,fieldset,footer,form,frame,frameset,head,header,html,iframe,input,label,legend,link,main,map,meta,noframes,noscript,object,optgroup,option,output,param,picture,script,select,source,style,summary,template,textarea,title,track,video",image_download_proxy:"WE DON`T HAVE PRODUCTION PROXY",menubar:"",max_height:600,min_height:300,width:"100%",padd_empty_with_br:!0,paste_block_drop:!1,paste_data_images:!0,paste_enable_default_filters:!1,paste_merge_formats:!1,plugins:["advlist","anchor","autolink","charmap","code","codesample","directionality","fullscreen","help","hr","image","imagetools","importcss","insertdatetime","link","lists","nonbreaking","noneditable","paste","preview","print","quickbars","searchreplace","table","template","textpattern","toc","visualblocks","visualchars","wordcount"],quickbars_insert_toolbar:!1,quickbars_selection_toolbar:"\n        | bold italic underline strikethrough \n        | forecolor backcolor removeformat",remove_trailing_brs:!1,toolbar:"\n        | undo redo\n        | alignleft aligncenter alignright alignjustify \n        | outdent indent\n        | numlist bullist\n        | fontselect fontsizeselect formatselect forecolor\n        | charmap blockquote\n        | insertfile image insert_video table link anchor codesample \n        | fullscreen fullscreen_inline preview print \n        | variables\n    ",toolbar_items_size:"small",toolbar_mode:"sliding",toolbar_persist:!1,toolbar_sticky:!1,valid_children:"+dir[li]"};function Zt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function en(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function tn(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function nn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Zt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Zt(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var rn=function(e){var t=e.control,n=e.emailId,o=e.inputRef,i=e.referencedEmailId,s=(0,nt.useController)({name:"html",control:t}).field,l=nn((0,a.useState)(!0),2),c=l[0],u=l[1],d=(0,a.useCallback)((function(){return u(!1)}),[]),f=(0,a.useMemo)((function(){return tn(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){en(e,t,n[t])}))}return e}({},Jt),{inline:!0,inline_boundaries:!1,fixed_toolbar_container:"#email-editor-toolbar-".concat(n),init_instance_callback:function(e){e.fire("focus")},setup:function(e){e.on("blur",(function(){return!1}))}})}),[]),m=(0,a.useCallback)((function(e){s.onChange(e)}),[s]);(0,we.assertDefined)("/agent/");var p,v="email-wysiwyg-editor:".concat(n);return(0,r.jsxs)("div",{className:W("relative mb-4 flex w-full flex-auto","[&>div]:flex-auto"),"data-test-id":v,"data-email-editor-reference-id":i,"data-email-editor-id":n,children:[(0,r.jsx)(Xt.M,{ref:o,id:v,init:f,onEditorChange:m,onInit:d,tinymceScriptSrc:(p="/agent/","".concat(p,"/static/js/tinymce/tinymce.js")),value:s.value}),c&&(0,r.jsx)(q.Loader,{active:!0,color:"primary",size:"medium"})]})};function an(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function on(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){an(e,t,n[t])}))}return e}function sn(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}var ln="flex items-center border-t border-main-border pt-2",cn=function(e){var t,n,o,i,s,l=e.emailId,c=e.referencedEmailId,u=ut(l),d=u.data,f=u.isSuccess,p=(0,nt.useForm)({values:{to:null!==(t=null==d?void 0:d.toAddresses.map(ft))&&void 0!==t?t:[],cc:null!==(n=null==d?void 0:d.ccAddresses.map(ft))&&void 0!==n?n:[],bcc:null!==(o=null==d?void 0:d.bccAddresses.map(ft))&&void 0!==o?o:[],subject:null!==(i=null==d?void 0:d.subject)&&void 0!==i?i:"",html:null!==(s=null==d?void 0:d.content)&&void 0!==s?s:"",headerFooterUserId:null==d?void 0:d.headerFooterUserId,attachments:[]}});Kt({draft:e,form:p}),function(e){var t=e.emailId,n=e.form,r=(0,a.useRef)(n.getValues()),o=gt(t).mutate,i=(0,a.useCallback)((function(){var e=n.getValues();(0,m.isEqual)(e,r.current)||(o(e),r.current=e)}),[n,o]);(0,a.useEffect)((function(){var e=setInterval((function(){i()}),5e3);return function(){return clearInterval(e)}}),[i]),(0,w.useDidUnmount)(i)}({emailId:l,form:p}),$t(e.interactionId,p);var v=(0,w.useBoolean)(),g=(0,w.useBoolean)(),h=(0,$.useLocalizationState)().t.EMAIL,b=(0,nt.useController)({control:p.control,name:"subject"}).field,y=z(["getAttachmentsList","removeAttachment"]),S=y.getAttachmentsList,x=y.removeAttachment,j=(0,a.useMemo)((function(){return S(l)}),[l,S]);return function(e){var t=e.attachmentsList,n=e.control,r=e.email,o=e.emailLoaded,i=(0,w.useBoolean)(),s=(0,nt.useController)({control:n,name:"attachments"}).field.onChange,l=z("initializeAttachmentsList"),c=null==r?void 0:r.attachments;(0,a.useEffect)((function(){o&&!i.value&&(i.setTrue(),(null==c?void 0:c.length)&&(null==r?void 0:r.id)&&l(r.id,c))}),[null==r?void 0:r.id,o,c,l,i]),(0,a.useEffect)((function(){s((0,we.truthy)(t.map((function(e){var t=e.fileData;return null==t?void 0:t.id}))))}),[t,n,s])}({email:d,attachmentsList:j,control:p.control,emailLoaded:f}),(0,r.jsxs)("div",{className:"p-2",children:[(0,r.jsxs)("div",{className:"rounded border border-main-border p-2",children:[(0,r.jsxs)("div",{className:"group min-h-10",children:[(0,r.jsxs)("section",{className:"flex justify-between",children:[(0,r.jsx)(Ht,{name:"to",control:p.control,label:h.email_address_to_prefix()}),(0,r.jsxs)("div",{className:"hidden shrink-0 group-focus-within:block",children:[(0,r.jsx)(q.Button,{className:W("block text-sm",{"text-primary-legacy":v.value}),onClick:v.toggle,children:h.email_address_cc_prefix()}),(0,r.jsx)(q.Button,{className:W("block text-sm",{"text-primary-legacy":g.value}),onClick:g.toggle,children:h.email_address_bcc_prefix()})]})]}),v.value&&(0,r.jsx)(Ht,{name:"cc",control:p.control,label:h.email_address_cc_prefix()}),g.value&&(0,r.jsx)(Ht,{name:"bcc",control:p.control,label:h.email_address_bcc_prefix()})]}),(0,r.jsxs)("section",{className:W(ln,"h-10 pb-2"),children:[(0,r.jsx)("label",{children:h.email_subject()}),(0,r.jsx)("input",sn(on({},b),{className:"w-full pl-2"}))]}),(0,r.jsxs)("section",{className:W(ln,"min-h-56 flex-col pb-2",{"min-h-80":j.length}),children:[(0,r.jsx)(rn,{control:p.control,emailId:l,referencedEmailId:c}),!!j.length&&(0,r.jsx)(q.AttachmentsList,{list:j,className:"mb-2",removeAttachment:x,attachmentsListGroupId:l}),(0,r.jsx)(Ct,sn(on({},e),{form:p}))]})]}),!1]})},un=n(8770),dn=n(8269),fn=n(5977),mn=(0,fn.createSelector)((function(e){return e.parties}),(function(e){var t=new Set;return null==e||e.forEach((function(e){"CONTACT"!==e.partyType&&e.disposition&&t.add(e.disposition)})),Array.from(t)})),pn=((0,fn.createSelector)((function(e){return e.parties}),(function(e){var t=new Set;return null==e||e.forEach((function(e){"CONTACT"!==e.partyType&&e.notes&&t.add(e.notes)})),Array.from(t)})),function(e){return(0,fn.createSelector)(function(e){return(0,fn.createSelector)((function(e){return e.parties}),(function(t){var n=new Set;return null==t||t.forEach((function(t){if("CONTACT"!==t.partyType){var r=e(t.firstName,t.lastName);r&&n.add(r)}})),Array.from(n)}))}(e),(function(e){return e.join(", ")}))}),vn=(0,fn.createSelector)((function(e){return e.services}),(function(e){var t;return null==e||null===(t=e.map((function(e){return e.serviceName})))||void 0===t?void 0:t.join(", ")})),gn=(0,fn.createSelector)(mn,(function(e){return null==e?void 0:e.join(", ")})),hn=(0,fn.createSelector)(vn,gn,(function(e,t){return[e,t].filter(Boolean).join(": ")}));var bn=function(e){var t,n=e.activity,o=e.serviceId,i=(0,un.useGetAvatarUrl)(),s=(null===(t=n.parties)||void 0===t?void 0:t.find((function(e){return"USER"===e.partyType})))||{},l=s.userId,c=s.firstName,u=void 0===c?"":c,d=s.lastName,f=void 0===d?"":d,m=function(e){var t=e.activity,n=e.serviceId,r=(0,$.useLocalizationState)().t,o=(0,Ce.useFormatting)().formatFullName,i=pn(o)(t),s=hn(t),l=gn(t),c=(0,He.useCaseState)("casePendingReasons"),u=(0,Ve.useServicesDispositionsState)((function(e){return n&&e.services[n].useDispositions}));return(0,a.useMemo)((function(){var e=new Date(t.createdTime).toLocaleDateString(),n=new Date(t.createdTime).toLocaleTimeString();switch(t.event){case"PULLED":return r.ACTIVITY_HISTORY.activity_view_case_pulled_label(s,i,e,n);case"PUSHED":return r.ACTIVITY_HISTORY.activity_view_case_pushed_label(s,i,e,n);case"ASSIGNED":var a=o(t.assignedByFirstName,t.assignedByLastName);return t.parties.length?r.ACTIVITY_HISTORY.activity_view_case_assigned_to_agent_label(a,i,e,n):r.ACTIVITY_HISTORY.activity_view_case_assigned_to_queue_label(a,s,e,n);case"TRANSFERRED":var d=o(t.transferredFromFirstName,t.transferredFromLastName);return t.parties.length?r.ACTIVITY_HISTORY.activity_view_case_transferred_to_agent_label(d,i,e,n):r.ACTIVITY_HISTORY.activity_view_case_transferred_to_queue_label(d,s,e,n);case"FOLLOWUP_FROM":case"FOLLOWUP_CREATED":return r.ACTIVITY_HISTORY.activity_view_case_created_event_label(i,e,n);case"STATE_CHANGED":switch(t.status){case"Closed":return r.ACTIVITY_HISTORY.activity_case_state_closed(e,n);case"Open":return r.ACTIVITY_HISTORY.activity_case_state_changed(i,t.status,e,n);case"Pending":return c.data.length?r.ACTIVITY_HISTORY.activity_case_state_pending(i,t.status,e,n,t.pendingReasonName||r.ACTIVITY_HISTORY.activity_case_state_no_message()):r.ACTIVITY_HISTORY.activity_case_state_changed(i,t.status,e,n);case"Resolved":return u?r.ACTIVITY_HISTORY.activity_case_state_disposition(i,t.status,e,n,l||r.ACTIVITY_HISTORY.activity_case_state_no_message()):r.ACTIVITY_HISTORY.activity_case_state_changed(i,t.status,e,n)}}}),[c.data.length,u,l,i,s,t,o,r.ACTIVITY_HISTORY])}({activity:n,serviceId:o}),p=(0,a.useMemo)((function(){return{userId:l,notFoundPlaceholder:!0}}),[l]);return(0,r.jsxs)("div",{className:"relative flex p-2",children:[(0,r.jsx)("div",{className:"mr-2 flex-none",children:(0,r.jsx)(q.Avatar,{size:40,firstName:u,lastName:f,url:i(p)})}),(0,r.jsx)("div",{className:"flex-auto bg-[--c-activity-bg] p-2",children:(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("div",{className:"mr-2 h-4 w-4 flex-none self-center [&_svg]:h-full [&_svg]:w-full",children:(0,r.jsx)(dn.LegacyIconKey,{fill:"var(--c-icon)"})}),(0,r.jsx)("div",{className:"mr-2 text-gray-500",children:m})]})})]})},yn=function(e){var t=e?[e.firstName,e.lastName].filter(Boolean):[];return t.length?t:["Anonymous"]};var Sn=function(e){var t=e.party,n=e.service,o=t||{},i=o.notes,s=o.disposition,l=o.userId,c=o.firstName,u=o.lastName,d=(n||{}).serviceName,f=(0,un.useGetAvatarUrl)(),m=(0,Ce.useFormatting)().formatFullName,p=(0,a.useMemo)((function(){return{userId:l,notFoundPlaceholder:!0}}),[l]);return i||s?(0,r.jsxs)("div",{className:"-mx-2 my-2 border-t-[2px] border-white p-2",children:[(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)("div",{className:"mr-2.5 h-8 w-8 flex-none",children:(0,r.jsx)(q.Avatar,{size:40,firstName:c,lastName:u,url:f(p)})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"text-gray-500",children:m(c,u)}),(0,r.jsx)("div",{children:i})]})]}),(0,r.jsx)("div",{className:"mt-2 text-gray-500",children:"".concat(d,": ").concat(s)})]}):null};function xn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function jn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function In(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){jn(e,t,n[t])}))}return e}function On(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return xn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return xn(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var _n=function(e){var t=e.messages,n=On((0,a.useState)([]),2),o=n[0],i=n[1],s=(0,Ce.useFormatting)().formatFullName,l=(0,un.useGetAvatarUrl)();return(0,a.useEffect)((function(){i(function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t={},n=function(e){return void 0!==e};return(e=e.map((function(e){var r=e.partyId,a=(0,m.pickBy)(e,n);return t[r]=In({},t[r],a),a}))).map((function(e){return In({},t[e.partyId],e)})).filter((function(e){var t=e.type,n=e.event,r=["party_changed","party_navigation"];return"scenario"===t&&r.push("party_joined","party_left"),!r.includes(n)}))}(t))}),[t]),(0,r.jsx)("div",{className:"bg-[--c-chat-content-bg]",children:o.map((function(e,t){var n=e.type,a=e.userId,o=e.firstName,i=e.lastName,c=s(o,i),u=function(e){return new Date(e).toLocaleTimeString(void 0,{hour:"numeric",minute:"numeric"})}(e.timestamp),d=function(e){var t=e.event,n=e.msg;switch(t){case"party_joined":return"has joined the chat";case"party_message":return n||"";case"party_file":return"sent a file";case"party_changed":case"party_navigation":default:return"";case"party_left":return"has left the chat"}}(e);return(0,r.jsxs)("div",{className:"flex gap-2 px-2 py-[5px]",children:[(0,r.jsx)("div",{className:"ml-2.5 h-10 w-10 flex-none",children:"internal"===n?(0,r.jsx)(q.Avatar,{size:40,firstName:o,lastName:i,url:l({userId:a,notFoundPlaceholder:!0})}):(0,r.jsx)("div",{className:"h-full w-full border border-current p-1 text-[--c-chat-content-icon-text]   [&_svg]:h-full [&_svg]:w-full [&_svg]:fill-current",children:"scenario"===n?(0,r.jsx)(dn.LegacyIconGear,{}):(0,r.jsx)(dn.LegacyIconPerson,{})})}),(0,r.jsxs)("div",{className:"flex-auto [&_b]:mr-[0.3em]",children:[(0,r.jsxs)("div",{children:[c&&(0,r.jsx)("b",{children:c}),(0,r.jsx)("span",{children:u})]}),(0,r.jsx)("div",{className:"mt-1",children:d})]})]},t)}))})};function Cn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function wn(e){return function(e){if(Array.isArray(e))return Cn(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Cn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Cn(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Nn=function(e){var t=e.activity,n=(0,Ce.useFormatting)().formatFullName,a=(0,un.useGetAvatarUrl)(),o=(0,He.useCaseState)("chats"),i=t.createdTime,s=t.parties,l=t.services,c=t.globalInteractionId,u=s.find((function(e){return"USER"===e.partyType})),d=s.find((function(e){return"USER"!==e.partyType})),f=(o[c]||{}).data,p=void 0===f?null:f;if(!p)return null;var v=n.apply(void 0,wn(yn(u))),g=n.apply(void 0,wn(yn(d))),h=(0,X.formatDate)(i),b=[g,"chatted on","".concat(h,", handled by"),v].join(" "),y={firstName:(0,m.get)(d,"firstName"),lastName:(0,m.get)(d,"lastName"),size:40,url:a({contactId:null==d?void 0:d.contactId,notFoundPlaceholder:!0})};return(0,r.jsxs)("div",{className:"relative flex p-2",children:[(0,r.jsx)("div",{className:"mr-2 flex-none",children:(0,r.jsx)(q.Avatar,{size:y.size,firstName:y.firstName,lastName:y.lastName,url:y.url})}),(0,r.jsxs)("div",{className:"flex-auto bg-[--c-activity-bg] p-2",children:[(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("div",{className:"mr-2 h-4 w-4 flex-none self-center [&_svg]:h-full [&_svg]:w-full",children:(0,r.jsx)(dn.LegacyIconChat,{})}),(0,r.jsx)("div",{className:"mr-2 text-gray-500",children:b})]}),(0,r.jsx)("div",{className:"mt-2",children:(0,r.jsx)(_n,{messages:p.messages})}),(0,r.jsx)(Sn,{party:u,service:null==l?void 0:l[0]})]})]})},An=n(6426),En=n.n(An);function Tn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}var Pn,Mn,Ln,kn=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,r=[{key:"validate",value:function(e){return null!=e&&this.emailPattern.test(e)}}],(n=null)&&Tn(t.prototype,n),r&&Tn(t,r),e}();function Dn(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}Pn=kn,Mn="emailPattern",Ln=new RegExp(wt.EMAIL_REGEX),Mn in Pn?Object.defineProperty(Pn,Mn,{value:Ln,enumerable:!0,configurable:!0,writable:!0}):Pn[Mn]=Ln;var Rn=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,r=[{key:"LABEL",value:function(e){var t="";if(e){var n=e.address,r=e.name;r&&r!==n?(t+=r,n&&(t+=" <".concat(n,">"))):n&&(t+=n)}return t}},{key:"LABEL2",value:function(e){if(!e)return"";var t=e.name,n=e.address,r=t?t.toLowerCase()===n.toLowerCase()?n:"".concat(t," (").concat(n,")"):n;return kn.validate(n)?(0,dt.sanitizeHtml)("<span data-email='".concat(n,"'>").concat(r,"</span>")):(0,dt.sanitizeHtml)("<span style='border-bottom: 1px dotted red; border-top: 1px solid transparent;' title='".concat(r,"'>").concat(r,"</span>"))}}],(n=null)&&Dn(t.prototype,n),r&&Dn(t,r),e}();function Fn(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")}function Bn(e){var t="chrome"===le.platformInfo.browser,n=(0,$.useLocalizationState)().t,r=n.EMAIL,a=n.ACTIVITY_HISTORY;return function(){var n=t?"about:blank":"screenpop.html",o=window.open(n,En()()),i=function(e,t,n){function r(e){var t=e.eraseTime,r=e.eraseReason,a=e.eraseLoginId,o=t&&new Date(t).toLocaleDateString(),i=t&&new Date(t).toLocaleTimeString();return o&&i&&a?n.activity_view_email_content_erased(o,i,a,null!=r?r:""):""}var a=new Set(["OUTBOUND","REPLY"]),o="<html><head><style>\n    body {\n      overflow-wrap: break-word;\n    }\n    </style></head><body>";a.has(e.direction)&&(o+="<div>");var i=function(e,t){t&&t.length>0&&(o+="".concat(Fn(e),": ").concat(Fn(t.map(Rn.LABEL).join(", ")),"<hr>"))};i(t.email_queue_field_from(),e.emailData.fromAddresses),i(t.email_address_to_prefix(),e.emailData.toAddresses),i(t.email_address_cc_prefix(),e.emailData.ccAddresses),i(t.email_address_bcc_prefix(),e.emailData.bccAddresses),o+="".concat(Fn(t.email_subject()),": ").concat(Fn(e.emailData.subject),"<hr>"),e.emailData.eraseTime?o+=r(e.emailData):o+=e.emailData.content;a.has(e.direction)&&(o+="</div>");return o+="</body></html>"}(e,r,a);(null==o?void 0:o.document)&&(o.document.write((0,dt.sanitizeHtml)(i)),o.document.title=(0,dt.sanitizeHtml)(e.emailData.subject))}}function Un(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function zn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Un(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Un(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Hn=function(e){var t=e.html,n=e.title,o=zn((0,a.useState)(""),2),i=o[0],s=o[1];(0,a.useEffect)((function(){s((0,dt.sanitizeHtml)(t))}),[t]);var l=(0,a.useMemo)((function(){return{__html:i}}),[i]);return(0,r.jsxs)("div",{children:[n&&(0,r.jsx)("div",{className:"mb-2 text-lg font-bold",children:n}),(0,r.jsx)("div",{className:"relative",children:(0,r.jsx)("div",{dangerouslySetInnerHTML:l})})]})};function Vn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Gn(e){return function(e){if(Array.isArray(e))return Vn(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Vn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Vn(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Wn=function(e){var t=e.activity,n=e.caseId,a=(0,$.useLocalizationState)().t,o=(0,Ce.useFormatting)().formatFullName,i=(0,un.useGetAvatarUrl)(),s=(0,C.useSessionState)(["serverOrigin","sessionId"]),l=s.serverOrigin,c=s.sessionId,u=t.createdTime,d=t.emailData,f=t.direction,p=t.parties,v=p.find((function(e){return"USER"===e.partyType})),g=p.find((function(e){return"USER"!==e.partyType})),h="INBOUND"!==f,b=(d.fromAddresses||[])[0],y=[o.apply(void 0,Gn((b&&b.name||"Unidentified").split(" "))),"sent on",(0,X.formatDate)(u)].join(" "),S={firstName:(0,m.get)(h?v:g,"firstName"),lastName:(0,m.get)(h?v:g,"lastName"),size:40,url:i({userId:h?null==v?void 0:v.userId:void 0,contactId:h||null==g?void 0:g.contactId,notFoundPlaceholder:!0})},x=W("!h-5 !w-5 [&_svg]:h-full [&_svg]:w-full"),j=Bn(t),I=(0,J.useInteractionStateRef)(),O=(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(q.SemanticButton,{transparent:!0,icon:!0,className:x,tooltip:a.EMAIL.show_original_email_body_button_tooltip(),onClick:j,children:(0,r.jsx)(dn.LegacyIconOriginalEmail,{fill:"var(--c-icon)"})}),(0,r.jsx)(q.SemanticButton,{transparent:!0,icon:!0,className:x,onClick:function(){var e,r,a,o;if(null===(e=I.current)||void 0===e?void 0:e.items.find((function(e){var t;return(null===(t=e.emailData)||void 0===t?void 0:t.caseId)===n}))){var i=(o=t.emailId,document.querySelector('[data-email-editor-reference-id="'.concat(o,'"]>div')));r=i,(null!=(a=HTMLElement)&&"undefined"!=typeof Symbol&&a[Symbol.hasInstance]?a[Symbol.hasInstance](r):r instanceof a)&&(i.scrollIntoView(),i.focus())}},children:(0,r.jsx)(dn.LegacyIconReply,{fill:"var(--c-icon)"})}),(0,r.jsx)(q.SemanticButton,{transparent:!0,icon:!0,className:x,children:(0,r.jsx)(dn.LegacyIconSingleStepTransfer,{fill:"var(--c-icon)"})}),(0,r.jsx)(q.SemanticButton,{size:"big",transparent:!0,icon:"download",tooltip:a.EMAIL.download_original(),onClick:function(){return(0,we.assertDefined)(c),(0,w.downloadURL)((0,at.getDownloadEmailUrl)(l,c,t.emailId),"originalMessage")}})]});return(0,r.jsxs)("div",{className:"group relative flex p-2",children:[(0,r.jsx)("div",{className:"mr-2 flex-none",children:(0,r.jsx)(q.Avatar,{size:S.size,firstName:S.firstName,lastName:S.lastName,url:S.url})}),(0,r.jsxs)("div",{className:"flex-auto bg-[--c-activity-bg] p-2",children:[(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("div",{className:"mr-2 mt-1 h-4 w-4 flex-none self-start [&_svg]:h-full [&_svg]:w-full",children:(0,r.jsx)(dn.LegacyIconEmail,{})}),(0,r.jsx)("div",{className:"mr-2 text-gray-500",children:y}),(0,r.jsx)("div",{className:"hidden flex-none text-[--c-controls-text] group-hover:!flex",children:O})]}),(0,r.jsx)("div",{className:"mt-2",children:(0,r.jsx)(Hn,{title:d.subject,html:d.content})}),(0,r.jsx)("div",{className:"mt-2 text-right text-[--c-controls-text]",children:O})]})]})},qn=function(e){var t=e.activity,n=(0,Ce.useFormatting)().formatFullName,o=(0,un.useGetAvatarUrl)(),i=t.createdTime,s=t.parties.find((function(e){return"USER"===e.partyType}))||{},l=s.userId,c=s.firstName,u=void 0===c?"":c,d=s.lastName,f=void 0===d?"":d,m=s.notes,p=void 0===m?"":m,v=s.disposition,g=n(u,f),h=function(e){return void 0===e?"left a note":"dispositioned interaction"}(v),b=[g,h,"on",(0,X.formatDate)(i)].join(" "),y=v||p,S=(0,a.useMemo)((function(){return{userId:l,notFoundPlaceholder:!0}}),[l]);return(0,r.jsxs)("div",{className:"relative flex p-2",children:[(0,r.jsx)("div",{className:"mr-2 flex-none",children:(0,r.jsx)(q.Avatar,{size:40,firstName:u,lastName:f,url:o(S)})}),(0,r.jsxs)("div",{className:"flex-auto bg-[--c-activity-bg] p-2",children:[(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("div",{className:"mr-2 h-4 w-4 flex-none self-center [&_svg]:h-full [&_svg]:w-full",children:(0,r.jsx)(dn.LegacyIconKey,{fill:"var(--c-icon)"})}),(0,r.jsx)("div",{className:"mr-2 text-gray-500",children:b})]}),(0,r.jsx)("div",{className:"mt-2",children:y})]})]})};function Yn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Qn(e){return function(e){if(Array.isArray(e))return Yn(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Yn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Yn(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Kn=function(e){var t=e?[e.firstName,e.lastName].filter(Boolean):[];return t.length?t:["Anonymous"]},$n=function(e){var t=e.activity,n=e.recordings,a=void 0===n?[]:n,o=(0,Ce.useFormatting)().formatFullName,i=(0,un.useGetAvatarUrl)(),s=t.createdTime,l=t.parties,c=t.services,u=l.find((function(e){return"USER"===e.partyType})),d=l.find((function(e){return"USER"!==e.partyType})),f=o.apply(void 0,Qn(Kn(u))),p=o.apply(void 0,Qn(Kn(d))),v=(0,X.formatDate)(s),g=[p,"called on","".concat(v,", handled by"),f].join(" "),h={firstName:(0,m.get)(d,"firstName"),lastName:(0,m.get)(d,"lastName"),size:40,url:i({contactId:null==d?void 0:d.contactId,notFoundPlaceholder:!0})};return(0,r.jsxs)("div",{className:"relative flex p-2 [&:not(:first-child)]:pt-0",children:[(0,r.jsx)("div",{className:"mr-2 flex-none",children:(0,r.jsx)(q.Avatar,{size:h.size,firstName:h.firstName,lastName:h.lastName,url:h.url})}),(0,r.jsxs)("div",{className:"flex-auto bg-[--c-activity-bg] p-2",children:[(0,r.jsxs)("div",{className:"flex",children:[(0,r.jsx)("div",{className:"mr-2 h-4 w-4 flex-none self-center [&_svg]:h-full [&_svg]:w-full",children:(0,r.jsx)(dn.LegacyIconCallInbound,{})}),(0,r.jsx)("div",{className:"mr-2 text-gray-500",children:g})]}),(0,r.jsx)("div",{className:"mt-2",children:a.map((function(e){return(0,r.jsx)("div",{className:"rounded-[24px] bg-[--c-activity-record-bg] p-3 [&:not(:first-child)]:mt-2",children:(0,r.jsx)(q.AudioPlayer,{src:e})},e)}))}),(0,r.jsx)(Sn,{party:u,service:null==c?void 0:c[0]})]})]})},Xn=function(e){var t=e.data,n=e.recordings,a=void 0===n?[]:n,o=e.serviceId;return(0,r.jsx)(r.Fragment,{children:t.activities.map((function(e){switch(e.mediaType){case"NOTES":return(0,r.jsx)(qn,{activity:e},e.id);case"CASE":return(0,r.jsx)(bn,{serviceId:o,activity:e},e.id);case"EMAIL":return(0,r.jsx)(Wn,{caseId:t.id,activity:e},e.id);case"VOICE":return(0,r.jsx)($n,{activity:e,recordings:a},e.id);case"CHAT":return(0,r.jsx)(Nn,{activity:e},e.id);default:return null}}))})},Jn=function(e){return(0,r.jsx)("footer",{className:"mx-2 flex rounded-t border border-main-border p-2",children:e.children})},Zn=n(161);function er(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function tr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return er(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return er(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var nr=[],rr=function(e){var t=e.className,n=e.user,o=e.placeholder,i=e.setUser,s=(0,$.useLocalizationState)().t,l=(0,w.useBoolean)(),c=(0,a.useCallback)((function(){l.setFalse(),f(""),v([])}),[l]),u=tr((0,a.useState)(""),2),d=u[0],f=u[1],m=tr((0,a.useState)([]),2),p=m[0],v=m[1];return(0,a.useEffect)((function(){var e=p[0];e&&(c(),v([]),"user"===e.type&&i({id:e.id,name:e.displayText}))}),[p,c,i]),(0,r.jsx)("div",{className:"relative flex items-center",children:l.value?(0,r.jsx)(Zn.MultipleUserSearch,{searchForUsers:!0,withSessionUser:!0,className:t,autoFocus:!0,uniqueSearchId:"calendar-owner",searchValue:d,onClickOutside:c,setSearchValue:f,selectedItems:nr,setSelectedItems:v,inputPlaceholder:s.EMAIL.find_agents(),loadingLabel:s.GLOBAL.loading()}):(0,r.jsx)("button",{className:W('after:ml-[0.3em] after:inline-block after:h-0 after:w-0 after:border-solid after:content-["_"]',"after:border-x-[0.3em] after:border-b-[0.1em] after:border-t-[0.3em] after:border-[var(--c-icon)_transparent_transparent]"),onClick:l.toggle,children:(null==n?void 0:n.name)||o})})};function ar(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function or(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ir(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function sr(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function lr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ar(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ar(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var cr=function(e){var t=e.onClose,n=e.queueItemsToMove,o=e.fromUserId,i=e.createNote,s=sr(e,["onClose","queueItemsToMove","fromUserId","createNote"]),l=(0,$.useLocalizationState)().t,c=lr((0,a.useState)(void 0),2),u=c[0],d=c[1],f=lr((0,a.useState)(""),2),m=f[0],p=f[1],v=(0,He.useCaseStateMethods)().moveQueueItems;return(0,r.jsxs)(q.Modal,ir(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){or(e,t,n[t])}))}return e}({onClose:t,className:"relative w-90 overflow-hidden","aria-labelledby":"assign_email_modal","data-testid":"AssignEmailModal"},s),{children:[(0,r.jsx)(q.Modal.Header,{role:"heading",id:"assign_email_modal",children:l.EMAIL.email_reply_assign_header()}),(0,r.jsx)(q.Modal.Content,{children:(0,r.jsxs)(re.SmForm,{children:[(0,r.jsxs)(re.SmForm.Field,{children:[(0,r.jsx)("label",{children:l.EMAIL.assign_to()}),(0,r.jsx)(rr,{user:u,setUser:d,placeholder:l.EMAIL.find_agent()})]}),(0,r.jsxs)(re.SmForm.Field,{children:[(0,r.jsx)("label",{children:l.DISPOSITION.disposition_notes_tooltip()}),(0,r.jsx)(Te.TextArea,{placeholder:l.DISPOSITION.disposition_notesEmptyText(),value:m,onChange:function(e){return p(e.target.value)}})]})]})}),(0,r.jsxs)(q.Modal.Actions,{children:[(0,r.jsx)(q.SemanticButton,{onClick:function(){return t()},children:l.WINDOW_POPUP_TITLES_AND_MESSAGES.window_buttonCancel()}),(0,r.jsx)(q.SemanticButton,{primary:!0,onClick:function(e){e.preventDefault(),(0,we.assertDefined)(u),(0,we.assertDefined)(o),v({itemsToMove:n,directions:{toQueueType:"PERSONAL",fromQueueType:"PERSONAL",toUserId:u.id,fromUserId:o}}),m&&n.forEach((function(e){i({user:u,notes:m,caseId:e.caseId})})),t()},disabled:!u,children:l.WINDOW_POPUP_TITLES_AND_MESSAGES.window_button_assign()})]})]}))};function ur(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function dr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ur(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ur(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function fr(){var e=(0,Ce.useFormatting)().getNamesFromDisplayName;return(0,rt.useMutation)({mutationFn:function(t){var n=t.user,r=t.notes,a=t.caseId,o=dr(e(n.name),2),i=o[0],s=o[1];return at.DefaultService.createCaseActivity({requestBody:{media_type:"NOTES",parties:[{party_type:"USER",user_id:n.id,first_name:i,last_name:s,notes:r,start_time:{date:(new Date).toISOString()}}],case_ids:[{oid:a}],has_voice_recording:!1,is_agent_assignment:!1,is_flagged:!1,is_auto_acknowledgement:!1}})}})}var mr=function(e){var t=e.title,n=e.info,o=e.tooltip,i=(0,a.useRef)(null);return n?(0,r.jsxs)("div",{ref:i,children:[t,": ",n&&o?(0,r.jsx)(q.Popup,{mountNode:i.current,mode:"hover",hoverable:!0,content:o,contentClassName:"z-[1]",children:(0,r.jsx)("span",{className:"underline decoration-dashed",children:n})}):n]}):null},pr=function(e){var t=e.caseId,n=e.firstName,o=e.lastName,i=e.interactionMode,s=(0,$.useLocalizationState)().t,l=(0,J.useActiveInteractionStepId)(),c=(0,He.useCaseStateMethods)().changeReporter,u=(0,Ce.useFormatting)().formatFullName,d=n||o?u(n,o):s.GLOBAL.unidentified(),f=(0,ze.useOpenSearchContactModal)(),m=(0,a.useCallback)((function(e){l&&c(l,t,e)}),[t,c,l]),p=(0,a.useCallback)((function(){f({dataKey:"change_reporter_modal",onSelect:m,title:s.CALENDAR_EVENT_FORM.contact_search_dialog_heading()})}),[m,f,s.CALENDAR_EVENT_FORM]);return(0,r.jsxs)("div",{children:[d,","," ",i?(0,r.jsx)(q.LinkLikeButton,{onClick:p,children:s.EMAIL.case_view_reporter_label()}):(0,r.jsx)("u",{children:s.EMAIL.case_view_reporter_label()})]})};function vr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function gr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return vr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return vr(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var hr=function(e){var t=e.initialTitle,n=e.caseId,o=gr((0,a.useState)(t),2),i=o[0],s=o[1],l=(0,He.useCaseStateMethods)().updateCaseTitle,c=(0,a.useCallback)((function(e){s(e.target.value)}),[]),u=(0,a.useCallback)((function(){i!==t&&l({caseId:n,caseTitle:i})}),[n,t,i,l]);return(0,r.jsx)(q.SimpleInput,{value:i,onChange:c,onBlur:u,className:"-ml-px -mt-px [&:not(:focus):not(:hover)]:!ml-0 [&:not(:focus):not(:hover)]:!mt-0 [&:not(:focus):not(:hover)]:[&_input]:!border-none"})},br=function(e){var t=e.text,n=e.editable,a=e.caseId;return(0,r.jsx)(r.Fragment,{children:n?(0,r.jsx)(hr,{initialTitle:t,caseId:a}):t})};const yr=n.p+"768a4584de75be31d108c80afaed59bb.svg";var Sr=(0,r.jsx)(q.Svg,{src:yr,className:"[&_svg]:!h-[15px] [&_svg]:!w-[15px]"}),xr=function(e){var t=e.caseId,n=(0,C.useSessionState)().serverOrigin,o=(0,$.useLocalizationState)().t,i=(0,a.useCallback)((function(){w.clipboard.copy((0,at.getCaseURL)(n,t))}),[t,n]);return(0,r.jsx)(q.SemanticButton,{basic:!0,icon:Sr,onClick:i,className:"!h-9 !w-9 [&_svg]:h-full [&_svg]:w-full",tooltip:o.GLOBAL.copy_shareable_link_button_tooltip()})},jr=function(e){var t=e.caseId,n=e.caseNumber,o=e.itemId,i=(0,J.useInteractionStateMethods)().completeItem,s=(0,$.useLocalizationState)().t,l=(0,He.useCaseStateMethods)().deleteCases,c=(0,ae.useModalsStateMethods)().openModal,u=(0,a.useCallback)((function(){o&&c({title:s.WINDOW_POPUP_TITLES_AND_MESSAGES.window_title_warning(),body:s.CASE_SEARCH.delete_case_confirmation_label(n),actions:{ok:{title:s.WINDOW_POPUP_TITLES_AND_MESSAGES.window_buttonOk(),action:function(){i(o),l([t],void 0)}},cancel:{title:s.WINDOW_POPUP_TITLES_AND_MESSAGES.window_buttonCancel()}},className:"autoSizeModal"})}),[t,n,i,l,o,c,s.CASE_SEARCH,s.WINDOW_POPUP_TITLES_AND_MESSAGES]);return(0,r.jsx)(q.SemanticButton,{basic:!0,icon:"trash",onClick:u})},Ir=function(e){var t=e.itemId,n=(0,J.useInteractionStateMethods)().saveEmailDraft,o=(0,a.useCallback)((function(){t&&n({itemId:t})}),[t,n]);return(0,r.jsx)(q.SemanticButton,{icon:!0,basic:!0,className:W("h-9 w-15 [&_svg]:h-full [&_svg]:w-9.5"),onClick:o,children:(0,r.jsx)(dn.LegacyIconSaveClose,{fill:"var(--c-icon)"})})};function Or(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _r(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Or(e,t,n[t])}))}return e}function Cr(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}var wr=function(e){var t,n=e.data,o=e.interactionMode,i=e.serviceId,s=e.assignments,l=(0,He.useCaseStateMethods)(),c=l.pinCase,u=l.unpinCase,d=l.flagCase,f=l.unflagCase,m=(0,un.useGetContactPictureUrl)(),p=(0,J.useActiveInteractionId)(),v=(0,Ce.useFormatting)().formatFullName,g={id:n.reporterId,firstName:n.reporterFirstName||"Unidentified",lastName:n.reporterLastName,avatarUrl:m(n.reporterId,!0)},h=null==s?void 0:s.personal[0],b=h&&v(h.firstName,h.lastName),y=null==s?void 0:s.followUp.map((function(e){return v(e.firstName,e.lastName)})),S=!!(null==y?void 0:y.length),x=null==y?void 0:y.join(", "),j=n.status,I=n.isFlagged,O=(0,a.useCallback)((function(){return c(n.id)}),[n.id,c]),_=(0,a.useCallback)((function(){return u(n.id)}),[n.id,u]),C=(0,a.useCallback)((function(){return d(n.id)}),[n.id,d]),w=(0,a.useCallback)((function(){return f(n.id)}),[n.id,f]),N=W("ml-4 mr-2 last:!mr-0"),A=W("mx-1 inline-block h-4 w-4 [&_svg]:h-full [&_svg]:w-full [&_svg]:fill-[--c-activity-border]"),E=W("[&_svg]:h-full [&_svg]:w-full"),T=(0,$.useLocalizationState)().t,P=(0,a.useMemo)((function(){return(null==y?void 0:y.length)?(0,r.jsx)(r.Fragment,{children:null==y?void 0:y.map((function(e,t){return(0,r.jsx)(mr,{info:e,title:T.EMAIL.case_view_followups_label()},t)}))}):null}),[y,T.EMAIL]),M=(0,ae.useModalComponentOpener)(cr),L=fr().mutate,k=(0,a.useMemo)((function(){if(!b||!h.date)return null;var e=new Date(h.date).toLocaleDateString("en-US",{month:"short",day:"2-digit",year:"numeric"}),t=new Date(h.date).toLocaleTimeString("en-US",{hour:"numeric",minute:"2-digit",hour12:!0});return(0,r.jsxs)("div",{className:"flex flex-col gap-1 p-2 ",children:[T.EMAIL.case_view_assignment_personal_label(b,e,t),(0,r.jsx)(q.SemanticButton,{basic:!0,className:"self-end",primary:!0,size:"small",onClick:function(){return M({createNote:L,queueItemsToMove:[{caseId:n.id,queueId:s.queueItemId,service:i}]})},children:T.EMAIL.email_assign_button()})]})}),[i,b,h,null==s?void 0:s.queueItemId,L,n.id,M,T.EMAIL]);return(0,r.jsxs)("div",{className:"flex flex-row flex-nowrap border-b border-[--c-activity-border] p-2",children:[(0,r.jsxs)("div",{className:"flex-1",children:[(0,r.jsx)("div",{className:"relative mb-2 block text-lg font-bold leading-[22px] before:inline-block before:content-[attr(before)]",children:(0,r.jsxs)("div",{className:"absolute inset-x-0 top-0 flex truncate pl-[0.1em] pt-px",children:[(0,r.jsx)("div",{className:"inline-block pr-[0.5em]",children:n.number}),n.title&&(0,r.jsx)(br,{editable:o,text:n.title,caseId:n.id})]})}),(0,r.jsxs)("div",{className:"mt-1 flex flex-row flex-nowrap",children:[(0,r.jsx)("div",{className:"w-10 flex-none",children:(0,r.jsx)(q.Avatar,{firstName:g.firstName,lastName:g.lastName,url:g.avatarUrl,size:40})}),(0,r.jsxs)("div",{className:"flex flex-1 flex-row flex-nowrap",children:[(0,r.jsxs)("div",{className:N,children:[(0,r.jsx)(pr,Cr(_r({},g),{interactionMode:o,caseId:n.id})),n.categoryName&&(0,r.jsx)("div",{className:"mt-1 text-gray-400",children:n.categoryName})]}),(0,r.jsxs)("div",{className:N,children:[(0,r.jsx)(mr,{title:T.EMAIL.case_view_status_label(),info:j}),(0,r.jsx)(mr,{title:T.EMAIL.case_view_assignments_label(),info:b,tooltip:k}),(0,r.jsx)(mr,{title:T.EMAIL.case_view_followups_label(),info:x,tooltip:P})]}),(S||I)&&(0,r.jsxs)("div",{className:N,children:[S&&(0,r.jsx)("div",{className:A,children:(0,r.jsx)(dn.LegacyIconPinOn,{})}),I&&(0,r.jsx)("div",{className:A,children:(0,r.jsx)(dn.LegacyIconCaseFlagOn,{})})]})]})]})]}),(0,r.jsxs)("div",{className:"ml-2 flex flex-none items-start",children:[(0,r.jsx)(q.SemanticButton,{basic:!0,active:S,className:E,icon:"pin",onClick:S?_:O}),(0,r.jsx)(q.SemanticButton,{basic:!0,icon:"flag",active:n.isFlagged,className:E,onClick:n.isFlagged?w:C}),(0,r.jsx)(xr,{caseId:n.id}),o&&p&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(Ir,{itemId:p}),(0,r.jsx)(jr,{caseId:n.id,itemId:p,caseNumber:null!==(t=n.number)&&void 0!==t?t:""})]})]})]})};function Nr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ar(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}var Er=o().memo((function(e){var t=e.id,n=e.className,o=e.loaderClassName,i=e.FooterContent,s=e.activeDrafts,l=e.interactionId,c=e.serviceId,u=((0,$.useLocalizationState)().t,(0,He.useCaseState)("cases")),d=(0,He.useCaseStateMethods)().getCase,f=t?u[t]:void 0;return(0,a.useEffect)((function(){t&&d(t)}),[t,d]),(null==f?void 0:f.data)?(0,r.jsxs)("div",{className:W("flex h-full flex-col",n),children:[(0,r.jsx)(wr,{data:f.data,serviceId:c,interactionMode:!!l,assignments:f.assignments}),(0,r.jsxs)("div",{className:"grow overflow-auto",children:[(0,r.jsx)(Xn,{serviceId:c,data:f.data,recordings:f.recordings}),l&&(null==s?void 0:s.map((function(e){return(0,r.jsx)(cn,Ar(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Nr(e,t,n[t])}))}return e}({},e),{interactionId:l}),e.emailId)})))]}),(0,r.jsx)(Jn,{children:i})]}):(0,r.jsx)(q.Loader,{color:"primary",size:"big",className:o,active:!0})}));function Tr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Pr(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}var Mr=function(e){var t,n,a=(0,J.useActiveInteraction)();return(null==a||null===(t=a.emailData)||void 0===t?void 0:t.caseId)?(0,r.jsx)(Er,Pr(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Tr(e,t,n[t])}))}return e}({},e),{interactionId:a.id,activeDrafts:null==a||null===(n=a.emailData)||void 0===n?void 0:n.activeDrafts,FooterContent:(0,r.jsx)(tt,{caseId:a.emailData.caseId})})):null},Lr=n(2684),kr=n(7005),Dr=n(2443),Rr="updateTime",Fr=(0,kr.atom)([{id:"TEAM",type:"queue",queueType:"TEAM",closeable:!1},{id:"PERSONAL",type:"queue",queueType:"PERSONAL",closeable:!1},{id:"FOLLOWUP",queueType:"FOLLOWUP",type:"queue",closeable:!1}]),Br=(0,kr.atom)("TEAM"),Ur=(0,kr.atom)((function(e){return e(Fr).find((function(t){return t.id===e(Br)}))})),zr=(0,kr.atom)(400),Hr=(0,kr.atom)(),Vr=(0,kr.atom)({skip:0,size:100}),Gr=(0,kr.atom)(void 0),Wr=(0,kr.atom)({field:Rr,direction:"desc"}),qr=(0,kr.atom)(void 0),Yr=(0,kr.atom)("all"),Qr=(0,kr.atom)(void 0),Kr=(0,kr.atom)({field:Rr,direction:"desc"}),$r=(0,kr.atom)({skip:0,size:100}),Xr=(0,kr.atom)(void 0),Jr=(0,kr.atom)({field:Rr,direction:"desc"});function Zr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ea(e){return function(e){if(Array.isArray(e))return Zr(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Zr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Zr(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var ta=function(e){var t=e.queueItem,n=(0,$.useLocalizationState)().t,a=(0,kr.useSetAtom)(Fr),o=(0,kr.useSetAtom)(Br);return(0,r.jsx)(q.SemanticButton,{basic:!0,primary:!0,onClick:function(){var e={id:t.caseId,case:{id:t.caseId,serviceId:t.service,number:Number(t.caseNumber)},type:"view_case",closeable:!0,queueType:t.queueType};a((function(t){return ea(t).concat([e])})),o(e.id)},children:n.EMAIL.email_view_button()})},na=function(e){var t=e.canViewCase,n=(0,kr.useAtomValue)(Gr),o=null!=n?n:{},i=o.caseId,s=o.queueId,l=o.queueType,c=(0,$.useLocalizationState)().t,u=(0,He.useCaseStateMethods)().openCase,d=(0,a.useCallback)((function(){(0,we.assertDefined)(s),(0,we.assertDefined)(i),u({caseId:i,queueId:s,queueType:l})}),[s,i,u,l]);return(0,r.jsxs)(r.Fragment,{children:[n&&t&&(0,r.jsx)(ta,{queueItem:n}),(0,r.jsx)(q.SemanticButton,{basic:!0,primary:!0,onClick:d,children:c.EMAIL.email_open_button()})]})},ra=n(5412),aa=n(3705),oa=function(e){var t=e.isActive,n=e.isDisabled,o=e.setActiveQueueItem,i=e.row,s=(0,a.useCallback)((function(){o(i.original)}),[i.original,o]);return(0,r.jsx)(re.SmTable.Row,{"data-element":"queue-item",onClick:s,active:t,disabled:n,children:i.getVisibleCells().map((function(e){return(0,r.jsx)(re.SmTable.Cell,{children:(0,ra.ie)(e.column.columnDef.cell,e.getContext())},e.id)}))},i.id)};function ia(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function sa(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ia(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ia(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var la=function(e){var t=e.table,n=e.noSelection,a=e.activeQueueItemAtom,o=e.HeaderContent,i=sa((0,kr.useAtom)(a),2),s=i[0],l=i[1],c=(0,q.useMenuKeysHandler)("queue-item","queue-table");(0,w.useEventListener)("keydown",c);var u=t.getHeaderGroups()[0].headers,d=u[0];return(0,r.jsx)("div",{className:"overflow-auto",children:(0,r.jsxs)(re.SmTable,{"data-element":"queue-table",compact:!0,className:"table-fixed",children:[(0,r.jsx)("colgroup",{children:u.map((function(e){return(0,r.jsx)("col",{style:{width:e.getSize()||"auto"}},e.id)}))}),(0,r.jsx)(re.SmTable.Header,{className:"relative",children:(0,r.jsxs)(re.SmTable.Row,{children:[!n&&(0,r.jsx)(re.SmTable.HeaderCell,{style:{width:d.getSize()||"auto"},children:(0,ra.ie)(d.column.columnDef.header,d.getContext())}),(0,r.jsx)("th",{colSpan:u.length-1,children:o})]})}),(0,r.jsx)(re.SmTable.Body,{children:t.getRowModel().rows.map((function(e){return(0,r.jsx)(oa,{setActiveQueueItem:l,isActive:(null==s?void 0:s.queueId)===e.original.queueId,row:e},e.id)}))})]})})};function ca(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ua(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ca(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ca(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function da(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function fa(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return da(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return da(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ma(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function pa(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ma(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ma(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var va=function(e){var t=e.table,n=e.noData,o=e.queueItems,i=e.noSelection,s=e.QueueControls,l=e.TableHeaderContent,c=e.CaseFooterContent,u=e.activeQueueItemAtom,d=(0,$.useLocalizationState)().t,f=pa((0,kr.useAtom)(zr),2),p=f[0],v=f[1],g=(0,kr.useAtomValue)(u);return function(e,t){var n=fa((0,kr.useAtom)(t),2),r=n[0],o=n[1];(0,a.useLayoutEffect)((function(){(null==e?void 0:e.some((function(e){return e.caseId===(null==r?void 0:r.caseId)})))||o(null==e?void 0:e[0])}),[r,e,o])}(o,u),function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n=ua((0,kr.useAtom)(t),2),r=n[0],o=n[1],i=null==r?void 0:r.queueId,s=(0,a.useMemo)((function(){return e.findIndex((function(e){return e.queueId===i}))}),[i,e]),l=(0,w.usePrevious)(s),c=(0,w.usePrevious)(null==e?void 0:e.length),u=c?c-e.length:0,d=(0,a.useMemo)((function(){return(null!=c?c:0)>(null==e?void 0:e.length)&&-1===s}),[s,c,null==e?void 0:e.length]);(0,a.useEffect)((function(){var t;d&&-1===s&&o(e[(t=(null!=l?l:0)-u+1,t>=e.length?e.length-1:t<0?0:t)])}),[e.length,i,s,d,u,l,o,e])}(o,u),(0,r.jsxs)("section",{className:"flex h-full items-start overflow-hidden",children:[(0,r.jsx)(q.ResizePanel,{className:"h-full",minSize:300,id:"queue-panel",maxSizeInPercent:70,initialSize:p,onDragEnd:(0,m.flow)((0,m.property)("size"),v),direction:"right",containerClass:"h-full",children:(0,r.jsxs)("aside",{className:"flex h-full min-w-[300px] flex-auto flex-col border-r border-gray-200",children:[s,(0,r.jsx)(la,{table:t,noSelection:i,activeQueueItemAtom:u,HeaderContent:l})]})}),(0,r.jsx)("article",{className:"relative flex h-full w-full flex-col items-center justify-center",children:!g||n?(0,r.jsx)("p",{className:"text-2xl",children:d.GLOBAL.no_data()}):(0,r.jsx)(Er,{id:null==g?void 0:g.caseId,serviceId:null==g?void 0:g.service,className:"w-full overflow-auto",FooterContent:c})})]})};function ga(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ha(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ga(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ga(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var ba=function(e){var t=e.actualQueueCount,n=e.paginationAtom,a=e.totalQueueCount,o=void 0===a?t:a,i=(0,$.useLocalizationState)().t,s=ha((0,kr.useAtom)(n),2),l=s[0],c=s[1],u=t+l.skip*l.size>=o,d=0===l.skip,m=l.skip*l.size+1,p=u?o:t+l.skip*l.size;return(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)("p",{className:"mr-2 text-sm text-gray-500",children:i.GLOBAL.pagination(m,p,o)}),(0,r.jsx)(q.SemanticButton,{transparent:!0,icon:"chevron left",className:"mr-2",onClick:function(){return c(f()((function(e){e.skip--})))},disabled:d}),(0,r.jsx)(q.SemanticButton,{transparent:!0,icon:"chevron right",onClick:function(){return c(f()((function(e){e.skip++})))},disabled:u})]})};function ya(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Sa(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function xa(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Sa(e,t,n[t])}))}return e}function ja(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Ia(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ya(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ya(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Oa=function(e){var t=e.options,n=e.sortingAtom,o=e.className,i=Ia((0,kr.useAtom)(n),2),s=i[0],l=i[1],c=(0,a.useCallback)((function(){l((function(e){return ja(xa({},e),{direction:"asc"===e.direction?"desc":"asc"})}))}),[l]),u=(0,a.useCallback)((function(e,t){l((function(e){return"string"!=typeof t.value?e:ja(xa({},e),{field:t.value})}))}),[l]),d=(0,$.useLocalizationState)().t;return(0,r.jsxs)("div",{className:W("ml-2 flex items-center gap-1",o),children:[(0,r.jsx)("p",{children:d.EMAIL.email_queue_sort_by_label("")}),(0,r.jsx)(q.SemanticButton,{className:"ml-2",icon:"asc"===s.direction?"caret up":"caret down",onClick:c,basic:!0,size:"mini"}),(0,r.jsx)(q.Dropdown,{inline:!0,options:t,onChange:u,value:s.field})]})};var _a=function(e){var t,n=e.actualQueueCount,o=e.totalQueueCount,i=e.noData,s=(t=(0,$.useLocalizationState)().t,(0,a.useMemo)((function(){return[{value:"createTime",text:t.EMAIL.email_queue_field_createTime()},{value:"updateTime",text:t.EMAIL.email_queue_field_updateTime()},{value:"customerUpdate",text:t.EMAIL.email_queue_field_customerUpdate()},{value:"sla",text:t.EMAIL.email_queue_field_serviceLevel()},{value:"from",text:t.EMAIL.email_queue_field_from()},{value:"subject",text:t.EMAIL.email_queue_field_subject()},{value:"flag",text:t.EMAIL.email_queue_field_flag()}]}),[t.EMAIL]));return i?null:(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsx)(Oa,{sortingAtom:Wr,options:s}),(0,r.jsx)(ba,{paginationAtom:Vr,actualQueueCount:n,totalQueueCount:o})]})},Ca=function(e){var t=e.value;return void 0===t||t<0?null:(0,r.jsx)("div",{className:"flex gap-0.5",children:Array.from({length:5}).map((function(e,n){var a=20*n<t;return(0,r.jsx)("span",{className:W("h-2 w-2 rounded-sm border border-icon",{"bg-icon":a})},n)}))})},wa=(0,aa.Cl)();function Na(){var e=(0,$.useLocalizationState)().t;return(0,a.useMemo)((function(){return[wa.accessor((function(t){return t.from||e.GLOBAL.heading_unknown()}),{id:"from",header:function(){return null},size:0,minSize:0,cell:function(e){return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("p",{className:"m-0 truncate",children:e.getValue()}),(0,r.jsx)("p",{className:"m-0 truncate",children:e.row.original.subject})]})}}),wa.accessor("serviceName",{id:"serviceName",header:function(){return null},cell:function(e){return(0,r.jsx)("p",{className:"m-0",children:e.getValue()})},size:90}),wa.accessor((function(e){return e.date&&(0,X.formatDate)(e.date)}),{id:"date",header:function(){return null},cell:function(e){return(0,r.jsx)("p",{className:"m-0",children:e.getValue()})},size:120}),wa.accessor("sla",{id:"sla",header:function(){return null},cell:function(e){return(0,r.jsx)(Ca,{value:e.getValue()})},size:70})]}),[e.GLOBAL])}function Aa(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ea(e){return function(e){if(Array.isArray(e))return Aa(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Aa(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Aa(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Ta=(0,aa.Cl)();var Pa=n(6658);function Ma(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function La(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function ka(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var Da=function(e){var t=e.onClose,n=ka(e,["onClose"]),a=(0,$.useLocalizationState)().t;return(0,r.jsxs)(q.Modal,La(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Ma(e,t,n[t])}))}return e}({size:"small",onClose:t,"aria-labelledby":"helpModal","data-testid":"help-modal"},n),{children:[(0,r.jsx)(re.SmModal.Header,{id:"helpModal",role:"heading",children:a.GLOBAL.help()}),(0,r.jsx)(re.SmModal.Content,{children:(0,r.jsx)(Pa.Help,{})}),(0,r.jsx)(re.SmModal.Actions,{children:(0,r.jsx)(q.SemanticButton,{enabledInOffline:!0,onClick:function(){return t()},"data-testid":"cancel-button",children:a.WINDOW_POPUP_TITLES_AND_MESSAGES.window_buttonOk()})})]}))};function Ra(e,t){var n=(0,kr.useAtomValue)(e),r=t.getSelectedRowModel().rows;return(0,a.useMemo)((function(){var e=r.map((function(e){return e.original}));return e.length?e:n?[n]:[]}),[n,r])}function Fa(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ba(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Fa(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Fa(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ua(e){var t=(0,$.useLocalizationState)().t,n=(0,C.useSessionState)("isSupervisor"),o=Ra(Gr,e),i=(0,He.useCaseStateMethods)(),s=i.moveQueueItems,l=i.createCaseEmail,c=(0,ee.useAgentState)(),u=c.notReadyReasons,d=c.selectedAgentStateOption,f=(0,ee.useAgentStateMethods)().setState,m=function(){var e=(0,$.useLocalizationState)().t,t=(0,ae.useModalsStateMethods)().openModal;return(0,a.useCallback)((function(n){var r=n.okAction;t({title:e.WINDOW_POPUP_TITLES_AND_MESSAGES.window_title_warning(),body:e.WINDOW_POPUP_TITLES_AND_MESSAGES.openingEmailFromSupervisingStateConfirmation(),actions:{ok:{title:e.WINDOW_POPUP_TITLES_AND_MESSAGES.window_buttonOk(),action:r},cancel:{title:e.WINDOW_POPUP_TITLES_AND_MESSAGES.window_buttonCancel()}},className:"autoSizeModal"})}),[t,e.WINDOW_POPUP_TITLES_AND_MESSAGES])}(),p=(0,C.useSessionState)().userId,v=(0,a.useCallback)((function(){(0,we.assertDefined)(p),s({itemsToMove:o,directions:{toQueueType:"TEAM",fromQueueType:"PERSONAL",fromUserId:p}}),e.resetRowSelection()}),[s,o,p,e]),g=(0,a.useCallback)((function(){""===(null==d?void 0:d.state)?m({okAction:function(){f({state:"not_ready",reason:null==u?void 0:u[0]}),l()}}):l()}),[null==d?void 0:d.state,m,l,f,u]),h=Ba((0,kr.useAtom)(Hr),2),b=h[0],y=h[1],S=(0,ae.useModalComponentOpener)(cr),x=fr().mutate,j=(0,a.useCallback)((function(){S({queueItemsToMove:o,fromUserId:b.id,createNote:x})}),[x,S,o,b.id]);return(0,a.useMemo)((function(){return(0,r.jsxs)("div",{className:"flex justify-between px-2 pb-2 pt-3",children:[(0,r.jsxs)("div",{className:"flex",children:[n&&(0,r.jsx)(q.SemanticButton,{icon:!0,basic:!0,onClick:j,tooltip:t.EMAIL.email_assign_button_tooltip(),children:(0,r.jsx)(dn.IconForward,{})}),(0,r.jsx)(q.SemanticButton,{onClick:v,primary:!0,basic:!0,children:t.EMAIL.email_move_to_team_queue_button_tooltip()})]}),(0,r.jsx)(rr,{user:b,setUser:y}),(0,r.jsx)(q.SemanticButton,{basic:!0,onClick:g,tooltip:t.ADDRESS_BOOK_AREA.addressBook_button_email_tooltip(),icon:"envelope"})]})}),[j,g,n,v,y,t.ADDRESS_BOOK_AREA,t.EMAIL,b])}function za(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ha=[],Va=function(e){var t,n,o=(0,kr.useAtomValue)(Wr),i=(0,kr.useAtomValue)(Vr),s=(0,kr.useAtomValue)(Hr),l=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{length:100,skip:0},t=(0,C.useSessionState)("serverOrigin");return(0,rt.useQuery)({queryKey:ot("PERSONAL",e),queryFn:function(){return(0,at.apiRequests)(t).getPersonalQueue(e)},refetchInterval:2e4,placeholderData:rt.keepPreviousData})}({length:i.size,skip:i.skip,sortBy:o.field,user:s.id,asc:"asc"===o.direction}),c=l.data,u=l.isFetched&&!(null==c?void 0:c.length),d=(0,ra.b7)({columns:(t=Na(),(0,a.useMemo)((function(){return[Ta.display({id:"select",header:function(e){var t=e.table;return(0,r.jsx)("div",{className:"w-9.5 px-2.5 pt-1",children:(0,r.jsx)(q.Checkbox,{checked:t.getIsAllRowsSelected(),indeterminate:t.getIsSomeRowsSelected(),onChange:function(e){return t.toggleAllPageRowsSelected(e)}})})},cell:function(e){var t=e.row;return(0,r.jsx)("div",{className:"w-9.5 px-2.5 pt-1",children:(0,r.jsx)(q.Checkbox,{checked:t.getIsSelected(),disabled:!t.getCanSelect(),indeterminate:t.getIsSomeSelected(),onChange:function(e){return t.toggleSelected(e)}})})},size:38})].concat(Ea(t))}),[t])),data:c||Ha,getCoreRowModel:(0,aa.sC)(),getRowId:function(e){return e.caseId}}),f=Ua(d);return(0,r.jsx)(va,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){za(e,t,n[t])}))}return e}({table:d,noData:u,CaseFooterContent:(0,r.jsx)(na,{canViewCase:!0}),TableHeaderContent:(0,r.jsx)(_a,{noData:u,actualQueueCount:null!==(n=null==c?void 0:c.length)&&void 0!==n?n:0,totalQueueCount:e.totalQueueCount}),QueueControls:f,queueItems:c,activeQueueItemAtom:Gr},e))};var Ga=function(e){var t=e.canViewCase,n=(0,kr.useAtomValue)(Xr),o=null!=n?n:{},i=o.caseId,s=o.queueId,l=o.queueType,c=(0,$.useLocalizationState)().t,u=(0,He.useCaseStateMethods)().openCase,d=(0,a.useCallback)((function(){(0,we.assertDefined)(s),(0,we.assertDefined)(i),u({caseId:i,queueId:s,queueType:l})}),[s,i,u,l]);return(0,r.jsxs)(r.Fragment,{children:[n&&t&&(0,r.jsx)(ta,{queueItem:n}),(0,r.jsx)(q.SemanticButton,{basic:!0,primary:!0,onClick:d,children:c.EMAIL.email_open_button()})]})};var Wa=function(e){var t,n=e.noData,o=(t=(0,$.useLocalizationState)().t,(0,a.useMemo)((function(){return[{value:"createTime",text:t.EMAIL.email_queue_field_createTime()},{value:"updateTime",text:t.EMAIL.email_queue_field_updateTime()},{value:"customerUpdate",text:t.EMAIL.email_queue_field_customerUpdate()},{value:"from",text:t.EMAIL.email_queue_field_from()},{value:"subject",text:t.EMAIL.email_queue_field_subject()}]}),[t.EMAIL]));return n?(0,r.jsx)(Oa,{className:"justify-self-end",sortingAtom:Jr,options:o}):null};function qa(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ya=[],Qa=function(e){var t=(0,kr.useAtomValue)(Jr),n=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{limit:100},t=(0,C.useSessionState)("serverOrigin");return(0,rt.useQuery)({queryKey:ot("FOLLOWUP",e),placeholderData:rt.keepPreviousData,queryFn:function(){return(0,at.apiRequests)(t).getPinnedCases(e)},refetchInterval:2e4})}({limit:100,sortBy:t.field,asc:"asc"===t.direction}),a=n.data,o=n.isFetched&&!(null==a?void 0:a.length),i=(0,ra.b7)({columns:Na(),data:a||Ya,getCoreRowModel:(0,aa.sC)(),getRowId:function(e){return e.caseId}});return(0,r.jsx)(va,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){qa(e,t,n[t])}))}return e}({noSelection:!0,noData:o,table:i,CaseFooterContent:(0,r.jsx)(Ga,{canViewCase:!0}),TableHeaderContent:(0,r.jsx)(Wa,{noData:o}),activeQueueItemAtom:Xr,queueItems:a},e))};function Ka(e,t){var n=(0,ae.useModalsStateMethods)().openModal,r=(0,He.useCaseStateMethods)().closeCasesAsSpam,o=(0,$.useLocalizationState)().t;return(0,a.useCallback)((function(){var a,i,s=null!==(a=null==e?void 0:e.length)&&void 0!==a?a:0;s&&n({title:o.WINDOW_POPUP_TITLES_AND_MESSAGES.window_title_warning(),body:s>1?o.EMAIL.spam_confirm_message_multiple(s.toString()):o.EMAIL.spam_confirm_message_single(null!==(i=e[0].caseNumber)&&void 0!==i?i:""),actions:{ok:{title:o.WINDOW_POPUP_TITLES_AND_MESSAGES.window_buttonOk(),action:function(){r(e.map((function(e){return e.caseId})),"TEAM"),null==t||t.setRowSelection(f()((function(t){e.forEach((function(e){delete t[e.caseId]}))})))}},cancel:{title:o.WINDOW_POPUP_TITLES_AND_MESSAGES.window_buttonCancel()}},className:"autoSizeModal"})}),[r,n,e,o.EMAIL,o.WINDOW_POPUP_TITLES_AND_MESSAGES,t])}function $a(e,t){var n=(0,$.useLocalizationState)().t,r=(0,C.useSessionState)("privileges"),o=(0,He.useCaseStateMethods)().deleteCases,i=(0,ae.useModalsStateMethods)().openModal;return(0,a.useCallback)((function(){var a,s=e.length;r.SYS_DELETE_CASES&&s&&i({title:n.WINDOW_POPUP_TITLES_AND_MESSAGES.window_title_warning(),body:s>1?n.EMAIL.trash_confirm_message_multiple(s.toString()):n.EMAIL.trash_confirm_message_single(null!==(a=e[0].caseNumber)&&void 0!==a?a:""),actions:{ok:{title:n.WINDOW_POPUP_TITLES_AND_MESSAGES.window_buttonOk(),action:function(){o(e.map((function(e){return e.caseId})),"TEAM"),null==t||t.resetRowSelection(),null==t||t.setRowSelection(f()((function(t){e.forEach((function(e){delete t[e.caseId]}))})))}},cancel:{title:n.WINDOW_POPUP_TITLES_AND_MESSAGES.window_buttonCancel()}},className:"autoSizeModal"})}),[o,i,r.SYS_DELETE_CASES,e,n.EMAIL,n.WINDOW_POPUP_TITLES_AND_MESSAGES,t])}var Xa=function(e){var t=e.table,n=e.canViewCase,o=(0,C.useSessionState)(["userId","privileges"]),i=o.userId,s=o.privileges,l=(0,kr.useAtomValue)(Qr),c=null!=l?l:{},u=c.caseId,d=c.queueId,f=c.queueType,m=(0,$.useLocalizationState)().t,p=(0,He.useCaseStateMethods)(),v=p.openCase,g=p.moveQueueItems,h=(0,a.useCallback)((function(){(0,we.assertDefined)(d),(0,we.assertDefined)(u),v({caseId:u,queueId:d,queueType:f})}),[d,f,u,v]),b=(0,a.useCallback)((function(){(0,we.assertDefined)(l),(0,we.assertDefined)(i),g({itemsToMove:[l],directions:{toQueueType:"PERSONAL",fromQueueType:"TEAM",toUserId:i}})}),[l,g,i]);(0,we.assertDefined)(l);var y=$a([l],t),S=Ka([l],t),x=(0,He.useCaseState)((function(e){var t;return u?null===(t=e.cases[u])||void 0===t?void 0:t.data:void 0})),j=null==x?void 0:x.status,I=null==x?void 0:x.pendingReasonId;return(0,we.assertDefined)(j),(0,we.assertDefined)(u),(0,we.assertDefined)(l.service),(0,r.jsxs)("div",{className:"flex w-full flex-wrap justify-between gap-y-2",children:[(0,r.jsxs)("div",{className:"flex flex-wrap gap-y-2",children:[n&&(0,r.jsx)(ta,{queueItem:l}),(0,r.jsx)(q.SemanticButton,{basic:!0,primary:!0,onClick:h,children:m.EMAIL.email_open_button()}),(0,r.jsx)(q.SemanticButton,{basic:!0,primary:!0,tooltip:m.EMAIL.email_grab_button_tooltip(),onClick:b,children:m.EMAIL.email_grab_button()}),(0,r.jsx)(q.SemanticButton,{basic:!0,color:"orange",onClick:S,children:m.EMAIL.button_spam_text()}),s.SYS_DELETE_CASES&&(0,r.jsx)(q.SemanticButton,{basic:!0,color:"red",onClick:y,icon:"trash",tooltip:m.EMAIL.button_trash_tooltip()})]}),(0,r.jsx)("div",{children:(0,r.jsx)(et,{caseId:u,initialPendingReasonId:I,service:l.service,initialStatus:j},u)})]})};function Ja(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Za(e){return function(e){if(Array.isArray(e))return Ja(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Ja(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ja(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function eo(){var e,t=(0,$.useLocalizationState)().t,n=(0,a.useMemo)((function(){return{all:t.EMAIL.email_teamQueue_allServices(),router:t.EMAIL.email_teamQueue_allPullServices(),team:t.EMAIL.email_teamQueue_allPushServices()}}),[t.EMAIL]),r=(e=(0,C.useSessionState)("privileges"),(0,a.useMemo)((function(){return e.CAN_SEE_CONTENTS_OF_EMAIL_PUSH_QUEUES?["router","team"]:[]}),[e.CAN_SEE_CONTENTS_OF_EMAIL_PUSH_QUEUES]));return(0,a.useMemo)((function(){return["all"].concat(Za(r)).map((function(e){return{value:e,text:n[e],"data-testid":"option","data-service":"true"}}))}),[n,r])}function to(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function no(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ro(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function ao(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||io(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function oo(e){return function(e){if(Array.isArray(e))return to(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||io(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function io(e,t){if(e){if("string"==typeof e)return to(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?to(e,t):void 0}}var so=function(e){var t=e.actualQueueCount,n=e.totalQueueCount,o=e.noData,i=eo(),s=bt(),l=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,C.useSessionState)("serverOrigin");return(0,rt.useQuery)({queryKey:st(),queryFn:function(){return(0,at.apiRequests)(t).getQueueCountByService(e)}})}({serviceIds:s.map((function(e){return e.value}))}),c=l.data,u=l.refetch,d=(0,a.useMemo)((function(){return oo(i).concat(oo(s)).filter((function(e){return"all"===e.value||(null==c?void 0:c[e.value])})).map((function(e){var t=null==c?void 0:c[e.value];return ro(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){no(e,t,n[t])}))}return e}({},e),{text:t?"".concat(e.text," (").concat(t,")"):e.text})}))}),[i,c,s]),f=ao((0,kr.useAtom)(Yr),2),m=f[0],p=f[1],v=(0,$.useLocalizationState)().t,g=function(){var e=(0,$.useLocalizationState)().t;return(0,a.useMemo)((function(){return[{value:"createTime",text:e.EMAIL.email_queue_field_createTime()},{value:"updateTime",text:e.EMAIL.email_queue_field_updateTime()},{value:"customerUpdate",text:e.EMAIL.email_queue_field_customerUpdate()},{value:"sla",text:e.EMAIL.email_queue_field_serviceLevel()},{value:"from",text:e.EMAIL.email_queue_field_from()},{value:"subject",text:e.EMAIL.email_queue_field_subject()},{value:"flag",text:e.EMAIL.email_queue_field_flag()}]}),[e.EMAIL])}();return(0,r.jsxs)("div",{className:"flex items-center justify-between",children:[(0,r.jsxs)("div",{className:"ml-2 flex items-center",children:[(0,r.jsx)("p",{className:"mr-1",children:v.EMAIL.email_teamQueue_service_label()}),(0,r.jsx)(q.Dropdown,{onOpen:u,options:d,inline:!0,value:m,onChange:function(e,t){"string"==typeof t.value&&p(t.value)}})]}),!o&&(0,r.jsx)(Oa,{sortingAtom:Kr,options:g}),!o&&(0,r.jsx)(ba,{paginationAtom:$r,actualQueueCount:t,totalQueueCount:n})]})};function lo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function co(e){return function(e){if(Array.isArray(e))return lo(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return lo(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return lo(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var uo=(0,aa.Cl)();var fo=n(3295);function mo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function po(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return mo(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return mo(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var vo=function(e){var t=e.teams,n=(0,C.useSessionState)("teamId"),o=po((0,kr.useAtom)(qr),2),i=o[0],s=o[1],l=(0,a.useMemo)((function(){return t.filter((function(e){return e.supervised||e.id===n})).map((function(e){return{key:e.id,text:e.name,value:e.id}}))}),[n,t]);return l.length<2?null:(0,r.jsx)(q.Dropdown,{className:"ml-2",options:l,onChange:function(e,t){"string"==typeof t.value&&s(t.value)},value:i||n,inline:!0})};function go(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ho=[],bo=function(e){var t,n,o=(0,kr.useAtomValue)(qr),i=(0,kr.useAtomValue)(Yr),s=(0,kr.useAtomValue)(Kr),l=(0,kr.useAtomValue)($r),c=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{skip:0,length:100},t=(0,C.useSessionState)("serverOrigin");return(0,rt.useQuery)({queryKey:ot("TEAM",e),queryFn:function(){return(0,at.apiRequests)(t).getTeamQueue(e)},placeholderData:rt.keepPreviousData,refetchInterval:2e4})}({services:i&&"all"!==i?[i]:void 0,team:o,length:l.size,skip:l.skip,sortBy:s.field,asc:"asc"===s.direction}),u=c.data,d=c.isFetched&&!(null==u?void 0:u.length),f=(0,ra.b7)({columns:(t=Na(),(0,a.useMemo)((function(){return[uo.display({id:"select",header:function(e){var t=e.table;return(0,r.jsx)("div",{className:"w-9.5 px-2.5 pt-1",children:(0,r.jsx)(q.Checkbox,{checked:t.getIsAllRowsSelected(),indeterminate:t.getIsSomeRowsSelected(),onChange:function(e){return t.toggleAllPageRowsSelected(e)}})})},cell:function(e){var t=e.row;return(0,r.jsx)("div",{className:"w-9.5 px-2.5 pt-1",children:(0,r.jsx)(q.Checkbox,{checked:t.getIsSelected(),disabled:!t.getCanSelect(),indeterminate:t.getIsSomeSelected(),onChange:function(e){return t.toggleSelected(e)}})})},size:38})].concat(co(t))}),[t])),data:u||ho,getCoreRowModel:(0,aa.sC)(),getRowId:function(e){return e.caseId}}),m=function(e){var t=(0,$.useLocalizationState)().t,n=(0,C.useSessionState)("teamId"),o=(0,kr.useAtomValue)(qr)||n,i=(0,fo.useDirectoryState)(["teams","isTeamsLoading"]),s=i.teams,l=i.isTeamsLoading,c=(0,fo.useDirectoryStateMethods)().getAgentTeams;(0,a.useEffect)((function(){l||s.length||c()}),[s,l,c]);var u=(0,a.useMemo)((function(){var e;return null===(e=s.find((function(e){return e.id===o})))||void 0===e?void 0:e.supervised}),[o,s]),d=Ra(Qr,e),f=(0,He.useCaseStateMethods)().moveQueueItems,m=(0,C.useSessionState)(),p=m.userId,v=m.privileges,g=(0,a.useCallback)((function(){(0,we.assertDefined)(p),f({directions:{fromQueueType:"TEAM",toQueueType:"PERSONAL",toUserId:p},itemsToMove:d}),e.resetRowSelection()}),[f,d,p,e]),h=$a(d,e),b=Ka(d,e),y=fr().mutate,S=(0,ae.useModalComponentOpener)(cr),x=(0,a.useCallback)((function(){S({queueItemsToMove:d,createNote:y})}),[y,S,d]);return(0,a.useMemo)((function(){return(0,r.jsxs)("div",{className:"flex justify-between px-2 pb-2 pt-3",children:[(0,r.jsxs)("div",{className:"flex",children:[u&&(0,r.jsx)(q.SemanticButton,{icon:!0,basic:!0,onClick:x,tooltip:t.EMAIL.email_assign_button_tooltip(),children:(0,r.jsx)(dn.IconForward,{})}),(0,r.jsx)(q.SemanticButton,{basic:!0,primary:!0,onClick:g,children:t.EMAIL.email_grab_button()})]}),(0,r.jsxs)("div",{children:[(0,r.jsx)(q.SemanticButton,{basic:!0,color:"orange",onClick:b,children:t.EMAIL.button_spam_text()}),v.SYS_DELETE_CASES&&(0,r.jsx)(q.SemanticButton,{basic:!0,color:"red",onClick:h,icon:"trash",tooltip:t.EMAIL.button_trash_tooltip()}),(0,r.jsx)(vo,{teams:s})]})]})}),[u,x,b,h,g,v.SYS_DELETE_CASES,t.EMAIL,s])}(f);return(0,r.jsx)(va,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){go(e,t,n[t])}))}return e}({noData:d,CaseFooterContent:(0,r.jsx)(Xa,{table:f,canViewCase:!0}),TableHeaderContent:(0,r.jsx)(so,{actualQueueCount:null!==(n=null==u?void 0:u.length)&&void 0!==n?n:0,noData:d,totalQueueCount:e.totalQueueCount}),table:f,queueItems:u,QueueControls:m,activeQueueItemAtom:Qr},e))};function yo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function So(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function xo(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function jo(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return yo(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return yo(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Io=function(){var e=(0,$.useLocalizationState)().t,t=jo((0,kr.useAtom)(Br),2),n=t[0],o=t[1],i=jo((0,kr.useAtom)(Fr),2),s=i[0],l=i[1],c=(0,kr.useAtomValue)(Hr),u=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=(0,C.useSessionState)("serverOrigin");return(0,rt.useQuery)({queryKey:it(e),queryFn:function(){return(0,at.apiRequests)(t).getQueueCount(e)}})}({team:(0,kr.useAtomValue)(qr),service:(0,kr.useAtomValue)(Yr),user:c.id}),d=u.data;!function(){var e=(0,rt.useQueryClient)(),t=!!(0,rt.useIsFetching)({queryKey:ot()});(0,a.useEffect)((function(){t&&e.invalidateQueries({queryKey:it()})}),[t,e])}();var f=function(){var e=(0,kr.useAtomValue)(qr),t=(0,C.useSessionState)("teamId"),n=(0,fo.useDirectoryState)("teams"),r=(0,$.useLocalizationState)().t;return(0,a.useMemo)((function(){var a=n.find((function(t){return t.id===e})),o=a&&a.id!==t?a.name:"";return o?r.EMAIL.queuePostfix(o):r.EMAIL.emailTeamQueue_header()}),[t,r.EMAIL,e,n])}(),m=function(){var e=(0,C.useSessionState)("userId"),t=(0,kr.useAtomValue)(Hr),n=(0,$.useLocalizationState)().t;return(0,a.useMemo)((function(){return e!==t.id?n.EMAIL.queuePostfix(t.name):n.EMAIL.emailPersonalQueue_header()}),[e,n.EMAIL,t])}(),p=(0,a.useMemo)((function(){function t(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:0,n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0;return n?"".concat(e," (").concat(n,"/").concat(t,")"):"".concat(e," (").concat(t,")")}function n(n){switch(n.type){case"queue":switch(n.queueType){case"TEAM":return t(f,null==d?void 0:d.team);case"PERSONAL":return t(m,null==d?void 0:d.personal,null==d?void 0:d.personalHighlighted);default:return t(e.EMAIL.emailFollowUpQueue_header(),null==d?void 0:d.followUp)}case"view_case":return n.case.number.toString()}}return s.map((function(e){return xo(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){So(e,t,n[t])}))}return e}({},e),{title:n(e)})}))}),[m,null==d?void 0:d.followUp,null==d?void 0:d.personal,null==d?void 0:d.personalHighlighted,null==d?void 0:d.team,e.EMAIL,s,f]),v=(0,a.useCallback)((function(e){return e.title}),[]),g=(0,a.useCallback)((function(e){if("queue"===e.type)switch(e.queueType){case"TEAM":return(0,r.jsx)(bo,{totalQueueCount:null==d?void 0:d.team});case"PERSONAL":return(0,r.jsx)(Va,{totalQueueCount:null==d?void 0:d.personal});default:return(0,r.jsx)(Qa,{totalQueueCount:null==d?void 0:d.followUp})}if("view_case"===e.type){var t="PERSONAL"===e.queueType?(0,r.jsx)(na,{}):"TEAM"===e.queueType?(0,r.jsx)(Xa,{}):(0,r.jsx)(Ga,{});return(0,r.jsx)(Er,{id:e.case.id,serviceId:e.case.serviceId,FooterContent:t})}}),[null==d?void 0:d.followUp,null==d?void 0:d.personal,null==d?void 0:d.team]),h=jo((0,kr.useAtom)(Br),2),b=h[0],y=h[1],S=(0,a.useCallback)((function(e){l((function(t){return t.filter((function(t){return t.id!==e}))})),b===e&&y(s[0].id)}),[b,y,l,s]);return function(){var e=(0,He.useCaseStateConnector)(),t=(0,rt.useQueryClient)(),n=(0,kr.useAtomValue)(Ur),r=(0,a.useCallback)((function(){(0,we.assertDefined)(n),t.invalidateQueries({queryKey:it()}),t.invalidateQueries({queryKey:ot(n.queueType)})}),[t,n]);(0,a.useEffect)((function(){var t=e.dispenser.subscribe({onQueueItemsMoved:r,onCasesDeleted:r,onCasesClosedAsSpam:r});return function(){t.unsubscribe()}}),[e.dispenser,r,t])}(),(0,r.jsx)("div",{className:"flex h-full flex-col","data-testid":"cases-page",children:(0,r.jsx)(q.Tabs,{onChange:o,className:"flex h-full min-h-0 flex-col",tabsContentClassName:"flex flex-col flex-auto h-auto",tabs:p,activeTabId:n,renderTab:v,onTabClose:S,renderTabContent:g})})},Oo=(0,kr.createStore)(),_o=function(e){var t=e.children,n=(0,C.useSessionState)(["userId","firstName","lastName"]),o=n.userId,i=n.firstName,s=n.lastName,l=(0,Ce.useFormatting)().formatFullName;return(0,a.useMemo)((function(){(0,we.assertDefined)(o),Oo.set(Hr,{id:o,name:l(i,s)})}),[l,i,s,o]),(0,r.jsx)(kr.Provider,{store:Oo,children:t})};function Co(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function wo(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Co(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Co(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var No=n(5632),Ao=n(2534),Eo=n(4692),To=n(1460);function Po(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Mo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Po(e,t,n[t])}))}return e}function Lo(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function ko(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var Do=function(e){var t=e.options,n=e.onChange,o=e.className,i=e.name,s=e.label,l=e.error,c=e.value,u=e.noValueLabel,d=void 0===u?"Please select":u,f=e.inputRef,m=e.placeholder,p=e.labelClassName,v=e.errorClassName,g=ko(e,["options","onChange","className","name","label","error","value","noValueLabel","inputRef","placeholder","labelClassName","errorClassName"]),h=(0,a.useCallback)((function(e){var t=e.target;if(t){var r=t.value||void 0;n(r,{name:i})}}),[i,n]);return(0,r.jsxs)("div",{className:W(o,"relative flex min-w-0 justify-between",{"text-red-500":l}),children:[s&&(0,r.jsx)("label",{className:W(p,"mt-1.5 flex-1"),children:s}),(0,r.jsxs)("select",Lo(Mo({placeholder:m,ref:f,value:c||"",onChange:h},g),{className:"max-w-full flex-[2] rounded-md border border-gray-400 bg-white p-1",children:[d&&(0,r.jsx)("option",{value:"",children:d}),null==t?void 0:t.map((function(e,t){return(0,r.jsx)("option",{value:e.value,children:e.label||e.value},t)}))]})),l&&(0,r.jsx)("p",{className:v,role:"alert aria-atomic",children:l})]})};function Ro(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Fo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Ro(e,t,n[t])}))}return e}function Bo(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Uo(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function zo(e){var t=e.ref,n=e.options,a=e.onChange,o=e.label,i=Uo(e,["ref","options","onChange","label"]),s=(0,N.uuid)();return(0,r.jsx)(Do,Bo(Fo({},i),{inputRef:t,label:o,placeholder:o,errorClassName:"self-end text-red-500","aria-labelledby":s,options:n,onChange:a}))}function Ho(e){return(0,r.jsx)(To.FieldRawConstructor,Bo(Fo({},e),{renderElement:zo}))}function Vo(e){return(0,r.jsx)(To.FieldConstructor,Bo(Fo({},e),{renderElement:zo}))}function Go(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Wo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Go(e,t,n[t])}))}return e}function qo(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Yo(e){return(0,r.jsx)(Te.InputField,Wo({},e))}function Qo(e){return(0,r.jsx)(To.FieldRawConstructor,qo(Wo({},e),{renderElement:Yo}))}function Ko(e){return(0,r.jsx)(To.FieldConstructor,qo(Wo({},e),{renderElement:Yo}))}var $o=function(e){var t=e.index,n=e.remove,o=(0,a.useCallback)((function(){n(t)}),[t,n]);return(0,r.jsx)("div",{className:"flex shrink-0 items-center",children:(0,r.jsx)("button",{onClick:o,"data-index":t,"aria-label":"Remove entry",title:"Remove entry",className:"cursor-pointer border-[none] bg-[none]",children:(0,r.jsx)(dn.IconCloseCircle,{})})})},Xo=function(e){var t=e.index,n=e.control,o=e.name,i=e.remove,s=e.typeClassName,l=e.layoutClassName,c=e.style,u=(0,$.useLocalizationState)().t,d=(0,Ce.useFormatting)().formatAddressType,f=(0,a.useMemo)((function(){return Object.keys(Ao.STATES).map((function(e){return{value:e,label:Ao.STATES[e]}}))}),[]),m=(0,a.useMemo)((function(){return Object.keys(Eo.AddressTypes).map((function(e){return{value:e,label:d(e)}}))}),[d]),p=(0,nt.useController)({name:"".concat(o,".").concat(t,".type"),control:n}).field,v=(0,nt.useController)({name:"".concat(o,".").concat(t,".address_line1"),control:n}).field,g=(0,nt.useController)({name:"".concat(o,".").concat(t,".address_line2"),control:n}).field,h=(0,nt.useController)({name:"".concat(o,".").concat(t,".city"),control:n}).field,b=(0,nt.useController)({name:"".concat(o,".").concat(t,".state"),control:n}).field,y=(0,nt.useController)({name:"".concat(o,".").concat(t,".postcode"),control:n}).field;return(0,r.jsxs)("div",{role:"row",className:W("flex items-start",l),children:[(0,r.jsx)(Ho,{style:c,className:s,field:p,options:m,placeholder:u.FORMS.address_type(),"aria-label":u.FORMS.address_type()}),(0,r.jsxs)("div",{className:W("flex min-w-0 flex-col",l),children:[(0,r.jsx)(Qo,{style:c,field:v,placeholder:u.FORMS.address_line_1(),"aria-label":u.FORMS.address_line_1()}),(0,r.jsx)(Qo,{style:c,field:g,placeholder:u.FORMS.address_line_2(),"aria-label":u.FORMS.address_line_2()}),(0,r.jsx)(Qo,{style:c,field:h,"aria-label":u.FORMS.city(),placeholder:u.FORMS.city()}),(0,r.jsxs)("div",{role:"row",className:W("flex items-start",l),children:[(0,r.jsx)(Ho,{style:c,field:b,options:f,placeholder:u.FORMS.state()}),(0,r.jsx)(Qo,{style:c,field:y,"aria-label":u.FORMS.zip(),placeholder:u.FORMS.zip()})]})]}),(0,r.jsx)($o,{index:t,remove:i})]})};function Jo(e){var t=e.append,n=e.AddButtonIcon,o=e.initialValues,i=e.addButtonText,s=(0,$.useLocalizationState)().t,l=(0,a.useCallback)((function(){t(o)}),[t,o]);return(0,r.jsx)("div",{children:(0,r.jsxs)("button",{onClick:l,className:"group/add-btn flex cursor-pointer border-[none] bg-[none] pl-0",title:s.CONTACT.add_entry_button_tooltip(),children:[(0,r.jsx)(n,{"aria-hidden":!0}),i&&(0,r.jsx)("span",{className:"ml-1 align-middle text-main-secondary group-hover/add-btn:text-black",children:i})]})})}var Zo=function(e){var t=e.label,n=e.layoutClassName,a=e.children;return(0,r.jsxs)("div",{className:W("flex min-w-0 flex-col",n),children:[t&&(0,r.jsx)("label",{children:t}),a]})},ei=function(e){var t=e.control,n=e.name,a=e.AddButtonIcon,o=e.addButtonText,i=e.renderComponents,s=e.layoutClassName,l=e.initialValues,c=e.label,u=e.className,d=(0,nt.useFieldArray)({control:t,name:n}),f=d.fields,m=d.append,p=d.remove;return(0,r.jsxs)("div",{className:W("flex flex-col",s,u),children:[f.map((function(e,t){return(0,r.jsx)(Zo,{layoutClassName:s,label:c,children:i(t,p,f.length)},t)})),(0,r.jsx)(Jo,{append:m,initialValues:l,AddButtonIcon:a,addButtonText:o})]})},ti={address_line1:"",address_line2:"",city:"",postcode:""},ni=function(e){var t=e.name,n=e.style,o=e.control,i=e.className,s=e.typeClassName,l=e.layoutClassName,c=(0,a.useCallback)((function(e,a){return(0,r.jsx)(Xo,{style:n,layoutClassName:l,typeClassName:s,remove:a,name:t,control:o,index:e})}),[n,l,o,t,s]);return(0,r.jsx)(ei,{className:i,layoutClassName:l,control:o,name:t,initialValues:ti,renderComponents:c,AddButtonIcon:dn.IconAddAddress})},ri=function(e){var t=e.label,n=e.value,a=e.viewStyle;return(0,r.jsxs)("div",{className:"flex w-full items-center gap-x-[--form-cellPadding] gap-y-[--form-rowHeight] overflow-hidden",children:[(0,r.jsx)("span",{className:"w-[--form-fieldLabelWidth] min-w-[--form-fieldLabelWidth] max-w-[--form-fieldLabelWidth]",children:t}),(0,r.jsx)("div",{className:"flex-auto",style:a,children:n})]})},ai=function(e){var t=e.pageItem,n=e.field,o=(0,x.useContext)(As),i=o.form,s=o.view,l=(0,Ce.useFormatting)().formatAddressType,c=(0,a.useId)(),u=(0,a.useId)();if(s){var d=i.getValues()[n.name||""],f=(0,No.getPageItemCSSProperties)(t.style);return(0,r.jsx)(r.Fragment,{children:null==d?void 0:d.map((function(e,t){var n=[e.address_line1,e.address_line2,e.city,Ao.STATES[e.state],e.postcode].filter(Boolean).join(", ");return(0,r.jsx)(ri,{viewStyle:f,label:l(e.type),value:(0,r.jsx)("a",{tabIndex:0,"aria-labelledby":"".concat(c," ").concat(u),id:u,children:n})},t)}))})}var m=(0,No.getPageItemCSSProperties)(t.editStyle);return(0,r.jsx)(ni,{name:n.name||"",control:i.control,style:m,layoutClassName:"gap-x-[--form-cellPadding] gap-y-[--form-rowHeight]",typeClassName:"w-[--form-fieldLabelWidth] min-w-[--form-fieldLabelWidth] max-w-[--form-fieldLabelWidth]"})};function oi(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ii(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){oi(e,t,n[t])}))}return e}function si(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var li=o().forwardRef((function(e,t){var n=e.id,a=e.className,o=e.inputClassName,i=e.label,s=e.error,l=e.value,c=e.onChange,u=e.onKeyDown,d=e.onBlur,f=e.minRows,m=void 0===f?1:f,p=e.maxRows,v=void 0===p?8:p,g=e.placeholder,h=void 0===g?"":g,b=e.labelClassName,y=e.wrapperClassName,S=e.errorClassName,x=si(e,["id","className","inputClassName","label","error","value","onChange","onKeyDown","onBlur","minRows","maxRows","placeholder","labelClassName","wrapperClassName","errorClassName"]);return(0,r.jsxs)("div",{className:W(y,"flex w-full flex-row"),children:[i&&(0,r.jsx)("label",{className:W("my-1 block",b),htmlFor:n,children:i}),(0,r.jsxs)("div",{className:"flex w-full flex-col",children:[(0,r.jsx)("div",{className:W(a,"box-border w-full flex-1 rounded border border-[#abb6bb] bg-white p-2","focus:border-[#4b85a0] focus:shadow-inner","hover:border-[#96a7b0] hover:shadow-inner",{"self-end border-[#ff8997] bg-[#ffdee2] text-red-500":s}),children:(0,r.jsx)(Te.TextArea,ii({ref:t,className:W(o,"m-0 box-border block w-full resize-none overflow-auto border-none bg-transparent p-0 leading-tight focus:outline-none"),value:l,onChange:c,onKeyDown:u,onBlur:d,minRows:m,maxRows:v,placeholder:h,id:n},x))}),s&&(0,r.jsx)("p",{className:S,role:"alert aria-atomic",children:s})]})]})}));function ci(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ui(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){ci(e,t,n[t])}))}return e}function di(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function fi(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function mi(e){var t=e.errorClassName,n=fi(e,["errorClassName"]),a=(0,N.uuid)();return(0,r.jsx)(li,di(ui({},n),{"aria-labelledby":a,errorClassName:W("self-end text-red-500",t)}))}function pi(e){return(0,r.jsx)(To.FieldConstructor,di(ui({},e),{renderElement:mi}))}var vi=function(e){var t=e.pageItem,n=e.control,a=e.multiline,o=e.placeholder,i=e.label,s=e.required,l=e.name,c=e.type,u=void 0===c?"text":c,d=e.minRows,f=(0,No.getFormElementStyle)(t),m=(0,No.getPageItemCSSProperties)(t.editStyle);return a?(0,r.jsx)(pi,{placeholder:o,label:i,required:s,name:l,control:n,minRows:d,wrapperClassName:"flex items-center gap-x-[--form-cellPadding] gap-y-[--form-rowHeight]",style:f,labelClassName:"w-[--form-fieldLabelWidth] min-w-[--form-fieldLabelWidth] max-w-[--form-fieldLabelWidth]"}):(0,r.jsx)(Ko,{placeholder:o,label:i,required:s,name:l,control:n,style:m,type:u})},gi=function(e){var t=e.pageItem,n=e.field,a=(0,x.useContext)(As),o=a.form;if(a.view){var i=(0,No.getPageItemCSSProperties)(t.style),s=o.getValues()[n.name||""];return n.hideEmpty&&!s?null:(0,r.jsx)(ri,{viewStyle:i,label:n.label||"",value:s})}return(0,r.jsx)(vi,{placeholder:n.emptyText||"",label:n.label,required:n.required,type:"number",name:n.name||"",control:o.control,pageItem:t,minRows:n.initialLinesNumber,multiline:n.multiline},n.key)};function hi(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function bi(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function yi(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Si(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return hi(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return hi(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xi(e,t){var n,r,a,o=(n=t,(null==n||null===(a=n.layout)||void 0===a||null===(r=a.pages)||void 0===r?void 0:r.flatMap((function(e){return(null==e?void 0:e.fields)||[]})).flat())||[]).filter((function(e){return!function(e){return"STATIC"===e.type&&("SECTION"===e.staticType||"CONTAINER"===e.staticType)}(e.field)}));return Object.entries(e).reduce((function(e,t){var n=Si(t,2),r=n[0],a=n[1],i=function(e){return"CUSTOM"===(null==e?void 0:e.field.type)&&(null==e?void 0:e.field.leadMappingString)?e.field.leadMappingString:"STATIC"===(null==e?void 0:e.field.type)&&"MESSENGER"===(null==e?void 0:e.field.staticType)&&(null==e?void 0:e.field.mapping)?e.field.mapping:""}(o.find((function(e){var t;return(null===(t=e.field)||void 0===t?void 0:t.name)===r})));return i?yi(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){bi(e,t,n[t])}))}return e}({},e),bi({},i,a)):e}),{})}var ji=n(2346),Ii=n(8124),Oi=n(2977);function _i(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ci(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function wi(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var Ni=function(e){var t=e.contactId,n=e.values,o=e.formDefinition,i=e.changeFormPageId,s=e.action,l=e.actionCases,c=e.children,u=e.dataKey,d=wi(e,["contactId","values","formDefinition","changeFormPageId","action","actionCases","children","dataKey"]),f=n&&o?xi(n||{},o):n,m=function(e){var t,n,r,o=e.contactId,i=e.actionCases,s=e.values,l=e.action,c=e.changeFormPageId,u=(0,J.useInteractionStateMethods)(),d=u.initiateCall,f=u.initiateChat,m=(0,ji.useContact)(o),p=(0,te.useInteractionChatStateMethods)().addMessageToPending,v=(0,ke.useNavigationState)("setActivePage"),g=(0,C.useSessionState)().privileges,b=!!Object.keys(g).length&&g.CAN_START_EXTERNAL_CHAT,y=(0,J.useInteractionStateMethods)(),S=(0,Ve.useServicesDispositionsState)().services,x=(0,h.useServiceState)().selectedService,I=(0,Ii.useDIDNumberState)().selectedDIDNumber,O=(0,K.useNotificationsState)("methods"),_=O.showNotification,w=O.hideNotificationsByTag,N=(0,Oi.useErrorValidation)().getServiceAndDIDNumbersErrors,A=(0,Ve.useServicesDispositionsState)().dispositions,E=(0,j.getAssociatedChatServiceId)(S,x),T=(0,a.useCallback)((function(e){null==i||i.forEach((function(t){(0,No.checkConditions)({conditions:null==t?void 0:t.conditions,values:s})&&e(t)}))}),[s,i]),P=(0,a.useCallback)((function(e){if(null==e?void 0:e.numberToCall){var t,n,r=N({skip:["noChatInService"],interactionType:"call"});if(r.length)return void _(r[0]);w("interaction-init"),d({phone:e.numberToCall,serviceId:x,accessNumberId:I,contactId:o,firstName:null==m||null===(t=m.data)||void 0===t?void 0:t.firstName,lastName:null==m||null===(n=m.data)||void 0===n?void 0:n.firstName,origination:"contact-profile"}),v({name:ke.AppRoutes.Interactions})}}),[null==m||null===(t=m.data)||void 0===t?void 0:t.firstName,o,N,w,d,I,x,v,_]),M=(0,a.useCallback)((function(e){if(b&&(null==e?void 0:e.numberToSMS)){var t,n;(null==e?void 0:e.messageToSMS)&&p({content:e.messageToSMS,channel:"sms",type:"message"},e.numberToSMS);var r=N({interactionType:"sms"});if(r.length)return void _(r[0]);w("interaction-init"),f({channel:"sms",address:e.numberToSMS,serviceId:E,displayData:{firstName:null==m||null===(t=m.data)||void 0===t?void 0:t.firstName,lastName:null==m||null===(n=m.data)||void 0===n?void 0:n.lastName},accessNumberId:I,contactId:o,origination:"contact-profile"}),v({name:ke.AppRoutes.Interactions})}}),[null==m||null===(n=m.data)||void 0===n?void 0:n.firstName,null==m||null===(r=m.data)||void 0===r?void 0:r.lastName,p,E,b,o,N,f,w,I,v,_]),L=(0,a.useCallback)((function(e){(null==e?void 0:e.searchText)&&v({name:ke.AppRoutes.KnowledgeBase,params:{searchText:e.searchText}})}),[v]),k=(0,a.useCallback)((function(e){e.page&&(null==c||c(e.page))}),[c]),D=(0,J.useInteractions)(),R=(0,ce.useDisconnectButtonClickHandler)(),F=(0,a.useCallback)((function(){var e=D.find((function(e){return e.contactId===o}));e&&R(e,{completeAfterDisconnect:!0,openInteractionsPageOnError:!0})}),[o,R,D]),B=(0,a.useCallback)((function(e){var t,n,r=D.find((function(e){return e.contactId===o}));if(r){var a=e.disposition,i=(0,j.isWorkItem)(r)?null==r||null===(t=r.workitemData)||void 0===t?void 0:t.serviceId:null==r||null===(n=r.scenarioData)||void 0===n?void 0:n.serviceId,s=i?A[i]:{},l=Object.values(s).find((function(e){return e.name===a}));l&&y.setDisposition({itemId:r.id,disposition:{id:l.id,name:l.name}}),R(r,{completeAfterDisconnect:!0,openInteractionsPageOnError:!0,disposition:l})}}),[o,A,R,y,D]),U=(0,a.useCallback)((function(){T(F)}),[F,T]),z=(0,a.useCallback)((function(){T(B)}),[T,B]),H=(0,a.useCallback)((function(){T(P)}),[T,P]),V=(0,a.useCallback)((function(){T(M)}),[T,M]),G=(0,a.useCallback)((function(){T(L)}),[L,T]),W=(0,a.useCallback)((function(){T(k)}),[k,T]);return(0,a.useCallback)((function(){"Start SMS"===l&&V(),"Call number"===l&&H(),"Search Knowledge Base"===l&&G(),"Complete"===l&&U(),"Disposition"===l&&z(),"Go To Page"===l&&W()}),[l,V,H,G,U,z,W])}({contactId:t,actionCases:l,action:s,values:f,changeFormPageId:i}),p=function(e){var t=(0,C.useSessionState)(),n=t.privileges,r=t.phoneDeviceCapabilities,o=(0,h.useServiceState)().selectedService,i=(0,Ve.useServicesDispositionsState)().outboundChatChannels;return(0,a.useMemo)((function(){var t,a=!!Object.keys(n).length&&!!n.CAN_START_EXTERNAL_CHAT;return"Start SMS"===e?a&&!(!o||!(null===(t=i[o])||void 0===t?void 0:t.includes("SMS"))):"Call number"!==e||!!r.canDial}),[i,r.canDial,n,o,e])}(s),v=function(e){var t=e.values,n=e.actionCases;return null==n?void 0:n.some((function(e){return(0,No.checkConditions)({values:t,conditions:null==e?void 0:e.conditions})}))}({values:f,actionCases:l}),g=!v||!p;return(0,r.jsx)(q.SemanticButton,Ci(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){_i(e,t,n[t])}))}return e}({},d),{"data-testid":u,"data-form-field":"true","data-field-type":"button","data-disabled":g||void 0,onClick:m,basic:!0,disabled:g,children:c}))};function Ai(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ei(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}var Ti=function(e){var t=e.style,n=e.value,o=e.className,i=(0,a.useMemo)((function(){return Ei(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Ai(e,t,n[t])}))}return e}({},t),{minHeight:null==t?void 0:t.height})}),[t]);return(0,r.jsx)("img",{className:o,src:n?"data:image;base64,".concat(n):void 0,style:i,alt:"form-image"})},Pi=function(e){var t=e.height,n=(0,a.useMemo)((function(){return"number"!=typeof t?{}:{flexShrink:0,height:2*t}}),[t]);return(0,r.jsx)("div",{style:n})},Mi=function(e){var t=e.field,n=(0,x.useContext)(As),a=n.form,o=n.formDefinition,i=n.changeFormPageId;return(0,r.jsx)(Ni,{actionCases:t.properties.actionCase,action:t.properties.action,values:a.getValues(),formDefinition:o,changeFormPageId:i,children:t.value})};function Li(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ki(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Li(e,t,n[t])}))}return e}function Di(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Ri(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function Fi(e){var t=e.value,n=e.type,a=void 0===n?"checkbox":n,o=e.radioValue,i=Ri(e,["value","type","radioValue"]),s="checkbox"===a?t:t===o;return"checkbox"===a?(0,r.jsx)(q.Checkbox,Di(ki({},i),{type:"checkbox",checked:s})):(0,r.jsx)(q.Checkbox,Di(ki({},i),{type:"radio",checked:s,value:null!=o?o:""}))}function Bi(e){return(0,r.jsx)(To.FieldConstructor,Di(ki({},e),{renderElement:Fi}))}var Ui=function(e){var t=e.pageItem,n=e.field,a=(0,x.useContext)(As),o=a.form;if(a.view){var i=o.getValues()[n.name||""],s=(0,No.getPageItemCSSProperties)(t.style);return i?(0,r.jsx)(ri,{viewStyle:s,label:n.label||"",value:(0,r.jsx)(q.Checkbox,{checked:i,onChange:m.noop})}):null}var l=(0,No.getFormElementStyle)(t),c=o.getValues(n.name||"");return(0,r.jsx)(Bi,{name:n.name||"",control:o.control,className:V()("flex items-center gap-x-[--form-cellPadding] gap-y-[--form-rowHeight]",{"line-through":n.crossOutWhenChecked&&c}),style:l,label:n.label,required:n.required,disabled:n.intentCheckOnly,type:"checkbox"})};function zi(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Hi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){zi(e,t,n[t])}))}return e}function Vi(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Gi(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function Wi(e){var t=e.ref,n=e.error,a=Gi(e,["ref","error"]);return(0,r.jsxs)("div",{children:[(0,r.jsx)(re.SmRef,{innerRef:t,children:(0,r.jsx)(To.DateTimeBase,Hi({},a))}),n&&(0,r.jsx)("p",{className:"self-end text-red-500",role:"alert aria-atomic",children:n})]})}function qi(e){return(0,r.jsx)(To.FieldConstructor,Vi(Hi({},e),{renderElement:Wi}))}var Yi=function(e){var t=e.pageItem,n=e.field,a=(0,x.useContext)(As),o=a.form;if(a.view){var i=o.getValues()[n.name||""],s=(0,No.getPageItemCSSProperties)(t.style);if(n.hideEmpty&&!i)return null;var l=i?(0,X.formatDate)(i):"";return(0,r.jsx)(ri,{viewStyle:s,label:n.label||"",value:l})}var c,u=(0,No.getPageItemCSSProperties)(t.editStyle);return(0,r.jsx)(qi,{placeholder:n.emptyText||"",label:n.label||"",required:n.required,control:o.control,style:u,name:n.name||"",className:V()("w-full","[&>.field]:w-full [&>.field>*]:w-full","[&>.field>*>input]:p-[5px] [&>.field>*>input]:flex-auto","[&>.field>*>input]:border [&>.field>*>input]:border-default [&>.field>*>input]:rounded-none [&>.field>*>input]:leading-6"),labelClassName:"!leading-3 caption-s text-primary-on-primary cursor-pointer",displayFormat:null!==(c=n.displayFormat)&&void 0!==c?c:void 0})},Qi=function(e){var t=e.pageItem,n=e.field,a=(0,x.useContext)(As),o=a.form;if(a.view){var i=o.getValues()[n.name||""],s=(0,No.getPageItemCSSProperties)(t.style);return i?(0,r.jsx)(ri,{viewStyle:s,label:n.label||"",value:(0,r.jsx)("a",{"data-value":i,tabIndex:0,children:i})}):null}return(0,r.jsx)(vi,{placeholder:n.emptyText||"",label:n.label,required:n.required,type:"email",name:n.name||"",control:o.control,pageItem:t,minRows:n.initialLinesNumber,multiline:n.multiline},n.key)};function Ki(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function $i(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Ki(e,t,n[t])}))}return e}function Xi(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Ji(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function Zi(e){var t=e.ref,n=Ji(e,["ref"]);return(0,r.jsx)(re.SmRef,{innerRef:t,children:(0,r.jsx)("input",$i({hidden:!0,"data-form-field":"true","data-field-type":"hidden-field"},n))})}function es(e){return(0,r.jsx)(To.FieldRawConstructor,Xi($i({},e),{renderElement:Zi}))}var ts=function(e){var t,n=e.idFieldName,a=e.selectFieldName,o=e.textFieldName,i=e.textFiledRules,s=e.style,l=e.control,c=e.index,u=e.options,d=e.remove,f=e.inputType,m=e.typeClassName,p=e.layoutClassName,v=(0,nt.useController)({name:n,control:l}).field,g=(0,nt.useController)({name:a,control:l}).field,h=(0,nt.useController)({name:o,control:l,rules:i}),b=h.field,y=null===(t=h.fieldState.error)||void 0===t?void 0:t.message;return(0,r.jsxs)("div",{role:"row",className:W(p,"flex flex-row"),children:[(0,r.jsx)(es,{field:v}),(0,r.jsx)(Ho,{className:m,field:g,style:s,options:u}),(0,r.jsx)(Qo,{field:b,style:s,type:f,error:y}),(0,r.jsx)($o,{index:c,remove:d})]})},ns={type:Eo.EmailTypes.BUSINESS,email_address:""},rs=function(e){var t=e.name,n=e.control,o=e.className,i=e.typeClassName,s=e.layoutClassName,l=e.style,c=(0,Ce.useFormatting)().formatEmailType,u=(0,To.useEmailValidationRules)(),d=(0,a.useMemo)((function(){return Object.keys(Eo.EmailTypes).map((function(e){return{value:e,label:c(e)}}))}),[c]),f=(0,a.useCallback)((function(e,a){return(0,r.jsx)(ts,{idFieldName:"".concat(t,".").concat(e,".id"),selectFieldName:"".concat(t,".").concat(e,".type"),textFieldName:"".concat(t,".").concat(e,".email_address"),control:n,layoutClassName:s,typeClassName:i,index:e,options:d,textFiledRules:u,inputType:"email",remove:a,style:l})}),[s,i,t,n,d,u,l]);return(0,r.jsx)(ei,{className:o,layoutClassName:s,control:n,name:t,initialValues:ns,renderComponents:f,AddButtonIcon:dn.IconAddEmail})},as=function(e){var t=e.pageItem,n=e.field,o=(0,x.useContext)(As),i=o.form,s=o.view,l=(0,Ce.useFormatting)().formatEmailType,c=(0,a.useId)(),u=(0,a.useId)();if(s){var d=i.getValues()[n.name||""],f=(0,No.getPageItemCSSProperties)(t.style);return(0,r.jsx)(r.Fragment,{children:null==d?void 0:d.map((function(e,t){return(0,r.jsx)(ri,{viewStyle:f,label:l(e.type),value:(0,r.jsx)("a",{tabIndex:0,"aria-labelledby":"".concat(c," ").concat(u),id:u,children:e.email_address})},t)}))})}var m=(0,No.getPageItemCSSProperties)(t.editStyle);return(0,r.jsx)(rs,{name:n.name||"",control:i.control,style:m,layoutClassName:"gap-x-[--form-cellPadding] gap-y-[--form-rowHeight]",typeClassName:"w-[--form-fieldLabelWidth] min-w-[--form-fieldLabelWidth] max-w-[--form-fieldLabelWidth]"})};function os(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function is(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){os(e,t,n[t])}))}return e}var ss=function(e){var t=e.pageItem,n=e.field,a=(0,x.useContext)(As),o=a.form;if(a.view){var i=o.getValues()[n.name||""],s=(0,No.getPageItemCSSProperties)(t.style),l=(0,No.getFormElementStyle)(t);return i?(0,r.jsx)(Ti,{style:is({},s,l),value:i}):null}return null},ls=function(e){var t=e.field,n=(0,x.useContext)(As).runtimeVariables,a=(0,No.parseTemplateToString)(t.value||"",n);return(0,r.jsx)("h4",{children:a})},cs=function(e){var t=e.field;return(0,r.jsx)("a",{href:t.linkUrl,target:"_blank",rel:"noopener noreferrer",className:"underline",children:t.initialValue||t.linkUrl})},us=n(7517),ds=["telegram","twitter"],fs=function(e){var t=e.control,n=e.userNameFieldName,o=e.typeFiledName,i=e.userIdFieldName,s=e.accountIdFieldName,l=e.availableMessengers,c=e.userNameDefault,u=e.accountIdDefault,d=e.userIdDefault,f=e.typeClassName,m=e.style,p=(0,$.useLocalizationState)().t,v=(0,nt.useController)({name:s,defaultValue:u||"",control:t}).field,g=(0,nt.useController)({name:o,control:t}).field,h=(0,nt.useController)({name:i,control:t,defaultValue:d||""}).field,b=(0,nt.useController)({name:n,control:t,defaultValue:c||""}).field,y=(0,nt.useWatch)({control:t,name:s}),S=(0,a.useMemo)((function(){var e;return null===(e=l.find((function(e){return e.id===y})))||void 0===e?void 0:e.type}),[y,l]),x=!!S&&ds.includes(S),j=(0,q.useGetMessengerName)(),I=(0,a.useMemo)((function(){return l.map((function(e){return{value:e.id,label:j(e.type)}}))}),[l,j]);return(0,a.useEffect)((function(){g.onChange(S)}),[S,g]),(0,a.useEffect)((function(){x||b.onChange("")}),[x,b]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(Ho,{className:f,style:m,field:v,placeholder:p.UNDEFINED.contact_messenger(),options:I}),(0,r.jsx)(es,{field:g}),(0,r.jsx)(Qo,{style:m,placeholder:p.UNDEFINED.contact_messenger_user_id_placeholder(),field:h}),x&&(0,r.jsx)(Qo,{style:m,placeholder:p.UNDEFINED.contact_messenger_username_placeholder(),field:b})]})},ms={type:null,user_name:"",user_id:"",account_id:""},ps=function(e){var t=e.availableMessengers,n=e.name,o=e.control,i=e.className,s=e.layoutClassName,l=e.typeClassName,c=e.style,u=(0,nt.useFieldArray)({control:o,name:n}),d=u.fields,f=u.append,m=u.remove,p=(0,a.useCallback)((function(e,a,i){return(0,r.jsxs)("div",{role:"row",className:W(s,"flex flex-row"),children:[(0,r.jsx)(fs,{control:o,typeFiledName:"".concat(n,".").concat(a,".type"),userIdFieldName:"".concat(n,".").concat(a,".user_id"),userNameFieldName:"".concat(n,".").concat(a,".user_name"),accountIdFieldName:"".concat(n,".").concat(a,".account_id"),availableMessengers:t,accountIdDefault:e.account_id,userIdDefault:e.user_id,userNameDefault:e.user_name,typeClassName:l,style:c}),(0,r.jsx)($o,{index:a,remove:i})]})}),[t,o,s,n,c,l]);return(0,r.jsxs)("div",{className:W("flex flex-col",s,i),children:[d.map((function(e,t){return(0,r.jsx)(Zo,{children:p(e,t,m)},t)})),Boolean(t.length)&&(0,r.jsx)(Jo,{append:f,initialValues:ms,AddButtonIcon:dn.IconAddMessenger})]})};function vs(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function gs(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){vs(e,t,n[t])}))}return e}var hs=function(e){var t=e.pageItem,n=e.field,a=(0,x.useContext)(As),o=a.form,i=a.view,s=a.contactData,l=(0,te.useInteractionChatState)("messengers"),c=(0,q.useGetMessengerName)();if(i){var u=o.getValues()[n.name||""],d=(0,No.getPageItemCSSProperties)(t.style);return u?(0,r.jsx)(r.Fragment,{children:null==u?void 0:u.map((function(e,t){return(0,r.jsx)(ri,{viewStyle:d,label:c(e.type),value:(0,r.jsx)(us.MessengerView,gs({messenger:e},s))},t)}))}):null}var f=(0,No.getPageItemCSSProperties)(t.editStyle);return(0,r.jsx)(ps,{name:n.name||"",control:o.control,style:f,availableMessengers:l,layoutClassName:"gap-x-[--form-cellPadding] gap-y-[--form-rowHeight]",typeClassName:"w-[--form-fieldLabelWidth] min-w-[--form-fieldLabelWidth] max-w-[--form-fieldLabelWidth]"})},bs=function(e){var t=e.pageItem,n=e.field,a=(0,x.useContext)(As).form;return(0,r.jsx)(vi,{placeholder:n.emptyText||"",label:n.label,required:n.required,name:n.name||"",control:a.control,pageItem:t,minRows:n.initialLinesNumber,multiline:n.multiline},n.key)},ys=function(e){var t,n,o,i=e.phone,s=(t=(0,J.useInteractionStateMethods)(),n=(0,h.useServiceState)().selectedService,o=(0,Ii.useDIDNumberState)().selectedDIDNumber,(0,a.useCallback)((function(e){e.preventDefault();var r=e.currentTarget.getAttribute("data-phone");r&&t.initiateCall({phone:r,serviceId:n,accessNumberId:o})}),[n,o,t]));return(0,r.jsx)("a",{onClick:s,"data-phone":i,tabIndex:0,children:(0,X.formatPhone)(i)})},Ss=function(e){var t=e.pageItem,n=e.field,a=(0,x.useContext)(As),o=a.form;if(a.view){var i=o.getValues()[n.name||""],s=(0,No.getPageItemCSSProperties)(t.style);return i?(0,r.jsx)(ri,{viewStyle:s,label:n.label||"",value:(0,r.jsx)(ys,{phone:i})}):null}return(0,r.jsx)(vi,{placeholder:n.emptyText||"",label:n.label,required:n.required,type:"tel",name:n.name||"",control:o.control,pageItem:t,minRows:n.initialLinesNumber,multiline:n.multiline},n.key)},xs={type:Eo.PhoneTypes.BUSINESS,phone:""},js=function(e){var t=e.name,n=e.style,o=e.control,i=e.className,s=e.typeClassName,l=e.layoutClassName,c=(0,Ce.useFormatting)().formatPhoneType,u=(0,To.usePhoneValidationRules)(),d=(0,a.useMemo)((function(){return Object.keys(Eo.PhoneTypes).map((function(e){return{value:e,label:c(e)}}))}),[c]),f=(0,a.useCallback)((function(e,a){return(0,r.jsx)(ts,{idFieldName:"".concat(t,".").concat(e,".id"),selectFieldName:"".concat(t,".").concat(e,".type"),textFieldName:"".concat(t,".").concat(e,".phone"),control:o,typeClassName:s,index:e,options:d,textFiledRules:u,inputType:"tel",remove:a,layoutClassName:l,style:n})}),[s,t,o,d,u,l,n]);return(0,r.jsx)(ei,{layoutClassName:l,className:i,control:o,name:t,initialValues:xs,renderComponents:f,AddButtonIcon:dn.IconAddPhone})},Is=function(e){var t=e.pageItem,n=e.field,a=(0,x.useContext)(As),o=a.form,i=a.view,s=(0,Ce.useFormatting)().formatPhoneType;if(i){var l=o.getValues()[n.name||""],c=(0,No.getPageItemCSSProperties)(t.style);return(0,r.jsx)(r.Fragment,{children:null==l?void 0:l.map((function(e,t){return(0,r.jsx)(ri,{viewStyle:c,label:s(e.type),value:(0,r.jsx)(ys,{phone:e.phone})},t)}))})}var u=(0,No.getPageItemCSSProperties)(t.editStyle);return(0,r.jsx)(js,{name:n.name||"",control:o.control,style:u,layoutClassName:"gap-x-[--form-cellPadding] gap-y-[--form-rowHeight]",typeClassName:"w-[--form-fieldLabelWidth] min-w-[--form-fieldLabelWidth] max-w-[--form-fieldLabelWidth]"})},Os=function(e){var t=e.pageItem,n=e.field,o=(0,x.useContext)(As),i=o.form,s=o.view,l=(0,a.useMemo)((function(){return n.listNameDataItems.map((function(e){return{value:e.id,label:e.name}||[]}))}),[n]),c=(0,No.getPageItemCSSProperties)(t.editStyle);if(s){var u,d=i.getValues()[n.name||""],f=null==l||null===(u=l.find((function(e){return e.value===d})))||void 0===u?void 0:u.label,m=(0,No.getPageItemCSSProperties)(t.style);return n.hideEmpty&&!d?null:(0,r.jsx)(ri,{viewStyle:m,label:n.label||"",value:f})}return(0,r.jsx)(Vo,{name:n.name||"",placeholder:n.emptyText||"",label:n.label||"",required:n.required,control:i.control,style:c,options:l,className:"flex items-center gap-x-[--form-cellPadding] gap-y-[--form-rowHeight]",labelClassName:"w-[--form-fieldLabelWidth] min-w-[--form-fieldLabelWidth] max-w-[--form-fieldLabelWidth]"})},_s=function(e){var t=e.pageItem,n=(0,No.getFormElementStyle)(t).height;return(0,r.jsx)(Pi,{height:n})},Cs=function(e){var t=e.pageItem,n=e.field,a=(0,x.useContext)(As),o=a.form;if(a.view){var i=o.getValues()[n.name||""],s=(0,No.getPageItemCSSProperties)(t.style);return n.hideEmpty&&!i?null:(0,r.jsx)(ri,{viewStyle:s,label:n.label||"",value:i})}return(0,r.jsx)(vi,{placeholder:n.emptyText||"",label:n.label,required:n.required,name:n.name||"",control:o.control,minRows:n.initialLinesNumber,multiline:n.multiline,pageItem:t})};var ws=function(e){var t=e.pageItem,n=t.field,o=function(e){var t=(0,x.useContext)(As),n=t.intents,r=t.runtimeVariables;return(0,a.useMemo)((function(){return!(0,No.isFieldWithConditions)(e)||!!(0,No.checkConditions)({conditions:e.conditions,values:r,intents:n})}),[e,r,n])}(n);if(!o)return null;if("CUSTOM"===(null==n?void 0:n.type))switch(null==n?void 0:n.customType){case"TEXT":return(0,r.jsx)(Cs,{pageItem:t,field:n});case"EMAIL":return(0,r.jsx)(Qi,{pageItem:t,field:n});case"PHONE":return(0,r.jsx)(Ss,{pageItem:t,field:n});case"PHONE_LIST":return(0,r.jsx)(Is,{pageItem:t,field:n});case"EMAIL_LIST":return(0,r.jsx)(as,{pageItem:t,field:n});case"ADDRESS_LIST":return(0,r.jsx)(ai,{pageItem:t,field:n});case"DATETIME":return(0,r.jsx)(Yi,{pageItem:t,field:n});case"CHECKBOX":return(0,r.jsx)(Ui,{pageItem:t,field:n});case"KEY_VALUE_LIST":return(0,r.jsx)(Os,{pageItem:t,field:n});case"NOTES":return(0,r.jsx)(bs,{pageItem:t,field:n});case"AMOUNT":return(0,r.jsx)(gi,{pageItem:t,field:n});case"IMAGE":return(0,r.jsx)(ss,{pageItem:t,field:n})}if("STATIC"===(null==n?void 0:n.type))switch(null==n?void 0:n.staticType){case"LINK":return(0,r.jsx)(cs,{field:n});case"TEXT":return(0,r.jsx)(ls,{field:n});case"SPACER":return(0,r.jsx)(_s,{pageItem:t});case"BUTTON":return(0,r.jsx)(Mi,{field:n});case"MESSENGER":return(0,r.jsx)(hs,{pageItem:t,field:n})}return"STATIC"===(null==n?void 0:n.type)&&"CONTAINER"===(null==n?void 0:n.staticType)||"STATIC"===(null==n?void 0:n.type)&&"SECTION"===(null==n?void 0:n.staticType)||console.warn("Not supported field type",n),null};function Ns(){var e,t=(0,x.useContext)(As),n=t.formDefinition,o=t.pageIndex,i=(0,a.useMemo)((function(){var e,t,r;return(null==n||null===(r=n.layout)||void 0===r||null===(t=r.pages)||void 0===t||null===(e=t[o])||void 0===e?void 0:e.fields)||[]}),[null==n||null===(e=n.layout)||void 0===e?void 0:e.pages,o]),s=i.filter((function(e){return!(0,No.checkIsLayout)(e.field)}));return(0,r.jsx)(r.Fragment,{children:s.map((function(e){return(0,r.jsx)(ws,{pageItem:e},e.field.id)}))})}var As,Es=function(e){var t=e.contentItem;return(0,No.isRecuriveFormLayout)(t)?(0,r.jsx)("div",{"data-testid":t.key,className:"gap-6",style:(0,No.calculateContainerStyle)(t),children:t.content.map((function(e){var t=(0,No.isRecuriveFormLayout)(e)?e.key:e.field.id;return(0,r.jsx)(Es,{contentItem:e},t)}))}):(0,r.jsx)(ws,{pageItem:t})};function Ts(){var e,t=(0,x.useContext)(As),n=t.formDefinition,o=t.pageIndex,i=(0,a.useMemo)((function(){var e,t,r;return(null==n||null===(r=n.layout)||void 0===r||null===(t=r.pages)||void 0===t||null===(e=t[o])||void 0===e?void 0:e.fields)||[]}),[null==n||null===(e=n.layout)||void 0===e?void 0:e.pages,o]),s=(0,a.useMemo)((function(){return(0,No.transformFormDefinitionsToLayout)(i)}),[i]);return(0,r.jsx)(r.Fragment,{children:s.map((function(e){return(0,r.jsx)(Es,{contentItem:e},e.key)}))})}function Ps(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ms=function(e){var t=e.variables,n=void 0===t?{}:t,o=e.formDefinition,i=e.intents,s=void 0===i?[]:i,l=e.pageIndex,c=void 0===l?0:l,u=e.changeFormPageId,d=e.view,f=void 0!==d&&d,m=e.onFormAvailable,p=e.contactData,v=e.defaultValues,g=e.shouldResetOnChange,h=void 0!==g&&g,b=e.compact,y=void 0!==b&&b,S=(0,nt.useForm)({defaultValues:v,mode:"onChange",reValidateMode:"onChange"}),j=(0,a.useRef)(!1);(0,a.useEffect)((function(){j.current?h&&(S.reset(v),setTimeout(S.trigger)):j.current=!0}),[h,v,S]),(0,a.useEffect)((function(){null==m||m(S)}),[S,m]);var I=S.watch(),O=(0,a.useMemo)((function(){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Ps(e,t,n[t])}))}return e}({},n,(0,No.createLeadMappingStringToFormValueMap)(I,o))}),[o,n,I]),_=(0,a.useMemo)((function(){return(0,No.getFormCSSVariables)(o)}),[o]),C=(0,a.useMemo)((function(){return{formDefinition:o,pageIndex:c,changeFormPageId:u,view:f,contactData:p,form:S,runtimeVariables:O,intents:s,compact:y}}),[o,c,u,f,p,S,O,s,y]);return As||(As=(0,x.createContext)(C)),(0,r.jsxs)(As.Provider,{value:C,children:[(0,r.jsx)("div",{style:_,className:"   flex   flex-auto   flex-col   gap-6   bg-[--form-backgroundColor]   text-[--form-textColor]   ",children:y?(0,r.jsx)(Ns,{}):(0,r.jsx)(Ts,{})}),!1]})};function Ls(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ks=function(e){var t,n=e.pageIndex,r=e.formDefinition,o=e.form,i=(0,l.useInteractionWorkspaceState)().shownWorkspaceItem,s=(0,w.useAsRef)(i),c=(0,J.useInteractionStateMethods)(),u=c.setFormValues,d=c.setNotes,f=(0,a.useMemo)((function(){var e,t,a;return(null==r||null===(a=r.layout)||void 0===a||null===(t=a.pages)||void 0===t||null===(e=t[n])||void 0===e?void 0:e.fields)||[]}),[null==r||null===(t=r.layout)||void 0===t?void 0:t.pages,n]);(0,a.useEffect)((function(){"wrap_up"===(null==i?void 0:i.state)&&(null==o||o.trigger())}),[null==i?void 0:i.state,o]);var p=(0,w.useEvent)((function(){var e,t;null==o||o.reset(null==i||null===(t=i.details)||void 0===t||null===(e=t.formData)||void 0===e?void 0:e.values)}));(0,a.useEffect)((function(){p()}),[n,p]);var v=(0,a.useMemo)((function(){return(0,m.debounce)((function(e){var t,n;(null===(t=s.current)||void 0===t?void 0:t.id)&&u(null===(n=s.current)||void 0===n?void 0:n.id,e)}),300)}),[s,u]),g=(0,a.useMemo)((function(){return(0,m.debounce)((function(e){var t,n;(null===(t=s.current)||void 0===t?void 0:t.id)&&d({itemId:null===(n=s.current)||void 0===n?void 0:n.id,notes:e})}),300)}),[s,d]),h=(0,w.useEvent)((function(e){var t,n,r;if(s.current){var a=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Ls(e,t,n[t])}))}return e}({},null===(r=s.current)||void 0===r||null===(n=r.details)||void 0===n||null===(t=n.formData)||void 0===t?void 0:t.values,e),o=structuredClone(a);v(o);var i=f.filter((function(e){var t,n;return"CUSTOM"===(null===(t=e.field)||void 0===t?void 0:t.type)&&"NOTES"===(null===(n=e.field)||void 0===n?void 0:n.customType)})).map((function(e){var t;return(null===(t=e.field)||void 0===t?void 0:t.name)||""})).map((function(e){return String(o[e])}))||[];i.length&&g(i)}}));(0,a.useEffect)((function(){var e=null==o?void 0:o.watch(h);return function(){return null==e?void 0:e.unsubscribe()}}),[o,h])};function Ds(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Rs(e,t,n,r,a,o,i){try{var s=e[o](i),l=s.value}catch(c){return void n(c)}s.done?t(l):Promise.resolve(l).then(r,a)}function Fs(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ds(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ds(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Bs(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(s){o=[6,s],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var Us=function(e){var t,n,o,i,s,c,u,d,f,m=e.className,p=(0,l.useInteractionWorkspaceState)().shownWorkspaceItem,v=(0,J.useInteractionStateMethods)().setFormPageId,g=(0,a.useMemo)((function(){var e,t;return null==p||null===(t=p.details)||void 0===t||null===(e=t.formDefinitions)||void 0===e?void 0:e.find((function(e){return"SCREENPOP"===e.type}))}),[null==p||null===(t=p.details)||void 0===t?void 0:t.formDefinitions]),h=null==p||null===(o=p.details)||void 0===o||null===(n=o.formData)||void 0===n?void 0:n.values,b=null==p||null===(s=p.details)||void 0===s||null===(i=s.formData)||void 0===i?void 0:i.variables,y=(null==p||null===(u=p.details)||void 0===u||null===(c=u.formData)||void 0===c?void 0:c.shownPageIndex)||0,S=null==p?void 0:p.receivedIntentsIds,x=Fs((0,a.useState)(null),2),j=x[0],I=x[1],O=(0,a.useCallback)((d=function(e){return Bs(this,(function(t){switch(t.label){case 0:return(0,we.assertDefined)(p),[4,null==j?void 0:j.trigger()];case 1:return t.sent()?(v(p.id,e),[2]):[2]}}))},f=function(){var e=this,t=arguments;return new Promise((function(n,r){var a=d.apply(e,t);function o(e){Rs(a,n,r,o,i,"next",e)}function i(e){Rs(a,n,r,o,i,"throw",e)}o(void 0)}))},function(e){return f.apply(this,arguments)}),[j,v,p]);return ks({pageIndex:y,formDefinition:g,form:j}),g?(0,r.jsx)("div",{className:m,children:(0,r.jsx)(Ms,{formDefinition:g,defaultValues:h,variables:b,intents:S,pageIndex:y,changeFormPageId:O,onFormAvailable:I,shouldResetOnChange:!0})}):null},zs=function(e){var t=e.content,n=e.className,o=(0,a.useMemo)((function(){return{__html:(0,dt.sanitizeHtml)(t)}}),[t]);return(0,r.jsx)(q.Frame,{className:W("h-full w-full",n),children:(0,r.jsx)("div",{dangerouslySetInnerHTML:o})})},Hs=n(3711);const Vs=n.p+"768a4584de75be31d108c80afaed59bb.svg";function Gs(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ws=function(e){var t=e.children;return(0,r.jsx)("div",{className:"flex w-full flex-row justify-between border-b border-gray-300 p-2.5",children:t})},qs=function(e){var t,n=e.children,a=e.type;return(0,r.jsx)("div",{className:V()("flex-auto",(t={},Gs(t,"flex-none pr-2.5","avatar"===a),Gs(t,"relative flex justify-end items-end whitespace-nowrap min-w-[200px] flex-none","controls"===a),t)),children:n})},Ys=function(e){var t=e.contact,n=e.actionsRef,o=(0,Ce.useFormatting)().formatFullName,i=(0,$.useLocalizationState)().t,s=(0,C.useSessionState)("serverOrigin"),l=(0,un.useGetAvatarUrl)()({contactId:t.Id.oid}),c=(0,a.useCallback)((function(){var e=t.Id.oid,n=(0,at.getContactUrl)(s,e);w.clipboard.copy(n)}),[t.Id.oid,s]);return(0,r.jsxs)(Ws,{children:[(0,r.jsx)(qs,{type:"avatar",children:(0,r.jsx)(Hs.AvatarLegacy,{firstName:t.firstName,lastName:t.lastName,url:l,type:"contact",size:74})}),(0,r.jsxs)(qs,{children:[(0,r.jsx)("div",{className:"my-1 mb-0.5 w-3/4 py-1 text-left text-base text-black no-underline",children:o(t.firstName,t.lastName)}),(0,r.jsxs)("div",{className:"flex flex-row",children:[(0,r.jsxs)("div",{className:"flex-auto",children:[(0,r.jsx)("div",{className:"py-1 pr-2.5",children:t.title}),(0,r.jsx)("div",{className:"py-1 pr-2.5",children:t.companyName})]}),(0,r.jsxs)("div",{className:"flex-auto",children:[(0,r.jsx)("div",{className:"py-1 pr-2.5",children:t.primaryPhone&&(0,X.formatPhone)(t.primaryPhone.phone)}),(0,r.jsx)("div",{className:"py-1 pr-2.5",children:t.primaryEmail&&t.primaryEmail.emailAddress})]})]})]}),(0,r.jsxs)(qs,{type:"controls",children:[(0,r.jsx)("div",{className:"absolute right-0 top-0 m-0",children:(0,r.jsx)(q.SemanticButton,{basic:!0,tooltip:i.GLOBAL.copy_shareable_link_button_tooltip(),icon:(0,r.jsx)(q.Svg,{src:Vs,className:"block h-3.5 w-3.5"}),onClick:c})}),(0,r.jsx)("div",{ref:n})]})]})},Qs=n(1510);function Ks(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function $s(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Ks(e,t,n[t])}))}return e}function Xs(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Js(e){return"USER"===e.partyType&&"firstName"in e}var Zs=function(e){if(!e)return"";return new Date(e).toLocaleDateString(void 0,{year:"numeric",month:"short",day:"numeric",hour:"numeric",minute:"numeric"})},el=function(e){return[e.firstName,e.lastName].join(" ")},tl=function(e){return new Date(e.timestamp).toLocaleDateString(void 0,{hour:"numeric",minute:"numeric"})},nl=function(e){var t,n=e.className,a=e.parties,o=e.message,i=e.agent,s=e.text,l=(0,un.useGetAvatarUrl)(),c=(0,$.useLocalizationState)().t,u=W("flex flex-row px-2 py-[5px] [&_b]:mr-1"),d=W("relative flex-auto pr-5"),f=W("absolute right-0 top-0 h-3 w-5 rounded bg-[--c-activity-message-icon]","before:absolute before:left-[3px] before:top-full before:border-[3px]","before:border-b-transparent before:border-l-[--c-activity-message-icon] before:border-r-transparent before:border-t-[--c-activity-message-icon]","after:absolute after:inset-x-0 after:top-0 after:text-center after:text-[8px] after:uppercase after:leading-[12px]"),m=W('after:content-["sms"]'),p=function(e){var t=l({userId:e.userId,contactId:e.contactId});return(0,r.jsx)(Hs.AvatarLegacy,{size:40,url:t,firstName:e.firstName,lastName:e.lastName,type:e.userId?"user":"contact"})};if(i)return(0,r.jsxs)("div",{className:W(n,u),children:[(0,r.jsx)("div",{className:"mr-2.5",children:p(i)}),(0,r.jsxs)("div",{className:d,children:[(0,r.jsx)("div",{children:(0,r.jsx)("b",{children:el(i)})}),(0,r.jsx)("div",{children:s})]})]});if(o&&a){var v=o.partyId;switch(o.event){case"party_joined":if((t=a[v])&&t.type&&["internal","external"].includes(t.type))return(0,r.jsxs)("div",{className:W(n,u,"bg-[--c-activity-message-bg]"),children:[(0,r.jsx)("div",{className:"mr-2.5",children:p(t)}),(0,r.jsxs)("div",{className:d,children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("b",{children:el(t)}),tl(t)]}),(0,r.jsx)("div",{children:" "+c.EXTERNAL_CHAT.party_joined_chat_2()+" "})]})]});break;case"party_left":if((t=a[v])&&t.type&&["internal","external"].includes(t.type))return(0,r.jsxs)("div",{className:W(n,u,"bg-[--c-activity-message-bg]"),children:[(0,r.jsx)("div",{className:"mr-2.5",children:p(t)}),(0,r.jsxs)("div",{className:d,children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("b",{children:el(t)}),tl(t)]}),(0,r.jsx)("div",{children:" "+c.EXTERNAL_CHAT.party_left_chat_2()+" "})]})]});break;case"party_message":if((t=a[v])&&t.type&&["internal","external"].includes(t.type))return(0,r.jsxs)("div",{className:W(n,u),children:[(0,r.jsx)("div",{className:"mr-2.5",children:p(t)}),(0,r.jsxs)("div",{className:d,children:[(0,r.jsxs)("div",{children:[(0,r.jsx)("b",{children:el(t)}),tl(t)]}),(0,r.jsx)("div",{children:t.msg}),"sms"===t.channel&&(0,r.jsx)("div",{className:W(f,m)})]})]});break;default:return null}}return null};function rl(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var al=function(e){var t=e.activity,n=e.services,o=e.agents,i=(0,Qs.useActivitiesState)("activities"),s=(0,Qs.useActivitiesStateMethods)().getActivity,l=(0,C.useSessionState)(),c=l.privileges,u=l.userId,d=(0,un.useGetAvatarUrl)(),f=(0,Ce.useFormatting)().formatFullName,m=(0,$.useLocalizationState)().t,p=W("mt-[5px] bg-[--c-activity-item-content] p-2 first:m-0"),v=W("flex flex-row"),g=W("mb-2 flex flex-row leading-[16px] text-gray-500","[&_svg]:mr-1 [&_svg]:inline-block [&_svg]:h-4 [&_svg]:w-4 [&_svg]:align-middle"),h=t.globalInteractionId,b=null==o?void 0:o.some((function(e){return e.userId===u})),y=!!Object.values(c).length,S=c.CAN_SEE_ACTIVITIES||c.LISTEN_ALL_RECORDINGS||b&&c.CAN_SEE_OWN_ACTIVITIES;(0,a.useEffect)((function(){y&&S&&"CHAT"===t.mediaType&&s({id:h})}),[t,h,s,y,S]);var x=i[h]||{data:[],isLoading:!1},j=x.data,I=x.isLoading,O=(0,a.useMemo)((function(){if(j){var e={};return j.forEach((function(t){var n,r;e=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){rl(e,t,n[t])}))}return e}({},e,(n=t.messages,r={},n.forEach((function(e){var t,n=e.partyId;for(t in e)Object.prototype.hasOwnProperty.call(e,t)&&"event"!==t&&void 0!==e[t]&&(r[n]=Xs($s({},r[n]||{}),Ks({},t,e[t])))})),r))})),e}}),[j]);if(I)return(0,r.jsx)("div",{children:m.GLOBAL.loading()});var _=function(e){var t=d({userId:e.userId,contactId:e.contactId});return(0,r.jsx)("div",{className:"flex-none px-2",children:(0,r.jsx)(Hs.AvatarLegacy,{size:40,url:t,firstName:e.firstName,lastName:e.lastName,type:e.userId?"user":"contact"})})},w=function(e){var t,a=null==n||null===(t=n.find((function(t){return t.serviceId===e.serviceId})))||void 0===t?void 0:t.serviceName,o=e.disposition;if(o||e.notes)return(0,r.jsxs)("div",{className:p,children:[(0,r.jsx)(nl,{className:"p-0",agent:e,text:e.notes}),a&&o&&(0,r.jsx)("div",{className:"mt-2 text-gray-500",children:"".concat(a,": ").concat(o)})]},e.partyId)};return(0,r.jsxs)("div",{className:"flex flex-auto flex-col",children:["VOICE"===t.mediaType&&(null==o?void 0:o.map((function(e){var n;if(!e)return null;var a="OUTBOUND"===t.direction?dn.LegacyIconCallOutbound:dn.LegacyIconCallInbound;return(0,r.jsxs)("div",{className:v,children:[_(e),(0,r.jsxs)("div",{className:"flex-auto",children:[(0,r.jsx)("div",{className:p,children:(0,r.jsxs)("div",{className:g,children:[(0,r.jsx)(a,{}),m.ACTIVITY_HISTORY.heading_user_started_call_on_date(f(e.firstName,e.lastName),"call",Zs(null===(n=e.startTime)||void 0===n?void 0:n.date))]})}),null==o?void 0:o.map(w)]})]})}))),"CHAT"===t.mediaType&&(j?j.map((function(e,t){var n,a,i=function(e){return e.messages.find((function(e){return e.firstName}))}(e),s=null!==(a=null!==(n=null==i?void 0:i.firstName)&&void 0!==n?n:" "+(null==i?void 0:i.lastName))&&void 0!==a?a:"",l=e.messages.filter((function(e){return e.event}));return(0,r.jsxs)("div",{className:v,children:[_(i),(0,r.jsxs)("div",{className:"flex-auto",children:[(0,r.jsxs)("div",{className:p,children:[(0,r.jsxs)("div",{className:g,children:[(0,r.jsx)(dn.LegacyIconChat,{}),m.ACTIVITY_HISTORY.heading_user_started_call_on_date(s,"chat",Zs(i.timestamp))]}),l.map((function(e,t){return(0,r.jsx)(nl,{message:e,parties:O},t)}))]}),null==o?void 0:o.map(w)]})]},t)})):null)]})};function ol(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function il(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ol(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ol(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var sl=function(e){var t,n=e.contactId,o=(0,Qs.useActivitiesState)(["activitiesList","activitiesListLoading"]),i=o.activitiesList,s=o.activitiesListLoading,l=(0,Qs.useActivitiesStateMethods)().getActivitiesList,c=(0,$.useLocalizationState)().t,u=(0,Ce.useFormatting)().formatFullName,d=W("mt-px h-4 w-4 align-middle"),f=null===(t=(0,ji.useContact)(n))||void 0===t?void 0:t.data,m=i.length?0:-1,p=(0,a.useMemo)((function(){return[{name:"icon",title:"",width:"36px"},{name:"time",title:c.UNDEFINED.activity_datetime(),width:"15%"},{name:"agent",title:c.UNDEFINED.activity_agent(),width:"20%"},{name:"disposition",title:c.UNDEFINED.activity_disposition(),width:"15%"},{name:"notes",title:c.UNDEFINED.activity_details(),width:"50%"}]}),[c]);(0,a.useEffect)((function(){f&&l({id:f.Id.oid})}),[f,l]);var v=il((0,a.useState)(m),2),g=v[0],h=v[1];(0,a.useEffect)((function(){h(m)}),[f,i,h]);var b=(0,a.useCallback)((function(e,t){switch(t.name){case"icon":return"CHAT"===e.mediaType?(0,r.jsx)(dn.LegacyIconChat,{className:d}):"VOICE"===e.mediaType?"OUTBOUND"===e.direction?(0,r.jsx)(dn.LegacyIconCallOutbound,{className:d}):(0,r.jsx)(dn.LegacyIconCallInbound,{className:d}):"";case"time":return c=e.createdTime.date,new Date(c).toLocaleDateString(void 0,{weekday:"short",hour:"numeric",minute:"numeric"});case"agent":var n,a;return null!==(a=null===(n=e.parties.filter(Js))||void 0===n?void 0:n.map((function(e){return u(e.firstName,e.lastName)})).filter(Boolean).join(", "))&&void 0!==a?a:"";case"disposition":var o,i;return null!==(i=null===(o=e.parties.filter(Js))||void 0===o?void 0:o.map((function(e){return e.disposition})).filter(Boolean).join(", "))&&void 0!==i?i:"";case"notes":var s,l;return null!==(l=null===(s=e.parties.filter(Js))||void 0===s?void 0:s.map((function(e){return[e.duration&&(0,w.toHHMMSS)(e.duration),e.notes].filter(Boolean).join(", ")})).filter(Boolean).join("; "))&&void 0!==l?l:"";default:return""}var c}),[d,u]),y=(0,a.useCallback)((function(e,t){return W({"bg-highlight-folder-color":g===t})}),[g]),S=i[g],x=(0,a.useCallback)((function(e,t,n){return h(n)}),[]),j=W("absolute left-1/2 right-0 top-[15px] ml-[-3px] h-full w-1.5","after:m-auto after:block after:w-px after:bg-[--c-activities-divider]");return(0,r.jsxs)("div",{className:"relative h-full flex-auto",children:[(0,r.jsx)("div",{className:"absolute left-0 top-0 flex h-full w-[calc(50%-3px)] flex-col",children:(0,r.jsx)(q.Table,{columns:p,data:i,isLoading:s,rowClassName:y,renderItem:b,onRowClick:x,onRowEnterPress:x})}),(0,r.jsx)("div",{className:j}),(0,r.jsx)("div",{className:"absolute inset-y-[15px] right-0 w-[calc(50%-3px)] overflow-y-auto overflow-x-hidden",children:S&&(0,r.jsx)(al,{activity:S,services:S.services,agents:S.parties.filter(Js)})})]})},ll=n(5914),cl=n(7777);function ul(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function dl(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function fl(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function ml(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function pl(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ul(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ul(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var vl=function(e){var t=e.onClose,n=e.email,o=e.contactId,i=e.firstName,s=e.lastName,l=e.onConfirm,c=ml(e,["onClose","email","contactId","firstName","lastName","onConfirm"]),u=(0,$.useLocalizationState)().t,d=(0,ji.useContactsStateMethods)().addEmail,f=(0,Ce.useFormatting)(),m=f.formatEmailType,p=f.formatFullName,v=pl((0,a.useState)(Eo.EmailTypes.PRIMARY),2),g=v[0],h=v[1],b=p(i,s),y=(0,a.useMemo)((function(){return Object.keys(Eo.EmailTypes).map((function(e){return{value:e,content:m(e,!1)}}))}),[m]);return(0,r.jsxs)(Te.Modal,fl(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){dl(e,t,n[t])}))}return e}({onClose:t,"data-testid":"contact-add-email-modal"},c),{children:[(0,r.jsx)(Te.Modal.Header,{children:u.CONTACT.add_email_heading()}),(0,r.jsx)(Te.Modal.Content,{className:"body-m",children:(0,r.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,r.jsxs)("p",{children:[u.CONTACT.add_email_description_1()," ",(0,r.jsx)("b",{children:n})," ",u.CONTACT.add_email_description_2()," ",(0,r.jsx)("b",{children:b})," ",u.CONTACT.add_email_description_3()]}),(0,r.jsxs)("p",{children:[u.CONTACT.add_email_description_4(),(0,r.jsx)(Te.SelectField,{layoutClassName:"inline-block min-w-[187px] mx-4",placeholder:u.CONTACT.add_email_email_type_placeholder(),value:g,onValueChange:function(e){if(!(0,we.isStringInEnum)(Eo.EmailTypes,e))throw Error("Invalid email type");h(e)},options:y,"data-testid":"phone-type-dropdown"}),u.CONTACT.add_email_description_5()]})]})}),(0,r.jsxs)(Te.Modal.Actions,{children:[(0,r.jsx)(cl.Button,{variant:"secondary",onClick:function(){return t()},"data-testid":"cancel-button",children:u.WINDOW_POPUP_TITLES_AND_MESSAGES.window_buttonCancel()}),(0,r.jsx)(cl.Button,{variant:"primary",onClick:function(){o&&n&&d({contactId:o,type:g,email:n}),null==l||l(),t()},"data-testid":"add-button",children:u.CONTACT.add_email_confirmation_button()})]})]}))};function gl(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function hl(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function bl(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function yl(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function Sl(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return gl(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return gl(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var xl=function(e){var t=e.onClose,n=e.phone,o=e.contactId,i=e.firstName,s=e.lastName,l=e.onConfirm,c=yl(e,["onClose","phone","contactId","firstName","lastName","onConfirm"]),u=(0,$.useLocalizationState)().t,d=(0,ji.useContactsStateMethods)().addPhone,f=(0,Ce.useFormatting)(),m=f.formatPhoneType,p=f.formatFullName,v=Sl((0,a.useState)(Eo.PhoneTypes.BUSINESS),2),g=v[0],h=v[1],b=p(i,s),y=(0,X.formatPhone)(n),S=(0,a.useMemo)((function(){return Object.keys(Eo.PhoneTypes).map((function(e){return{value:e,content:m(e)}}))}),[m]);return(0,r.jsxs)(Te.Modal,bl(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){hl(e,t,n[t])}))}return e}({onClose:t,"data-testid":"contact-add-phone-modal"},c),{children:[(0,r.jsx)(Te.Modal.Header,{children:u.CONTACT.add_phone_heading()}),(0,r.jsx)(Te.Modal.Content,{className:"body-m",children:!!y&&(0,r.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,r.jsxs)("p",{children:[u.CONTACT.add_phone_description_1()," ",(0,r.jsx)("b",{children:y})," ",u.CONTACT.add_phone_description_2()," ",(0,r.jsx)("b",{children:b})," ",u.CONTACT.add_phone_description_3()]}),(0,r.jsxs)("p",{children:[u.CONTACT.add_phone_description_4(),(0,r.jsx)(Te.SelectField,{layoutClassName:"inline-block min-w-[187px] mx-4",placeholder:u.CONTACT.add_phone_phone_type_placeholder(),value:g,onValueChange:function(e){if(!(0,we.isStringInEnum)(Eo.PhoneTypes,e))throw Error("Invalid phone type");h(e)},options:S,"data-testid":"phone-type-dropdown"}),u.CONTACT.add_phone_description_5()]})]})}),(0,r.jsxs)(Te.Modal.Actions,{children:[(0,r.jsx)(cl.Button,{onClick:function(){return t()},"data-testid":"cancel-button",variant:"secondary",children:u.WINDOW_POPUP_TITLES_AND_MESSAGES.window_buttonCancel()}),(0,r.jsx)(cl.Button,{onClick:function(){o&&n&&d({contactId:o,type:g,phone:n}),null==l||l(),t()},"data-testid":"add-button",variant:"primary",children:u.CONTACT.add_phone_confirmation_button()})]})]}))};function jl(){var e=(0,J.useActiveInteraction)(),t=(0,J.useInteractionStateMethods)(),n=(0,ae.useModalComponentOpener)(vl),r=(0,ae.useModalComponentOpener)(xl),o=(0,j.getChannel)(e),i=(0,ji.useContactsStateMethods)().getContactDetails;return(0,a.useCallback)((function(a){var s=function(e){var t;return null===(t=a.phones)||void 0===t?void 0:t.every((function(t){return t!==e}))};(0,we.assertDefined)(e);var l=a.id,c=a.firstName,u=a.lastName;if((0,j.isCall)(e)){var d=e.allParties||[];if(d.length){var f=d[0],m=f.id,p=f.theirItemId,v=f.phone;return t.useContact({partyId:m,itemId:p||"",contactId:l,firstName:c||"",lastName:u||""}),v&&s(v)&&r({phone:v,contactId:l,firstName:c,lastName:u}),Promise.resolve()}}else if((0,j.isExternalChat)(e)){var g=(0,j.getChatParties)(e);if(null==g?void 0:g.length){var h=g[0],b=h.email,y=h.item_id,S=h.party_id,x=h.first_name,I=h.last_name,O=h.phone,_=c||x||"",C=u||I||"";return t.useContact({itemId:y,partyId:S,contactId:l,firstName:_,lastName:C}),O&&s(O)&&r({phone:O,contactId:l,firstName:_,lastName:C}),b&&n({email:b,contactId:l,firstName:c,lastName:u}),(0,Q.isMessengerChannel)(o)&&setTimeout((function(){i({id:l,force:!0})}),500),Promise.resolve()}}else if((0,j.isWorkItem)(e))return t.useContact({itemId:e.id,contactId:l,firstName:null!=c?c:"",lastName:null!=u?u:""}),Promise.resolve();return Promise.reject()}),[e,t,r,o,n,i])}function Il(){return(0,J.useActiveInteractionProp)((function(e){return(0,j.isCall)(e)||(0,j.isExternalChat)(e)||(0,j.isEmail)(e)}))}var Ol=n(4995),_l=n(7704),Cl=n.n(_l),wl=function(e){var t=e.profileActionsRef,n=e.children;return t.current&&Cl().createPortal(n,t.current)},Nl=function(e){var t=e.contactId,n=e.actionsRef,o=e.onEditMode,i=e.form,s=(0,$.useLocalizationState)().t,l=(0,K.useNotificationsState)("methods").showNotification,c=(0,ji.useContactsStateMethods)().saveContactDetails,u=(0,ji.useContactFormDefinition)("CONTACT_DETAIL"),d=(0,a.useCallback)((function(){var e=(0,To.dirtyValues)((null==i?void 0:i.formState.dirtyFields)||{},(null==i?void 0:i.getValues())||{}),n=function(){return null==o?void 0:o(!1)},r=function(){null==o||o(!1),l({type:"error",id:K.Notifications.ContactSaveError,tags:["current-view"],message:s.CONTACT.save_error()})};null==i||i.handleSubmit((function(){if((0,we.assertDefined)(u),Object.keys(e).length){var a=(0,No.createLeadMappingStringToFormValueMap)(e,u),i=(0,Ol.unflatten)(a);c(t,i,{onSuccess:n,onError:r})}else null==o||o(!1)}))()}),[i,o,l,s.CONTACT,u,c,t]);return(0,r.jsxs)(wl,{profileActionsRef:n,children:[(0,r.jsx)(q.SemanticButton,{onClick:d,basic:!0,primary:!0,children:s.UNDEFINED.button_save_contact_text()}),(0,r.jsx)(q.SemanticButton,{onClick:function(){return null==o?void 0:o(!1)},basic:!0,color:"orange",children:s.UNDEFINED.button_cancel_contact_text()})]})};function Al(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function El(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Al(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Al(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Tl=function(e){var t=e.contactId,n=e.actionsRef,o=e.editMode,i=e.onMerge,s=e.onEditMode,l=(0,$.useLocalizationState)().t,c=(0,C.useSessionState)().privileges,u=El((0,a.useState)(null),2),d=u[0],f=u[1],m=(0,ji.useContactFormDefinition)("CONTACT_DETAIL"),p=(0,ji.useContact)(t),v=(null==p?void 0:p.details)||{},g=(0,a.useMemo)((function(){return(null==p?void 0:p.data)?{contactId:t,firstName:p.data.firstName,lastName:p.data.lastName}:void 0}),[t,null==p?void 0:p.data]),h=Il(),b=jl();if(!m)return null;var y=(0,No.createFormValues)(m,v);return(0,r.jsxs)(r.Fragment,{children:[o?(0,r.jsx)(Nl,{actionsRef:n,onEditMode:s,contactId:t,form:d}):(0,r.jsxs)(wl,{profileActionsRef:n,children:[c.EDIT_CONTACTS&&(0,r.jsx)(q.SemanticButton,{onClick:function(){return null==s?void 0:s(!0)},basic:!0,primary:!0,children:l.UNDEFINED.button_edit_contact_text()}),i&&(0,r.jsx)(q.SemanticButton,{onClick:i,basic:!0,primary:!0,children:l.GLOBAL.merge()}),h&&(0,r.jsx)(q.SemanticButton,{basic:!0,primary:!0,onClick:function(){(0,we.assertDefined)(null==p?void 0:p.data),b((0,ll.contactToShortContact)(p.data))},children:l.UNDEFINED.button_use_contact_text()})]}),(0,r.jsx)(Ms,{formDefinition:m,onFormAvailable:f,variables:v,defaultValues:y,view:!o,contactData:g})]})},Pl=function(e){var t=e.contactId,n=e.tab,a=e.editMode,o=e.actionsRef,i=e.onMerge,s=e.onEditMode;return"details"===n.id?(0,r.jsx)(Tl,{contactId:t,editMode:a,actionsRef:o,onMerge:i,onEditMode:s}):"activities"===n.id?(0,r.jsx)(sl,{contactId:t}):(0,r.jsx)("div",{children:'Content of "'.concat(n.title,'" tab')})};function Ml(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ll(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ml(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ml(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var kl=function(e){var t,n=e.contactId,o=e.className,i=e.editMode,s=e.onMerge,l=e.onEditMode,c=(0,$.useLocalizationState)().t,u=(0,a.useMemo)((function(){return[{id:"details",title:c.CRM.crm_details_tab()},{id:"activities",title:c.CRM.crm_history_tab()},{id:"pending",title:c.CRM.crm_pending_tab()},{id:"cases",title:c.CRM.crm_case_tab()}]}),[c]),d=(0,ji.useContactsStateMethods)(),f=d.getContact,m=d.getContactDetails,p=d.getContactFormsDefinitions,v=Ll((0,a.useState)(u[0].id),2),g=v[0],h=v[1];(0,a.useEffect)((function(){p({}),f({id:n}),m({id:n})}),[n,f,m,p]);var b=(0,a.useRef)(null),y=(0,a.useCallback)((function(e){return(0,r.jsx)(Pl,{tab:e,editMode:i,contactId:n,actionsRef:b,onMerge:s,onEditMode:l},n)}),[n,i,s,l]),S=null===(t=(0,ji.useContact)(n))||void 0===t?void 0:t.data;return S?(0,r.jsxs)("div",{className:W("flex h-full flex-auto flex-col",o),children:[(0,r.jsx)(Ys,{contact:S,actionsRef:b}),(0,r.jsx)("div",{className:"relative flex flex-auto flex-col overflow-auto",children:(0,r.jsx)(q.Tabs,{className:"flex w-full flex-auto flex-col overflow-y-auto overflow-x-hidden",tabs:u,activeTabId:g,renderTabContent:y,onChange:h})})]}):null},Dl=function(e){var t=e.actionsRef,n=e.closeCreateTab,o=e.form,i=e.onContactCreated,s=(0,$.useLocalizationState)().t,l=(0,K.useNotificationsState)("methods").showNotification,c=(0,ji.useContactsStateMethods)().createContact,u=(0,a.useCallback)((function(){(0,we.assertDefined)(o);var e=function(e){null==i||i(e),n()},t=function(){l({type:"error",id:K.Notifications.ContactSaveError,tags:["current-view"],message:s.CONTACT.save_error()})};null==o||o.handleSubmit((function(){c({details:o.getValues()},{onSuccess:e,onError:t})}))()}),[o,i,n,l,s.CONTACT,c]);return(0,r.jsxs)(wl,{profileActionsRef:t,children:[(0,r.jsx)(q.SemanticButton,{onClick:u,basic:!0,primary:!0,children:s.UNDEFINED.button_save_contact_text()}),(0,r.jsx)(q.SemanticButton,{onClick:n,basic:!0,color:"orange",children:s.UNDEFINED.button_cancel_contact_text()})]})},Rl=function(e){var t=e.actionsRef;return(0,r.jsxs)(Ws,{children:[(0,r.jsx)(qs,{type:"avatar",children:(0,r.jsx)(Hs.AvatarLegacy,{type:"contact",size:74})}),(0,r.jsx)(qs,{type:"controls",children:(0,r.jsx)("div",{ref:t})})]})};function Fl(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Bl(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Fl(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Fl(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Ul=function(e){var t=e.className,n=e.onCancel,o=e.initialData,i=e.onContactCreated,s=(0,ji.useContactsStateMethods)().getContactFormsDefinitions;(0,a.useEffect)((function(){s({})}),[s]);var l=(0,a.useRef)(null),c=Bl((0,a.useState)(null),2),u=c[0],d=c[1],f=(0,ji.useContactFormDefinition)("CONTACT_DETAIL"),m=f&&o&&(0,No.createFormValues)(f,o);return f?(0,r.jsxs)("div",{className:W("flex h-full flex-auto flex-col",t),children:[(0,r.jsx)(Rl,{actionsRef:l}),(0,r.jsxs)("div",{className:"relative flex flex-auto flex-col overflow-auto",children:[(0,r.jsx)(Dl,{actionsRef:l,closeCreateTab:n,form:u,onContactCreated:i}),(0,r.jsx)(Ms,{formDefinition:f,onFormAvailable:d,defaultValues:m})]})]}):null},zl=function(){var e=(0,l.useInteractionWorkspaceState)(),t=e.shownWorkspaceTabId,n=e.shownWorkspaceTabs;return(0,r.jsx)(r.Fragment,{children:null==n?void 0:n.map((function(e){var n=W({hidden:t!==e.id});switch(e.type){case"profile":return(0,r.jsx)(kl,{contactId:e.contactId,className:n},e.id);case"iframe":return(0,r.jsx)(q.Iframe,{src:e.url,className:W("h-full w-full",n)},e.id);case"case":return(0,r.jsx)(Mr,{id:e.id,className:n},e.id);case"iframe-html":return(0,r.jsx)(zs,{content:e.content,className:n},e.id);case"activityForm":return(0,r.jsx)(Us,{className:n},e.id);default:return null}}))})},Hl=function(e){var t=e.tab,n=(0,l.useInteractionWorkspaceState)().removeItemTab,a="profile"===t.type?t.contactId:void 0,o=(0,un.useContactDisplayName)(a)||t.title;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{children:o}),"iframe-html"===t.type||"iframe"===t.type&&(0,r.jsx)(q.SemanticButton,{transparent:!0,className:"ml-1 flex h-6 w-6 items-center justify-center opacity-70 transition-opacity duration-300 hover:opacity-100",onClick:function(e){e.preventDefault(),e.stopPropagation(),n(t.id)},children:(0,r.jsx)(dn.IconClose,{className:"h-3.5 w-3.5"})})]})},Vl=[];var Gl=n(3037);var Wl={events:[],pageIsVisible:!0},ql=f()((function(e,t){if(function(e){return"pageVisibilityChanged"===e.type}(t)&&(e.pageIsVisible=t.pageIsVisible,e.events=Wl.events),!e.pageIsVisible){if(function(e){return"interactionAppeared"===e.type}(t)&&e.events.push({type:"interaction",title:Yl(t.mediaType),id:t.id}),function(e){return"interactionDisappeared"===e.type}(t)){var n=e.events.findIndex((function(e){return e.id===t.id}));e.events.splice(n,1)}if(function(e){return"calendarEventAppeared"===e.type}(t)&&e.events.push({type:"calendar",title:Yl("calendar"),id:t.id}),function(e){return"calendarEventDisappeared"===e.type}(t)){var r=e.events.findIndex((function(e){return e.id===t.id}));e.events.splice(r,1)}(function(e){return"chatMessageAppeared"===e.type})(t)&&e.events.push({type:"chatMessage",title:Yl("chatMessage"),id:t.id})}}));function Yl(e){switch(e){case"chatMessage":return"GLOBAL.heading_incomingMessage";case"workitem":return"GLOBAL.heading_incomingPreview";case"voice":return"GLOBAL.heading_incomingCall";case"forum":return"GLOBAL.heading_incomingForum";case"chat":return"GLOBAL.heading_incomingChat";case"email":return"GLOBAL.heading_incomingEmail";case"calendar":return"GLOBAL.heading_calendarAlert"}}function Ql(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Kl(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ql(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ql(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function $l(){var e=Kl((0,a.useReducer)(ql,Wl),2),t=e[0],n=e[1];!function(e){var t=(0,$.useLocalizationState)().t,n=(0,a.useRef)(document.title),r=(0,a.useRef)(0),o=(0,a.useCallback)((function(e){var a=e?(0,m.get)(t,e)():"Unknown / incoming";r.current=setInterval((function(){document.title=document.title===a?n.current:a}),700)}),[t]),i=(0,a.useCallback)((function(){clearInterval(r.current),document.title=n.current}),[]);(0,a.useEffect)((function(){if(e.events.length){var t=e.events[e.events.length-1];o(null==t?void 0:t.title)}else i();return function(){clearInterval(r.current)}}),[o,e.events,i])}(t),function(e){var t,n=(0,J.useInteractions)(),r=(0,J.useModalInteractionIds)(),o=(0,a.useMemo)((function(){return r.map((function(e){return n.find((function(t){return t.id===e}))})).filter(Boolean)}),[n,r]),i=(0,w.usePrevious)(o),s=null!==(t=null==i?void 0:i.length)&&void 0!==t?t:0;(0,a.useEffect)((function(){if(o.length>s){var t=o[o.length-1];e({type:"interactionAppeared",id:t.id,mediaType:t.mediaType})}else if(o.length<s){var n=null==i?void 0:i[i.length-1];n&&e({type:"interactionDisappeared",id:n.id})}}),[e,o,o.length,i,s])}(n),function(e){var t,n=(0,Gl.useCalendarAlertState)("calendarEventAlerts"),r=(0,w.usePrevious)(n),o=null!==(t=null==r?void 0:r.length)&&void 0!==t?t:0;(0,a.useEffect)((function(){if(n.length>o){var t=n[n.length-1];e({type:"calendarEventAppeared",id:t.id})}else if(n.length<o){var a=null==r?void 0:r[r.length-1];a&&e({type:"calendarEventDisappeared",id:a.id})}}),[n,n.length,e,r,o])}(n),function(e){var t=(0,te.useInteractionChatStateConnector)();(0,a.useEffect)((function(){var n=null==t?void 0:t.dispenser.subscribe({onNewMessage:function(t){e({type:"chatMessageAppeared",id:t.msg_id})}});return function(){null==n||n.unsubscribe()}}),[e,null==t?void 0:t.dispenser])}(n),function(e){var t=(0,w.usePageVisibility)();(0,a.useEffect)((function(){e({type:"pageVisibilityChanged",pageIsVisible:t})}),[e,t])}(n),function(e){var t=(0,a.useCallback)((function(){e({type:"resetState"})}),[]);(0,C.useOnLogout)(t)}(n)}var Xl=n(173),Jl={__ts__:Date.now(),notification:{compact:!0,hideWhileActiveInteraction:!1,position:void 0},calendar_event_notification:{position:void 0},quality_management_monitor:{position:void 0}};function Zl(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ec(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function tc(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var nc=function(e){var t=e.actionCallback,n=tc(e,["actionCallback"]),a=(0,$.useLocalizationState)().t;return(0,r.jsx)(q.Modal,ec(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Zl(e,t,n[t])}))}return e}({},n),{header:a.WINDOW_POPUP_TITLES_AND_MESSAGES.window_title_warning(),content:a.WINDOW_POPUP_TITLES_AND_MESSAGES.openingEmailFromSupervisingStateConfirmation(),actions:(0,r.jsxs)(q.Modal.Actions,{children:[(0,r.jsx)(q.SemanticButton,{onClick:function(){return n.onClose()},enabledInOffline:!0,children:a.WINDOW_POPUP_TITLES_AND_MESSAGES.window_buttonClose()}),(0,r.jsx)(q.SemanticButton,{primary:!0,onClick:function(){t(),n.onClose()},children:a.GLOBAL.ok()})]})}))};function rc(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ac(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){rc(e,t,n[t])}))}return e}function oc(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}var ic=n(638);function sc(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function lc(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function cc(){var e=(0,ic.useRemoteAssistStateConnector)(),t=(0,J.useInteractions)(),n=(0,w.useAsRef)(t),r=(0,Fe.useInteractionUIItemStateSetter)();(0,a.useEffect)((function(){var t=e.dispenser.subscribe({onSessionStarted:function(e){var t=e.globalInteractionId,a=e.clientUrl,o=n.current.find((function(e){return(0,j.getGlobalInteractionId)(e)===t})),i=n.current.find((function(e){return e.id===t})),s=null!=o?o:i;s&&r(s.id,(function(e){return lc(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){sc(e,t,n[t])}))}return e}({},e),{chatMessage:e.chatMessage+" "+a})}))}});return function(){return t.unsubscribe()}}),[e,r,n])}function uc(){var e,t,n,r,o,i,s,c,u,d,f,m,p,v;e=(0,ne.useBpClientStateConnector)(),t=(0,ke.useNavigationStateRef)(),n=(0,l.useCommunicatorFloatingStateSetter)(),(0,a.useEffect)((function(){var r=t.current,a=r.setActivePage,o=r.activePage,i=null==e?void 0:e.dispenser.subscribe({onNavigateToInteraction:function(){n((function(e){return"closed"===e?"floating":e})),o.name!==ke.AppRoutes.Interactions&&a({name:ke.AppRoutes.Interactions})}});return function(){return null==i?void 0:i.unsubscribe()}}),[n,e,t]),r=(0,He.useCaseStateConnector)(),o=(0,He.useCaseStateMethods)(),i=o.openCase,s=o.replyEmail,c=(0,$.useLocalizationState)().t,u=(0,ze.useOpenInfoModal)(),d=(0,ae.useModalComponentOpener)(nc),(0,a.useEffect)((function(){var e=null==r?void 0:r.dispenser.subscribe({onQueueMovementFailed:function(e){u({body:c.EMAIL.itemsWithoutServiceStillInPersonalQueue(e.toString())})},onCaseOpenAttemptedWhileSupervising:function(e){d({actionCallback:function(){return i(oc(ac({},e),{forceOpenWhileSupervising:!0}))}})},onReplyEmailAttemptedWhileSupervising:function(e){d({actionCallback:function(){return s(oc(ac({},e),{forceOpenWhileSupervising:!0}))}})}});return function(){null==e||e.unsubscribe()}}),[null==r?void 0:r.dispenser,i,d,u,s,c.EMAIL,c.GLOBAL,c.WINDOW_POPUP_TITLES_AND_MESSAGES]),f=(0,te.useInteractionChatStateConnector)(),m=(0,J.useInteractions)(),p=(0,w.useAsRef)(m),v=(0,ce.useOpenChannel)(),(0,a.useEffect)((function(){var e=f.dispenser.subscribe({onSwitchItemChannel:function(e){var t=e.interactionStepId,n=e.channel,r=p.current.find((function(e){return(0,j.getInteractionStepId)(e)===t}));r&&v(n,r.id)},onCobrowsingStarted:function(e){e.cobrowsingLink&&window.open(e.cobrowsingLink,"_blank","")}});return function(){e.unsubscribe()}}),[f,p,v]),function(){var e=(0,ke.useNavigationStateRef)(),t=(0,l.useCommunicatorFloatingStateSetter)(),n=(0,J.useInteractionStateConnector)(),r=(0,kr.useAtomValue)(Fe.isParallelItemAtom),o=(0,a.useCallback)((function(n){var a=e.current,o=a.activePage,i=a.setActivePage;t((function(e){return"closed"===e?"floating":e})),o.name!==ke.AppRoutes.Interactions&&(r(n.id)||i({name:ke.AppRoutes.Interactions}))}),[r,e,t]);(0,a.useEffect)((function(){var e=null==n?void 0:n.dispenser.subscribe({onItemAccepted:o,onActiveItemChanged:o});return function(){return null==e?void 0:e.unsubscribe()}}),[null==n?void 0:n.dispenser,o])}(),cc()}n(8506);var dc=n(6906);n(1857);n.p;n.p;n.p;n.p;n.p;n.p;n.p;n.p;n.p;n.p;n.p;n.p;n.p;n.p;n.p;n.p;n.p;n.p;n.p;n.p;n.p;n.p;n.p;n.p;n.p;n.p;n.p;n.p;n.p;n.p;n.p;n.p;n.p;n.p;n.p;n.p;n.p;var fc,mc;!function(e){e.SUMMARY="summary",e.TRANSCRIPT="transcript",e.SCREEN_RECORDING="screen-recording"}(fc||(fc={})),function(e){e.EVALUATION="evaluation",e.ALL_EVALS="all-evals"}(mc||(mc={}));W("before:absolute before:inset-x-0 before:top-0 before:hidden before:h-1 before:bg-[--c-dropzone-line-bg]","after:absolute after:inset-x-0 after:bottom-0 after:hidden after:h-1 after:bg-[--c-dropzone-line-bg]");var pc;!function(e){e.VOICE_RECORDING="hasVoiceRecording",e.SCREEN_RECORDING="hasScreenRecording",e.TRANSCRIPT="hasTranscript",e.CHAT_TRANSCRIPT="hasChatTranscript",e.ERASED_VOICE="erasedVoiceRecording",e.ERASED_CHAT="erasedChatTranscript",e.ERASED_SCREEN="erasedScreenRecording"}(pc||(pc={}));var vc=(0,x.createContext)({filters:{},customFilters:{},searchName:"",updateFilterValue:m.noop,addFilter:m.noop,removeFilter:m.noop,saveSearch:m.noop,addCustomFilter:m.noop,removeCustomFilter:m.noop,updateCustomFilterValue:m.noop,setSearchName:m.noop,changeRandomize:m.noop,isRandomize:!1,order:{and:[],or:[]},searchResultsMode:!1,onClosePanel:m.noop,onCloneFilters:m.noop,makeSearch:m.noop,resetFilters:m.noop});vc.displayName="SearchFiltersContext";Object.keys(dc.filtersGroups);n(5213);w.MS_IN_MINUTE;n.p;(0,w.createProviderWrapper)([y.UIContextProvider]);var gc=n(635);function hc(e,t,n,r,a,o,i){try{var s=e[o](i),l=s.value}catch(c){return void n(c)}s.done?t(l):Promise.resolve(l).then(r,a)}function bc(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){hc(o,r,a,i,s,"next",e)}function s(e){hc(o,r,a,i,s,"throw",e)}i(void 0)}))}}function yc(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(s){o=[6,s],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}const Sc="agent_NonCallCases_iFrame_rm769",xc="agent_NonCallCases_tabsContent_cio2A",jc="agent_NonCallCases_tabs_ME0ot";function Ic(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Oc(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ic(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ic(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var _c={id:"search",type:"search",title:"",closeable:!1},Cc=(0,kr.atom)(""),wc=(0,kr.atom)([_c]),Nc=(0,kr.atom)(_c.id),Ac=(0,kr.atom)(void 0),Ec=(0,kr.atom)(void 0),Tc=(0,kr.atom)(600),Pc=(0,kr.atom)([]),Mc=(0,kr.atom)({sortBy:"score",asc:!1}),Lc=(0,kr.atom)(void 0),kc=(0,kr.atom)(void 0),Dc=(0,kr.atom)([]);function Rc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Fc(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||Uc(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Bc(e){return function(e){if(Array.isArray(e))return Rc(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Uc(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Uc(e,t){if(e){if("string"==typeof e)return Rc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Rc(e,t):void 0}}function zc(){var e=Fc((0,kr.useAtom)(wc),2),t=e[0],n=e[1],r=Fc((0,kr.useAtom)(Nc),2),o=r[0],i=r[1];return{handleTabOpen:(0,a.useCallback)((function(e){t.find((function(t){return t.id===e.id}))||n(Bc(t).concat([e])),i(e.id)}),[i,n,t]),handleTabClose:(0,a.useCallback)((function(e){e===o&&i(t[0].id),n(t.filter((function(t){return t.id!==e})))}),[o,i,n,t]),handleTabUpdate:(0,a.useCallback)((function(e){n((function(t){return t.map((function(t){return t.id===e.id?e:t}))}))}),[n])}}function Hc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Vc(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||Wc(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Gc(e){return function(e){if(Array.isArray(e))return Hc(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Wc(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Wc(e,t){if(e){if("string"==typeof e)return Hc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Hc(e,t):void 0}}function qc(){var e=(0,$.useLocalizationState)().t,t=(0,C.useSessionState)("privileges"),n=Vc((0,kr.useAtom)(Dc),2),r=n[0],o=n[1],i=zc(),s=i.handleTabOpen,l=i.handleTabClose,c=3>r.length&&t.EDIT_CONTACTS&&t.DELETE_CONTACTS,u=(0,a.useCallback)((function(t){o((function(e){return Array.from(new Set(Gc(e).concat([t])))})),s({id:"merge",type:"merge_contacts",title:e.GLOBAL.merge(),closeable:!1})}),[s,o,e.GLOBAL]);return{addContactForMerge:c?u:void 0,removeContactFromMerge:(0,a.useCallback)((function(e){var t=r.filter((function(t){return t!==e}));o(t),t.length||l("merge")}),[l,r,o]),canAddContactForMerge:c,closeContactsMerge:(0,a.useCallback)((function(){o([]),l("merge")}),[l,r,o])}}var Yc=function(){var e=(0,$.useLocalizationState)().t,t=(0,ze.useOpenSearchContactModal)(),n=qc().addContactForMerge,o=(0,a.useCallback)((function(){t({dataKey:"calendar-event-form-add-contact-modal",onSelect:function(e){var t=e.id;return null==n?void 0:n(t)},title:e.MERGE_FORM.add_contact(),selectButtonTitle:e.GLOBAL.add()})}),[n,t,e.MERGE_FORM]);return(0,r.jsx)(q.LinkLikeButton,{onClick:o,children:(0,r.jsx)("span",{children:"+ ".concat(e.MERGE_FORM.add_contact())})})},Qc=function(e){var t=e.onReset,n=e.onConfirm,a=e.isSubmitting,o=e.disabled,i=(0,$.useLocalizationState)().t,s=(0,ae.useModalsStateMethods)().openModal;return(0,r.jsxs)("div",{className:"flex items-center justify-center p-3.5",children:[(0,r.jsx)(q.SemanticButton,{basic:!0,primary:!0,onClick:n,disabled:o,loading:a,children:i.GLOBAL.confirm()}),(0,r.jsx)(q.SemanticButton,{basic:!0,primary:!0,onClick:function(){s({title:i.GLOBAL.reset(),body:i.MERGE_FORM.confirm_reset(),actions:{ok:{title:i.GLOBAL.reset(),action:function(){return t()}},cancel:{title:i.GLOBAL.cancel()}}})},disabled:o||a,children:i.GLOBAL.reset()})]})},Kc=function(e){var t=e.field,n=e.control,a=(0,nt.useController)({name:t.name,defaultValue:t.defaultValue,control:n}).field,o=a.name,i=a.onChange,s=a.value,l=(0,nt.useWatch)({control:n}),c=(0,r.jsx)("label",{htmlFor:o,className:W("[&:after]:!top-1/2 [&:after]:!-translate-y-1/2 [&:before]:!top-1/2 [&:before]:!-translate-y-1/2",{"[&:after]:!scale-[47%]":"radio"===t.type,"[&:after]:!opacity-95":s===t.value}),children:t.content});return(0,r.jsx)(re.SmCheckbox,{name:o,type:t.type,radio:"radio"===t.type,label:c,disabled:t.disabled,onChange:function(e,n){n.checked&&t.validate&&!t.validate(l)||("radio"===n.type?i(n.value):"checkbox"===n.type&&i(n.checked?n.value:null))},value:t.value,checked:s===t.value})};var $c=function(e){var t=e.contact,n=(0,$.useLocalizationState)().t,a=(0,Ce.useFormatting)().formatFullName,o=(0,un.useGetAvatarUrl)(),i=qc().removeContactFromMerge,s=o({contactId:null==t?void 0:t.Id.oid});return(0,r.jsxs)("div",{className:"flex gap-2",children:[(0,r.jsx)(Hs.AvatarLegacy,{size:40,url:s,firstName:null==t?void 0:t.firstName,lastName:null==t?void 0:t.lastName,type:"contact"}),(0,r.jsxs)("div",{children:[(0,r.jsx)("p",{className:"font-bold",children:a(null==t?void 0:t.firstName,null==t?void 0:t.lastName)}),(0,r.jsx)("p",{className:"text-main-secondary",children:n.MERGE_FORM.created("--/--/----")})]}),(0,r.jsx)(q.SemanticButton,{transparent:!0,icon:"close",onClick:function(){return i((null==t?void 0:t.Id.oid)||"")}})]})},Xc={phones:5,emails:3,addresses:3,messengers:1};function Jc(e,t){var n,o,i=(0,q.useGetMessengerName)(),s=(n=(0,$.useLocalizationState)().t,o=(0,ae.useModalsStateMethods)().openModal,(0,a.useCallback)((function(e){var t={addresses:n.MERGE_FORM.max_addresses(Xc[e]),phones:n.MERGE_FORM.max_phones(Xc[e]),emails:n.MERGE_FORM.max_emails(Xc[e]),messengers:n.MERGE_FORM.max_messengers(Xc[e])};return function(r){var a;return!((0,we.truthy)((null===(a=r.Contact)||void 0===a?void 0:a[e])||[]).length>=Xc[e]&&(o({title:n.WINDOW_POPUP_TITLES_AND_MESSAGES.window_title_warning(),body:t[e],actions:{ok:{title:n.WINDOW_POPUP_TITLES_AND_MESSAGES.window_buttonOk()}}}),1))}}),[o,n.MERGE_FORM,n.WINDOW_POPUP_TITLES_AND_MESSAGES]));return(0,a.useMemo)((function(){var n=[],a={phones:0,emails:0,addresses:0,messengers:0};return t.forEach((function(o){var l=o.details,c=o.data,u=o.isLoading,d=[];n.push({rows:d}),e.forEach((function(e){var o=e.mapping,f=e.type,p=e.element,v=[];d.push({fields:v});var g=l&&o?l[o]:null,h="string"==typeof g?g:"";if(!u&&o&&(g||"id"===o)){var b=t.filter((function(e){var t;return(null===(t=e.data)||void 0===t?void 0:t.Id.oid)!==(null==c?void 0:c.Id.oid)&&e.details})).map((function(e){var t;return null===(t=e.details)||void 0===t?void 0:t[o]})).filter(Boolean),y="string"==typeof b[0]?b[0]:void 0,S=function(e,t){var n=!b.length||b.every((function(e){return(0,m.isEqual)(e,t)}));v.push({name:o,disabled:n,defaultValue:y||t,content:e,type:n?"checkbox":"radio",value:t})},x=function(e,r,i){var l=function(e,t){var r,i=null===(r=n.map((function(e){return e.rows})).flat().map((function(e){return e.fields})).flat().find((function(e){return e.value===JSON.stringify((0,m.omit)(t,"id"))})))||void 0===r?void 0:r.name;if(i)return i;var s=a[e];return a[e]++,"".concat(o,".[").concat(s,"]")}(i,r),u=t.filter((function(e){var t;return(null===(t=e.data)||void 0===t?void 0:t.Id.oid)!==(null==c?void 0:c.Id.oid)&&e.details})).map((function(e){var t;return null===(t=e.details)||void 0===t?void 0:t[o]})).every((function(e){return Array.isArray(e)&&e.some((function(e){return(0,m.isEqual)((0,m.omit)(e,"id"),(0,m.omit)(r,"id"))}))})),d=JSON.stringify((0,m.omit)(r,"id"));v.push({name:l,disabled:u,defaultValue:u?d:void 0,content:e,type:"checkbox",value:d,validate:s(i)})};if("id"!==o)switch(null==p?void 0:p.type){case"phoneList":return void g.filter((function(e){return e.type===f})).forEach((function(e){x(e.phone,e,"phones")}));case"emailList":return void g.filter((function(e){return e.type===f})).forEach((function(e){x(e.email_address,e,"emails")}));case"addressList":return void g.filter((function(e){return e.type===f})).forEach((function(e){var t=[e.address_line1,e.address_line2,e.city,Ao.STATES[e.state],e.postcode].filter(Boolean).join(", ");x(t,e,"addresses")}));case"messengers":var j;return void((null===(j=(0,To.parseMessengers)(g))||void 0===j?void 0:j.filter((function(e){return e.type===f})))||[]).forEach((function(e){x("".concat(i(e.type)," ").concat(null==e?void 0:e.user_name),e,"messengers")}));case"dateTime":return void S((0,X.formatDate)(h,{birthday:!0}),h);case"image":return void S((0,r.jsx)(Ti,{value:h}),h);default:S(h,h)}else v.push({name:o,disabled:!1,type:"radio",defaultValue:y||(null==c?void 0:c.Id.oid)||"",content:(0,r.jsx)($c,{contact:c}),value:(null==c?void 0:c.Id.oid)||""})}}))})),n}),[t,e,i])}var Zc=["checkbox","select","spacer","button","radio","label"];function eu(){var e,t=(e=(0,ji.useContactFormDefinition)("CONTACT_DETAIL"),(0,a.useMemo)((function(){if(!e)return[];var t,n=e.layout.pages.map((function(e){return e.fields})).flat().filter((function(e){return!(0,No.checkIsLayout)(e.field)}));return null!==(t=null==n?void 0:n.map(No.createFormElement))&&void 0!==t?t:[]}),[e])),n=(0,kr.useAtomValue)(Dc),r=(0,ji.useContactsState)((function(e){return n.map((function(t){var n,r=e.contacts[t]||{},a=r.contactDetailsLoading,o=r.details,i=r.data;return{isLoading:null===(n=r.isLoading||a)||void 0===n||n,details:o,data:i||void 0}}))})),o=function(e,t){var n=(0,$.useLocalizationState)().t,r=(0,q.useGetMessengerName)(),o=(0,Ce.useFormatting)(),i=o.formatEmailType,s=o.formatPhoneType,l=o.formatAddressType;return(0,a.useMemo)((function(){var a=e.length?[{label:n.MERGE_FORM.master_record(),mapping:"id",element:void 0}]:[];return e.forEach((function(e){var o=e.mapping,c=e.type;if(o&&c&&!Zc.includes(c)){var u=t.map((function(e){var t;return null===(t=e.details)||void 0===t?void 0:t[o]})).filter(Boolean).flat();if(u.length)switch(c){case"phoneList":a.push({label:n.MERGE_FORM.phone_number(),element:e});var d=u.map((function(e){return e.type}));Array.from(new Set(d)).forEach((function(t){a.push({label:s(t),mapping:o,type:t,element:e})}));break;case"emailList":a.push({label:n.MERGE_FORM.email(),element:e});var f=u.map((function(e){return e.type}));Array.from(new Set(f)).forEach((function(t){a.push({label:i(t),mapping:o,type:t,element:e})}));break;case"addressList":a.push({label:n.MERGE_FORM.address(),element:e});var m=u.map((function(e){return e.type}));Array.from(new Set(m)).forEach((function(t){a.push({label:l(t),mapping:o,type:t,element:e})}));break;case"messengers":a.push({label:n.MERGE_FORM.messenger(),element:e});var p=u.map(To.parseMessengers).flat().map((function(e){return null==e?void 0:e.type}));Array.from(new Set(p)).forEach((function(t){t&&a.push({label:r(t),mapping:o,type:t,element:e})}));break;default:a.push({label:e.label||"",mapping:o,element:e})}}})),a}),[t,e,l,i,s,r,n.MERGE_FORM])}(t,r);return{formRows:o,contactsData:r,mergeContactsData:Jc(o,r)}}function tu(e,t,n,r,a,o,i){try{var s=e[o](i),l=s.value}catch(c){return void n(c)}s.done?t(l):Promise.resolve(l).then(r,a)}function nu(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ru(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){nu(e,t,n[t])}))}return e}function au(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function ou(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function iu(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(s){o=[6,s],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function su(e){var t=e.handleSubmit,n=(0,$.useLocalizationState)().t,r=(0,kr.useAtomValue)(Dc),o=qc().closeContactsMerge,i=(0,ji.useContactsStateMethods)(),s=i.mergeContacts,l=i.getContactDetails,c=(0,ae.useModalsStateMethods)().openModal;return(0,a.useMemo)((function(){return t((e=function(e){var t,a,i,u;return iu(this,(function(d){switch(d.label){case 0:return[4,new Promise((function(e){c({title:n.GLOBAL.confirm(),body:n.MERGE_FORM.confirm_merge(),actions:{ok:{title:n.GLOBAL.continue(),action:function(){return e(!0)}},cancel:{title:n.GLOBAL.cancel(),action:function(){return e(!1)}}},afterClose:function(){return e(!1)}})}))];case 1:return d.sent()?(t=e.id,a=ou(e,["id"]),[4,l({id:t})]):[2];case 2:return(i=d.sent())?(f=a.Contact,p=(m=void 0===f?{}:f).emails,v=m.addresses,g=m.phones,h=m.messengers,b=ou(a.Contact,["emails","addresses","phones","messengers"]),y=au(ru({},ou(a,["Contact"])),{Contact:au(ru({},b),{phones:(0,we.truthy)(g||[]).map((function(e){return JSON.parse(e)})),addresses:(0,we.truthy)(v||[]).map((function(e){return JSON.parse(e)})),emails:(0,we.truthy)(p||[]).map((function(e){return JSON.parse(e)})),messengers:(0,we.truthy)(h||[]).map((function(e){return JSON.parse(e)}))})}),S=(0,Ol.flatten)(y,{maxDepth:2}),u=(0,Ol.unflatten)(ru({},i,S)),[4,s({id:t,mergedDetails:u,removeIds:r.filter((function(e){return e!==t}))})]):[2];case 3:return d.sent(),o(),[2]}var f,m,p,v,g,h,b,y,S}))},a=function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){tu(o,r,a,i,s,"next",e)}function s(e){tu(o,r,a,i,s,"throw",e)}i(void 0)}))},function(e){return a.apply(this,arguments)}));var e,a}),[o,l,t,s,r,c,n.GLOBAL,n.MERGE_FORM])}function lu(e){return W("row-auto bg-main-bg px-4 py-3",{"bg-black bg-opacity-5":e%2,"sticky top-0 z-10 border-b border-main-border":0===e})}var cu=function(){var e,t,n,o,i;e=(0,kr.useAtomValue)(Dc),t=(0,ji.useContactsStateMethods)(),n=t.getContact,o=t.getContactDetails,i=t.getContactFormsDefinitions,(0,a.useEffect)((function(){e.forEach((function(e){n({id:e,force:!0}),o({id:e,force:!0})}))}),[n,o,e]),(0,a.useEffect)((function(){i({})}),[i]);var s=qc().canAddContactForMerge,l=eu(),c=l.formRows,u=l.contactsData,d=l.mergeContactsData,f=(0,a.useMemo)((function(){return{gridRow:"1/".concat(c.length+1)}}),[c.length]),m=(0,nt.useForm)(),p=m.control,v=m.handleSubmit,g=m.formState.isSubmitting,h=m.reset;(0,a.useEffect)((function(){d.length&&h()}),[d.length,h]);var b=u.some((function(e){return e.isLoading})),y=su({handleSubmit:v});return(0,r.jsxs)("div",{className:"flex flex-1 flex-col overflow-hidden",children:[(0,r.jsxs)("div",{className:"flex flex-1 flex-col overflow-hidden border-b border-main-border bg-main-bg",children:[(0,r.jsxs)("div",{className:"relative grid auto-cols-fr auto-rows-max overflow-y-auto",children:[(0,r.jsx)("div",{className:"grid grid-rows-subgrid",style:f,children:c.map((function(e,t){var n=e.label,a=e.mapping;return(0,r.jsx)("div",{className:W(lu(t),{"font-bold":!a}),children:n},t)}))}),d.map((function(e,t){var n=e.rows;return(0,r.jsxs)("div",{className:"relative grid grid-rows-subgrid",style:f,children:[n.map((function(e,t){var n=e.fields;return(0,r.jsx)("div",{className:lu(t),children:!b&&n.map((function(e,t){return(0,r.jsx)("div",{children:(0,r.jsx)(Kc,{field:e,control:p})},t)}))},t)})),b&&(0,r.jsx)(q.Loader,{active:!0,color:"primary",size:"huge",className:"z-10"})]},t)})),s&&(0,r.jsx)("div",{className:"grid grid-rows-subgrid",style:f,children:c.map((function(e,t){return(0,r.jsx)("div",{className:W(lu(t),{"flex items-center justify-end":!t}),children:!t&&(0,r.jsx)(Yc,{})},t)}))})]}),!c.length&&(0,r.jsx)(q.Loader,{active:!0,color:"primary",size:"huge",className:"z-10"})]}),(0,r.jsx)(Qc,{disabled:b,onReset:function(){return h()},onConfirm:y,isSubmitting:g}),!1]})};function uu(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function du(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||mu(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function fu(e){return function(e){if(Array.isArray(e))return uu(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||mu(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function mu(e,t){if(e){if("string"==typeof e)return uu(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?uu(e,t):void 0}}var pu="all_teams",vu=function(){var e=(0,$.useLocalizationState)().t,t=(0,C.useSessionState)("teamId"),n=du((0,kr.useAtom)(kc),2),o=n[0],i=n[1],s=(0,fo.useDirectoryState)(["teams","isTeamsLoading"]),l=s.teams,c=s.isTeamsLoading,u=(0,fo.useDirectoryStateMethods)().getAgentTeams;(0,a.useEffect)((function(){c||l.length||u()}),[l,c,u]);var d=(0,a.useMemo)((function(){return[{text:e.GLOBAL.all_teams(),value:pu}].concat(fu(l.filter((function(e){return e.supervised||e.id===t})).map((function(e){return{text:e.name,value:e.id}}))))}),[t,e.GLOBAL,l]);return d.length<2||c?null:(0,r.jsx)(q.Dropdown,{className:"ml-2",options:d,onChange:function(e,t){"string"==typeof t.value&&i(t.value===pu?void 0:t.value)},value:o||pu,inline:!0})};var gu=function(e){var t=e.table,n=(0,$.useLocalizationState)().t,o=(0,C.useSessionState)("privileges"),i=function(e){var t=(0,ae.useModalsStateMethods)().openModal,n=(0,He.useCaseStateMethods)().closeCasesAsSpam,r=(0,$.useLocalizationState)().t;return(0,a.useCallback)((function(){var a,o=e.getSelectedRowModel().flatRows,i=o.length;i&&t({title:r.WINDOW_POPUP_TITLES_AND_MESSAGES.window_title_warning(),body:i>1?r.EMAIL.spam_confirm_message_multiple(i.toString()):r.EMAIL.spam_confirm_message_single(null!==(a=o[0].original.title)&&void 0!==a?a:""),actions:{ok:{title:r.WINDOW_POPUP_TITLES_AND_MESSAGES.window_buttonOk(),action:function(){n(o.map((function(e){return e.original.id}))),e.resetRowSelection()}},cancel:{title:r.WINDOW_POPUP_TITLES_AND_MESSAGES.window_buttonCancel()}},className:"autoSizeModal"})}),[n,t,r.EMAIL,r.WINDOW_POPUP_TITLES_AND_MESSAGES,e])}(t),s=function(e){var t=(0,$.useLocalizationState)().t,n=(0,C.useSessionState)("privileges"),r=(0,He.useCaseStateMethods)().deleteCases,o=(0,ae.useModalsStateMethods)().openModal;return(0,a.useCallback)((function(){var a,i=e.getSelectedRowModel().flatRows,s=i.length;n.SYS_DELETE_CASES&&s&&o({title:t.WINDOW_POPUP_TITLES_AND_MESSAGES.window_title_warning(),body:s>1?t.EMAIL.trash_confirm_message_multiple(s.toString()):t.EMAIL.trash_confirm_message_single(null!==(a=i[0].original.title)&&void 0!==a?a:""),actions:{ok:{title:t.WINDOW_POPUP_TITLES_AND_MESSAGES.window_buttonOk(),action:function(){r(i.map((function(e){return e.original.id}))),e.resetRowSelection()}},cancel:{title:t.WINDOW_POPUP_TITLES_AND_MESSAGES.window_buttonCancel()}},className:"autoSizeModal"})}),[r,o,n.SYS_DELETE_CASES,t.EMAIL,t.WINDOW_POPUP_TITLES_AND_MESSAGES,e])}(t);return(0,r.jsxs)("div",{className:"flex items-center justify-end gap-2 p-2",children:[(0,r.jsx)(vu,{}),(0,r.jsx)(q.SemanticButton,{onClick:i,basic:!0,color:"orange",className:"mr-0",children:n.EMAIL.button_spam_text()}),o.SYS_DELETE_CASES&&(0,r.jsx)(q.SemanticButton,{onClick:s,basic:!0,color:"red",icon:"trash",tooltip:n.EMAIL.button_trash_tooltip()})]})},hu={select:!0,title:!0,ownerName:!0,categoryName:!0,status:!0,createdTime:!0,sla:!0,lastService:!1,lastDisposition:!1},bu=["New","Open","Pending","Resolved","Closed"],yu=function(e){var t=e.table,n=(0,$.useLocalizationState)().t;return(0,r.jsx)(q.PopupButton,{transparent:!0,className:"text-[14px] !text-main",popupContent:(0,r.jsxs)("div",{className:"flex flex-col gap-1.5 p-2",children:[(0,r.jsx)(q.Checkbox,{checked:t.getIsAllColumnsVisible(),onChange:function(e){t.toggleAllColumnsVisible(e)},label:n.EMAIL.search_queue_case_content_all()}),t.getAllLeafColumns().filter((function(e){return e.getCanHide()})).map((function(e){var t=e.columnDef.header;return(0,r.jsx)(q.Checkbox,{onChange:function(t){e.toggleVisibility(t)},checked:e.getIsVisible(),label:"string"==typeof t?t:null},e.id)})),(0,r.jsx)(q.Button,{transparent:!0,className:"pl-[26px]",onClick:function(){t.setColumnVisibility(hu)},children:n.EMAIL.search_queue_case_restore_default()})]}),children:n.EMAIL.search_queue_case_content_label()})};function Su(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function xu(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Su(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Su(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var ju=function(){var e=(0,$.useLocalizationState)().t,t=xu((0,kr.useAtom)(Lc),2),n=t[0],o=t[1],i=(0,a.useCallback)((function(e,t){var n="string"==typeof t.value&&"team"===t.value?"team":void 0;o(n)}),[o]),s=(0,a.useMemo)((function(){return[{text:e.EMAIL.search_queue_all_team_services(),value:"all"},{text:e.EMAIL.search_queue_team_services(),value:"team"}]}),[e.EMAIL]);return(0,r.jsx)(q.Dropdown,{inline:!0,options:s,onChange:i,value:n||"all",hideIcon:!0,trigger:(0,r.jsxs)("p",{className:"cursor-pointer font-normal",children:[e.EMAIL.email_teamQueue_service_label(),": ","team"===n?e.EMAIL.search_queue_team_services():e.EMAIL.search_queue_all_team_services()]})})};function Iu(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ou(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _u(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Ou(e,t,n[t])}))}return e}function Cu(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function wu(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Iu(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Iu(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Nu=function(){var e,t=(e=(0,$.useLocalizationState)().t.EMAIL,(0,a.useMemo)((function(){return[{value:"score",text:e.email_queue_field_relevance()},{value:"createTime",text:e.email_queue_field_createTime()},{value:"updateTime",text:e.email_queue_field_updateTime()},{value:"customerUpdate",text:e.email_queue_field_customerUpdate()},{value:"slaTarget",text:e.email_queue_field_slaTarget()},{value:"sla",text:e.email_queue_field_serviceLevel()},{value:"flag",text:e.email_queue_field_flag()},{value:"service",text:e.search_queue_case_content_last_service()},{value:"disposition",text:e.search_queue_case_content_disposition()},{value:"status",text:e.search_queue_case_content_state()}]}),[e])),n=wu((0,kr.useAtom)(Mc),2),o=n[0],i=n[1],s=(0,a.useCallback)((function(){i((function(e){return Cu(_u({},e),{asc:!e.asc})}))}),[i]),l=(0,a.useCallback)((function(e,t){i((function(e){return"string"!=typeof t.value?e:Cu(_u({},e),{asc:"score"!==t.value&&e.asc,sortBy:t.value})}))}),[i]);return(0,r.jsxs)("div",{className:"flex items-center gap-0.5",children:[(0,r.jsx)(q.Dropdown,{inline:!0,options:t,onChange:l,value:o.sortBy,hideIcon:!0}),(0,r.jsx)(q.SemanticButton,{transparent:!0,icon:o.asc?"caret up":"caret down",className:"[&>i]:flex [&>i]:items-center [&>i]:justify-center [&>i]:text-[18px]",onClick:s,disabled:"score"===o.sortBy,basic:!0,size:"mini"})]})};function Au(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Eu(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||Pu(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Tu(e){return function(e){if(Array.isArray(e))return Au(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Pu(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Pu(e,t){if(e){if("string"==typeof e)return Au(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Au(e,t):void 0}}var Mu=function(){var e,t=(0,$.useLocalizationState)().t,n=Eu((0,kr.useAtom)(Pc),2),o=n[0],i=n[1],s=(e=(0,$.useLocalizationState)().t.GLOBAL,(0,a.useMemo)((function(){return[{value:"New",text:e.case_status_new()},{value:"Open",text:e.case_status_open()},{value:"Pending",text:e.case_status_pending()},{value:"Resolved",text:e.case_status_resolved()},{value:"Closed",text:e.case_status_closed()}]}),[])),l=bu.every((function(e){return o.includes(e)})),c=bu.filter((function(e){return o.includes(e)})).map((function(e){var t;return(null===(t=s.find((function(t){return t.value===e})))||void 0===t?void 0:t.value)||""})).join(", ");return(0,r.jsxs)(q.PopupButton,{transparent:!0,className:"text-[14px] !text-main",popupContent:(0,r.jsxs)("div",{className:"flex flex-col gap-1.5 p-2",children:[(0,r.jsx)(q.Checkbox,{checked:l,onChange:function(){i(l?[]:bu)},label:t.EMAIL.search_queue_case_content_all()}),s.map((function(e){var t=e.value,n=e.text;return(0,r.jsx)(q.Checkbox,{onChange:function(){i((function(e){return e.includes(t)?e.filter((function(e){return e!==t})):Tu(e).concat([t])}))},checked:o.includes(t),label:n},t)}))]}),children:[t.EMAIL.search_queue_case_status_label(),": ",(0,r.jsx)("span",{className:"text-main-secondary",children:l||!c?t.EMAIL.search_queue_case_content_all():c})]})};function Lu(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ku(e){return function(e){if(Array.isArray(e))return e}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Lu(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Lu(e,t)}(e)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Du=function(e){var t=e.table,n=ku(t.getLeafHeaders()),a=n[0],o=n.slice(1);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(re.SmTable.HeaderCell,{children:(0,ra.ie)(a.column.columnDef.header,a.getContext())}),(0,r.jsx)(re.SmTable.HeaderCell,{colSpan:o.length,children:(0,r.jsxs)("div",{className:"flex items-center justify-between gap-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(Mu,{}),(0,r.jsx)(ju,{})]}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(Nu,{}),(0,r.jsx)(yu,{table:t})]})]})})]})};function Ru(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Fu(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ru(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ru(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Bu=function(e){var t=e.row,n=Fu((0,kr.useAtom)(Ec),2),a=n[0],o=n[1];return(0,r.jsx)(re.SmTable.Row,{tabIndex:0,onClick:function(){return o(t.id)},onKeyDown:function(e){["Enter"," "].includes(e.key)&&o(t.id)},active:t.id===a,className:"cursor-pointer border-b-0",children:t.getVisibleCells().map((function(e){return(0,r.jsx)(re.SmTable.Cell,{children:(0,ra.ie)(e.column.columnDef.cell,e.getContext())},e.id)}))},t.id+"_1")},Uu=function(e){var t=e.table,n=t.getLeafHeaders();return(0,r.jsx)("div",{className:"overflow-auto border-t",onKeyDown:function(e){["Enter"," "].includes(e.key)&&e.preventDefault()},children:(0,r.jsxs)(re.SmTable,{compact:!0,striped:!0,className:"w-full table-fixed border-none",children:[(0,r.jsx)("colgroup",{children:n.map((function(e){return(0,r.jsx)("col",{"data-id":e.id,style:{width:e.column.columnDef.size||"auto"}},e.id)}))}),(0,r.jsx)(re.SmTable.Header,{className:"sticky top-0 z-[1]",children:(0,r.jsx)(Du,{table:t})}),(0,r.jsx)(re.SmTable.Body,{children:t.getRowModel().rows.map((function(e){return(0,r.jsx)(Bu,{row:e},e.id)}))})]})})},zu=(0,aa.Cl)(),Hu=function(e){return(0,r.jsx)("div",{className:"truncate",title:e.getValue(),children:e.getValue()})};function Vu(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Gu(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Vu(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Vu(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Wu=function(){var e,t,n=(0,kr.useAtomValue)(Cc),o=(0,kr.useSetAtom)(Ec),i=(0,kr.useAtomValue)(Pc),s=(0,kr.useAtomValue)(Mc),l=(0,kr.useAtomValue)(Lc),c=(0,kr.useAtomValue)(kc),u=(0,He.useCaseState)(["casesList","casesListLoading"]),d=u.casesList,f=u.casesListLoading,m=(0,He.useCaseStateMethods)().getCasesList,p=Gu((0,a.useState)(hu),2),v=p[0],g=p[1],h=Gu((0,a.useState)({}),2),b=h[0],y=h[1],S=(0,ra.b7)({columns:(e=(0,$.useLocalizationState)().t,t=(0,Ce.useFormatting)().formatFullName,(0,a.useMemo)((function(){return[zu.display({id:"select",header:function(e){var t=e.table;return(0,r.jsx)(q.Checkbox,{checked:t.getIsAllRowsSelected(),indeterminate:t.getIsSomeRowsSelected(),onChange:function(e){return t.toggleAllPageRowsSelected(e)}})},cell:function(e){var t=e.row;return(0,r.jsx)(q.Checkbox,{checked:t.getIsSelected(),disabled:!t.getCanSelect(),onChange:function(e){return t.toggleSelected(e)}})},enableHiding:!1,size:41}),zu.accessor((function(n){return t(n.reporterFirstName,n.reporterLastName)||e.GLOBAL.unidentified()}),{id:"title",header:e.CASE_SEARCH.caseSearch_case_column(),cell:function(e){var t=e.getValue,n=e.row.original.title;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("p",{className:"truncate",title:t(),children:t()}),n&&(0,r.jsx)("p",{className:"truncate",title:n,children:n})]})},enableHiding:!1,size:0}),zu.accessor("queuedCase.ownerName",{id:"ownerName",header:e.EMAIL.search_queue_case_content_location(),size:100}),zu.accessor("categoryName",{id:"categoryName",header:e.EMAIL.search_queue_case_category(),size:100}),zu.accessor("status",{id:"status",header:e.EMAIL.case_view_status_label(),cell:Hu,size:80}),zu.accessor((function(e){return(0,X.formatDate)(e.createdTime)}),{id:"createdTime",header:e.EMAIL.search_queue_case_content_date(),size:110}),zu.accessor("queuedCase.sla",{id:"sla",header:e.EMAIL.search_queue_case_content_sla(),size:70}),zu.accessor("lastService",{id:"lastService",header:e.EMAIL.search_queue_case_content_last_service(),cell:Hu,size:0}),zu.accessor("lastDisposition",{id:"lastDisposition",header:e.EMAIL.search_queue_case_content_disposition(),cell:Hu,size:80})]}),[t,e.CASE_SEARCH,e.EMAIL])),data:d,getCoreRowModel:(0,aa.sC)(),getRowId:function(e){return e.id},state:{rowSelection:b,columnVisibility:v},onRowSelectionChange:y,onColumnVisibilityChange:g});return(0,a.useEffect)((function(){var e=setTimeout((function(){m({query:n,statuses:i,service:l,teamId:c,sortBy:s.sortBy,asc:s.asc})}),500);return function(){e&&clearTimeout(e)}}),[n,i,m,s,l,c]),(0,a.useEffect)((function(){var e;o(null===(e=d[0])||void 0===e?void 0:e.id)}),[d,o]),(0,r.jsxs)("div",{className:"relative flex flex-1 flex-col  overflow-hidden",children:[(0,r.jsx)(gu,{table:S}),(0,r.jsx)(Uu,{table:S}),(0,r.jsx)(q.Loader,{active:f,color:"primary",size:"huge"})]})},qu=function(e){var t=e.caseId,n=(0,$.useLocalizationState)().t,o=(0,He.useCaseStateMethods)().openCase,i=(0,a.useCallback)((function(){t&&o({caseId:t})}),[t,o]),s=(0,w.useOnKeyPressHandler)(i);return(0,r.jsx)(q.SemanticButton,{basic:!0,primary:!0,onClick:i,onKeyDown:s,children:n.EMAIL.email_open_button()})},Yu=function(){var e=(0,$.useLocalizationState)().t,t=(0,kr.useAtomValue)(Ec);return t?(0,r.jsx)(Er,{id:t,FooterContent:(0,r.jsx)(qu,{caseId:t})}):(0,r.jsx)("div",{className:"m-auto text-[28px] text-[--c-no-data-text]",children:e.GLOBAL.no_data()})};function Qu(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ku(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Qu(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Qu(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var $u=function(){var e=Ku((0,kr.useAtom)(Tc),2),t=e[0],n=e[1];return(0,r.jsxs)("section",{className:"flex h-full items-start overflow-hidden",children:[(0,r.jsx)(q.ResizePanel,{className:"h-full",minSize:400,maxSizeInPercent:70,initialSize:t,onDragEnd:(0,m.flow)((0,m.property)("size"),n),direction:"right",containerClass:"h-full",children:(0,r.jsx)("aside",{className:"flex h-full min-w-0 flex-auto flex-col border-r border-gray-200",children:(0,r.jsx)(Wu,{})})}),(0,r.jsx)("article",{className:"relative flex h-full w-full flex-1 flex-col overflow-hidden",children:(0,r.jsx)(Yu,{})})]})};function Xu(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ju(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Xu(e,t,n[t])}))}return e}function Zu(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function ed(){var e=(0,$.useLocalizationState)().t,t=zc(),n=t.handleTabOpen,r=t.handleTabClose,o=t.handleTabUpdate,i=(0,Ce.useFormatting)().formatFullName,s=qc().addContactForMerge,l=(0,a.useCallback)((function(e,t){var r={id:e.id,type:"contact",title:i(e.firstName,e.lastName),props:{editMode:t,onMerge:s?function(){return s(e.id)}:void 0,onEditMode:function(e){return o(Zu(Ju({},r),{props:Zu(Ju({},r.props),{editMode:e})}))}},closeable:!0};n(r)}),[s,i,n,o]),c=(0,a.useCallback)((function(t,r,a){var o={id:"create",type:"create_contact",title:t||e.GLOBAL.anonymous(),closeable:!0,props:{initialData:r,onContactCreated:a}};n(o)}),[e,n]);return{handleContactCreate:c,handleContactOpen:l,handleContactCreateCancel:(0,a.useCallback)((function(){r("create")}),[r])}}var td=function(e){var t=e.selectedContact,n=(0,$.useLocalizationState)().t,o=(0,C.useSessionState)().privileges,i=(0,ae.useModalsStateMethods)().openModal,s=(0,Ce.useFormatting)().formatFullName,l=(0,ji.useContactsStateMethods)().deleteContact,c=(0,K.useNotificationsState)("methods").showNotification,u=Il(),d=jl(),f=ed(),m=f.handleContactCreate,p=f.handleContactOpen,v=qc().addContactForMerge,g=(0,a.useCallback)((function(){t&&p(t)}),[t,p]),h=(0,a.useCallback)((function(){t&&p(t,!0)}),[p,t]),b=(0,a.useCallback)((function(){t&&v&&v(t.id)}),[v,t]),y=(0,a.useCallback)((function(){var e=function(){return c({type:"error",id:K.Notifications.ContactDeleteError,tags:["current-view"],message:n.CONTACT.delete_error()})},r=s(null==t?void 0:t.firstName,null==t?void 0:t.lastName)||"";i({title:n.WINDOW_POPUP_TITLES_AND_MESSAGES.window_title_warning(),body:n.UNDEFINED.contact_deleting_confirmation(r),actions:{ok:{title:n.WINDOW_POPUP_TITLES_AND_MESSAGES.window_buttonOk(),action:function(){t?l(t.id).catch(e):e()}},cancel:{title:n.WINDOW_POPUP_TITLES_AND_MESSAGES.window_buttonCancel()}}})}),[s,t,i,n.WINDOW_POPUP_TITLES_AND_MESSAGES,n.UNDEFINED,n.CONTACT,c,l]);return(0,r.jsxs)("div",{className:"flex items-center justify-center p-3.5",children:[(0,r.jsx)(q.SemanticButton,{onClick:g,basic:!0,primary:!0,children:n.UNDEFINED.button_view_contact_text()}),o.EDIT_CONTACTS&&(0,r.jsx)(q.SemanticButton,{basic:!0,primary:!0,onClick:h,children:n.UNDEFINED.button_edit_contact_text()}),v&&(0,r.jsx)(q.SemanticButton,{basic:!0,primary:!0,onClick:b,children:n.GLOBAL.merge()}),u&&(0,r.jsx)(q.SemanticButton,{basic:!0,primary:!0,onClick:function(){(0,we.assertDefined)(t),d(t)},children:n.UNDEFINED.button_use_contact_text()}),(0,r.jsx)(q.SemanticButton,{basic:!0,primary:!0,onClick:function(){return m()},children:n.UNDEFINED.button_create_contact_text()}),o.DELETE_CONTACTS&&(0,r.jsx)(q.SemanticButton,{basic:!0,color:"red",onClick:y,children:n.UNDEFINED.button_delete_contact_text()})]})},nd=function(e){var t=e.row,n=ed().handleContactOpen;return(0,r.jsx)(re.SmTable.Row,{tabIndex:0,"data-id":t.id,onClick:t.getToggleSelectedHandler(),onKeyDown:function(e){["Enter"," "].includes(e.key)&&(t.getIsSelected()?n(t.original):t.toggleSelected())},onDoubleClick:function(){t.toggleSelected(!0),n(t.original)},active:t.getIsSelected(),className:"cursor-pointer",children:t.getVisibleCells().map((function(e){return(0,r.jsx)(re.SmTable.Cell,{children:(0,ra.ie)(e.column.columnDef.cell,e.getContext())},e.id)}))},t.id)},rd=(0,aa.Cl)();function ad(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function od(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ad(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ad(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var id=function(e){var t,n=e.data,o=e.selectedContactId,i=(0,kr.useSetAtom)(Ac),s=(0,a.useMemo)((function(){return o?function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},o,!0):{}}),[o]),l=(0,a.useCallback)((function(e){var t,r,a="function"==typeof e?e(s):e,o=null===(t=Object.entries(a).find((function(e){var t=od(e,2);t[0];return t[1]})))||void 0===t?void 0:t[0],l=n.find((function(e){return e.id===o}));i((null==l?void 0:l.id)||(null===(r=n[0])||void 0===r?void 0:r.id))}),[n,s,i]),c=(0,ra.b7)({columns:(t=(0,$.useLocalizationState)().t,(0,a.useMemo)((function(){return[rd.accessor("firstName",{id:"firstName",header:function(){return t.UNDEFINED.contact_first_name()},meta:{width:"20%"}}),rd.accessor("lastName",{id:"lastName",header:function(){return t.UNDEFINED.contact_last_name()},meta:{width:"20%"}}),rd.accessor("phone",{id:"phone",header:function(){return t.UNDEFINED.contact_phone()},meta:{width:"10%"}}),rd.accessor("email",{id:"email",header:function(){return t.UNDEFINED.contact_email()},meta:{width:"50%"}}),rd.accessor("source",{id:"source",header:function(){return t.UNDEFINED.column_type()},meta:{width:"100px"}})]}),[t.UNDEFINED])),data:n,getCoreRowModel:(0,aa.sC)(),getRowId:function(e){return e.id},enableMultiRowSelection:!1,state:{rowSelection:s},onRowSelectionChange:l}),u=c.getHeaderGroups()[0].headers;return(0,r.jsx)("div",{className:"overflow-auto",onKeyDown:function(e){["Enter"," "].includes(e.key)&&e.preventDefault()},children:(0,r.jsxs)(re.SmTable,{compact:!0,striped:!0,className:"w-full border-none",children:[(0,r.jsx)("colgroup",{children:u.map((function(e){return(0,r.jsx)("col",{style:{width:(t=e.column,t.columnDef.meta&&"width"in t.columnDef.meta?t.columnDef.meta.width:"auto")}},e.id);var t}))}),(0,r.jsx)(re.SmTable.Header,{className:"sticky top-0 z-[1]",children:u.map((function(e){return(0,r.jsx)(re.SmTable.HeaderCell,{children:(0,ra.ie)(e.column.columnDef.header,e.getContext())},e.id)}))}),(0,r.jsx)(re.SmTable.Body,{children:c.getRowModel().rows.map((function(e){return(0,r.jsx)(nd,{row:e},e.id)}))})]})})};function sd(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ld(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return sd(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return sd(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var cd=function(e){var t=e.searchId,n=(0,a.useRef)(null),o=(0,kr.useAtomValue)(Cc),i=ld((0,kr.useAtom)(Ac),2),s=i[0],l=i[1],c=(0,ji.useContactsState)(["search","contactList","contactListLoading"]),u=c.search,d=c.contactList,f=c.contactListLoading,m=(0,ji.useContactsStateMethods)(),p=ld((0,a.useMemo)((function(){var e,n,r,a;return t?[null!==(r=null===(e=u[t])||void 0===e?void 0:e.list)&&void 0!==r?r:[],null===(a=null===(n=u[t])||void 0===n?void 0:n.isLoading)||void 0===a||a]:[d,f]}),[d,f,u,t]),2),v=p[0],g=p[1],h=(0,a.useMemo)((function(){return v.find((function(e){return e.id===s}))}),[v,s]);(0,a.useEffect)((function(){var e=setTimeout((function(){m.getContactList({query:o,searchId:t})}),1e3);return function(){e&&clearTimeout(e)}}),[o,m,t]),(0,a.useEffect)((function(){if(s){var e,t=v.some((function(e){return e.id===s}));if(!t)l(null===(e=v[0])||void 0===e?void 0:e.id)}else if(v.length){var n;l(null===(n=v[0])||void 0===n?void 0:n.id)}else l(void 0)}),[v,s,l]);var b=(0,w.useEvent)((function(e){var t=v.findIndex((function(e){return e.id===s})),r="";switch(e.key){case"ArrowUp":r=0===t||-1===t?v[v.length-1].id:v[t-1].id;break;case"ArrowDown":var a,o;r=t===v.length-1||-1===t?null===(a=v[0])||void 0===a?void 0:a.id:null===(o=v[t+1])||void 0===o?void 0:o.id}if(r){var i;e.stopPropagation(),e.preventDefault(),l(r);var c=null===(i=n.current)||void 0===i?void 0:i.querySelector("tr[data-id='".concat(r,"']"));null==c||c.scrollIntoView({block:"center",behavior:"smooth"}),null==c||c.focus()}}));return(0,w.useEventListener)("keydown",b),(0,r.jsxs)("div",{className:"flex flex-1 flex-col overflow-hidden",children:[(0,r.jsx)("div",{className:"flex flex-1 flex-col overflow-hidden border-b border-main-border",ref:n,children:(0,r.jsx)(id,{data:v,selectedContactId:s})}),(0,r.jsx)(q.Loader,{active:g,color:"primary",size:"huge"}),(0,r.jsx)(td,{selectedContact:h})]})};function ud(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function dd(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ud(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ud(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var fd=function(){var e=(0,$.useLocalizationState)().t,t=dd((0,kr.useAtom)(Cc),2),n=t[0],o=t[1],i=(0,a.useMemo)((function(){return[{id:"contacts",title:e.UNDEFINED.search_tab_contacts(),Icon:dn.LegacyIconContacts},{id:"cases",title:e.UNDEFINED.search_tab_cases(),Icon:dn.LegacyIconSearchCases}]}),[e]),s=dd((0,a.useState)(i[0].id),2),l=s[0],c=s[1];(0,Dr.useLocalStorageForState)(l,"adSearchActiveTab",c,i[0].id);var u=(0,a.useCallback)((function(){return o("")}),[o]),d=(0,a.useCallback)((function(e){o(e.target.value)}),[o]),f=(0,a.useCallback)((function(t){return(0,r.jsxs)("div",{className:"mx-[15%] flex flex-auto flex-row flex-nowrap items-center justify-center",children:[(0,r.jsx)(q.SearchInput,{className:"mr-4",tabIndex:0,value:n,onChange:d,placeholder:e.UNDEFINED.contact_search_input_placeholder(),clearable:!0,onClear:u}),t]})}),[n,d,e.UNDEFINED,u]),m=(0,a.useCallback)((function(e){var t=e.title,n=e.Icon;return(0,r.jsxs)("div",{className:"flex whitespace-nowrap py-[5px] text-lg leading-[30px]",children:[(0,r.jsx)(n,{className:"mr-2.5 h-[30px] w-[30px] align-top [&_path]:fill-main"}),t]})}),[]),p=(0,a.useCallback)((function(e){switch(e.id){case"contacts":return(0,r.jsx)(cd,{searchId:n});case"cases":return(0,r.jsx)($u,{})}return null}),[]);return(0,r.jsx)(q.Tabs,{className:"flex flex-auto flex-col overflow-auto",tabsContentClassName:"flex-auto h-auto flex flex-col",tabs:i,activeTabId:l,renderHeader:f,renderTab:m,renderTabContent:p,onChange:c})};function md(e,t,n,r,a,o,i){try{var s=e[o](i),l=s.value}catch(c){return void n(c)}s.done?t(l):Promise.resolve(l).then(r,a)}function pd(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){md(o,r,a,i,s,"next",e)}function s(e){md(o,r,a,i,s,"throw",e)}i(void 0)}))}}function vd(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(s){o=[6,s],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function gd(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function hd(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function bd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){hd(e,t,n[t])}))}return e}function yd(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Sd(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return gd(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return gd(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var xd=function(){var e=(0,$.useLocalizationState)().t,t=(0,kr.useAtomValue)(wc),n=Sd((0,kr.useAtom)(Nc),2),o=n[0],i=n[1],l=zc().handleTabClose,u=ed().handleContactCreateCancel;!function(){var e=(0,s.useParams)(),t=(0,Ce.useFormatting)().formatFullName,n=(0,ji.useContactsStateMethods)().getContact,r=(0,He.useCaseState)((function(t){return e.caseId?t.cases[e.caseId]:void 0})),o=(0,He.useCaseStateMethods)().getCase,i=(0,kr.useSetAtom)(wc),l=(0,kr.useSetAtom)(Nc),u=qc().addContactForMerge;(0,a.useEffect)((function(){function r(){return(r=pd((function(){var r,a;return vd(this,(function(o){switch(o.label){case 0:return(r=e.contactId)?[4,n({id:r})]:[2];case 1:return(a=o.sent())?(i(f()((function(e){e.push({id:r,type:"contact",title:t(a.firstName,a.lastName),closeable:!0,props:{editMode:!1,onMerge:u?function(){return u(r)}:void 0}})}))),l(r),history.replaceState(null,"",c.AppRoutes.search),[2]):(console.error("Contact with id ".concat(r," not found")),[2])}}))}))).apply(this,arguments)}!function(){r.apply(this,arguments)}()}),[t,n,u,e.contactId,l,i]),(0,a.useEffect)((function(){var t=e.caseId;t&&o(t)}),[o,e.caseId,l,i]);var d=(0,w.usePrevious)(r);(0,a.useEffect)((function(){e.caseId&&!(null==d?void 0:d.data)&&(null==r?void 0:r.data)&&(i(f()((function(e){var t;(0,we.assertDefined)(null==r?void 0:r.data),(0,we.assertDefined)(r.data.number),e.push({id:r.data.id,type:"case",title:null===(t=r.data.number)||void 0===t?void 0:t.toString(),closeable:!0})}))),l(r.data.id),history.replaceState(null,"",c.AppRoutes.search))}),[r,e.caseId,null==d?void 0:d.data,l,i])}();var d=(0,a.useCallback)((function(t){var n=t.title;return"search"===t.id?e.SCREENPOP_FORM.searchButton():n}),[e.SCREENPOP_FORM]),m=(0,a.useCallback)((function(e){switch(e.type){case"search":return(0,r.jsx)(fd,{});case"create_contact":return(0,r.jsx)(Ul,yd(bd({},e.props),{onCancel:u}));case"contact":return(0,r.jsx)(kl,bd({contactId:e.id},e.props));case"case":return(0,r.jsx)(Er,{id:e.id});case"merge_contacts":return(0,r.jsx)(cu,{})}}),[u]);return(0,r.jsx)(q.Tabs,{"data-testid":"search-page",className:"flex flex-auto flex-col overflow-auto",tabsContentClassName:"flex-auto flex flex-col h-auto",tabs:t,activeTabId:o,renderTabContent:m,renderTab:d,onChange:i,onTabClose:l})},jd=n(6070),Id=(0,q.createComponentLoader)("knowledgeBase",n.e(330).then(n.t.bind(n,2330,23)),"KBPage").KBPageLoader,Od={autoOpenInteractionTab:!0,dualView:!0,multiTabs:!0,openInNewTab:!0},_d=(0,a.memo)((function(){var e=(0,jd.useKbBridgeConnector)();return(0,jd.assertKBBridgeInterface)(e),(0,r.jsx)(Id,{features:Od,kbBridge:e})}));function Cd(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var wd,Nd=(0,q.createComponentLoader)("chatCenter",(function(){return n.e(975).then(n.t.bind(n,9975,23))}),"ChatCenterPage").ChatCenterPageLoader,Ad=(0,q.createComponentLoader)("supervision",(function(){return n.e(205).then(n.t.bind(n,3205,23))}),"SupervisionPage").SupervisionPageLoader,Ed=(0,q.createComponentLoader)("campaigns",(function(){return n.e(809).then(n.t.bind(n,7809,23))}),"CampaignsPage").CampaignsPageLoader,Td=(0,q.createComponentLoader)("calendar",(function(){return n.e(662).then(n.t.bind(n,5662,23))}),"CalendarPage").CalendarPageLoader,Pd=(0,q.createComponentLoader)("interactionSearch",n.e(437).then(n.t.bind(n,1437,23)),"InteractionSearchPage").InteractionSearchPageLoader,Md=(0,q.createComponentLoader)("homePage",(function(){return n.e(398).then(n.t.bind(n,8398,23))}),"HomePage").HomePageLoader,Ld=(0,q.createComponentLoader)("omniQm",(function(){return n.e(839).then(n.t.bind(n,839,23))}),"EvaluationPage").EvaluationPageLoader,kd=function(){var e=(0,$.useLocalizationState)().t;return(0,r.jsx)(re.SmMessage,{error:!0,children:e.ERROR_MESSAGES.unhandled_router_error()})},Dd=(Cd(wd={},c.AppRoutes.interactionWorkspace,{path:c.AppRoutes.interactionWorkspace,Component:Rd((function(){var e=(0,l.useInteractionWorkspaceState)(),t=e.shownWorkspaceTabs,n=e.shownWorkspaceTabId,o=e.activateItemTab,i=t||Vl;!function(){var e=(0,l.useInteractionWorkspaceState)(),t=e.shownWorkspaceTabs,n=e.shownWorkspaceItem,r=e.activateItemTab,o=(0,s.useLocation)(),i=null==n?void 0:n.id,u=(0,c.useNavigationState)(),d=u.getParams,f=u.setParams;(0,a.useEffect)((function(){var e,n=d();if(i){var a=null!=t?t:[],o=null==a||null===(e=a.find((function(e){return"activityForm"===e.type})))||void 0===e?void 0:e.id;"activityForm"===n.tab&&o&&(r(o),f({}))}}),[o,i,d,f,t,r])}();var u=(0,a.useCallback)((function(e){o(e)}),[o]);return i.length&&n?(0,r.jsx)(q.Tabs,{activeTabId:n,renderTabContent:zl,renderTab:function(e){return(0,r.jsx)(Hl,{tab:e})},tabs:i,onChange:u,className:"flex h-full w-full flex-1 flex-col"}):null}))}),Cd(wd,c.AppRoutes.calendar,{path:c.AppRoutes.calendar,load:function(){return n.e(662).then(n.t.bind(n,5662,23))},checkPrivileges:function(e){return!!e.CAN_USE_CALENDAR},Component:Rd(Td)}),Cd(wd,c.AppRoutes.searchContact,{path:c.AppRoutes.searchContact,Component:Rd(xd),allowSubRoutes:!0}),Cd(wd,c.AppRoutes.searchCase,{path:c.AppRoutes.searchCase,Component:Rd(xd),allowSubRoutes:!0}),Cd(wd,c.AppRoutes.search,{path:c.AppRoutes.search,Component:Rd(xd),allowSubRoutes:!0}),Cd(wd,c.AppRoutes.cases,{path:c.AppRoutes.cases,checkPrivileges:function(e){return!!e.SYS_HANDLE_EMAILS},Component:Rd((function(){var e=wo((0,kr.useAtom)(zr),2),t=e[0],n=e[1];(0,Dr.useLocalStorageForState)(t,"adQueueTableWidth",n,t);var o=(0,He.useCaseStateMethods)().getCasePendingReasons;return(0,a.useEffect)((function(){o()}),[o]),(0,r.jsxs)(_o,{children:[(0,r.jsx)(Io,{}),(0,r.jsx)(Lr.t,{initialIsOpen:!1,buttonPosition:"bottom-left"})]})}))}),Cd(wd,c.AppRoutes.chat,{path:c.AppRoutes.chat,load:function(){return n.e(975).then(n.t.bind(n,9975,23))},checkPrivileges:function(e){return!!e.CAN_START_INTERNAL_CHAT},Component:Rd(Nd)}),Cd(wd,c.AppRoutes.interactionSearch,{path:c.AppRoutes.interactionSearch,Component:Rd(Pd)}),Cd(wd,c.AppRoutes.home,{path:c.AppRoutes.home,Component:Rd(Md),allowSubRoutes:!0}),Cd(wd,c.AppRoutes.supervision,{load:function(){return n.e(205).then(n.t.bind(n,3205,23))},path:c.AppRoutes.supervision,checkPrivileges:function(e){return!!e.SYS_VIEW_LIST_OF_AGENTS||!!e.SYS_VIEW_QUEUE_STATUS},Component:Rd(Ad)}),Cd(wd,c.AppRoutes.nonCallCases,{path:c.AppRoutes.nonCallCases,Component:Rd((function(){var e=(0,C.useSessionState)().nonCallCasesUrls,t=(0,a.useMemo)((function(){var t;return null!==(t=null==e?void 0:e.map((function(e){return{id:e,title:(0,m.flow)(w.removeLastSlash,w.removeHttp)(e)}})))&&void 0!==t?t:[]}),[e]),n=Oc((0,a.useState)(),2),o=n[0],i=n[1],s=(0,a.useCallback)((function(e){var t=e.id;return(0,r.jsx)(q.Iframe,{src:t,className:Sc})}),[]);return(0,a.useEffect)((function(){t.length&&!o&&i(t[0].id)}),[o,t]),o?(0,r.jsx)(q.Tabs,{"data-testid":"non-call-cases-page",tabs:t,activeTabId:o,onChange:i,renderTabContent:s,className:jc,tabsContentClassName:xc}):(0,r.jsx)("div",{"data-testid":"non-call-cases-page"})}))}),Cd(wd,c.AppRoutes.campaigns,{path:c.AppRoutes.campaigns,checkPrivileges:function(e){return!!e.CAN_OPERATE_CAMPAIGNS},Component:Rd(Ed)}),Cd(wd,c.AppRoutes.oldOmniQm,{path:c.AppRoutes.oldOmniQm,checkPrivileges:function(e){return!!(e.EVALUATE_OWN_INTERACTIONS||e.CONFIRM_EVALUATIONS_OF_SELF||e.CONFIRM_EVALUATIONS_OF_SUPERVISED_AGENTS||e.DELETE_EVALS_COMPLETED_BY_ANYONE||e.DELETE_EVALS_COMPLETED_BY_THEMSELVES||e.ASSIGN_EVALUATIONS_AND_CALIBRATIONS||e.MANAGE_EVALUATIONS_ACCROSS_TEAMS||e.SEE_EVALS_OF_SELF)},Component:Rd((function(){var e=(0,$.useLocalizationState)().language,t=(0,C.useSessionState)(),n=t.sessionId,o=t.userId,i=(0,gc.useTimezonesState)().localTimezone,s=(0,a.useRef)(null),l=(0,a.useCallback)(bc((function(){var t,r,a,l,c;return yc(this,(function(u){switch(u.label){case 0:return s.current?[4,fetch("/admin/EvaluationHome.jsp?token=".concat(n))]:[3,3];case 1:return[4,u.sent().text()];case 2:if(r=u.sent(),a=/initializer\.init\([^,]+,[^,]+,\s*(\{.*\})\s*,/,(l=r.match(a))&&l[1])try{c=JSON.parse(l[1])}catch(d){}null===(t=s.current.contentWindow)||void 0===t||t.postMessage({token:n,type:"init-evaluation",loginId:o,timezone:i,locale:e,permissions:c||{}},document.location.origin),u.label=3;case 3:return[2]}}))})),[s,e,n,o,i]);return(0,r.jsx)("div",{style:{height:"100%"},children:(0,r.jsx)("iframe",{id:"containerIframe",ref:s,src:"/agent/evaluation-page/main.html",onLoad:l,width:"100%",height:"100%"})})}))}),Cd(wd,c.AppRoutes.omniQm,{path:c.AppRoutes.omniQm,checkPrivileges:function(e){return!!(e.EVALUATE_OWN_INTERACTIONS||e.CONFIRM_EVALUATIONS_OF_SELF||e.CONFIRM_EVALUATIONS_OF_SUPERVISED_AGENTS||e.DELETE_EVALS_COMPLETED_BY_ANYONE||e.DELETE_EVALS_COMPLETED_BY_THEMSELVES||e.ASSIGN_EVALUATIONS_AND_CALIBRATIONS||e.MANAGE_EVALUATIONS_ACCROSS_TEAMS||e.SEE_EVALS_OF_SELF)},Component:Rd(Ld)}),Cd(wd,c.AppRoutes.knowledgeBase,{path:c.AppRoutes.knowledgeBase,Component:Rd(_d)}),wd);function Rd(e){return function(){return(0,r.jsx)(q.ErrorBoundary,{fallback:kd,children:(0,r.jsx)(e,{})})}}const Fd="agent_Notifications_listWrapper_NVyLi",Bd="agent_Notifications_listItem_5BLxr";var Ud={hide:0,show:300},zd=function(e){var t=e.omit,n=e.show,o=e.className,i=(0,K.useNotificationsState)(),s=i.notifications,l=i.methods.hideNotificationById,c=(0,a.useMemo)((function(){var e=(0,we.truthy)(Object.values(s)).filter((function(e){return!e.delayed}));return n&&(e=e.filter((function(e){return n.includes(e.id)}))),t&&(e=e.filter((function(e){return!t.includes(e.id)}))),e.slice(0,3)}),[s,t,n]);return(0,r.jsx)("div",{className:W(o,Fd),children:(0,r.jsx)(re.SmTransition.Group,{animation:"fade down",duration:Ud,children:c.map((function(e){var t;return t=e.content?(0,a.isValidElement)(e.content)?(0,a.cloneElement)(e.content,{onHide:function(){return l(e.id)}}):e.content:e.message,(0,r.jsxs)("div",{className:Bd,children:[(0,r.jsx)("div",{children:(0,r.jsx)(re.SmMessage,{onDismiss:e.closable?function(){return l(e.id)}:void 0,content:t,error:"error"===e.type,info:"info"===e.type,warning:"warning"===e.type,success:"success"===e.type})}),(0,r.jsx)(q.AriaStatus,{children:t})]},e.id)}))})})};const Hd="agent_MainPage_content_GcMZQ",Vd="agent_MainPage_communicator_3pdIU",Gd="agent_MainPage_incomingMessagesModalsStack_8exp0";function Wd(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function qd(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Wd(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Wd(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Yd=[K.Notifications.ContactCreationError,K.Notifications.ContactMergeError],Qd=["[data-chat-actions-menu]",'[data-testid="channel-selector"]','[data-modal="true"]'],Kd=(0,q.createComponentLoader)("communicator",n.e(666).then(n.t.bind(n,8666,23)),"CommunicatorWidget").CommunicatorWidgetLoader,$d=(0,q.createComponentLoader)("communicator",n.e(666).then(n.t.bind(n,8666,23)),"ParallelChatInteraction").ParallelChatInteractionLoader,Xd=function(){var e=(0,l.useCommunicatorUIState)(),t=e.floatingState,n=e.setFloatingState,o=e.width,i=e.setWidth,s=e.openerRef,u=e.setParallelInteractionsWidth,d=e.parallelInteractionsWidth,f=(0,$.useLocalizationState)().t,p=(0,l.useMainPageUIState)(["mainContentNode","kbFloatingState"]),v=p.kbFloatingState,g=p.mainContentNode,h=(0,w.useResizeObserver)(g),b=qd((0,a.useState)(0),2),y=b[0],S=b[1],x=(0,a.useMemo)((function(){return(0,m.throttle)((function(e){return S(e)}),200)}),[]);(0,a.useEffect)((function(){var e;x(null!==(e=null==h?void 0:h.contentRect.width)&&void 0!==e?e:0)}),[null==h?void 0:h.contentRect.width,x]);var j=(0,c.useNavigationState)("getLocationState")()===c.AppRoutes.interactionWorkspace,I=(0,kr.useAtomValue)(Fe.parallelItemsAtom),O=l.MAIN_CONTENT_MIN_WIDTH-("pinned"===v?15:0),_=I.length>0&&j,C=(0,a.useCallback)((function(e){var t=e.size;_?(u(t),i(t/(I.length+1))):i(t)}),[I.length,u,i,_]),N=(0,a.useMemo)((function(){return(0,q.canPinFloating)({mainContentWidth:y,floatingState:t,floatingSize:_?d:o,contentMinWidth:O})}),[t,o,y,O,_,d]),A=(0,a.useCallback)((function(){n((function(e){return"pinned"===e?"floating":"pinned"}))}),[n]);return(0,r.jsxs)(q.Floating,{side:"left",resizeable:!0,maxSizeInPercent:l.MAX_COMMUNICATOR_WIDTH_IN_PERCENT,minSize:_?l.MIN_COMMUNICATOR_WIDTH*(I.length+1):l.MIN_COMMUNICATOR_WIDTH,"data-testid":"communicator_panel",className:Vd,state:t,setState:n,showEar:!1,openerRef:s,size:_?d:o,onDragEnd:C,canPin:N,unmountOnHide:!1,exceptionSelectors:Qd,closeByEscape:"floating"===t,children:[(0,r.jsx)(zd,{show:Yd}),(0,r.jsxs)("div",{className:"grid flex-auto grid-cols-[repeat(auto-fit,minmax(100px,1fr))] overflow-hidden bg-neutral-100",children:[(0,r.jsxs)("div",{className:"flex flex-auto flex-col overflow-hidden bg-primary-background",children:[N&&(0,r.jsx)(cl.Button,{variant:"ghost",className:"absolute right-2 top-2",icon:"pinned"===t?(0,r.jsx)(Te.IconPinFilled24,{}):(0,r.jsx)(Te.IconPin24,{}),onClick:A,tooltip:f.COMMUNICATION_PANEL.pin_tooltip()}),(0,r.jsx)(Kd,{})]}),_&&I.map((function(e){return(0,r.jsx)($d,{parallelItem:e},e.activeItemId)}))]})]})};var Jd={value:"sms",text:"SMS"};var Zd="ChannelStateContext",ef={getSelectedChannel:function(){return Jd},getSelectedPhone:function(){},isTouched:function(){return!1},channelOptions:[Jd],setIsTouched:(0,w.throwNoProviderError)(Zd),setSelectedChannel:(0,w.throwNoProviderError)(Zd)},tf=o().createContext(ef);tf.displayName=Zd;var nf=function(){return(0,a.useContext)(tf)},rf=n(2107),af=n(1554),of=n(4171),sf=n(7110);function lf(e){var t=(0,sf.useScreenPopStateMethods)().addTabs,n=(0,Oe.useBrowserTabMetaInfo)(),r=null==n?void 0:n.app,o=(0,J.useInteractionStateMethods)().saveOpenedSuggestionUrl;return(0,a.useCallback)((function(n){var a,i;if(n.suggestionURL)if(o(e,n.suggestionURL),"ad"===r&&"AGENT_DESKTOP"===n.openURLIn){var s,l=null!==(s=n.msgId)&&void 0!==s?s:n.suggestionURL;t(e,[{id:l,type:"iframe",url:n.suggestionURL,title:(0,dt.formatHTMLAsOneLineString)(n.text)}])}else try{window.open((0,w.normalizeExternalURL)(n.suggestionURL),"NEW_TAB"==n.openURLIn?"_blank":void 0,"noopener,noreferrer")}catch(u){var c=(a=u,(null!=(i=Error)&&"undefined"!=typeof Symbol&&i[Symbol.hasInstance]?i[Symbol.hasInstance](a):a instanceof i)?u.message:"unknown error");console.error("error opening window for url ".concat(n.suggestionURL,": ").concat(c))}}),[r,e,t,o])}var cf=n(5715),uf=n(7856);function df(e){return"string"==typeof e}function ff(e){return!!e&&!df(e)&&"globalInteractionId"in e}function mf(e){return!!e&&!df(e)&&"serviceId"in e&&"activityGroup"===e.displayType}function pf(e){return!!e&&!mf(e)&&!ff(e)}function vf(e){return"object"==typeof e&&"type"in e&&uf.voiceTranscriptMessageTypes.includes(e.type)}function gf(e){return"string"==typeof e}function hf(e){return vf(e)&&"suggestion"===e.type}function bf(e){return!hf(e)&&("string"==typeof e||"VOICE"===e.mediaType||"VOICE_TRANSCRIPT"===e.mediaType)}function yf(e){return ff(e)&&"VOICE"==e.mediaType}function Sf(e){return((null==e?void 0:e.scrollTop)||0)+((null==e?void 0:e.clientHeight)||0)>=((null==e?void 0:e.scrollHeight)||0)}function xf(e){var t,n;return vf(e)?"error"===(null===(t=e.chatMessageData)||void 0===t?void 0:t.displayType)?"".concat(e.timestamp,"-error"):e.chatMessageData?r(e.chatMessageData):"".concat((n=e).partyId,"-").concat(n.msgId,"-").concat(n.timestamp):function(e){return"object"==typeof e&&!vf(e)}(e)?mf(e)?function(e){var t;return"".concat(e.timestamp,"-").concat(null!==(t=e.msgId)&&void 0!==t?t:"","-").concat(e.partyId,"-").concat(e.notes?"notes":"disposition")}(e):"scenario"===Nf(e)?function(e){return"".concat(e.timestamp,"-").concat(e.msg,"-scenario")}(e):ff(e)?function(e){var t;return"".concat(e.timestamp,"-").concat(null!==(t=e.msgId)&&void 0!==t?t:"","-").concat(e.direction)}(e):r(e):e;function r(e){var t;return"".concat(e.timestamp,"-").concat(null!==(t=e.msgId)&&void 0!==t?t:"","-").concat(e.source)}}function jf(e,t,n){var r=null==e?void 0:e.querySelector("[data-index='".concat(t,"']"));if(!r)return{id:"",offset:0};var a=((null==e?void 0:e.scrollTop)||0)-r.offsetTop;if(a>0)return jf(e,t+1,n);var o=n[t];return o?"string"==typeof o?jf(e,t+1,n):{id:xf(n[t]||""),offset:a}:{id:"",offset:0}}function If(e,t){if(!t.name)return null;var n=(0,w.getFileNameAndExtension)(t.name),r=n.extension,a=n.name,o=[];return rf.CHAT_PROHIBITED_EXTENSIONS.includes(".".concat(r))&&o.push({code:cf.ErrorCode.FileInvalidType,message:e.EXTERNAL_CHAT.invalid_file_extension_error(a)}),o.length?o:null}function Of(e,t){var n=If(e,t);return n?{file:t,errors:n}:null}function _f(e){return function(t){return t.parties.reduce((function(n,r){if("USER"===r.partyType&&(r.disposition||r.notes)){var a=r;n.push(function(e,t,n){var r,a,o,i,s,l=t.Id.oid,c=(null===(r=e.startTime)||void 0===r?void 0:r.date)||t.createdTime.date,u=t.mediaType,d=e.serviceId,f=d?null===(a=t.services)||void 0===a?void 0:a.find((function(e){return e.serviceId===d})):void 0;return{mediaType:u,msgId:l,displayType:"activityGroup",notes:e.notes,disposition:e.disposition,timestamp:c?(0,w.addTime)(c,"seconds",null!==(o=e.duration)&&void 0!==o?o:0).getTime():0,serviceId:null!==(i=null==f?void 0:f.serviceId)&&void 0!==i?i:e.serviceId,serviceName:null!==(s=null==f?void 0:f.serviceName)&&void 0!==s?s:"",firstName:e.firstName,lastName:e.lastName,userId:e.userId,isSelf:e.userId===n,partyId:e.partyId}}(a,t,e))}return n}),[])}}function Cf(e,t,n){var r=e.firstName,a=e.lastName,o=e.timestamp,i=e.mediaType,s=n(r,a),l=(0,w.formatDate)(o,"ll"),c=(0,w.formatDate)(o,"h:mm A");return"CHAT"===i?t.EXTERNAL_CHAT.disposition_message_title(s,l,c):t.VOICE_CALL.disposition_message_title(s,l,c)}function wf(e){var t=document.createElement("div");t.innerHTML=e,t.style.opacity="0",t.style.position="absolute",t.style.display="hidden",t.style.zIndex="-1000",document.body.append(t);var n=t.innerText;return t.remove(),n}function Nf(e){return pf(e)||ff(e)||mf(e)?e.displayType:void 0}function Af(e,t){var n=yf(e)?e.users:void 0;if(null==n?void 0:n.length)return n.map((function(e){return t(e.firstName,e.lastName)})).join(", ");var r=pf(e)?e.displayName:void 0;if(r)return r;var a=ff(e)?e:{firstName:void 0,lastName:void 0},o=a.firstName,i=a.lastName;return o||i?t(o,i):void 0}function Ef(e){return pf(e)&&"error"===e.displayType}function Tf(e){return pf(e)&&"file"===e.displayType?{fileId:e.fileId,fileError:e.fileError,fileIsMasked:e.fileIsMasked,fileProgress:e.fileProgress,fileName:e.fileName,fileType:e.fileType,refMsgId:void 0}:function(e){return ff(e)&&"file"===e.displayType}(e)?{fileId:e.fileId,refMsgId:e.refMsgId,fileType:e.fileType,fileName:e.fileName,fileError:void 0,fileIsMasked:void 0,fileProgress:void 0}:void 0}var Pf=n(9327);function Mf(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Lf(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function kf(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Mf(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Mf(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Df=(0,x.createContext)({hasSelection:!1,setHasSelection:m.noop,messages:[],selectedMessages:[],getClipboardBuffer:function(){return""},setClipboardBuffer:m.noop,scrollContainer:null});Df.displayName="ChatMessagesContextProvider";var Rf=function(e){var t=e.children,n=e.messages,o=e.interactionId,i=e.scrollContainer,s=kf((0,a.useState)(!1),2),l=s[0],c=s[1],u=kf((0,a.useState)(""),2),d=u[0],f=u[1],m=kf((0,a.useState)([]),2),p=m[0],v=m[1],g=(0,a.useRef)(),h=(0,w.useEvent)((function(){return d})),b=(0,w.useValueUpdated)(o);(0,a.useEffect)((function(){b&&(c(!1),f(""),v([]))}),[b]),(0,w.useEventListener)("mouseup",(function(e){if(g.current&&Lf(e,MouseEvent)){var t=Vf(e.target);if(t){var r,a=n.findIndex((function(e){return xf(e)===g.current})),o=n.findIndex((function(e){return xf(e)===t})),i=[a,o].sort((function(e,t){return e-t})),s=n.slice(i[0],i[1]+1),l=window.getSelection(),c=(null!==(r=null==l?void 0:l.rangeCount)&&void 0!==r?r:0)>0?null==l?void 0:l.getRangeAt(0):void 0;if(s.length>1&&l&&c){var u=a<o,d=document.querySelector("[data-message-id-selection='".concat(g.current,"']")),f=document.querySelector("[data-message-id-selection='".concat(t,"']")),m=u?d:f,p=u?f:d;c.setStartBefore(m||c.startContainer),c.setEndAfter(p||c.endContainer),u?l.setBaseAndExtent(c.startContainer,c.startOffset,c.endContainer,c.endOffset):l.setBaseAndExtent(c.endContainer,c.endOffset,c.startContainer,c.startOffset)}v(s)}}}));var y=(0,a.useCallback)((function(e){g.current=Vf(e.target)}),[]),S=(0,a.useMemo)((function(){return{hasSelection:l,setHasSelection:c,messages:n,selectedMessages:p,setClipboardBuffer:f,getClipboardBuffer:h,scrollContainer:i}}),[h,l,n,i,p]);return(0,r.jsx)(Df.Provider,{value:S,children:(0,r.jsx)("div",{onMouseDown:y,children:t})})},Ff=function(){return(0,x.useContextSelector)(Df,(function(e){return e.messages}))},Bf=function(){return(0,x.useContextSelector)(Df,(function(e){return e.selectedMessages}))},Uf=function(){return(0,x.useContextSelector)(Df,(function(e){return e.getClipboardBuffer}))},zf=function(){return(0,x.useContextSelector)(Df,(function(e){return e.setClipboardBuffer}))},Hf=function(){return(0,x.useContextSelector)(Df,(function(e){return e.scrollContainer}))};function Vf(e){var t,n=void 0;if(Lf(e,HTMLElement))n=(null===(t=e.closest("[data-message]"))||void 0===t?void 0:t.querySelector("[data-message-id-selection]"))||void 0;else if(Lf(e,Node)){var r,a;n=(null===(a=e.parentElement)||void 0===a||null===(r=a.closest("[data-message]"))||void 0===r?void 0:r.querySelector("[data-message-id-selection]"))||void 0}return(null==n?void 0:n.getAttribute("data-message-id-selection"))||void 0}var Gf=n(9190);function Wf(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function qf(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Yf(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var Qf=function(e){var t=e.className,n=e.children,a=Yf(e,["className","children"]);return(0,r.jsx)("button",qf(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Wf(e,t,n[t])}))}return e}({},a),{className:W("flex items-center gap-1 rounded border px-2 py-0.5 shadow-4 state-layer-bg-neutral-0 svg-color-current border-default","transition-colors","hover:state-layer-mix-dark-on-white-1","focus:state-layer-mix-dark-on-white-2","active:state-layer-mix-dark-on-white-3",t),children:n}))};function Kf(){var e=(0,$.useLocalizationState)().t,t=(0,Ce.useFormatting)().formatFullName,n=(0,ji.useContactsState)("contacts"),r=(0,Pf.useUserDetailsState)("userDetails"),o=(0,Re.useNonAssertedInteractionId)(),i=(0,J.useInteraction)(o),s=(0,C.useSessionState)(["firstName","lastName"]);return(0,a.useCallback)((function(a){var o=function(){if(gf(a))return;if(vf(a)){var o,l,c=a.endTime,u=a.partyId,d=a.text,f=null==i||null===(o=i.parties)||void 0===o?void 0:o.find((function(e){return e.id===u})),m=null==i||null===(l=i.chatParties)||void 0===l?void 0:l.find((function(e){return e.party_id===u})),p=f?t(f.firstName,f.lastName):m?t(m.first_name,m.last_name):t(s.firstName,s.lastName),v=wf(d);return{date:(0,X.formatDate)(c,{full:!0}),name:p,text:v}}if(mf(a)){var g=a.timestamp,h=a.lastName,b=a.firstName,y=a.notes||function(e,t,n){return"".concat(Cf(e,t,n),"\n\n")+"".concat(e.disposition,"\n\n")+"".concat(t.EXTERNAL_CHAT.disposition_message_service_name()," ").concat(e.serviceName)}(a,e,t);return{date:(0,X.formatDate)(g,{full:!0}),name:t(b,h),text:y}}if(ff(a)||pf(a)){var S,x,j=a.timestamp,I=a.contactId,O=a.userId,_=Af(a,t),C=I?null===(S=n[I])||void 0===S?void 0:S.data:O?null===(x=r[O])||void 0===x?void 0:x.data:void 0,N=C?t(C.firstName,C.lastName):"",A=_||N,E=function(e,t){var n=Tf(e);if(n)return n.fileName;if(pf(e))return e.page?e.title||t.EXTERNAL_CHAT.external_chat_customer_navigates_to():wf(e.msg||"");if(yf(e)){var r=e.isMissedCall?t.ACTIVITY_HISTORY.call_message_missed():"incoming"===e.direction?t.ACTIVITY_HISTORY.call_message_incoming_text():t.ACTIVITY_HISTORY.call_message_outgoing_text();return"".concat(r,"\n\n")+"".concat((0,w.formatDate)(e.timestamp,"LT"),", ").concat(e.duration,"\n\n")}return"msg"in e&&"string"==typeof e.msg?wf(e.msg):void 0}(a,e);if(!E)return;return{date:(0,X.formatDate)(j,{full:!0}),name:A,text:E}}return null}();return o?"[".concat(o.date,"] ").concat(o.name,"\n\n").concat(o.text,"\n\n"):""}),[n,t,null==i?void 0:i.chatParties,null==i?void 0:i.parties,s.firstName,s.lastName,e,r])}function $f(e,t,n,r,a,o,i){try{var s=e[o](i),l=s.value}catch(c){return void n(c)}s.done?t(l):Promise.resolve(l).then(r,a)}function Xf(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){$f(o,r,a,i,s,"next",e)}function s(e){$f(o,r,a,i,s,"throw",e)}i(void 0)}))}}function Jf(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Zf(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Jf(e,t,n[t])}))}return e}function em(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(s){o=[6,s],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function tm(e){var t=function(e){return(null==e?void 0:e.commonAncestorContainer.nodeType)===Node.ELEMENT_NODE?null==e?void 0:e.commonAncestorContainer:null==e?void 0:e.commonAncestorContainer.parentElement}(e);return nm(t)}function nm(e){var t,n=null==e?void 0:e.closest(pm()),r=null==n?void 0:n.getAttribute("data-message-id"),a=null!==(t=null==n?void 0:n.getAttribute("data-global-interaction-id"))&&void 0!==t?t:void 0;return"current"===a&&(a=void 0),r?{messageId:r,globalInteractionId:a}:void 0}function rm(e){if(e){var t=e.extractContents(),n=om(t);w.Mask.obscureHTML(n),t=document.createDocumentFragment(),Array.from(n.childNodes).forEach((function(e){t.appendChild(e)})),e.insertNode(t)}}function am(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=Zf({},t);if(e){im(e);var r=e.extractContents(),a=om(r),o=cm(a,n),i=(0,N.uuid)();o.classList.add("bp-masked"),o.id=i;var s=o.innerHTML;return w.Mask.obscureHTML(o),n[i]={originalText:s,maskedText:o.innerHTML},e.insertNode(o),n}}function om(e){var t=document.createElement("span");return e.childNodes.forEach((function(e){var n=e.cloneNode(!0);t.append(n)})),t}function im(e){var t=e.startContainer.parentElement;(sm(t)||lm(t))&&(e.setStartBefore(e.startContainer),e.setStartBefore(e.startContainer));var n=e.endContainer.parentElement;(sm(n)||lm(n))&&(e.setEndAfter(e.endContainer),e.setEndAfter(e.endContainer))}function sm(e){return null==e?void 0:e.classList.contains("bp-masked")}function lm(e){return"A"===(null==e?void 0:e.nodeName)}function cm(e,t){var n=e.cloneNode(!0);return function e(n){if(n.classList.contains("bp-masked")){var r=n.id,a=(0,w.stringToHTMLFragment)(t[r].originalText);return delete t[n.id],void n.replaceWith(a)}Array.from(n.children).forEach((function(t){e(t)}))}(n),n}function um(e,t){return e.messageId===t.messageId&&e.globalInteractionId===t.globalInteractionId}function dm(e){return{messageId:gf(e)?e:e.msgId,globalInteractionId:gf(e)||vf(e)||!ff(e)?void 0:e.globalInteractionId}}function fm(e){var t,n;return null!==(n=null===(t=mm(e))||void 0===t?void 0:t.innerHTML)&&void 0!==n?n:""}function mm(e){var t;return e.messageId?null===(t=document.querySelector(pm(e)))||void 0===t?void 0:t.children[0]:void 0}function pm(e){if(e){var t=e.messageId,n=e.globalInteractionId;return'[data-message-id="'.concat(t,'"][data-global-interaction-id="').concat(null!=n?n:"current",'"]')}return"[data-message-id][data-global-interaction-id]"}function vm(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function gm(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return vm(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return vm(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var hm=o().memo((function(e){var t=e.interactionId,n=e.children,o=e.className,i=(0,$.useLocalizationState)().t,s=(0,J.useInteractionProp)(t,j.getInteractionStepId),l=Ff(),c=(0,w.useBoolean)(),u=c.value,d=c.toggle,f=(0,a.useRef)(null),m=gm((0,a.useState)(),2),p=m[0],v=m[1],g=gm((0,a.useState)(),2),h=g[0],b=g[1],y=gm((0,a.useState)(),2),S=y[0],x=y[1],I=(0,a.useRef)(null),O=(0,te.useInteractionChatStateMethods)().maskMessage,_=(0,te.useInteractionChatDataSelector)(s,(function(e){return null==e?void 0:e.masked})),C=Hf();(0,a.useEffect)((function(){var e=function(e){var t=e.target;if(t&&(0,dt.isHTMLElement)(t)&&(I.current=t,t.classList.contains("bp-masked")&&t.id)){b(t.id);var n=nm(t);n&&x(n),v(t.getBoundingClientRect()),d()}},t=f.current;return null==t||t.addEventListener("click",e),function(){null==t||t.removeEventListener("click",e)}}),[d]);var N=(0,a.useCallback)((function(){var e=l.find((function(e){return S&&!vf(e)&&um(S,dm(e))}));if(h&&S&&!vf(e)&&!gf(e)){if(pf(e)){var t,n,r,a,o,i,c,u,m=(null==S?void 0:S.messageId)?null==_||null===(a=_.messages)||void 0===a||null===(r=a[S.messageId])||void 0===r||null===(n=r.textChunks)||void 0===n||null===(t=n[h])||void 0===t?void 0:t.originalText:void 0;if(!m)return void d(!1);var p,v=(0,w.stringToHTMLFragment)(m);null===(o=I.current)||void 0===o||o.replaceWith(v);var g=null!==(p=null===(u=f.current)||void 0===u||null===(c=u.querySelector('[data-message-id="'.concat(e.msgId,'"]')))||void 0===c||null===(i=c.children[0])||void 0===i?void 0:i.innerHTML)&&void 0!==p?p:"";if(!g)return void d(!1);O({itemId:s,messageId:S.messageId,maskedText:g})}d(!1)}}),[s,O,null==_?void 0:_.messages,l,d,h,S]),A=(0,a.useMemo)((function(){var e,t;return{position:"fixed",top:null!==(e=null==p?void 0:p.y)&&void 0!==e?e:0,left:null!==(t=null==p?void 0:p.x)&&void 0!==t?t:0}}),[p]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{ref:f,className:o,children:n}),(0,r.jsx)(q.Popup,{show:u,"data-testid":"selection-popup",placement:"top-start",contentClassName:"border-none bg-transparent shadow-none p-0","data-visible":u,onClickOutside:d,style:A,mountNode:C,content:(0,r.jsxs)(Qf,{onClick:N,"data-testid":"unmask-content-button",children:[(0,r.jsx)(Te.IconUnmask,{}),i.EMAIL.button_unMaskSelectedText_text()]})})]})})),bm=function(e){var t=e.children,n=e.withMaskAction,o=e.interactionId,i=(0,x.useContextSelector)(Df,(function(e){return e.setHasSelection})),s=(0,J.useInteraction)(o);(0,we.assertDefined)(s);var c=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=(0,$.useLocalizationState)().t,a=Ff(),o=Bf(),i=(0,C.useSessionState)(),s=i.serverOrigin,c=i.loginId,u=i.sessionId,d=i.privileges,f=(0,ji.useContactsStateMethods)().updateActivityHistoryMessageText,m=Kf(),p=(0,K.useNotificationsState)("methods").showNotification,v=(0,te.useInteractionChatStateMethods)().maskMessage,g=zf(),h=Uf(),b=(0,te.useInteractionChatDataSelector)((0,j.getInteractionStepId)(e),(function(e){return null==e?void 0:e.masked})),y=(0,Gf.useOpenInteractionSlidingModal)(),S=(0,Oe.useIsCommunicator)(),x=(0,l.useMainPageUIState)("setKBFloatingState"),I=(0,jd.useKbBridgeMethods)().setupInteractionKB;return function(i){var l=i.toggleShow,O=i.selectedText,_=i.selectionData,C=(null!=_?_:{}).range,N=tm(C),A=a.find((function(e){return N&&um(N,dm(e))}));function E(){return(E=Xf((function(){return em(this,(function(t){return l(!1),S?y(e.id,"knowledgeBase"):x((function(e){return"closed"===e?"floating":e})),I(O),[2]}))}))).apply(this,arguments)}return O?(0,r.jsxs)(r.Fragment,{children:[!(0,j.isAfterCallWork)(e)&&(0,r.jsxs)(Qf,{onClick:function(){return E.apply(this,arguments)},"data-testid":"search-kb-button",children:[(0,r.jsx)(Te.IconKnowledgeBase,{className:"size-4"}),n.GLOBAL.search()]}),!(!t||gf(A)||!d.CAN_MASK_INTERACTION_CONTENT||vf(A)||"message"!==Nf(A))&&(0,r.jsxs)(Qf,{onClick:function(){if(!vf(A)&&!gf(A)){if(ff(A)){var t=fm(dm(A));rm(C);var r=fm(dm(A));(0,ll.maskActivityHistoryMessages)({loginId:c,sessionId:u,serverOrigin:s,globalInteractionId:A.globalInteractionId,messages:[{messageId:A.msgId,maskedText:r}]}).then((function(){var t=(0,j.getContactId)(e);t&&f({contactId:t,messageId:A.msgId,messageText:r})})).catch((function(e){p({type:"error",id:K.Notifications.ChatMessageMaskError,tags:["current-view"],message:n.EXTERNAL_CHAT.masking_failed_error_message(),duration:5e3}),ye.bpLogger.error((0,w.getErrorMessage)(e));var r=mm(dm(A));r&&(r.innerHTML=t)}))}else if(pf(A)&&A.msgId){var a,o,i=null==b||null===(o=b.messages)||void 0===o||null===(a=o[A.msgId])||void 0===a?void 0:a.textChunks,d=am(C,i),m=fm(dm(A));v({itemId:(0,j.getInteractionStepId)(e),messageId:A.msgId,maskedText:m,textChunks:d})}l(!1)}},"data-testid":"mask-content-button",children:[(0,r.jsx)(Te.IconMask,{}),n.EXTERNAL_CHAT.mask()]}),(0,r.jsxs)(Qf,{onClick:function(){l(!1);var e="",t="";o.length>1?t=e=o.reduce((function(e,t){return e+m(t)}),""):((0,we.assertDefined)(o[0]),e=O,t=m(o[0])),console.info("\u{1f4cb} Clipboard text\n",e),g(t),navigator.clipboard.writeText(e)},"data-testid":"copy",children:[(0,r.jsx)(Te.IconCopy,{}),n.GLOBAL.copy()]}),!!h().length&&(0,r.jsxs)(Qf,{onClick:function(){l(!1);var e="";o.length>1?e=o.reduce((function(e,t){return e+m(t)}),""):((0,we.assertDefined)(o[0]),e=m(o[0]));var t=h()+e;console.info("\u{1f4cb} Clipboard text\n",t),navigator.clipboard.writeText(t),g(t)},"data-testid":"add-to-copy",children:[(0,r.jsx)(Te.IconAddToCopy,{}),n.GLOBAL.add_to_copy()]})]}):null}}(s,n),u=(0,a.useCallback)((function(e){var t;i(!!(null==e||null===(t=e.range)||void 0===t?void 0:t.toString()))}),[i]),d=Hf();return(0,r.jsx)(q.WithSelectionPopup,{getPopupContent:c,onSelectionChange:u,mountNode:d,popupContentClassName:"border-none bg-transparent shadow-none flex gap-1",children:n?(0,r.jsx)(hm,{interactionId:o,children:t}):t})},ym=function(e){var t=e.children,n=e.withMaskAction,a=e.messages,o=e.interactionId,i=e.scrollContainer;return(0,r.jsx)(Rf,{messages:a,interactionId:o,scrollContainer:i,children:(0,r.jsx)(bm,{withMaskAction:n,interactionId:o,children:t})})};var Sm=function(e){var t=e.fileIsMasked,n=e.canMask,o=e.interactionStepId,i=e.globalInteractionId,s=e.fileId,l=e.contactId,c=e.children,u=(0,$.useLocalizationState)().t,d=function(e){var t=e.globalInteractionId,n=e.interactionStepId,r=e.itemContactId,o=e.isActiveChat,i=e.fileId,s=(0,C.useSessionState)(),l=s.loginId,c=s.sessionId,u=s.serverOrigin,d=(0,ji.useContactsStateMethods)().maskFile,f=(0,$.useLocalizationState)("t").ERROR_MESSAGES,m=(0,te.useInteractionChatStateMethods)().toggleFileMask,p=(0,K.useNotificationsState)("methods").showNotification;return(0,a.useCallback)((function(){o&&!t?m({itemId:n,fileId:i}):t&&(0,ll.maskActivityHistoryMessages)({loginId:l,sessionId:c,serverOrigin:u,globalInteractionId:t,fileIds:[i]}).then((function(){r&&d({fileId:i,contactId:r})})).catch((function(e){p({type:"error",id:K.Notifications.ChatFileMaskError,tags:["current-view"],message:f.activity_history_file_masking_error(),duration:5e3}),ye.bpLogger.error((0,w.getErrorMessage)(e))}))}),[f,r,i,t,n,o,l,d,u,c,p,m])}({interactionStepId:o,itemContactId:l,globalInteractionId:i,fileId:s,isActiveChat:(0,te.useActiveChatChecker)(o)});return(0,r.jsxs)("div",{className:"group relative",children:[t&&(0,r.jsx)(Te.IconMask,{className:"absolute left-1/2 top-1/2 z-[1] size-6 -translate-x-1/2 -translate-y-1/2"}),n&&(0,r.jsxs)(Qf,{onClick:d,className:"absolute right-2 top-2 z-[1] opacity-0 transition-opacity group-hover:opacity-100",children:[t?(0,r.jsx)(Te.IconUnmask,{}):(0,r.jsx)(Te.IconMask,{}),(0,r.jsx)("p",{children:t?u.EXTERNAL_CHAT.unmask():u.EXTERNAL_CHAT.mask()})]}),(0,r.jsx)("div",{className:W("border border-transparent",{"overflow-hidden rounded-xs border-[rgba(0,0,0,0.1)]":t}),children:(0,r.jsx)("div",{className:W({"pointer-events-none blur-[6px] state-layer-bg-white state-layer-mix-dark-on-white-1":t}),children:c})})]})},xm=n(7914);function jm(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Im(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){jm(e,t,n[t])}))}return e}function Om(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function _m(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var Cm=function(e){var t=e.children,n=e.messageId,o=_m(e,["children","messageId"]),i=Kf(),s=(0,x.useContextSelector)(Df,(function(e){return e.hasSelection})),l=Ff(),c=Uf(),u=zf(),d=Hf(),f=(0,a.useMemo)((function(){return l.find((function(e){return xf(e)===n}))}),[n,l]),m=(0,$.useLocalizationState)("t"),p=(0,w.useBoolean)(),v=(0,a.useCallback)((function(){if(f){var e=i(f);console.info("\u{1f4cb} Clipboard text\n",e),navigator.clipboard.writeText(e),u(e),p.setFalse()}}),[i,f,p,u]),g=(0,a.useCallback)((function(){if(f){var e=i(f),t=c()+e;navigator.clipboard.writeText(t),u(t),console.info("\u{1f4cb} Clipboard text\n",t),p.setFalse()}}),[c,i,f,p,u]);return(0,r.jsxs)(xm.Root,{open:!s&&p.value,onOpenChange:p.toggle,children:[(0,r.jsx)(xm.Trigger,{asChild:!0,children:(0,r.jsx)("div",Om(Im({},o),{children:t}))}),(0,r.jsx)(xm.Portal,{container:d,children:(0,r.jsxs)(xm.Content,{collisionBoundary:d,side:"top",align:"end",className:"z-10 flex gap-1",hideWhenDetached:!0,children:[(0,r.jsxs)(Qf,{onClick:v,children:[(0,r.jsx)(Te.IconCopy,{}),m.GLOBAL.copy()]}),(0,r.jsxs)(Qf,{onClick:g,children:[(0,r.jsx)(Te.IconAddToCopy,{}),m.GLOBAL.add_to_copy()]})]})})]})};function wm(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Nm(e){return function(e){if(Array.isArray(e))return wm(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return wm(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return wm(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Am(e){var t=(0,a.useMemo)((function(){return function(e){return(0,fn.createSelector)((function(t){return t.items.find((function(t){return t.id===e}))}),(function(e){return e.items}),(function(e,t){var n=(0,j.getAssociatedItems)({item:e,items:t});return(0,we.truthy)(Nm(n).concat([e])).flatMap((function(e){var t;return null!==(t=null==e?void 0:e.botSuggestions)&&void 0!==t?t:[]}))}))}(e)}),[e]);return(0,J.useInteractionStateSelector)(t)}function Em(e){var t=(0,a.useMemo)((function(){return function(e){return(0,fn.createSelector)((function(t){return t.items.find((function(t){return t.id===e}))}),(function(e){return e.items}),(function(e,t){var n=(0,j.getAssociatedItems)({item:e,items:t});return(0,we.truthy)(Nm(n).concat([e])).reduce((function(e,t){var n;if((0,j.isCall)(t))e.voice=null!==(n=null==t?void 0:t.botSuggestions)&&void 0!==n?n:[];else if((0,j.isChat)(t)){var r;e.chat=null!==(r=null==t?void 0:t.botSuggestions)&&void 0!==r?r:[]}return e}),{voice:[],chat:[]})}))}(e)}),[e]);return(0,J.useInteractionStateSelector)(t)}var Tm=(0,kr.atom)(""),Pm=(0,kr.atom)(-1),Mm=(0,kr.atom)(void 0),Lm=(0,kr.atom)(null);function km(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Dm(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Rm(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var Fm=function(e){var t=function(){a(),null==o||o()},n=e.rejection,a=e.onClose,o=e.onCloseCallback,i=e.totalFilesAmount,s=Rm(e,["rejection","onClose","onCloseCallback","totalFilesAmount"]),l=(0,kr.useAtomValue)(Lm),c=(0,$.useLocalizationState)("t"),u=(0,m.uniq)(n.flatMap((function(e){return e.errors.map((function(e){return e.message}))})));return(0,r.jsxs)(Te.Modal,Dm(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){km(e,t,n[t])}))}return e}({},s),{onClose:t,children:[(0,r.jsx)(Te.Modal.Header,{type:"error",children:c.CHAT_CENTER.upload_failed()}),(0,r.jsxs)(Te.Modal.Content,{children:[(0,r.jsx)(Te.InlineAlert,{variant:"error",children:(0,r.jsx)("ul",{className:"m-0 p-0",children:u.map((function(e,t){return(0,r.jsx)("li",{children:e},t)}))})}),(0,r.jsx)("p",{className:"my-6",children:c.CHAT_CENTER.failed_to_upload(n.length,i)}),(0,r.jsx)("div",{className:"flex flex-col gap-2",children:n.map((function(e,t){return"attachment"===(0,X.mimeTypeToExternalChatFileType)(e.file.type)?(0,r.jsx)(Te.Attachment.File,{name:e.file.name,className:"pointer-events-none",isFailed:!0},t):(0,r.jsx)(Te.Attachment.Image,{name:e.file.name,className:"pointer-events-none",isFailed:!0},t)}))})]}),(0,r.jsxs)(Te.Modal.Actions,{children:[(0,r.jsx)(cl.Button,{variant:"secondary",onClick:function(){null==l||l.click(),t()},children:c.CHAT_CENTER.select_files()}),(0,r.jsx)(cl.Button,{variant:"primary",onClick:function(){return t()},children:c.WINDOW_POPUP_TITLES_AND_MESSAGES.window_buttonOk()})]})]}))};function Bm(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Um(e){return function(e){if(Array.isArray(e))return Bm(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Bm(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Bm(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function zm(e){var t=e.chatItem,n=(0,K.useNotificationsState)("methods"),r=n.showNotification,a=n.hideNotificationsByTag,o=(0,ji.useContactsState)("contacts"),i=nf(),s=i.getSelectedChannel,l=i.getSelectedPhone,c=s(t.id),u=l(t.id),d=(0,j.getMessengers)(o,t),f=(null==u?void 0:u.phone)||(0,j.getPhoneFromItem)(t),m=(0,Oi.useErrorValidation)(),p=(0,h.useServiceState)().selectedService,v=(0,Ii.useDIDNumberState)().selectedDIDNumber,g=(0,j.getContactId)(t),b=(0,j.getServiceId)(t),y=(0,J.useInteractionStateMethods)().initiateChat,S=b||p,x=(0,Ve.useServicesDispositionsState)().services,I=(0,j.getAssociatedChatServiceId)(x,p);return(0,w.useEvent)((function(){var e,n=(null==d||null===(e=d.find((function(e){return e.type===(null==c?void 0:c.value)})))||void 0===e?void 0:e.userId)||f;if(!n)return!1;var o=Um(m.getServiceAndDIDNumbersErrors({service:S,didNumber:v,interactionType:"sms"})).concat(Um(m.getChannelError({selectedChannel:null==c?void 0:c.value})));return o.length?(r(o[0]),!1):(a("interaction-init"),y({channel:null==c?void 0:c.value,address:n,displayData:null==t?void 0:t.displayData,serviceId:I,accessNumberId:v,contactId:g,origination:"interaction"}),!0)}))}const Hm={dropzone:"agent_Dropzone_dropzone_NnIGW",dropzoneDisabled:"agent_Dropzone_dropzoneDisabled_Z62xX",dropzoneTitle:"agent_Dropzone_dropzoneTitle_GjrhI",dropzoneSubtitle:"agent_Dropzone_dropzoneSubtitle_3av8B"};function Vm(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Gm(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Vm(e,t,n[t])}))}return e}function Wm(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}var qm=function(e){var t=e.itemId,n=(0,$.useLocalizationState)().t,o=function(){var e=(0,w.useBoolean)(),t=e.value,n=e.toggle,r=(0,a.useRef)(0);return(0,a.useEffect)((function(){var e=function(){r.current++,n(!0)},t=function(){r.current--,0===r.current&&n(!1)};return document.addEventListener("dragenter",e),document.addEventListener("dragleave",t),document.addEventListener("drop",t),function(){document.removeEventListener("dragenter",e),document.removeEventListener("dragleave",t),document.removeEventListener("drop",t)}}),[n]),t}(),i=function(e){var t=F("addAttachment"),n=(0,J.useInteraction)(e),r=(0,J.useInteractions)();(0,w.useAsRef)(r).current=r,(0,we.assertDefined)(n);var o=zm({chatItem:n}),i=(0,j.isPotentialInteraction)(n)||(0,j.isCall)(n);return(0,a.useCallback)((function(e){var r;e.length&&n&&(i&&o(),r=(0,j.getInteractionStepId)(n),e.forEach((function(e){return t(r,e)})))}),[n,i,o,t])}(t),s=(0,cf.useDropzone)({onDrop:i,validator:(0,m.partial)(If,n)}),l=s.getRootProps,c=s.getInputProps,u=s.fileRejections,d=s.acceptedFiles,f=(0,ae.useModalComponentOpener)(Fm),p=(0,w.useAsRef)(d.length);return(0,a.useEffect)((function(){u.length&&f({rejection:u,totalFilesAmount:p.current+u.length})}),[p,u,f]),(0,r.jsxs)("div",Wm(Gm({},l()),{className:o?Hm.dropzone:Hm.dropzoneDisabled,"data-testid":"attachments-dropzone","data-visible":o,children:[(0,r.jsx)("input",Gm({},c())),(0,r.jsxs)("div",{className:Hm.dropzoneContent,children:[(0,r.jsx)("p",{className:Hm.dropzoneTitle,children:n.GLOBAL.drop_files_here()}),(0,r.jsx)("p",{className:Hm.dropzoneSubtitle,children:n.GLOBAL.drag_and_drop_subtitle()})]})]}))};function Ym(e){var t,n=(0,J.useInteractionProp)(e,j.getInteractionStepId),r=(0,te.useInteractionChatData)(n),a=null==r||null===(t=r.messages)||void 0===t?void 0:t.find((function(e){return("customer"===e.source||"agent"===e.source)&&!e.isRead}));return a?xf(a):null}function Qm(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Km(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Qm(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Qm(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var $m=function(e){var t=e.itemId,n=e.scrollNode,o=(0,$.useLocalizationState)().t,i=Km((0,a.useState)(!0),2),s=i[0],l=i[1],c=Km((0,a.useState)(!1),2),u=c[0],d=c[1],f=(0,Fe.useInteractionUIChatScrollerApi)(t),p=Ym(t),v=(0,J.useInteractionProp)(t,j.getInteractionStepId),g=(0,te.useInteractionChatStateConnector)();(0,a.useEffect)((function(){var e=null==g?void 0:g.dispenser.subscribe({onNewMessage:function(e){e.item_id===v&&l(!1)}});return function(){null==e||e.unsubscribe()}}),[null==g?void 0:g.dispenser,v]),(0,a.useEffect)((function(){var e=(0,m.throttle)((function(){d(Sf(n))}),500);return null==n||n.addEventListener("scroll",e),function(){null==n||n.removeEventListener("scroll",e)}}),[n]);var h=(0,a.useCallback)((function(){p&&(l(!0),null==f||f.scrollTo(p,"end"))}),[p,f]);return!p||s||u?null:(0,r.jsxs)(q.Button,{enabledInOffline:!0,transparent:!0,onClick:h,className:"absolute bottom-4 left-4 z-10 h-8 items-center   rounded border border-solid border-primary-legacy bg-white px-6 text-primary-legacy   hover:border-primary-hover hover:text-primary-hover   active:border-primary-active active:text-primary-active",children:[o.CHAT_CENTER.unread_messages_button_text(),(0,r.jsx)(re.SmIcon,{name:"caret down",className:"leading-[16px]"})]})};function Xm(){return(0,a.useCallback)((function(e,t,n){return e.reduce((function(e,a,o,i){var s,l;return 0===o?r(e,a):n&&!n(a)||(s=new Date(t(i[o-1])),l=new Date(t(a)),(0,w.areSameDays)(s,l))||r(e,a),e.push(a),e}),[]);function r(e,n){var r=(0,X.formatChatDate)(t(n));e.push(r)}}),[])}function Jm(e,t){var n=function(e){var t=(0,Qs.useActivitiesState)("activitiesListByContactId"),n=(0,Qs.useActivitiesStateMethods)().getActivitiesList,r=(0,C.useSessionState)().userId,o=t[e];return(0,a.useEffect)((function(){e&&!o&&n({id:e})}),[o,n,e]),(0,a.useMemo)((function(){var e,t;return null!==(t=null==o||null===(e=o.data)||void 0===e?void 0:e.flatMap(_f(r)))&&void 0!==t?t:[]}),[o,r])}(e);return(0,a.useMemo)((function(){var e=t;return t||(e=(new Date).getTime()),t?n.filter((function(t){return e&&t.timestamp&&t.timestamp>=e})):[]}),[t,n])}function Zm(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ep(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Zm(e,t,n[t])}))}return e}function tp(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function np(e){var t=(0,J.useInteraction)(e),n=nf().channelOptions,r=(0,$.useLocalizationState)().t,o=(0,te.useInteractionChatData)((0,j.getInteractionStepId)(t)),i=null==o?void 0:o.masked,s=(0,a.useMemo)((function(){return(0,j.isExternalChat)(t)&&(null==o?void 0:o.messages)||[]}),[t,o]),l=(0,a.useCallback)((function(e){var n=(0,j.getChatParties)(t),r=null==n?void 0:n.find((function(t){return t.party_id===e.partyId})),a=e.userId||r&&r.user_id;return tp(ep({},e),{userId:a})}),[t]),c=(0,a.useCallback)((function(e){var t,n=e.msgId?null==i||null===(t=i.messages)||void 0===t?void 0:t[e.msgId]:void 0,r=e.fileId?null==i?void 0:i.files.includes(e.fileId):void 0;if(n||r){var a=ep({},e);return a.maskedText=null==n?void 0:n.maskedText,a.fileIsMasked=r,a}return e}),[i]),u=(0,a.useCallback)((function(e){if(e.eventType=e.msg,e.needLocalization&&e.msg){var t=[],a=e.partyName||"unknown party";if("external_chat_party_joined_new"===e.msg||"external_chat_party_left_new"===e.msg)return tp(ep({},e),{msg:r.EXTERNAL_CHAT[e.msg]()});if("external_chat_party_joined"!==e.msg&&"external_chat_party_left"!==e.msg||(t=[a]),"external_chat_party_joined_new"===e.msg&&"whisper"===e.qmMode)return tp(ep({},e),{msg:r.EXTERNAL_CHAT.external_chat_party_coaching(a)});if("message_connection_accepted"===e.msg)if("sms"===e.channel)t=[r.GLOBAL.chat_type_sms()];else{var o=n.find((function(t){return t.value===e.channel}));t=o?[null==o?void 0:o.text]:[]}if(e.msg in r.EXTERNAL_CHAT){var i=e.msg;return tp(ep({},e),{msg:r.EXTERNAL_CHAT[i](t[0],t[1],t[2])})}}return e}),[n,r]),d=(0,a.useCallback)((function(e){return function(t){return e.some((function(e){return e===t.displayType}))}}),[]);return(0,a.useMemo)((function(){return{messagesList:s,addUserId:l,localizeSystemMessage:u,msgHasDisplayTypes:d,maskMessage:c}}),[s,l,u,d,c])}function rp(e){var t=np(e),n=t.messagesList,r=t.addUserId,o=t.localizeSystemMessage,i=t.maskMessage;return(0,a.useMemo)((function(){return{normalizedChatMessages:n.reduce((function(e,t){var n=(0,m.flow)(r,o,i)(t);return e.push(n),e}),[])}}),[r,o,i,n])}var ap=function(e){var t,n,o,i=e.message,s=(t=i,n=(0,ji.useContactsState)("contacts"),o=(0,Ce.useFormatting)().formatFullName,(0,a.useMemo)((function(){var e;if("suggestion"!==t.type){var r=t.contactId&&(null===(e=n[t.contactId])||void 0===e?void 0:e.data),a=r&&o(r.firstName,r.lastName),i=o(t.firstName,t.lastName);return r?a:i}}),[n,o,t.contactId,t.firstName,t.lastName,t.type])),l=(0,p.useChatMessageSanitizer)({message:i.msg}),c=(0,w.useInnerHTML)(l);return(0,r.jsxs)("section",{className:"flex w-full gap-2.5","data-testid":"transcript-message",children:[(0,r.jsx)("div",{className:"shrink-0 caption-s text-neutral-fade","data-testid":"transcript-message-time",children:(0,w.formatDate)(i.endTimestamp,"h:mm A")}),(0,r.jsxs)("div",{className:"flex flex-col",children:[s&&(0,r.jsx)("div",{className:"break-all caption-s text-neutral-fade","data-testid":"transcript-message-name",children:s}),(0,r.jsx)("div",{className:"break-words body","data-testid":"transcript-message-text",dangerouslySetInnerHTML:c})]})]})},op=o().memo((function(e){var t=e.contentVoiceTranscript,n=e.isOpenModal,o=void 0!==n&&n,i=(0,$.useLocalizationState)().t,s=(0,w.useBoolean)(),l=s.value,c=s.toggle,u=function(e){var t=e.isOpenModal,n=e.contentVoiceTranscript,o=e.handleCloseView,i=(0,$.useLocalizationState)().t,s=(0,Gf.useOpenGlobalSlidingModal)(),l=(0,Gf.useCloseGlobalSlidingModal)(),c="icon-default size-4",u=(0,a.useCallback)((function(){s("voiceTranscript",{contentVoiceTranscript:n})}),[s,n]),d=(0,a.useCallback)((function(){l("voiceTranscript")}),[l]);return[{optionName:t?i.ACTIVITY_HISTORY.close_transcript_option():i.ACTIVITY_HISTORY.view_transcript_option(),onClick:t?d:u,renderIcon:function(){return(0,r.jsx)(Te.IconViewTranscript,{className:c})}},{optionName:i.ACTIVITY_HISTORY.download_transcript_option(),onClick:o,renderIcon:function(){return(0,r.jsx)(Te.IconDownloadTranscript,{className:c})}}]}({isOpenModal:o,contentVoiceTranscript:t,handleCloseView:s.setFalse});return(0,r.jsx)(Te.TriggerDropdown,{modal:!1,open:l,onClick:w.stopPropagation,onFocus:w.stopPropagation,onOpenChange:c,className:"rounded-xs",align:"end",side:"bottom",options:u.map((function(e,t){var n=e.renderIcon,a=e.optionName,o=e.onClick;return(0,r.jsxs)("button",{className:"flex items-center gap-2",onClick:o,children:[n(),(0,r.jsx)("div",{className:"min-w-[140px] caption-s text-primary-on-primary",children:a})]},t)})),children:(0,r.jsx)(Te.ButtonIcon,{tooltip:l?i.ACTIVITY_HISTORY.call_message_collapse_voice_transcript():i.ACTIVITY_HISTORY.call_message_expand_voice_transcript(),"data-testid":"voice-transcript-button",className:"rounded-xs",children:(0,r.jsx)(Te.IconTranscriptOptions,{className:"size-4"})})})})),ip=o().memo((function(e){var t=e.isOpenModal,n=e.hasVoiceTranscript,o=e.isMissedCall,i=e.duration,s=e.title,l=e.recordingLink,c=e.sentiment,u=e.createdTime,d=e.ariaLabel,f=e.containerClassName,m=e.audioPlayerClassName,p=(0,$.useLocalizationState)().t,v=function(e){var t=e.direction,n=e.duration,o=e.timestamp,i=e.hasVoiceRecording,s=e.recordingLink,l=e.isMissedCall,c=e.voiceTranscript,u=e.createdTime,d=e.ariaLabel,f=e.title;return(0,a.useMemo)((function(){return(0,r.jsxs)("div",{children:[s&&(0,r.jsx)(ip,{isOpenModal:!0,audioPlayerClassName:"bg-transparent shadow-none",containerClassName:"bg-primary-container-variant1 rounded-xs px-3 py-2",hasVoiceRecording:i,recordingLink:s,voiceTranscript:c,timestamp:o,duration:n,isMissedCall:l,title:f,createdTime:u,hasVoiceTranscript:!!(null==c?void 0:c.length),ariaLabel:d,direction:t}),(0,r.jsx)("div",{className:"scrollbar-general mt-4 flex select-none flex-col gap-4 overflow-y-auto","data-testid":"voice-transcript-messages",children:c&&c.map((function(e){return(0,r.jsx)(ap,{message:e},xf(e))}))})]})}),[d,u,t,n,i,l,s,o,f,c])}(e),g=(0,a.useCallback)((function(){return(0,r.jsx)(r.Fragment,{children:n&&(0,r.jsx)(op,{isOpenModal:t,contentVoiceTranscript:v})})}),[v,n,t]);return(0,r.jsxs)("div",{className:W("flex flex-col gap-1",f),"data-testid":"call-content","data-missed":o,children:[(0,r.jsxs)("div",{className:"flex items-center justify-between gap-2","aria-label":d,children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[o?(0,r.jsx)(Te.IconMissedCall16,{className:"size-4","aria-hidden":!0}):(0,r.jsx)(Te.IconInteractionCall,{className:"size-4 icon-default","aria-hidden":!0}),(0,r.jsx)("span",{className:"caption-s text-primary-on-primary","aria-hidden":!0,"data-testid":"call-title",children:s})]}),!!i&&(0,r.jsxs)("span",{children:[(0,r.jsx)("span",{className:"aria-description",children:p.ACTIVITY_HISTORY.call_message_duration_aria()}),(0,r.jsxs)("div",{className:"flex items-center gap-2 caption-s text-neutral-fade",children:[(0,r.jsx)("span",{"aria-hidden":!0,className:"flex size-0.5 items-center rounded-full bg-neutral-500"}),(0,r.jsx)("span",{"data-testid":"call-duration",children:i})]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[c&&(0,r.jsx)(q.Sentiment,{sentiment:c,className:"mr-1 w-5"}),(0,r.jsxs)("span",{children:[(0,r.jsx)("span",{className:"aria-description",children:p.ACTIVITY_HISTORY.call_message_created_time_aria()}),(0,r.jsx)("span",{"data-testid":"call-start-time",className:"caption-s text-neutral-fade",children:u})]})]})]}),(0,r.jsx)("div",{className:"flex select-none flex-nowrap",children:(0,r.jsx)(q.AudioPlayer,{isNewAudioPlayerUI:!0,src:l,skipUnmount:!0,playerGroupTag:rf.CHAT_VOICE_RECORDING_PLAYER_GROUP,pauseGroupWhenPlaying:!0,renderOptionalNode:g,className:m})})]})})),sp=o().memo((function(e){var t=e.isMissedCall,n=e.duration,a=e.title,o=e.sentiment,i=e.ariaLabel,s=e.createdTime,l=(0,$.useLocalizationState)().t;return(0,r.jsxs)("div",{className:"flex items-center justify-between gap-4","aria-label":i,children:[(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[t?(0,r.jsx)(Te.IconMissedCall16,{className:"size-4","aria-hidden":!0}):(0,r.jsx)(Te.IconInteractionCall,{className:"size-4 icon-default","aria-hidden":!0}),(0,r.jsxs)("div",{className:W("flex items-center gap-1 caption-s text-neutral-on-secondary",{"text-on-error":t}),children:[(0,r.jsx)("span",{"aria-hidden":!0,"data-testid":"call-title",children:a}),!!n&&(0,r.jsx)("span",{"data-testid":"call-duration",children:"(".concat(n,")")})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[o&&(0,r.jsx)(q.Sentiment,{sentiment:o,className:"mr-1 w-5"}),(0,r.jsxs)("span",{className:"flex items-center",children:[(0,r.jsx)("span",{className:"aria-description",children:l.ACTIVITY_HISTORY.call_message_created_time_aria()}),(0,r.jsx)("span",{"data-testid":"call-start-time",className:"caption-s text-neutral-fade",children:s})]})]})]})}));function lp(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function cp(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){lp(e,t,n[t])}))}return e}function up(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var dp=function(e){var t=e.direction,n=e.duration,a=e.timestamp,o=e.hasVoiceRecording,i=e.recordingLink,s=e.isMissedCall,l=e.voiceTranscript,c=up(e,["direction","duration","timestamp","hasVoiceRecording","recordingLink","isMissedCall","voiceTranscript"]),u=(0,$.useLocalizationState)().t,d=!!(null==l?void 0:l.length),f=(0,w.formatDate)(a,"LT"),m=["incoming"===t?u.ACTIVITY_HISTORY.call_message_incoming_aria_label():u.ACTIVITY_HISTORY.call_message_outgoing_aria_label(),u.ACTIVITY_HISTORY.call_message_created_time_aria()+f,u.ACTIVITY_HISTORY.call_message_duration_aria()+n].join("; "),p=s?u.ACTIVITY_HISTORY.call_message_missed():"incoming"===t?u.ACTIVITY_HISTORY.call_message_incoming_text():u.ACTIVITY_HISTORY.call_message_outgoing_text();return o&&i?(0,r.jsx)(ip,cp({hasVoiceRecording:o,recordingLink:i,voiceTranscript:l,timestamp:a,duration:n,isMissedCall:s,title:p,createdTime:f,hasVoiceTranscript:d,ariaLabel:m,direction:t},c)):(0,r.jsx)(sp,cp({timestamp:a,duration:n,isMissedCall:s,title:p,createdTime:f,ariaLabel:m,direction:t},c))},fp=function(e){var t=e.caseId,n=e.caseNumber,o=e.caseTitle,i=(0,ke.useNavigationState)("setActivePage"),s=(0,a.useCallback)((function(e){e.preventDefault(),i({name:ke.AppRoutes.Cases,params:{id:t}})}),[i,t]);return(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{children:(0,r.jsx)(re.SmIcon,{name:"envelope",color:"grey"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("a",{href:"#",onClick:s,children:"#".concat(n)})," ",(0,r.jsx)("span",{children:o})]})]})};const mp="agent_RemoteAssistMessage_remoteAssistMessage_GuCjK",pp="agent_RemoteAssistMessage_remoteAssistMessageHeader_1NdA1",vp="agent_RemoteAssistMessage_remoteAssistMessageIcon_wYT2a",gp="agent_RemoteAssistMessage_remoteAssistMessageContent_BkraK",hp="agent_RemoteAssistMessage_remoteAssistContentRow_gezxx";var bp=function(e){var t=e.duration,n=e.privateIp,a=e.publicIp,o=e.osVersion,i=(0,$.useLocalizationState)().t,s=(0,w.getMomentUTC)(1e3*t,"m:s"),l=n||i.ACTIVITY_HISTORY.remote_assist_empty_private_ip_display_value(),c=a||i.ACTIVITY_HISTORY.remote_assist_empty_public_ip_display_value(),u=o||i.ACTIVITY_HISTORY.remote_assist_empty_os_version_display_value();return(0,r.jsxs)("div",{className:mp,children:[(0,r.jsxs)("div",{className:pp,children:[(0,r.jsx)(dn.IconRemoteAssistSession,{className:vp,"aria-hidden":!0}),(0,r.jsx)("span",{children:i.ACTIVITY_HISTORY.remote_assist_title()})]}),(0,r.jsxs)("div",{className:gp,children:[(0,r.jsxs)("div",{className:hp,children:[(0,r.jsx)("span",{children:i.ACTIVITY_HISTORY.remote_assist_duration_label()}),(0,r.jsx)("span",{children:s})]}),(0,r.jsxs)("div",{className:hp,children:[(0,r.jsx)("span",{children:i.ACTIVITY_HISTORY.remote_assist_os_version_label()}),(0,r.jsx)("span",{children:u})]}),(0,r.jsxs)("div",{className:hp,children:[(0,r.jsx)("span",{children:i.ACTIVITY_HISTORY.remote_assist_private_ip_label()}),(0,r.jsx)("span",{children:l})]}),(0,r.jsxs)("div",{className:hp,children:[(0,r.jsx)("span",{children:i.ACTIVITY_HISTORY.remote_assist_public_ip_label()}),(0,r.jsx)("span",{children:c})]})]})]})};function yp(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Sp(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){yp(e,t,n[t])}))}return e}function xp(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function jp(e){var t=e.selfUserId;return function(e,n){var a=n.userId===t;return(0,Eo.isCall)(n)&&e.push(function(e,t){var n,a,o="INBOUND"===e.direction?"incoming":"outgoing",i=(0,X.formatCallDuration)(e.counterpartDuration),s=null===(n=e.users)||void 0===n?void 0:n.find((function(e){return e.userId===t})),l=s&&e.users&&1===e.users.length,c=!!(null==s?void 0:s.partyFailureCause)&&"OTHER"!==(null==s?void 0:s.partyFailureCause),u=!!s&&(0===e.duration||c)&&"INBOUND"===e.direction,d=null===(a=e.transcript)||void 0===a?void 0:a.reduce((function(e,n){return(0,Eo.isTranscriptMessage)(n)&&e.push(function(e,t){var n=(null==e?void 0:e.userId)===t;return xp(Sp({},(0,m.omit)(Op(e,n),"channel")),{confidence:e.confidence,endTimestamp:e.endTimestamp,mediaType:"VOICE_TRANSCRIPT",sentiment:void 0!==e.sentimentScore?(0,X.getSentimentFrom)(e.sentimentScore):void 0,type:void 0})}(n,t)),e}),[]);return{direction:o,users:e.users,timestamp:e.createdTime,mediaType:"VOICE",globalInteractionId:e.globalInteractionId,msg:(0,r.jsx)(dp,{direction:o,timestamp:e.createdTime,sentiment:e.sentiment,duration:i,isMissedCall:u,hasVoiceRecording:e.hasVoiceRecording,recordingLink:e.recordingLink,voiceTranscript:d}),msgId:"".concat(e.createdTime),isSelf:l,isMissedCall:u,hasVoiceRecording:e.hasVoiceRecording,duration:i,firstName:void 0,lastName:void 0}}(n,t)),(0,Eo.isMessage)(n)&&e.push(Op(n,a)),(0,Eo.isFile)(n)&&e.push(function(e,t){return{globalInteractionId:e.globalInteractionId,direction:e.userId?"outgoing":"incoming",msgId:e.fileId||(0,N.uuid)(),displayType:"file",fileId:e.fileId,fileType:e.fileType,fileName:e.fileName,timestamp:e&&e.timestamp?Number(e.timestamp):Date.now(),mediaType:"CHAT",isSelf:t,msg:e.text,refMsgId:e.refMsgId,firstName:e.firstName,lastName:e.lastName}}(n,a)),(0,Eo.isEmail)(n)&&e.push(function(e,t){var n="INBOUND"===e.direction?"incoming":"outgoing";return{msgId:e.caseId,direction:n,globalInteractionId:e.globalInteractionId,timestamp:e.createdTime,mediaType:"EMAIL",isSelf:t,firstName:e.firstName,lastName:e.lastName,msg:(0,r.jsx)(fp,{caseId:e.caseId,caseNumber:e.caseNumber,caseTitle:e.caseTitle})}}(n,a)),(0,Eo.isRemoteAssistSession)(n)&&e.push(function(e,t){var n,a,o,i=null===(n=e.users)||void 0===n?void 0:n.find((function(e){return!!t&&e.userId===t})),s=null===(o=e.users)||void 0===o||null===(a=o.toSorted((function(e,t){return t.startTime-e.startTime})))||void 0===a?void 0:a[0],l=i||s;return{mediaType:"REMOTE_ASSIST",direction:"outgoing",msgId:"".concat(e.createdTime),globalInteractionId:e.globalInteractionId,timestamp:e.createdTime,isSelf:!!t&&(null==l?void 0:l.userId)===t,firstName:null==l?void 0:l.firstName,lastName:null==l?void 0:l.lastName,userId:null==l?void 0:l.userId,msg:(0,r.jsx)(bp,{duration:e.counterpartDuration,privateIp:e.privateIp,publicIp:e.publicIp,osVersion:e.osVersion})}}(n,t)),e}}function Ip(e){if(e)return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t={},n=function(e){return void 0!==e};return e.forEach((function(e){var r=e.partyId,a={partyId:r,contactId:e.contactId,firstName:e.firstName,lastName:e.lastName,phone:e.phone,userId:e.userId};t[r]=Sp({},t[r],(0,m.pickBy)(a,n))})),e.filter((function(e){var t=e.event;return!["party_changed","party_navigation"].includes(null!=t?t:"")})).map((function(e){return Sp({},e,t[e.partyId])}))}(e).reduce((function(e,t){var n,r,a,o;t.type&&t.event&&e.push(xp(Sp({},t),{mediaType:"CHAT",nickName:"",createdTime:t.timestamp,phone:null!==(n=t.phone)&&void 0!==n?n:"",type:t.type,event:t.event,msg:null!==(r=t.msg)&&void 0!==r?r:"",channel:t.channel,firstName:null!==(a=t.firstName)&&void 0!==a?a:"",lastName:null!==(o=t.lastName)&&void 0!==o?o:""}));return e}),[])}function Op(e,t){return{mediaType:"CHAT",msg:e.msg,msgId:e.msgId||String(e.timestamp),timestamp:e.timestamp,userId:e.userId,contactId:e.contactId,direction:"external"===e.type?"incoming":"outgoing",isSelf:t,globalInteractionId:e.globalInteractionId,firstName:e.firstName,lastName:e.lastName,channel:e.channel,displayType:"scenario"===e.type?"scenario":"message"}}function _p(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Cp(e){return function(e){if(Array.isArray(e))return _p(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return _p(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _p(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function wp(e,t){var n=(0,ji.useContactsState)("activityHistory"),r=(0,C.useSessionState)().userId,o=(0,Qs.useActivitiesState)("activities"),i=(0,J.useInteractionProp)(t,(function(e){return null==e?void 0:e.previousActivity})),s=i?o[i.globalInteractionId]:void 0;return(0,a.useMemo)((function(){var t,a=e?n[e]:void 0,o=null==a?void 0:a.messages,i=Ip(null==s||null===(t=s.data)||void 0===t?void 0:t.reduce((function(e,t){var n;return(n=e).push.apply(n,Cp(t.messages)),e}),[]));return(o||i||[]).reduce(jp({selfUserId:r}),[])}),[e,n,null==s?void 0:s.data,r])}function Np(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ap(e){return function(e){if(Array.isArray(e))return Np(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Np(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Np(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Ep=[];function Tp(e,t,n){return e.reduce(function(e,t){function n(e,n,r){return t&&!(t<=n.timestamp)||!hf(n)&&r&&!r(n)||e.push(n),e}function r(e,t){var n=e.length-1;return gf(e[n])?e.splice(n,1,t):e.push(t),e}return function(t,a){return gf(a)?r(t,a):"messages"===e?n(t,a,Lp):"calls"===e?n(t,a,bf):n(t,a)}}(t,n),[])}function Pp(e){return e.timestamp}function Mp(e){return!function(e){return"displayName"in e&&"itemId"in e&&"partyId"in e}(e)||"navigation"!==e.displayType}function Lp(e){if(vf(e))return!1;if(gf(e))return!0;var t=ff(e)?e.mediaType:void 0;if("VOICE_TRANSCRIPT"===t)return!1;var n=Nf(e);return"message"===n||"file"===n||"system"===n||"CHAT"===t}var kp=n(9552);function Dp(e,t,n){var r=function(e,t,n){var r=(0,w.useAsRef)((0,ji.useActivityHistoryByContactId)(t)),o=(0,w.useAsRef)((0,p.useContactActivityHistory)().getMessages);return(0,a.useCallback)((function(){var e=r.current||{},a=e.isLoading,i=e.reachedLimitByMedia;return a||"transcript"===n||(null==i?void 0:i[X.chatTypeToMedia[n]])||!t?Promise.resolve(!1):o.current({contactId:t,type:n}).then((function(){return!0})).catch((function(e){return console.error(e||"Error while trying loadMessages when top is reached")}))}),[r,t,o,n])}(0,t,n),o=(0,a.useRef)(!1),i=(0,a.useRef)(0);return(0,a.useCallback)((function(){var e=function(){return o.current||i.current>5?Promise.resolve(!1):(o.current=!0,r().then((function(e){return i.current=0,o.current=!1,e})).catch((function(t){i.current+=1,o.current=!1,console.error(t||"Error while trying load messages again until scroll"),e()})))};e()}),[r])}const Rp="agent_NoMessages_noMessages_UX4AP",Fp="agent_NoMessages_noRecent_7ixir",Bp="agent_NoMessages_searchForOlder_QGkjJ";var Up=function(e){var t=e.type,n=e.contactId,o=(0,p.useContactActivityHistory)(),i=o.isLoading,s=o.getMessages,l=(0,$.useLocalizationState)().t,c=function(e){var t=(0,ji.useContactsState)("activityHistory");return(0,a.useMemo)((function(){return(0,m.get)(t[e],"reachedLimit",!0)}),[t,e])}(n),u=(0,a.useCallback)((function(){s({type:t,contactId:n})}),[n,s,t]);return(0,r.jsx)(r.Fragment,{children:!i&&c?(0,r.jsx)("div",{className:Rp,children:(0,r.jsx)("p",{className:Fp,children:l.INTERNAL_CHAT.chat_history_no_recent_found(t)})}):(0,r.jsxs)("div",{className:Rp,children:[(0,r.jsx)("p",{className:Fp,children:l.INTERNAL_CHAT.chat_history_no_recent_while_loading(t)}),(0,r.jsx)(q.Button,{className:Bp,onClick:u,children:l.INTERNAL_CHAT.chat_history_search_for_older(t)})]})})},zp=function(e){var t=e.contactId,n=e.type;return"messages"!==n&&"calls"!==n?null:(0,r.jsx)(Up,{type:n,contactId:t})};const Hp={messageWrapper:"agent_Chat_messageWrapper_drgLf",messageTopInfo:"agent_Chat_messageTopInfo_VoA3v",incoming:"agent_Chat_incoming_6DHeo",messageBlock:"agent_Chat_messageBlock_i7M0B",outgoing:"agent_Chat_outgoing_JD3jd",avatar:"agent_Chat_avatar_mUd4N",placementTop:"agent_Chat_placementTop_Awuqp",remoteAssistMessageAvatar:"agent_Chat_remoteAssistMessageAvatar_FEd8Z",message:"agent_Chat_message_x5tfb",urgent:"agent_Chat_urgent_KfI8l",messageContent:"agent_Chat_messageContent_nw7Cp",messageContentHtml:"agent_Chat_messageContentHtml_AuPlx",voice:"agent_Chat_voice_GZnDG",voiceRecording:"agent_Chat_voiceRecording_crXBM",emi:"agent_Chat_emi_LuUC3",errorMessageContent:"agent_Chat_errorMessageContent_4XIXs",messageTopInfoGap:"agent_Chat_messageTopInfoGap_jZaVp",transcriptSuggestionAvatar:"agent_Chat_transcriptSuggestionAvatar_FScZp",timeChannel:"agent_Chat_timeChannel_N1P8J",channelIcon:"agent_Chat_channelIcon_nzkb9",selectionPopupOption:"agent_Chat_selectionPopupOption_UTtPT"};function Vp(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Gp(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Vp(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Vp(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Wp="m-0 mr-1.5",qp=function(e){var t=e.userId,n=e.displayName,o=e.isSelf,i=e.isScenarioAvatar,s=e.className,l=e.isConference,c=e.showUserAvatar,u=void 0===c||c,d=(0,un.useGetUserPictureUrl)(),f=(0,a.useMemo)((function(){if(!l)return!o&&t?d(t):""}),[d,l,o,t]),m=Gp((0,a.useMemo)((function(){return n?n.split(" "):["",""]}),[n]),2),p=m[0],v=m[1];return i?(0,r.jsx)(Hs.Avatar,{className:W(s,Hp.avatar,Wp),type:"scenario",size:"28"}):(0,r.jsx)(r.Fragment,{children:u&&(0,r.jsx)(Hs.Avatar,{className:W(s,Hp.avatar,Wp),url:f,size:"28",firstName:p,lastName:v,type:l?"conference":"contact"})})};var Yp=function(e){var t=e.children,n=e.className,a=e.isError,o=e.messageId,i=W(n,function(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}({},Hp.errorMessageContent,a));return(0,r.jsx)(q.SelectionItem,{"data-message-id-selection":o,focusOnSelection:!0,touchedOnly:!0,tabIndex:0,className:i,itemId:o,children:t})},Qp=function(e){var t=e.children,n=e.displayName,a=e.isOutgoing,o=e.isSystemMessage,i=e.sendTime,s=e.showTime,l=e.showName,c=(0,$.useLocalizationState)().t,u=W("text-neutral-fade [&:not(:last-child)]:mr-2");return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"flex justify-between pb-1 text-sm leading-[16px]",children:(0,r.jsxs)("div",{className:W("flex items-center justify-start",{"w-full justify-end":a}),children:[o&&(0,r.jsx)(Te.IconRobot,{className:"mr-2"}),(l||o)&&(0,r.jsx)("span",{className:u,"data-testid":"party-display-name",children:o?c.EXTERNAL_CHAT.system_message():n}),s&&(0,r.jsx)("span",{className:u,"data-testid":"message-time",children:(0,w.formatDate)(i,"h:mm A")})]})}),t]})};function Kp(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var $p=o().memo((function(e){var t,n,a=e.className,o=e.children,i=e.message,s=e.isFullWidth,l=e.messageClassName,c=e.withoutBorder,u=(0,Ce.useFormatting)().formatFullName,d=i.userId,f=i.isSelf,m=i.timestamp,p=xf(i),v=Nf(i),g=pf(i),h=!!g&&!!i.page,b=g?i.source:void 0,y=mf(i),S=!!y&&!!i.notes,x=!!y&&!!i.disposition,I=ff(i),O=I?i.direction:void 0,_=I?i.mediaType:void 0,C="EMAIL"===_&&!y,w="VOICE"===_&&!y,N=yf(i)?i.users:void 0,A=Ef(i),E=!!Tf(i),T=!(y||C||E||w),P="REMOTE_ASSIST"===_,M=N&&N.length>1,L="outgoing"===O||"agent"===b||"system"===b||"navigation"===v||"activityGroup"===v||A||x||f&&!w,k="activityGroup"===v||"REMOTE_ASSIST"===_,D=Af(i,u),R=L&&!f&&!(null==i?void 0:i.userId),F=Boolean(R||w&&!L&&!f||!L&&D),B=(0,j.isScenarioMessage)(v),U=L?"outgoing":"incoming",z=null!==(t=null==N?void 0:N[0].userId)&&void 0!==t?t:d,H=W(Hp.messageBlock,Hp[U]);return(0,r.jsx)("div",{className:H,"data-disposition":x||void 0,"data-email":C||void 0,"data-error":A||void 0,"data-file":E||void 0,"data-incoming":!L||void 0,"data-testid":"message-item","data-link":h||void 0,"data-notes":S||void 0,"data-outgoing":L||void 0,"data-remote-assist-session":P||void 0,"data-text-message":T||void 0,children:(0,r.jsx)("div",{className:W("z-0 flex max-w-[71%] flex-auto flex-col",{"w-full max-w-full":s}),children:(0,r.jsxs)("section",{className:W(Hp.message,Hp[U]),children:["incoming"===U&&!c&&(0,r.jsx)(qp,{userId:z,isConference:M,displayName:D,isScenarioAvatar:B,showUserAvatar:!0}),k?o:(0,r.jsx)(Yp,{className:W("relative",{"w-full max-w-full":s},a),isError:A,messageId:p,children:(0,r.jsx)(Cm,{messageId:p,className:W("relative inline-block\n                                        whitespace-normal break-all rounded border p-2\n                                        border-on-secondary text-primary-on-primary before:absolute\n                                        before:-bottom-px before:z-[-1] before:h-0 before:w-0 before:rounded-b-[33%]\n                                        before:border-b-4 before:border-t-0\n                                        before:border-transparent before:border-b-secondary-100 before:content-[''] after:absolute\n                                        after:bottom-0 after:z-0 after:h-0 after:w-0 after:rounded-b-[33%] after:border-b-[9px]\n                                        after:border-t-0 after:border-transparent after:content-[''] hover:text-primary-on-primary",(n={},Kp(n,"rounded-bl-[8px] bg-secondary-50\n                                            before:left-[-5px] before:border-l-[9px] before:border-r-0\n                                            after:left-[-5px] after:border-l-[8px]\n                                            after:border-r-0 after:border-b-secondary-50","incoming"===U),Kp(n,"rounded-br-[8px] bg-primary-background\n                                            before:right-[-5px] before:border-l-0 before:border-r-[9px]\n                                            after:right-[-5px] after:border-l-0\n                                            after:border-r-[8px] after:border-b-neutral-0","outgoing"===U),n),l),children:c?o:(0,r.jsx)(Qp,{displayName:D,isOutgoing:L,isSystemMessage:R,sendTime:m,showName:F,showTime:!w||y,children:o})})})]})})})})),Xp="size-1.5 rounded bg-inverse-disabled inline-block",Jp=function(){return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:W(Xp,"ml-1.5 mr-1 animate-[dot-transform_1s_alternate_infinite]")}),(0,r.jsx)("div",{className:W(Xp,"mr-1 animate-[dot-transform_1s_500ms_alternate_infinite]")}),(0,r.jsx)("div",{className:W(Xp,"animate-[dot-transform_1s_1.5s_alternate_infinite]")})]})};var Zp=function(e){var t=e.party,n=e.typingParty,a=t.first_name,o=t.last_name,i=t.user_id,s=(0,$.useLocalizationState)().t,l=(0,(0,Ce.useFormatting)().formatFullName)(a,o),c=l||s.EXTERNAL_CHAT.display_name_placeholder(),u=(i?s.EXTERNAL_CHAT.agent_is_typing(l):s.EXTERNAL_CHAT.party_is_typing()).replace(/\.\.\.$/,""),d=(null==t?void 0:t.timestamp)?Number(t.timestamp):Date.now().valueOf();return(0,r.jsxs)($p,{message:{itemId:t.item_id,partyId:t.party_id,timestamp:d,type:"message",displayType:"message",displayName:c},children:[u," ",n.message,(0,r.jsx)(Jp,{})]})},ev=function(e){var t,n=e.itemId,o=e.rangeRef,i=e.messagesRef,s=(0,a.useRef)(null),l=(0,J.useInteractionProp)(n,j.getInteractionStepId),c=(0,te.useInteractionChatData)(l),u=(0,j.getTypingParties)(c),d=u.length>0,f=null===(t=o.current)||void 0===t?void 0:t.endIndex,m=i.current.length-1,p=(0,w.useAsRef)(m===f);return(0,a.useEffect)((function(){var e;d&&p.current&&(null===(e=s.current)||void 0===e||e.scrollIntoView({behavior:"auto",block:"start"}))}),[d,p]),(0,r.jsxs)(r.Fragment,{children:[u.map((function(e,t){return(0,r.jsx)(Zp,{party:e,typingParty:null==c?void 0:c.typingParties[e.party_id]},t)})),d&&(0,r.jsx)("div",{ref:s})]})};var tv=o().memo((function(e){var t=e.messages,n=e.itemId,o=e.type,i=e.contactId,s=e.scrollNode,l=e.renderMessage,c=(0,$.useLocalizationState)().t,u=(0,Fe.useInteractionUIItemStateSetter)(),d=(0,a.useRef)(null),p=(0,a.useRef)(void 0),v=(0,w.useAsRef)(t),g=(0,a.useRef)(!1),h=(0,J.useInteraction)(n),b=(0,j.getServiceNameFromItem)(h),y=(0,j.getChannel)(h),S=(0,q.getChannelImageIcon)(y),x=Dp(0,i,o);(0,a.useEffect)((function(){u(n,f()((function(e){e.scrollerApi={scrollToLast:function(){var e;null===(e=d.current)||void 0===e||e.scrollToIndex({index:"LAST"})},scrollTo:function(e,t){var n,r,a=null===(n=v.current)||void 0===n?void 0:n.findIndex((function(t){return e===xf(t)}));null===(r=d.current)||void 0===r||r.scrollToIndex({index:a,align:t})}}})))}),[n,v,u]),function(e,t,n,r){var o=(0,w.useAsRef)(e),i=(0,w.usePreviousValueRef)(e),s=(0,w.useValueUpdated)(e.length);(0,a.useLayoutEffect)((function(){var e;if(n.current&&!Sf(r)&&xf(o.current[0])!==xf((null===(e=i.current)||void 0===e?void 0:e[0])||"")&&s){var a,l=jf(r,n.current.startIndex,i.current||[]),c=l.offset,u=l.id,d=o.current.findIndex((function(e){return xf(e)===u}));null===(a=t.current)||void 0===a||a.scrollToIndex({index:d,offset:c,align:"start"})}}),[s,i,o,n,r,t])}(t,d,p,s);var I=function(e,t,n,r,o){var i=(0,Fe.useInteractionUIItemStateSetter)(),s=(0,w.useAsRef)(Ym(e)),l=(0,w.useAsRef)((0,Fe.useInteractionUIChatTypeTopItemId)(e,t));return(0,a.useLayoutEffect)((function(){return function(){if(r.current)if(Sf(o))i(e,f()((function(e){delete e.tabTopItemId[t]})));else{var a=jf(o,r.current.startIndex,n.current),s=a.id,l=a.offset;i(e,f()((function(e){e.tabTopItemId[t]={id:s,offset:l}})))}}}),[e,n,r,o,i,t]),(0,a.useMemo)((function(){if(s.current)return{index:n.current.findIndex((function(e){return xf(e)===s.current})),align:"end"};if(l.current){var e,t=n.current.findIndex((function(e){var t;return xf(e)===(null===(t=l.current)||void 0===t?void 0:t.id)}));return{index:t,align:"start",offset:(null===(e=l.current)||void 0===e?void 0:e.offset)||0}}return{index:"LAST"}}),[s,n,l])}(n,o,v,p,s),O=(0,a.useCallback)((function(e,t){return xf(t)}),[]),_=y?"remoteassist"===y?c.ACTIVITY_HISTORY.remote_assist_title():c.GLOBAL["chat_type_".concat(y)]():"",C=(0,a.useCallback)((function(){return b?(0,r.jsx)("div",{className:"my-6 flex justify-center",children:(0,r.jsxs)("div",{className:"text-neutral-on-secondary",children:[(0,r.jsx)("p",{className:"text-center font-semibold caption-s",children:b}),(0,r.jsxs)("div",{className:"flex items-center justify-center",children:[S&&(0,r.jsx)(S,{className:"mr-1 size-4 icon-disabled"})," ",(0,r.jsx)("p",{className:"text-center caption-s",children:_})]})]})}):null}),[S,_,b]),N=(0,a.useMemo)((function(){return{Header:C,Footer:function(){return(0,r.jsx)(ev,{itemId:n,messagesRef:v,rangeRef:p})}}}),[n,v,C]),A=(0,a.useCallback)((function(e){p.current=e}),[]),E=(0,a.useCallback)((function(e){s&&s.clientHeight>=e&&x()}),[x,s]),T=(0,a.useMemo)((function(){return(0,m.debounce)(E,100)}),[E]),P=(0,a.useCallback)((function(e){g.current?e&&x():g.current=!0}),[x]),M=(0,a.useCallback)((function(e,t){return l(t)}),[l]);return t.length<1||1==t.length&&gf(t[0])?(0,r.jsx)(zp,{type:o,contactId:i}):(0,r.jsx)(kp.Virtuoso,{tabIndex:void 0,ref:d,followOutput:!0,data:t,itemContent:M,computeItemKey:O,atTopStateChange:P,initialTopMostItemIndex:I,customScrollParent:s||void 0,components:N,rangeChanged:A,totalListHeightChanged:T,increaseViewportBy:200})})),nv=function(e){var t=e.isScenario,n=e.displayName,a=e.showName,o=e.timestamp,i=e.gapBeforeTime,s=e.channel,l=e.mediaType,c=e.direction,u=e.showTime,d=i||u&&a,f=(0,q.getChannelImageIcon)(s,{omit:["web"],default:void 0});return(0,r.jsxs)("p",{className:W(Hp.messageTopInfo,Hp[c]),children:[(0,r.jsx)("span",{"data-testid":"party-display-name",children:a&&n}),(0,r.jsx)("span",{className:d?Hp.messageTopInfoGap:""}),u&&(0,r.jsxs)("span",{className:W(Hp.timeChannel,Hp[c]),children:[!t&&"EMAIL"!==l&&f&&(0,r.jsx)(f,{"data-testid":"channel","data-value":s,className:Hp.channelIcon,title:s}),(0,r.jsx)("span",{"data-testid":"message-time",children:(0,w.formatDate)(o,"h:mm A")})]})]})};const rv="agent_Chat_messageBlock_i7M0B",av="agent_Chat_outgoing_JD3jd",ov="agent_Chat_message_x5tfb",iv="agent_ErrorMessage_errorMessage_LqBft",sv="agent_ErrorMessage_errorMessageAvatar_fhbT1";var lv=function(e){var t=e.children;return(0,r.jsxs)("div",{className:W(rv,av),children:[(0,r.jsx)(nv,{direction:"outgoing",isScenario:!0,timestamp:0}),(0,r.jsx)("section",{className:W(ov,av),children:(0,r.jsx)(Yp,{className:iv,isError:!0,children:t})}),(0,r.jsx)(qp,{className:sv,isScenarioAvatar:!0})]})},cv=function(e){var t=e.title,n=e.disposition,a=e.serviceName,o=e.messageId,i=(0,$.useLocalizationState)().t,s=W("break-words font-normal caption-s text-neutral-on-secondary"),l=W("flex w-full items-center gap-1");return(0,r.jsx)(q.SelectionItem,{touchedOnly:!0,focusOnSelection:!0,tabIndex:0,itemId:o,className:"w-full rounded-xs border py-1.5 pl-2 pr-3 bg-primary-container-variant1 border-action",children:(0,r.jsx)(Cm,{messageId:o,children:(0,r.jsxs)("div",{className:"flex w-full flex-col gap-2",children:[(0,r.jsxs)("div",{className:l,children:[(0,r.jsx)(Te.IconACWDisposition24,{className:"size-4 icon-neutral"}),(0,r.jsx)("div",{className:"font-semibold caption-xs text-primary-on-primary",children:i.ACTIVITY_HISTORY.disposition_title()})]}),(0,r.jsx)("div",{className:W("flex w-full gap-1",s),"data-testid":"disposition-title",children:t}),(0,r.jsxs)("div",{className:l,children:[(0,r.jsx)("span",{className:s,children:i.EXTERNAL_CHAT.disposition_message_service_name()}),(0,r.jsx)("span",{className:W(s,"font-semibold"),"data-testid":"disposition-service",children:a})]}),(0,r.jsxs)("div",{className:l,"data-testid":"disposition",children:[(0,r.jsx)("span",{className:s,children:i.EXTERNAL_CHAT.disposition_message_name()}),(0,r.jsx)("span",{className:W(s,"font-semibold"),children:n})]})]})})})},uv=function(e){var t=e.children,n=(0,$.useLocalizationState)().t;return(0,r.jsxs)("div",{className:"flex w-full flex-col gap-2 rounded-xs border py-1.5 pl-2 pr-3 bg-warning-variant border-on-warning","data-testid":"notes",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(Te.IconAgentNotes,{className:"size-4"}),(0,r.jsx)("div",{className:"font-semibold caption-xs text-primary-on-primary",children:n.ACTIVITY_HISTORY.agent_notes_title()})]}),(0,r.jsx)("div",{className:"w-full gap-1 break-words caption-s text-neutral-on-secondary",children:t})]})};var dv=function(e){var t=e.message,n=t.notes,o=t.disposition,i=t.serviceName,s=xf(t),l=function(e){var t=(0,$.useLocalizationState)().t,n=(0,Ce.useFormatting)().formatFullName;return(0,a.useMemo)((function(){return Cf(e,t,n)}),[n,e,t])}(t);return(0,r.jsxs)("div",{children:[n&&(0,r.jsx)($p,{isFullWidth:!0,message:t,children:(0,r.jsx)(Cm,{messageId:s,className:"w-full",children:(0,r.jsx)(uv,{children:n})})}),o&&(0,r.jsx)($p,{isFullWidth:!0,message:t,children:(0,r.jsx)(cv,{messageId:s,title:l,disposition:o,serviceName:i})})]})};const fv=n.p+"21ff305d2488d9478cc624e673ec8bab.svg";const mv=n.p+"57f727bf2f169e0b19d872ec87e1ebc4.svg";const pv=n.p+"0c921db40ddee9f34a5d15b376ee0df7.svg";const vv=n.p+"910dfbe6763a148f8a6af4b2866390ff.svg";const gv=n.p+"3b81ec51938bfa793e8ba0cb4f274188.svg";const hv=n.p+"6157ddd8a81feea7b302231a623e132e.svg";const bv=n.p+"705a55fc7f1f462947be817d84a580cc.svg";const yv=n.p+"14effeb1e434fca9cf40a30e4b4c1cfa.svg";const Sv=n.p+"720e2babef2e76400cb343b776053cba.svg";const xv=n.p+"a39c903b5cca1b36c65e91151a83b019.svg";const jv={messageRow:"agent_Message_messageRow_UOs4p",incoming:"agent_Message_incoming_bnpcD",outgoing:"agent_Message_outgoing_pKbZe",time:"agent_Message_time_wb5xv",message:"agent_Message_message_chWfh",link:"agent_Message_link_J61uY",error:"agent_Message_error_NKpnz",html:"agent_Message_html_rIkTi",closable:"agent_Message_closable_a7mGz",sentiment:"agent_Message_sentiment_jM9aL",icon:"agent_Message_icon_XNLkK"};function Iv(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ov=o().forwardRef((function(e,t){var n,a=e.message,o=e.itemId,i=e.direction,s=e.closeButton,l=e.isLink,c=e.isHtml,u=e.content,d=a.endTime,f=a.sentiment,m=a.chatMessageData,p=(0,w.useInnerHTML)(u),v=function(e){if((0,of.isSuggestion)(e))return fv;if((0,of.isCurrentChatTranscriptMessage)(e)&&e.chatMessageData.channel)switch(e.chatMessageData.channel){case"sms":return vv;case"whatsapp":return xv;case"facebook":return mv;case"line":return pv;case"telegram":return gv;case"twitter":return hv;case"viber":return bv;case"web":return yv;case"wechat":return Sv}}(a),g=xf(a),h=lf(o),b=(0,r.jsxs)(q.SelectionItem,{ref:t,itemId:g,focusOnSelection:!0,touchedOnly:!0,tabIndex:0,"data-message-id-selection":g,className:W(jv.message,jv[i],(n={},Iv(n,jv.html,c),Iv(n,jv.link,l),Iv(n,jv.closable,!!s),Iv(n,jv.error,"error"===(null==m?void 0:m.displayType)),n)),children:[(0,r.jsx)(Cm,{messageId:g,children:(0,r.jsx)("div",{dangerouslySetInnerHTML:p,onClickCapture:function(e){l&&(e.preventDefault(),e.stopPropagation(),h(a))}})}),s]});return(0,r.jsxs)("div",{className:W(jv.messageRow,jv[i]),children:[(0,r.jsx)("div",{className:W(jv.time,jv[i]),children:(0,w.formatDate)(d,"h:mm A")}),b,v&&(0,r.jsx)(q.Svg,{src:v,className:W(jv.icon,jv[i])}),f&&(0,r.jsx)(q.Sentiment,{sentiment:f,className:W(jv.sentiment,jv[i])})]})}));function _v(e){var t=e.text,n=e.url,r=e.target,a=(0,w.normalizeExternalURL)(n);return"<a href=".concat(a,' target="').concat(r,'">').concat(t,"</a>")}function Cv(e){var t,n;return{partyId:e.partyId,msgId:null!==(t=e.msgId)&&void 0!==t?t:"",text:null!==(n=e.msg)&&void 0!==n?n:"",startTime:e.timestamp,endTime:e.timestamp,sentiment:e.sentiment,type:"chatMessage",format:"HTML",isSelf:e.isSelf,chatMessageData:e}}function wv(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Nv(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var Av=function(e){var t=e.message,n=e.itemId,a=Nv(e,["message","itemId"]),o=t.text,i=void 0===o?"":o,s=(0,of.isHTMLSuggestion)(t),l=(0,of.isLinkSuggestion)(t),c=l?_v({text:t.text,target:n,url:t.suggestionURL}):i;return(0,r.jsx)(Ov,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){wv(e,t,n[t])}))}return e}({message:t,isHtml:s,isLink:l,content:c,itemId:n},a))},Ev=o().memo((function(e){var t=e.message;return(0,r.jsx)("div",{className:"text-neutral-on-fade words-break flex w-full select-none items-center justify-center gap-1 px-8 py-4 caption-s","data-testid":"date-separator",children:t})}));function Tv(e){var t=e.msgId,n=e.scrollNode,r=e.mediaType,o=e.isDIDChat,i=e.itemInteractionStepId,s=e.itemContactId,l=e.itemGlobalInteractionId,c=e.source,u=e.isRead,d=e.historyMessageGlobalInteractionId,f=(0,w.usePageVisibility)(),m=(0,te.useInteractionChatStateMethods)(),p=m.markMessageAsRead,v=m.markPersonalMessageAsRead,g=(0,te.useInteractionChatStateSelector)((function(e){var n,r;return!!(s&&t&&d&&(null===(r=e.unreadPersonalMessages[s])||void 0===r||null===(n=r[d])||void 0===n?void 0:n[t]))})),h=(0,a.useMemo)((function(){return!!f&&(r?g:!(!i||"customer"!==c&&"agent"!==c||u))}),[i,u,r,f,c,g]),b=(0,a.useRef)(null),y=(0,w.useIntersectionObserver)(b,{root:n,enabled:h}).isIntersecting,S=(0,a.useCallback)((function(e){e&&(g?d&&v({globalInteractionId:d,messageId:t,contactId:s}):t&&(i&&p({interactionStepId:i,messageId:t}),l&&o&&s&&v({globalInteractionId:l,messageId:t,contactId:s})))}),[g,t,v,d,s,i,l,p,o]);return(0,a.useEffect)((function(){y&&h&&S(!0)}),[S,y,h]),b}var Pv=o().forwardRef((function(e,t){var n=e.fileLink,a=e.fileName;return(0,r.jsx)("div",{ref:t,children:(0,r.jsx)(Te.Attachment.File,{height:"44",name:a,link:n,withDownloadButton:!0})})})),Mv=function(e){var t=e.fileLink;return(0,r.jsx)(q.AudioPlayer,{src:t,showDownloadButton:!0,isNewAudioPlayerUI:!0})},Lv=n(8391);function kv(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Dv(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){kv(e,t,n[t])}))}return e}function Rv(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Fv(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var Bv=o().forwardRef((function(e,t){var n=e.fileLink,a=e.fileName,o=e.className,i=e.senderName,s=e.timestamp,l=Fv(e,["fileLink","fileName","className","senderName","timestamp"]),c=(0,w.useBoolean)(!1);return(0,w.useEscapeManager)(c.setFalse,{enabled:c.value}),(0,r.jsxs)(Lv.fC,{open:c.value,onOpenChange:c.toggle,children:[(0,r.jsx)(Lv.xz,{asChild:!0,children:(0,r.jsx)("img",Rv(Dv({ref:t},l),{className:W("cursor-zoom-in rounded-xs",o),alt:a,src:n,title:a,"data-testid":"attachment","data-value":a}))}),(0,r.jsxs)(Lv.h_,{children:[(0,r.jsx)(Lv.aV,{className:W("fixed left-0 top-0 z-10 h-full w-full bg-inverse-overlay","data-[state=open]:animate-fade-in-100","data-state=[closed]:animate-fade-out-100")}),(0,r.jsxs)(Lv.VY,{className:W("fixed left-1/2 top-1/2 z-20 max-h-[90vw] max-w-[90vw] -translate-x-1/2 -translate-y-1/2","data-[state=open]:animate-fade-in-100","data-state=[closed]:animate-fade-out-100"),children:[(0,r.jsx)(Lv.x8,{className:"absolute right-0 top-0 translate-y-[calc(-100%-10px)]",children:(0,r.jsx)(Te.IconClose24,{className:"size-8 icon-reversed"})}),(0,r.jsx)("img",Rv(Dv({ref:t},l),{className:"h-auto w-auto",alt:a,src:n,title:a,"data-testid":"attachment","data-value":a})),(0,r.jsx)("p",{className:"mt-2 caption-s text-inverse-disabled",children:a}),(0,r.jsxs)("p",{className:"caption-s text-inverse-disabled",children:[(0,r.jsx)("b",{className:"text-inverse-disabled",children:i}),", ",(0,r.jsx)("b",{className:"text-inverse-disabled",children:(0,X.formatChatDate)(s)})]})]})]})]})}));function Uv(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var zv=function(e){var t=e.session,n=void 0===t?{}:t,a=e.canMask,o=e.mediaType,i=e.source,s=e.isRead,l=e.fileData,c=e.markAsReadData,u=e.globalInteractionId,d=e.msg,f=e.senderName,m=e.timestamp,p=l.refMsgId,v=l.fileId,g=void 0===v?"":v,h=l.fileType,b=void 0===h?"attachment":h,y=l.fileName,S=void 0===y?"":y,x=l.fileProgress,j=void 0===x?0:x,I=l.fileError,O=l.fileIsMasked,_=void 0!==O&&O,C=n.id,w=n.domain,N=n.loginId,A=(0,at.paramsToQueryString)({token:C,user:N,tenant:w,id:g,no_disposition:0}),E="".concat(at.requestUrls.getChatAttachmentDownload,"?").concat(A),T=(0,$.useLocalizationState)().t,P=!g&&!I,M=Tv(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Uv(e,t,n[t])}))}return e}({msgId:p,historyMessageGlobalInteractionId:u,mediaType:o,source:i,isRead:s},c));if(P&&j)return(0,r.jsx)(q.FileProgress,{progress:j});if(!g){var L=T.INTERNAL_CHAT.chat_removedAttachment_label();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:["[",L," ",(0,r.jsx)("del",{"data-testid":"file-name",children:S}),"]"]}),d&&(0,r.jsx)("div",{"data-testid":"message-content",children:d})]})}return I?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{"data-testid":"file-error",children:I}),d&&(0,r.jsx)("div",{"data-testid":"message-content",children:d})]}):"attachment"===b||"video"===b?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(Sm,{fileId:g,fileIsMasked:_,canMask:a,globalInteractionId:u,interactionStepId:c.itemInteractionStepId,contactId:c.itemContactId,children:(0,r.jsx)(Pv,{ref:M,fileName:S,fileLink:E})}),d&&(0,r.jsx)("div",{"data-testid":"message-content",children:d})]}):"audio"===b?(0,r.jsx)(Sm,{fileId:g,fileIsMasked:_,canMask:a,globalInteractionId:u,interactionStepId:c.itemInteractionStepId,contactId:c.itemContactId,children:(0,r.jsx)(Mv,{fileLink:E})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(Sm,{fileId:g,fileIsMasked:_,canMask:a,globalInteractionId:u,interactionStepId:c.itemInteractionStepId,contactId:c.itemContactId,children:(0,r.jsx)(Bv,{ref:M,fileName:S,fileLink:E,senderName:f,timestamp:m})}),(0,r.jsx)("p",{className:"mt-1 caption-xs text-neutral-fade",children:S}),d&&(0,r.jsx)("div",{"data-testid":"message-content",children:d})]})};const Hv="agent_FileMessage_file_JZUYk",Vv="agent_FileMessage_isError_gJF8O",Gv="agent_FileMessage_voice_fmzfp";function Wv(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var qv=function(e){var t,n=e.message,o=e.fileData,i=e.markAsReadData,s=o.fileError,l=o.fileType,c=(0,C.useSessionState)(),u=c.sessionId,d=c.domain,f=c.loginId,m=c.privileges,p=(0,a.useMemo)((function(){return{id:u,domain:d,loginId:f}}),[u,d,f]),v=!!m.CAN_MASK_INTERACTION_CONTENT,g=ff(n)?n.globalInteractionId:void 0,h="audio"===l,b=(0,Ce.useFormatting)().formatFullName;return(0,r.jsx)($p,{message:n,className:W(Hv,(t={},Wv(t,Vv,s),Wv(t,Gv,h),t)),children:(0,r.jsx)(zv,{timestamp:n.timestamp,senderName:Af(n,b),fileData:o,markAsReadData:i,canMask:v,session:p,globalInteractionId:g})})};var Yv=o().memo((function(e){var t=e.message,n=(0,$.useLocalizationState)().t,o=function(e){var t=e.itemId,n=e.partyId,r=e.inviteId,o=(0,te.useInteractionChatStateMethods)().removeInviteFromChat;return(0,a.useCallback)((function(){o({itemId:t,partyId:n,messageId:r||""})}),[r,t,n,o])}(t);return(0,r.jsxs)("div",{className:"select-none pb-2.5","data-testid":"message-item","data-outgoing":"true","data-invitation":"true",children:[(0,r.jsx)("span",{className:"mr-[5px]",children:n.EXTERNAL_CHAT.external_chat_party_inviting()}),(0,r.jsx)(q.SemanticButton,{size:"mini",negative:!0,onClick:o,tooltip:n.WINDOW_POPUP_TITLES_AND_MESSAGES.window_buttonCancel(),"data-testid":"cancel-invitation-button",children:n.WINDOW_POPUP_TITLES_AND_MESSAGES.window_buttonCancel()})]})})),Qv=function(e){var t=e.link,n=e.latitude,a=e.longitude,o=(0,$.useLocalizationState)("t").EXTERNAL_CHAT,i=t||(n&&a?function(e,t){return"https://www.google.com/maps/search/?api=1&query=".concat(e,",").concat(t)}(n,a):void 0);return(0,r.jsx)(re.SmImage,{src:dn.iconLocation,title:o.location_message_icon_tooltip(),as:"a",href:i,target:"_blank"})},Kv=function(e){var t=e.message,n=t.serviceName,a=t.serviceAddress,o=t.msg,i=t.timestamp,s="".concat(n," ").concat((0,X.formatPhone)(a)),l=xf(t),c=(0,p.useChatMessageSanitizer)({message:o}),u=(0,w.useInnerHTML)(c);return(0,r.jsxs)("div",{className:W(Hp.messageBlock,Hp.outgoing),"data-testid":"message-item","data-outgoing-campaign":"true","data-outgoing":"true",children:[(0,r.jsxs)("div",{className:Hp.messageWrapper,children:[(0,r.jsx)(nv,{direction:"outgoing",timestamp:i,showName:!0,gapBeforeTime:!0,displayName:s}),(0,r.jsx)("section",{className:W(Hp.message,Hp.outgoing),children:(0,r.jsx)(Yp,{messageId:l,children:(0,r.jsx)("span",{dangerouslySetInnerHTML:u})})})]}),(0,r.jsx)(dn.IconOutboundCampaign,{className:Hp.avatar})]})},$v=function(e){var t,n,a,o,i,s,l,c,u,d=e.link,f=e.title,m=e.partyId,p=(0,$.useLocalizationState)().t,v=(0,J.useActiveInteraction)(),g=null==v||null===(t=v.chatParties)||void 0===t?void 0:t.find((function(e){return e.party_id===m})),h=null==g?void 0:g.contact_id,b=null===(n=(0,ji.useContact)(h))||void 0===n?void 0:n.data,y=(0,Ce.useFormatting)().formatFullName,S=y(null==b?void 0:b.firstName,null==b?void 0:b.lastName),x=y(null==g?void 0:g.first_name,null==g?void 0:g.last_name),j=y(null==v||null===(a=v.externalChatData)||void 0===a?void 0:a.firstName,null==v||null===(o=v.externalChatData)||void 0===o?void 0:o.lastName),I=S||x||j||!!(null==b||null===(i=b.phones)||void 0===i?void 0:i.length)&&(null==b||null===(l=b.phones)||void 0===l||null===(s=l[0])||void 0===s?void 0:s.phone)||!!(null==b||null===(c=b.emails)||void 0===c?void 0:c.length)&&(null==b||null===(u=b.emails[0])||void 0===u?void 0:u.emailAddress)||p.EXTERNAL_CHAT.display_name_placeholder();return(0,r.jsx)("div",{className:"flex items-center justify-center bg-transparent py-4",children:(0,r.jsxs)("div",{className:"flex flex-wrap items-center justify-center",children:[(0,r.jsx)(Te.IconSendInvitation,{className:"mr-2 size-4 icon-default"}),I&&(0,r.jsx)("span",{className:"mr-1 font-semibold caption-s text-neutral-on-secondary",children:I}),(0,r.jsx)("span",{className:"caption-s text-neutral-fade",children:p.ACTIVITY_HISTORY.navigate_to()}),(0,r.jsx)(Te.Link,{href:d,title:d,"data-testid":"link",className:"!caption-s",children:f||p.EXTERNAL_CHAT.external_chat_customer_navigates_to()})]})})};var Xv=function(e){var t=e.className,n=e.confidence,o=(0,$.useLocalizationState)().t,i=function(e,t,n){var r,a,o=[];if(0===t)r=[n,n,n];else switch(o=[n*(1-t),n*(1-t*((e/=60)-(a=Math.floor(e)))),n*(1-t*(1-(e-a)))],a){case 0:r=[n,o[2],o[0]];break;case 1:r=[o[1],n,o[0]];break;case 2:r=[o[0],n,o[2]];break;case 3:r=[o[0],o[1],n];break;case 4:r=[o[2],o[0],n];break;default:r=[n,o[0],o[1]]}return"#"+r.map((function(e){return("0"+Math.round(255*e).toString(16)).slice(-2)})).join("")}(Math.floor(120*n),.66,1),s=(0,a.useMemo)((function(){return{backgroundColor:i}}),[i]),l=n>.7?"high":n>.4?"medium":"low",c=Math.floor(100*n),u=(0,a.useMemo)((function(){return{high:o.ACTIVITY_HISTORY.call_message_transcript_confidence_high(),medium:o.ACTIVITY_HISTORY.call_message_transcript_confidence_medium(),low:o.ACTIVITY_HISTORY.call_message_transcript_confidence_low()}}),[o])[l]+" (".concat(c,"%)");return(0,r.jsx)("span",{className:t,style:s,title:u,"data-testid":"message-confidence","data-value":c,"data-confidence-low":"low"===l,"data-confidence-medium":"medium"===l,"data-confidence-high":"high"===l})};const Jv="agent_PlainMessage_plainMessage_gEaYP",Zv="agent_PlainMessage_sentimentLeft_Uh6NW",eg="agent_PlainMessage_sentimentRight_kUWim",tg="agent_PlainMessage_visible_kcCDF";function ng(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var rg=function(e){var t=e.markAsReadData,n=e.message,a=t.scrollNode,o=t.itemGlobalInteractionId,i=t.itemInteractionStepId,s=t.isDIDChat,l=t.itemContactId,c=t.interactionItemId,u=n.msgId,d=n.userId,f=ff(n),m=f?n.mediaType:void 0,v=f?n.globalInteractionId:void 0,g=function(e){return ff(e)&&"VOICE_TRANSCRIPT"===e.mediaType}(n)?n.confidence:void 0,h=pf(n),b=h?n.source:void 0,y=h?n.sentiment:void 0,S=h?n.isRead:void 0,x=h?n.maskedText:void 0,j=h||f?n.msg:void 0,I=(0,p.useChatMessageSanitizer)({message:j,allowedAttributes:rf.CHAT_MESSAGE_ALLOWED_ATTRIBUTES,allowedTags:rf.CHAT_MESSAGE_ALLOWED_TAGS}),O=(0,w.useInnerHTML)(x||I),_=(0,Fe.useChatSentimentsOn)(c),C=Tv({msgId:u,historyMessageGlobalInteractionId:v,scrollNode:a,mediaType:m,source:b,isRead:S,itemContactId:l,isDIDChat:s,itemInteractionStepId:i,itemGlobalInteractionId:o});return(0,r.jsxs)("div",{"data-message-id":u,"data-global-interaction-id":null!=v?v:"current",ref:C,children:[d&&y&&(0,r.jsx)(q.Sentiment,{sentiment:y,className:W(ng({},tg,_),Zv)}),d&&g&&(0,r.jsx)(Xv,{confidence:g}),(0,r.jsx)("span",{dangerouslySetInnerHTML:O,className:Jv,"data-testid":"message-content"}),!d&&y&&(0,r.jsx)(q.Sentiment,{sentiment:y,className:W(ng({},tg,_),eg)}),!d&&g&&(0,r.jsx)(Xv,{confidence:g})]})},ag=function(){var e=(0,$.useLocalizationState)().t,t=function(){var e=(0,$.useLocalizationState)().t;return(0,a.useCallback)((function(t){switch(t){case"external_chat_file_received":return e.EXTERNAL_CHAT.file();case"external_chat_contact_received":return e.EXTERNAL_CHAT.contact();case"external_chat_url_received":return e.EXTERNAL_CHAT.url();default:return null}}),[e.EXTERNAL_CHAT])}();return(0,a.useCallback)((function(n){var a='"'.concat(n.partyName,'"');if(n.needLocalization&&n.eventType&&n.partyName&&n.msg)switch(n.eventType){case"external_chat_party_joined_new":case"external_chat_party_left_new":return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"font-semibold caption-s text-neutral-on-secondary",children:n.partyName}),(0,r.jsx)("span",{className:"caption-s text-neutral-fade",children:n.msg})]});case"external_chat_party_coaching":return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"font-semibold caption-s text-neutral-on-secondary",children:n.partyName}),(0,r.jsx)("span",{className:"caption-s text-neutral-fade",children:e.EXTERNAL_CHAT.external_chat_party_coaching_new()})]});case"external_chat_file_received":case"external_chat_contact_received":case"external_chat_url_received":return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"caption-s text-neutral-fade",children:t(n.eventType)}),(0,r.jsx)("span",{className:"font-semibold caption-s text-neutral-on-secondary",children:a}),(0,r.jsx)("span",{children:e.EXTERNAL_CHAT.received()})]});case"external_chat_file_sent":return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"caption-s text-neutral-fade",children:e.EXTERNAL_CHAT.external_chat_file_sent_new()}),(0,r.jsx)("span",{className:"font-semibold caption-s text-neutral-on-secondary",children:a})]});default:return(0,r.jsx)("span",{className:"caption-s text-neutral-fade",children:n.msg})}}),[t,e.EXTERNAL_CHAT])},og=function(e){var t=e.message,n=ag(),o=(0,a.useCallback)((function(e){switch(e.eventType){case"external_chat_party_joined_new":return"whisper"!==e.qmMode?(0,r.jsx)(Te.IconJoin,{className:"size-4 icon-default"}):null;case"external_chat_party_left_new":return(0,r.jsx)(Te.IconLeaveParty,{className:"size-4 icon-default"});default:return null}}),[]);return(0,r.jsx)("div",{className:"flex items-center justify-center pb-2.5",children:(0,r.jsx)("div",{className:"flex flex-col","data-testid":"message-item","data-system":"true",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[o(t),(0,r.jsx)("div",{className:"flex items-center gap-1",children:n(t)})]})})})},ig=o().memo((function(e){var t=e.message,n=e.scrollNode,o=e.itemInteractionStepId,i=e.itemContactId,s=e.isDIDChat,l=e.itemGlobalInteractionId,c=e.interactionItemId,u=(0,a.useMemo)((function(){return{scrollNode:n,itemInteractionStepId:o,itemContactId:i,isDIDChat:s,itemGlobalInteractionId:l,interactionItemId:c}}),[c,s,i,l,o,n]),d=(0,a.useMemo)((function(){if(!hf(t))return Tf(t)}),[t]);if(hf(t))return(0,r.jsx)(Av,{itemId:c,direction:"outgoing",message:t});if(df(t))return(0,r.jsx)(Ev,{message:t});if(mf(t))return(0,r.jsx)(dv,{message:t});if(function(e){return ff(e)&&"OUTBOUND_MESSAGING"==e.serviceType}(t))return(0,r.jsx)(Kv,{message:t});if(yf(t))return(0,r.jsx)($p,{messageClassName:"w-full",className:"min-w-[300px]",message:t,children:t.msg});if(function(e){return ff(e)&&"EMAIL"==e.mediaType}(t))return(0,r.jsx)($p,{message:t,children:t.msg});if(pf(t)){if(function(e){return pf(e)&&"system"===e.displayType}(t))return(0,r.jsx)(og,{message:t});if(function(e){return pf(e)&&"invite"===e.displayType}(t))return(0,r.jsx)(Yv,{message:t});if(Ef(t))return(0,r.jsx)($p,{message:t,children:t.msg});if(function(e){return pf(e)&&"location"===e.displayType}(t)){var f=t.page,m=t.longitude,p=t.latitude;return(0,r.jsx)($p,{message:t,children:(0,r.jsx)(Qv,{link:f,longitude:m,latitude:p})})}var v=t.page,g=t.title,h=t.partyId;if(v)return(0,r.jsx)($p,{message:t,isFullWidth:!0,withoutBorder:!0,messageClassName:"w-full !border-none !bg-transparent after:content-none before:content-none",children:(0,r.jsx)($v,{link:v,title:g,partyId:h})})}return d?(0,r.jsx)(qv,{markAsReadData:u,message:t,fileData:d}):function(e){return ff(e)&&"REMOTE_ASSIST"==e.mediaType}(t)?(0,r.jsx)($p,{message:t,children:t.msg}):(0,r.jsx)($p,{message:t,children:(0,r.jsx)(rg,{message:t,markAsReadData:u})})})),sg=(0,r.jsx)(lv,{children:"Broken message"}),lg=o().memo((function(e){var t,n=e.itemId,o=e.contactId,i=e.scrollNode,s=e.interactionStepId,l=e.messages,c=e.type,u=(0,J.useInteractionProp)(n,(function(e){var t,n;return null!==(n=null==e||null===(t=e.scenarioData)||void 0===t?void 0:t.isDID)&&void 0!==n&&n})),d=null!==(t=(0,J.useInteractionProp)(n,j.getGlobalInteractionId))&&void 0!==t?t:"",f=(0,a.useCallback)((function(e){return vf(e)&&!hf(e)?null:(0,r.jsx)("div",{"data-message":"true",children:(0,r.jsx)(q.ErrorBoundary,{fallback:sg,children:(0,r.jsx)(ig,{message:e,scrollNode:i,interactionItemId:n,itemContactId:o,itemInteractionStepId:s,itemGlobalInteractionId:d,isDIDChat:u})})})}),[o,d,s,u,n,i]);return(0,r.jsx)(tv,{itemId:n,contactId:o,type:c,messages:l,renderMessage:f,scrollNode:i},"".concat(n,"_").concat(c))}));const cg="agent_ExternalMessages_messagesContainer_mpPuU",ug="agent_ExternalMessages_messages_istRY";function dg(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function fg(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||pg(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function mg(e){return function(e){if(Array.isArray(e))return dg(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||pg(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function pg(e,t){if(e){if("string"==typeof e)return dg(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?dg(e,t):void 0}}var vg=o().memo((function(e){var t=e.itemId,n=(0,Fe.useInteractionUIChatScrollerApi)(t),o=fg((0,a.useState)(null),2),i=o[0],s=o[1],l=(0,Fe.useInteractionUIChatType)(t),c=(0,J.useInteraction)(t),u=(0,j.getContactId)(c),d=(0,j.getInteractionStepId)(c),f=Em(t),p=(0,a.useMemo)((function(){switch(l){case"calls":return f.voice;case"messages":return f.chat;default:return mg(f.voice).concat(mg(f.chat))}}),[f.chat,f.voice,l]),v=function(e,t,n){var r,o,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Ep,s={messages:"chat",calls:"voice",all:"all",transcript:"all"},l=Xm(),c=wp(t,n),u=rp(n).normalizedChatMessages,d=(0,ji.useContactsState)("activityHistory"),f=null===(o=d[t])||void 0===o||null===(r=o.activityCreatedTimeByMedia)||void 0===r?void 0:r[s[e]],p=Jm(t,f);return(0,a.useMemo)((function(){var t=Tp((0,m.orderBy)(Ap(c).concat(Ap(i),Ap(p),Ap(u)),"timestamp"),e,f);return{messagesWithDates:l(t,Pp,Mp)}}),[i,c,p,u,e,f,l])}(l,u,t,p).messagesWithDates,g=(0,J.useInteractionProp)(t,j.isAfterCallWork),h=(0,a.useMemo)((function(){return v.filter(gg).map(xf)}),[v]),b=(0,w.useAsRef)(h),y=(0,a.useCallback)((function(){return b.current}),[b]),S=(0,a.useCallback)((function(e,t){"keys"===t&&(null==n||n.scrollTo(e,"center"))}),[n]);return(0,r.jsxs)(q.SelectionContainer,{startFrom:"bottom",className:cg,itemsListProvider:y,onItemSelect:S,children:[!g&&(0,r.jsx)(qm,{itemId:t}),(0,r.jsx)("div",{ref:s,className:ug,children:(0,r.jsx)(ym,{messages:v,interactionId:t,scrollContainer:i,withMaskAction:!0,children:(0,r.jsx)(lg,{messages:v,scrollNode:i,itemId:t,contactId:u,type:l,interactionStepId:d})})}),(0,r.jsx)($m,{itemId:t,scrollNode:i})]})}));function gg(e){return!!vf(e)||!(gf(e)||ff(e)&&"REMOTE_ASSIST"===e.mediaType)}function hg(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function bg(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return hg(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return hg(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var yg=function(){},Sg={search:"",setSearch:yg,searchResult:void 0,setSearchResult:yg,showBotSuggestions:!0,toggleBotSuggestions:yg,showSMS:!0,toggleSMS:yg,showTranscript:!0,toggleTranscript:yg},xg=(0,x.createContext)(Sg);xg.displayName="VoiceTranscriptUIContext";var jg=function(e){var t=e.children,n=bg((0,a.useState)(Sg.search),2),o=n[0],i=n[1],s=bg((0,a.useState)(void 0),2),l=s[0],c=s[1],u=(0,w.useBoolean)(Sg.showBotSuggestions),d=u.value,f=u.toggle,m=(0,w.useBoolean)(Sg.showSMS),p=m.value,v=m.toggle,g=(0,w.useBoolean)(Sg.showTranscript),h=g.value,b=g.toggle,y=(0,a.useMemo)((function(){return{search:o,setSearch:i,searchResult:l,setSearchResult:c,showBotSuggestions:d,toggleBotSuggestions:f,showSMS:p,toggleSMS:v,showTranscript:h,toggleTranscript:b}}),[o,l,d,p,h,f,v,b]);return(0,r.jsx)(xg.Provider,{value:y,children:t})};function Ig(){return(0,x.useContext)(xg)}function Og(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _g(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||wg(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Cg(e){return function(e){if(Array.isArray(e))return Og(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||wg(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function wg(e,t){if(e){if("string"==typeof e)return Og(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Og(e,t):void 0}}var Ng=function(e){var t=e.className,n=e.messagesContent,o=e.itemId,i=(0,$.useLocalizationState)().t,s=Ig(),l=s.search,c=s.setSearch,u=s.setSearchResult,d=s.showBotSuggestions,f=s.showSMS,p=s.showTranscript,v=s.toggleBotSuggestions,g=s.toggleSMS,h=s.toggleTranscript,b=_g((0,a.useState)(l),2),y=b[0],S=b[1],x=_g((0,a.useState)(void 0),2),j=x[0],I=x[1],O=(0,Fe.useInteractionUIChatScrollerApi)(o),_=(0,a.useMemo)((function(){return(0,m.debounce)((function(e){c(e)}),500)}),[c]),C=(0,a.useMemo)((function(){return l?Object.entries(n).reduce((function(e,t){var n=_g(t,2),r=n[0],a=n[1].marksCount;return Cg(Array.from({length:a}).map((function(e,t){return{messageId:r,index:t}})).reverse()).concat(Cg(e))}),[]):[]}),[l,n]);(0,a.useEffect)((function(){_(y)}),[y,_]),(0,a.useEffect)((function(){if(j){var e=C[j-1];u(e),e&&e.messageId&&(null==O||O.scrollTo(e.messageId,"center"))}else u(void 0)}),[C,O,j,u]);var w=(0,a.useCallback)((function(e){I(e)}),[]),N=(0,a.useCallback)((function(e){S(e.target.value),I(1)}),[]);return(0,r.jsxs)("div",{className:W("flex items-center gap-2 px-4 py-2 bg-primary-background",t),children:[(0,r.jsx)(Te.SearchField,{value:y,onChange:N,layoutClassName:"grow",placeholder:i.EXTERNAL_CHAT.search_transcript()}),!!y&&(0,r.jsx)(q.SearchResultsSwitcher,{current:j||0,total:C.length,onChange:w}),(0,r.jsxs)("div",{className:"flex items-center gap-0.5",children:[(0,r.jsx)(Te.ButtonIcon,{size:"40",disabled:!d,onClick:v,className:"rounded-xs",tooltip:i.VOICE_TRANSCRIPT.bot_suggestion_btn_tooltip(),children:(0,r.jsx)(Te.IconIntentFilled,{className:"size-6 icon-disabled"})}),(0,r.jsx)(Te.ButtonIcon,{size:"40",disabled:!f,onClick:g,className:"rounded-xs",tooltip:i.VOICE_TRANSCRIPT.sms_btn_tooltip(),children:(0,r.jsx)(Te.IconMessageExternal,{className:"size-6 icon-disabled"})}),(0,r.jsx)(Te.ButtonIcon,{size:"40",tooltip:i.VOICE_TRANSCRIPT.transcript_btn_tooltip(),disabled:!p,onClick:h,className:"rounded-xs",children:(0,r.jsx)(Te.IconVoiceTranscript,{className:"size-6 icon-disabled"})})]})]})};const Ag="agent_VoiceTranscript_mark_t17ja",Eg="agent_VoiceTranscript_highlighted_6A15l";function Tg(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Pg(e){return function(e){if(Array.isArray(e))return Tg(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Tg(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Tg(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Mg(e){var t=e.chatMessages,n=e.voiceTranscript,r=e.botSuggestions,o=Ig(),i=o.showBotSuggestions,s=o.showTranscript,l=o.showSMS;return(0,a.useMemo)((function(){return(l?(0,m.orderBy)(Pg(n).concat(Pg(r),Pg(t.filter((function(e){return"message"===e.displayType||"error"===e.displayType})).map(Cv))),"endTime"):Pg(n)).filter((function(e){return t=e.type,{voiceTranscriptMessage:s,suggestion:i,chatMessage:l}[t];var t}))}),[r,t,i,l,s,n])}function Lg(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function kg(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Dg(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var Rg=function(e){var t=e.itemContactId,n=void 0===t?"":t,a=e.itemInteractionStepId,o=void 0===a?"":a,i=e.scrollNode,s=e.isDIDChat,l=e.message,c=Dg(e,["itemContactId","itemInteractionStepId","scrollNode","isDIDChat","message"]),u=Tv({msgId:l.msgId,itemInteractionStepId:o,itemContactId:n,scrollNode:i,source:l.chatMessageData.source,isRead:l.chatMessageData.isRead,isDIDChat:s});return(0,r.jsx)(Ov,kg(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Lg(e,t,n[t])}))}return e}({message:l},c),{ref:u}))},Fg=function(e){var t=e.messageId,n=e.children,o=Ig().searchResult,i=(0,a.useRef)(null);return(0,a.useEffect)((function(){if(i.current&&o&&o.messageId===t){var e,n,r=null===(e=i.current.querySelectorAll("mark"))||void 0===e?void 0:e[o.index];r.classList.add(Eg);var a=null===(n=i.current.querySelectorAll("mark"))||void 0===n?void 0:n[o.index];return null==a||a.scrollIntoView({block:"center"}),function(){return r.classList.remove(Eg)}}}),[t,o]),(0,r.jsx)("div",{ref:i,"data-message-highlight":t,children:n})},Bg=o().memo((function(e){var t=e.itemId,n=e.contactId,o=e.scrollNode,i=e.messages,s=e.interactionStepId,l=e.messagesContent,c=(0,J.useInteractionProp)(t,(function(e){var t,n;return null!==(n=null==e||null===(t=e.scenarioData)||void 0===t?void 0:t.isDID)&&void 0!==n&&n})),u=(0,a.useCallback)((function(e){if(!vf(e))return null;var a=xf(e),i=l[a];if(!i)return null;var u=e.isSelf||"suggestion"===e.type?"outgoing":"incoming";return(0,r.jsx)(Fg,{messageId:a,children:(0,r.jsx)("div",{"data-message":"true",children:(0,of.isCurrentChatTranscriptMessage)(e)?(0,r.jsx)(Rg,{isDIDChat:c,scrollNode:o,itemContactId:n,itemInteractionStepId:s,direction:u,itemId:t,message:e,content:i.content,isLink:i.isLink,isHtml:i.isHTML}):(0,r.jsx)(Ov,{direction:u,itemId:t,message:e,content:i.content,isLink:i.isLink,isHtml:i.isHTML})})})}),[n,s,c,t,l,o]);return(0,r.jsx)(tv,{itemId:t,contactId:n,type:"transcript",messages:i,renderMessage:u,scrollNode:o},"".concat(t,"_transcript"))}));function Ug(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function zg(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ug(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ug(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Hg=[],Vg=[],Gg=[],Wg=function(e){var t=e.chatMessages,n=void 0===t?Hg:t,o=e.voiceTranscript,i=void 0===o?Vg:o,s=e.botSuggestions,l=void 0===s?Gg:s,c=e.itemId,u=e.className,d=e.filtersClassName,f=(0,Fe.useInteractionUIChatScrollerApi)(c),v=zg((0,a.useState)(null),2),g=v[0],h=v[1],b=(0,J.useInteraction)(c),y=(0,j.getContactId)(b),S=(0,j.getInteractionStepId)(b),x=Mg({voiceTranscript:i,chatMessages:n,botSuggestions:l}),I=function(e,t){var n=Ig().search;return(0,a.useMemo)((function(){return e.reduce((function(e,r){var a=r.format,o=void 0===a?"TEXT":a,i=xf(r),s=r.text;(0,of.isCurrentChatTranscriptMessage)(r)&&(s=(0,p.normalizeByUrlParser)(r.text));var l="TEXT"===o?s:_v({text:r.text,target:t,url:r.suggestionURL||""}),c=(0,dt.highlightHTML)({html:l,textToHighlight:n,className:Ag}),u=(c.match(new RegExp((0,m.escapeRegExp)(Ag),"g"))||[]).length;return e[i]={content:c,marksCount:u,isLink:(0,of.isLinkSuggestion)(r),isHTML:(0,of.isHTMLSuggestion)(r)},e}),{})}),[t,e,n])}(x,c),O=(0,a.useMemo)((function(){return x.map(xf)}),[x]),_=(0,w.useAsRef)(O),C=(0,a.useCallback)((function(){return _.current}),[_]),N=(0,a.useCallback)((function(e){null==f||f.scrollTo(e,"center")}),[f]);return(0,r.jsxs)("div",{className:W("flex h-full flex-col",u),children:[(0,r.jsx)(Ng,{className:d,messagesContent:I,itemId:c}),(0,r.jsx)(q.SelectionContainer,{startFrom:"bottom",className:"mt-1 flex h-0 flex-auto flex-col",itemsListProvider:C,onItemSelect:N,children:(0,r.jsx)("div",{className:"relative mr-1.5 flex-auto overflow-y-auto overflow-x-hidden pl-4 pr-2",ref:h,children:(0,r.jsx)(ym,{messages:x,interactionId:c,scrollContainer:g,children:(0,r.jsx)(Bg,{itemId:c,contactId:y,messages:x,interactionStepId:S,scrollNode:g,messagesContent:I})})})})]})},qg=o().memo((function(e){var t=e.itemId,n=(0,J.useInteractionStateSelector)((function(e){return(0,j.getAssociatedCallItem)({item:e.items.find((function(e){return e.id===t})),items:e.items})})),a=Am(t),o=np(t).messagesList;return n?(0,r.jsx)(jg,{children:(0,r.jsx)(Wg,{botSuggestions:a,voiceTranscript:null==n?void 0:n.voiceTranscript,chatMessages:o,itemId:null==n?void 0:n.id})}):null})),Yg=n(1360),Qg=n(3156);var Kg=o().memo((function(e){var t,n,o=e.disabled,i=(0,Re.useInteractionId)();!function(){var e=(0,Re.useInteractionId)(),t=(0,J.useAssociatedChatInteractionProp)(e,j.getChannel),n=(0,J.useAssociatedChatInteractionProp)(e,(function(e){var t;return null==e||null===(t=e.displayData)||void 0===t?void 0:t.number})),r=(0,J.useAssociatedChatInteractionProp)(e,j.hasMultiplyPhones),o=nf(),i=o.isTouched,s=o.setIsTouched,l=o.channelOptions,c=o.setSelectedChannel,u=(0,a.useMemo)((function(){return t?r?e():l.find((function(e){return e.value===t})):r&&n?e():l.find((function(e){return"sms"===e.value}));function e(){return l.find((function(e){var r;return t&&"sms"!==t?e.value===t:new RegExp(null!==(r=(0,m.escapeRegExp)(n))&&void 0!==r?r:"").test(e.value)}))||l[0]}}),[t,r,n,l]),d=i(e);(0,a.useEffect)((function(){!d&&u&&c(e,u)}),[d,u,e,s,c])}();var s=nf(),l=s.channelOptions,c=s.getSelectedChannel,u=s.getSelectedPhone,d=s.setSelectedChannel,f=u(i),p=c(i);(0,a.useEffect)((function(){!l.length||(null==p?void 0:p.value)&&!l.every((function(e){return e.value!==p.value}))||d(i,l[0])}),[l,i,null==p?void 0:p.value,d]);var v=(0,w.useBoolean)();if((0,w.useEscapeManager)(v.setFalse,{enabled:v.value}),!l.length)return null;var g,h=(0,q.getChannelImageIcon)(null==p?void 0:p.value),b=o||l.length<2&&(null!==(g=null===(n=l[0])||void 0===n||null===(t=n.phones)||void 0===t?void 0:t.length)&&void 0!==g?g:0)<2;return(0,r.jsx)(Te.TriggerDropdown,{open:v.value,onOpenChange:v.toggle,disabled:b,className:"min-w-[168px]",modal:!1,side:"top",onEscapeKeyDown:function(e){e.stopPropagation()},align:"start","data-testid":"channel-selector",options:(0,r.jsx)(r.Fragment,{children:l.map((function(e){var t=function(){var t=(0,q.getChannelImageIcon)(e.value);return(0,r.jsxs)(r.Fragment,{children:[t&&(0,r.jsx)(t,{className:"icon-neutral"}),e.text]})};return e.phones?(0,r.jsxs)(Te.TriggerDropdown.Sub,{children:[(0,r.jsx)(Te.TriggerDropdown.SubTrigger,{contentClassName:"flex items-center gap-2",children:t()}),(0,r.jsx)(Te.TriggerDropdown.SubContent,{children:e.phones.map((function(t){return(0,r.jsx)(Te.TriggerDropdown.Item,{asChild:!1,"data-selected":t.id===(null==f?void 0:f.id),"aria-selected":t.id===(null==f?void 0:f.id),onClick:function(){d(i,e,t.id)},children:(0,r.jsx)(q.PhoneOption,{value:t.phone,type:t.type})},t.id)}))})]},e.value):(0,r.jsx)(Te.TriggerDropdown.Item,{onClick:function(){d(i,e)},asChild:!1,contentClassName:"flex gap-2",children:t()},e.value)}))}),children:(0,r.jsxs)(Te.CircleButton,{className:"group flex w-auto shrink-0 gap-0.5 p-[7.5px]",children:[h&&(0,r.jsx)(h,{}),!b&&(0,r.jsx)(Te.IconArrowDown8,{className:"group-data-[state=open]:rotate-180"})]})})}));function $g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Xg(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||Zg(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Jg(e){return function(e){if(Array.isArray(e))return $g(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Zg(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Zg(e,t){if(e){if("string"==typeof e)return $g(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?$g(e,t):void 0}}function eh(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function th(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return eh(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return eh(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var nh="chat-input",rh=o().memo((function(e){var t,n,o=e.currentMessage,i=e.handleKeyDown,s=e.handleChange,l=e.disabled,c=e.isExternalChat,u=e.interactionStepId,d=e.sendCurrentMessage,f=e.itemId,m=F("isAttachmentsListReady"),p=(0,J.useInteraction)(f);(0,we.assertDefined)(p);var v="potential"===(null==p?void 0:p.itemKind)&&(!p.contactId&&!(null==p||null===(t=p.displayData)||void 0===t?void 0:t.number)),g=(0,$.useLocalizationState)().t,h=function(e,t){var n=t.interactionStepId,r=void 0===n?"":n,o=t.isExternalChat,i=Xg((0,a.useState)(0),2),s=i[0],l=i[1],c=Xg((0,a.useState)(!1),2),u=c[0],d=c[1],f=Xg((0,a.useState)(!1),2),m=f[0],p=f[1],v=(0,te.useInteractionChatStateMethods)(),g=v.sendAgentIsTyping,h=v.sendAgentIsNotTyping;return(0,a.useEffect)((function(){if(o){var e=setInterval((function(){l((function(e){return e+1}))}),1e3);return function(){return clearInterval(e)}}}),[o]),(0,a.useEffect)((function(){var t;if(o)return u||(d(!0),p(!1)),l(0),m||(e.filter(Boolean).length&&g(r),p(!0),t=setTimeout((function(){p(!1)}),5e3)),function(){return clearTimeout(t)}}),Jg(e).concat([o])),(0,a.useEffect)((function(){o&&s>10&&u&&(h(r),d(!1))}),[u,r,h,s,o]),o?function(){d(!1),h(r)}:function(){}}([o],{interactionStepId:u,isExternalChat:c}),b=null===(n=(0,nf().getSelectedChannel)(f))||void 0===n?void 0:n.value.startsWith("sms"),y=function(e){var t=(0,J.useInteractionProp)(e,j.getInteractionStepId),n=F("getAttachmentsList");return(0,a.useMemo)((function(){return n(t)}),[n,t])}(f),S=!m(null!=u?u:"")||(0,j.isAfterCallWork)(p)||v||!o.trim()&&!y.length,x=F("removeAttachment"),I=(0,a.useRef)(null),O=function(e){var t=th((0,a.useState)(!1),2),n=t[0],r=t[1],o=(0,w.useResizeObserver)(e);return(0,a.useEffect)((function(){var e,t;if(o){var n=(e=o.target,t=parseFloat(window.getComputedStyle(e).lineHeight)||0,isNaN(t)?0:t),a=function(e){return e.clientHeight}(o.target);r(a>n)}}),[o]),n}(I);return(0,we.assertDefined)(u),(0,r.jsx)(Te.FieldFrame,{disabled:l,contentClassName:"p-0 overflow-hidden",className:"max-h-36 flex-auto items-end overflow-hidden px-2 py-1.5","data-testid":"chat-text-area",children:(0,r.jsxs)("div",{className:"flex flex-auto flex-col gap-1 overflow-hidden",children:[(0,r.jsx)(q.AttachmentsList,{className:W("flex flex-wrap gap-1 overflow-auto",{"flex-nowrap":O}),list:y,removeAttachment:x,attachmentsListGroupId:u}),(0,r.jsxs)("div",{className:"flex cursor-text items-end overflow-hidden",children:[(0,r.jsx)(q.ContentEditable,{ref:I,"data-testid":"chat-text-area-input",onKeyDown:i,onChange:s,onBlur:h,className:"h-full w-full overflow-auto",placeholder:g.INTERNAL_CHAT.message_input_placeholder(),plainTextOnly:b,"data-id":nh,value:o,disabled:l}),(0,r.jsx)(Te.CircleButton,{className:W("size-6 state-layer-bg-primary-600","hover:state-layer-mix-dark-on-teal-1","focus-visible:state-layer-mix-dark-on-teal-2","active:state-layer-mix-dark-on-teal-3",{"bg-primary-container-disabled":S}),onClick:d,tooltip:{content:g.EXTERNAL_CHAT.send_message_btn_tooltip()},disabled:S,"data-testid":"send-button",children:(0,r.jsx)(Te.IconSendFilled,{className:W("size-4 icon-reversed",{"icon-disabled":S})})})]})]})})}));function ah(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function oh(e,t,n,r,a,o,i){try{var s=e[o](i),l=s.value}catch(c){return void n(c)}s.done?t(l):Promise.resolve(l).then(r,a)}function ih(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){oh(o,r,a,i,s,"next",e)}function s(e){oh(o,r,a,i,s,"throw",e)}i(void 0)}))}}function sh(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ah(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ah(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function lh(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(s){o=[6,s],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var ch=function(e){var t=e.disabled,n=void 0!==t&&t,o=e.chatItem,i=e.buttonElementAtom,s=(0,kr.useSetAtom)(i),l=F(["addAttachment","fileRejections","setFileRejections","isAttachmentsListReady","getAttachmentsList"]),c=l.addAttachment,u=l.fileRejections,d=l.setFileRejections,f=l.isAttachmentsListReady,p=l.getAttachmentsList,v=(0,j.isPotentialInteraction)(o)||(0,j.isCall)(o),g=(0,j.getInteractionStepId)(o),h=(0,$.useLocalizationState)().t,b=(0,ae.useModalComponentOpener)(Fm),y=(0,a.useCallback)((function(e){var t=function(){var t=e.target;return t.files?Array.from(t.files):[]};!function(){var e=t();if(e){var n=(0,m.partial)(Of,h),r=(0,we.truthy)(e.map(n)),a=e.filter((0,w.not)(n));r.length&&b({rejection:r,totalFilesAmount:e.length}),g&&a.forEach((0,m.partial)(c,g))}}()}),[c,g,b,h]);(0,a.useEffect)((function(){f(g)&&u.length&&b({rejection:u,onCloseCallback:function(){return d([])},totalFilesAmount:p(g).length+u.length})}),[u,p,g,f,b,d]),(0,w.useDidUnmount)((function(){s(null),d([])}));var S=zm({chatItem:o}),x=(0,a.useCallback)(ih((function(){return lh(this,(function(e){return v?[2,{selectFiles:S()}]:[2,{selectFiles:!0}]}))})),[S,v]),I=sh((0,a.useState)(null),2),O=I[0],_=I[1];return(0,a.useEffect)((function(){s(O)}),[O,s]),(0,r.jsx)(dh,{ref:function(e){var t,n;t=e,((null!=(n=HTMLButtonElement)&&"undefined"!=typeof Symbol&&n[Symbol.hasInstance]?n[Symbol.hasInstance](t):t instanceof n)||null===e)&&_(e)},onFileInputClick:x,handleUploadFiles:y,isDisabled:n})},uh=o().forwardRef((function(e,t){var n=e.onFileInputClick;return(0,r.jsx)("button",{onClick:n,ref:t,className:"invisible absolute z-[-1] w-0"})})),dh=(0,q.withFileInput)(uh),fh=n(2952),mh=n(3941);function ph(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function vh(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function gh(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function hh(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||yh(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function bh(e){return function(e){if(Array.isArray(e))return vh(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||yh(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function yh(e,t){if(e){if("string"==typeof e)return vh(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?vh(e,t):void 0}}function Sh(e){var t,n,r,o,i,s,l,c=hh((0,kr.useAtom)(Mm),2),u=c[0],d=c[1],p=e.itemId,v=e.serviceId,g=hh((0,kr.useAtom)(Pm),2),b=g[0],y=g[1],S=hh((0,kr.useAtom)(Tm),2),x=S[0],I=S[1],O=(0,K.useNotificationsState)("methods"),_=O.showNotification,C=O.hideNotificationById,N=O.hideNotificationsByTag,A=(0,Oi.useErrorValidation)(),E=nf(),T=E.getSelectedChannel,P=E.getSelectedPhone,M=null===(t=T(p))||void 0===t?void 0:t.value,L=(0,ji.useContactsState)("contacts"),k=(0,ve.useIsOffline)(),D=(0,ve.useOfflineStateMethods)().setShowOfflineAlert,R=(0,$.useLocalizationState)("t").ERROR_MESSAGES,B=(0,J.useInteraction)(p),U=null!==(s=null==B?void 0:B.id)&&void 0!==s?s:"",z=(0,j.getMessengers)(L,B),H=(0,j.getInteractionStepId)(B),V=(0,J.useInteractionStateMethods)().initiateChat,G=(0,te.useInteractionChatStateMethods)(),W=G.sendMessage,Y=G.addMessageToPending,Q=G.sendFile,X=G.openChannel,Z=(0,Fe.useInteractionUIState)(),ee=Z.getItemState,ne=Z.setItemState,re=F(["clearAttachmentsList","getAttachmentsList","isAttachmentsListReady"]),ae=re.clearAttachmentsList,oe=re.getAttachmentsList,ie=re.isAttachmentsListReady,se=(0,h.useServiceState)().selectedService,le=(0,fh.useDidState)("didNumbers"),ce=(0,Ii.useDIDNumberState)().selectedDIDNumber,ue=(0,j.isCall)(B)&&(null==B||null===(n=B.callData)||void 0===n?void 0:n.incoming)?B.callData.fromNumber:null==B||null===(r=B.callData)||void 0===r?void 0:r.destination,de=(null===(o=P(p))||void 0===o?void 0:o.phone)||(0,j.getPhoneFromItem)(B),fe=ue===de,me=(0,a.useMemo)((function(){if((0,j.isCall)(B))if((0,j.isOutboundInteraction)(B)){var e,t=(null==B?void 0:B.accessNumberId)&&(null===(e=le[B.accessNumberId])||void 0===e?void 0:e.isSMS);if(fe&&t)return B.accessNumberId}else{var n,r;if((null==B||null===(n=B.scenarioData)||void 0===n?void 0:n.isDID)&&(!ce||(null===(r=le[ce])||void 0===r?void 0:r.isSMS))){var a=!0,o=!1,i=void 0;try{for(var s,l=Object.keys(le)[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value;if(le[c].isSMS)return c}}catch(u){o=!0,i=u}finally{try{a||null==l.return||l.return()}finally{if(o)throw i}}}}return ce}),[B,le,fe,ce]),pe=(0,j.getServiceId)(B),ge=v||(fe?pe:se),he=(0,Ve.useServicesDispositionsState)().services,be=(0,j.getAssociatedChatServiceId)(he,ge)||(0,j.getAssociatedChatServiceId)(he,se),ye=null!==(l=null===(i=ee(U))||void 0===i?void 0:i.chatMessage)&&void 0!==l?l:"",Se=oe(H),xe=(0,a.useCallback)((function(e){ne(U,f()((function(t){t.chatMessage="string"==typeof e?e:e(t.chatMessage)})))}),[U,ne]),je=(0,a.useCallback)((function(){!k&&xe("")}),[k,xe]),Ie=(0,a.useCallback)((function(){var e,t=(0,m.get)(B,"contactId"),n=(null==z||null===(e=z.find((function(e){return e.type===M})))||void 0===e?void 0:e.userId)||de;if(n&&M)return Y({content:ye,channel:M,type:"message"},n),V({channel:M,address:n,serviceId:be,accessNumberId:me,contactId:t,displayData:null==B?void 0:B.displayData,origination:"interaction"}),je()}),[M,B,z,de,Y,ye,V,be,me,je]),Oe=(0,a.useCallback)((function(){if((0,j.isExternalChat)(B))ie(H)&&(ye&&W({content:(0,dt.condenseNewLines)(ye),itemId:H,channel:M,type:"message"}),Se.length&&(Se.forEach((function(e){e.fileData&&Q({fileData:e.fileData,itemId:H,channel:M||"sms"})})),ae(H)),je());else{var e,t=(null==z||null===(e=z.find((function(e){return e.type===M})))||void 0===e?void 0:e.userId)||de;ge&&B&&be&&M&&t&&(Y({content:ye,channel:M,type:"message"},t),V({channel:M,address:t,serviceId:be,contactId:B.contactId,displayData:B.displayData,accessNumberId:me,origination:"interaction"})),je()}}),[de,z,M,B,ie,H,ye,Se,je,W,ae,Q,ge,be,Y,V,me]),_e=(0,a.useCallback)((function(){if(ye.startsWith("/invite")){var e=ye.split(" ");if(2!==e.length)_({id:K.Notifications.ChatChannelInviteBadFormatError,type:"error",message:R.chat_channel_invite_bad_format(),tags:["current-view"],duration:3e4,closable:!0});else{var t=e[1];if(mh.messengerTypes.includes(t)){var n;C(K.Notifications.ChatChannelInviteBadFormatError),C(K.Notifications.ChatChannelInviteUnknownMessengerError);var r=(null==z||null===(n=z.find((function(e){return e.type===t})))||void 0===n?void 0:n.userId)||de;pe&&r&&X({channel:t,address:r,interactionStepId:H,serviceId:pe}),je()}else _({id:K.Notifications.ChatChannelInviteUnknownMessengerError,type:"error",tags:["current-view"],message:R.chat_channel_invite_unknown_messenger(),duration:3e4,closable:!0})}return!0}}),[z,ye,C,H,pe,X,de,_,je,R]),Ce=(0,a.useCallback)((function(){if(k)D(!0);else{if(ye){var e,t=null===(e=ee(p))||void 0===e?void 0:e.scrollerApi;null==t||t.scrollToLast()}if((0,j.isPotentialInteraction)(B)||(0,j.isCall)(B)){var n=bh(A.getServiceAndDIDNumbersErrors({service:ge,didNumber:me,interactionType:"sms"})).concat(bh(A.getChannelError({selectedChannel:M})));if(n.length)return void _(n[0]);if(ye){var r=A.getMessageErrors({message:ye,channel:M||"sms"});if(r.length)return void _(r[0])}return N("interaction-init"),ye&&Ie()}var a=A.getMessageErrors({message:ye,channel:M||"sms"});if(a.length)_(a[0]);else if(H){if(_e())return;return(ye||Se.length)&&Oe()}}}),[k,ye,B,M,A,H,D,ee,p,ge,me,N,Ie,_,Se.length,Oe,_e]),we=(0,w.useEvent)((function(e){xe((function(t){return t.slice(0,b)+e+t.slice(b+1,x.length)})),I(""),d(void 0);var t=document.querySelector('[data-testid="chat-text-area-input"]');gh(t,HTMLElement)&&setTimeout((function(){t.focus(),-1===b?(0,q.moveCursorToTheEnd)(t):(0,q.setCursorPosition)(t,b+e.length)}))})),Ne=(0,a.useCallback)((function(e){var t=function(){d(void 0),y(-1),I("")},n=gh(e.target,HTMLElement)?e.target:void 0;if(n){var r=(0,q.getCursorPosition)(n);if(";"===e.key&&(y(r),d("predefinedMessages"))," "===e.key&&r-1===b&&t(),"Escape"===e.key&&"predefinedMessages"===u&&(t(),e.preventDefault(),e.stopPropagation()),"Enter"===e.key){if(e.shiftKey||e.ctrlKey)return;e.preventDefault(),e.stopPropagation(),Ce()}}}),[u,d,b,Ce,I,y]),Ae=(0,a.useCallback)((function(e,t){var n=e.target;if((0,dt.isHTMLElement)(n)){n.scrollTop=n.scrollHeight;var r=(0,q.getCursorPosition)(n);xe(t),x&&r<=b?(d(void 0),I("")):I("predefinedMessages"===u?t.slice(b+1):"")}}),[u,x,b,d,xe,I]),Ee=function(e,t){return(0,a.useCallback)((function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){return e};return function(r){var a=document.querySelector(t);(0,m.flow)(n,(function(n){var r=0,o=null;return e((function(e){var i,s,l,c,u,d,f,m=function(e){return e.getFirstNode()!==e.getLastNode()},p=function(e){return e.getSelectionStartIndex()!==e.getSelectionEndIndex()},v=new w.Selection,g=null==v?void 0:v.getLastNode(),h=(null==g?void 0:g.nodeType)===Node.TEXT_NODE?null==g?void 0:g.parentElement:g,b=null==h?void 0:h.closest(t);return a?(e="<br><br>"===e.substring(e.length-8)?e.substring(0,e.length-4):e,b?v&&g?(function(e){var t;if(m(e))r=null!==(t=e.getSelectionStartIndex())&&void 0!==t?t:0,o=e.getFirstNode();else if(p(e)){var n;r=null!==(n=e.getSelectionStartIndex())&&void 0!==n?n:0,o=e.getFirstNode()}else{var a;r=null!==(a=e.getSelectionEndIndex())&&void 0!==a?a:0,o=e.getLastNode()}}(v),(m(f=v)||p(f))&&f.deleteSelected(),o&&(c=r,d=null!==(u=null==(l=o)?void 0:l.textContent)&&void 0!==u?u:"",l.textContent=(null==d?void 0:d.slice(0,c))+n+(null==d?void 0:d.slice(c))),null!==(s=null===(i=document.querySelector(t))||void 0===i?void 0:i.innerHTML)&&void 0!==s?s:e):e:e+n):e+n})),{nodeToFocus:o,offsetToFocus:r,dataToAdd:n}}),(function(e){var t=e.nodeToFocus,n=e.offsetToFocus,r=e.dataToAdd;ph(a,HTMLElement)&&(a.focus(),requestAnimationFrame((function(){var e=function(){a&&(t?o(t):a.lastChild&&i(a.lastChild))},o=function(e){var t,a,o=document.createRange();o.setStart(e,n+r.length),o.setEnd(e,n+r.length),null===(t=window.getSelection())||void 0===t||t.removeAllRanges(),null===(a=window.getSelection())||void 0===a||a.addRange(o)},i=function(e){var t,n,r,a,o,i,s=document.createRange();s.setStart(e,null!==(o=null===(t=e.textContent)||void 0===t?void 0:t.length)&&void 0!==o?o:0),s.setEnd(e,null!==(i=null===(n=e.textContent)||void 0===n?void 0:n.length)&&void 0!==i?i:0),null===(r=window.getSelection())||void 0===r||r.removeAllRanges(),null===(a=window.getSelection())||void 0===a||a.addRange(s)};e(),requestAnimationFrame(e)})))}))(r)}}),[t,e])}(xe,'[data-id="'.concat(nh,'"]'));return(0,a.useMemo)((function(){return{handleSelectPredefinedMessage:we,sendCurrentMessage:Ce,handleKeyDown:Ne,currentMessage:ye,setCurrentMessage:xe,handleTextareaChange:Ae,setPredefinedMessagesSearch:I,predefinedMessagesSearch:x,updateMessage:Ee}}),[we,x,I,ye,xe,Ae,Ce,Ne,Ee])}function xh(e,t,n,r,a,o,i){try{var s=e[o](i),l=s.value}catch(c){return void n(c)}s.done?t(l):Promise.resolve(l).then(r,a)}function jh(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(s){o=[6,s],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function Ih(e){var t,n,r=e.itemId,a=e.setCurrentMessage,o=(0,kr.useAtomValue)(Lm),i=(0,Gf.useOpenInteractionSlidingModal)(),s=(0,kr.useSetAtom)(Mm),c=(0,kr.useSetAtom)(Pm),u=(0,$.useLocalizationState)("t"),d="mac"===le.platformInfo.platform?"\u2318":"Ctrl",f=(0,l.useMainPageUIState)("setKBFloatingState"),m=(0,Oe.useIsCommunicator)(),p=(0,jd.useKbBridgeMethods)().setupInteractionKB,v=(t=function(){return jh(this,(function(e){return m?i(r,"knowledgeBase"):(f((function(e){return"closed"===e?"floating":e})),p()),[2]}))},n=function(){var e=this,n=arguments;return new Promise((function(r,a){var o=t.apply(e,n);function i(e){xh(o,r,a,i,s,"next",e)}function s(e){xh(o,r,a,i,s,"throw",e)}i(void 0)}))},function(){return n.apply(this,arguments)});return[{Icon:Te.IconSentimentGood,text:u.EXTERNAL_CHAT.add_emoji(),shortcut:"".concat(d,"E"),onClick:function(){s("emojiPicker")}},{Icon:Te.IconAttachment,text:u.EXTERNAL_CHAT.attachment(),shortcut:"".concat(d,"A"),onClick:function(){return null==o?void 0:o.click()}},{Icon:Te.IconPredefinedMessage,text:u.EXTERNAL_CHAT.predefined_messages(),shortcut:";",onClick:function(){var e,t,n=document.querySelector('[data-testid="chat-text-area-input"]');e=n,(null!=(t=HTMLElement)&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t)&&(c(n.innerHTML.length),a((function(e){return e+";"})),n.focus(),setTimeout((function(){(0,q.moveCursorToTheEnd)(n)}))),s("predefinedMessages")}},{Icon:Te.IconKnowledgeBase,text:u.EXTERNAL_CHAT.knowledge_base(),shortcut:"".concat(d,"K"),onClick:v}]}var Oh=n(7087);var _h=n(1539);const Ch="agent_ChatForm_smsMessageCounter_MlvOG";function wh(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Nh(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return wh(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return wh(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ah(){var e,t,n=document.querySelector('[data-testid="chat-content"]');if(e=n,null!=(t=HTMLElement)&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t)return n}var Eh=o().memo((function(e){var t=e.itemId,n=e.serviceId,o=(0,De.useCommunicatorUIState)("interactionChatFormRef"),i=(0,Re.useNonAssertedInteractionId)(),s=Sh({itemId:t,serviceId:n}),l=s.updateMessage,c=s.handleSelectPredefinedMessage,u=s.sendCurrentMessage,d=s.handleKeyDown,f=s.handleTextareaChange,m=s.setCurrentMessage,p=s.currentMessage,v=(0,kr.useAtomValue)(Tm);!function(e){var t=e.currentMessage,n=e.setCurrentMessage,r=e.itemId,o=e.parseVariables,i=(0,K.useNotificationsState)("methods").hideNotificationsByTag,s=(0,J.useInteractionProp)(r,(function(e){return(0,j.isExternalChat)(e)&&(0,j.isInboundInteraction)(e)})),l=(0,Oh.usePredefinedChatMessageState)().greetings,c=(0,Oh.usePredefinedChatMessageStateMethods)().resetGreeting;(0,a.useEffect)((function(){t?c(r):l[r]&&s&&(n(o(l[r])),c(r))}),[r,t,l,i,o,c,n,s])}({currentMessage:p,setCurrentMessage:m,itemId:t,parseVariables:(0,ce.useChatResponsesVariablesParser)()});var g=(0,J.useInteractionProp)(t,j.getInteractionStepId),h=(0,J.useInteractionProp)(t,j.isExternalChat),b=function(e,t){var n,r=(0,he.useAppConfigState)().enableSmsCharacterCount,o=(0,$.useLocalizationState)().t,i=null===(n=(0,nf().getSelectedChannel)(e))||void 0===n?void 0:n.value;return(0,a.useMemo)((function(){if(!r||(null==i?void 0:i.startsWith("sms")))return{enabled:!1,text:""};var e=(0,_h.getCharCount)(t),n=e.msgCount,a=e.charCount,s=e.charsPerSegment;return{enabled:!0,text:1===n?"".concat(a,"/").concat(s):a<1e3?"".concat(a," (").concat(o.EXTERNAL_CHAT.sms_messages_number(n),")"):String(a)}}),[r,i,t,o.EXTERNAL_CHAT])}(t,p),y=b.text,S=b.enabled,x=(0,w.useResizeObserver)(Ah()),I=Nh((0,kr.useAtom)(Mm),2),O=I[0],_=I[1],C=(0,J.useAssociatedChatInteraction)(t);(0,we.assertDefined)(C);var N,A=Ih({setCurrentMessage:m,itemId:t}),E=(0,w.useBoolean)();return(0,w.useEscapeManager)((function(){E.setFalse()}),{enabled:E.value}),(0,w.useEscapeManager)((function(){_(void 0)}),{enabled:Boolean(O)}),(0,r.jsxs)("div",{ref:o,className:"flex px-4 py-2.5","data-testid":"chat-bottom-panel",children:[(0,r.jsx)(ch,{chatItem:C,buttonElementAtom:Lm}),S&&(0,r.jsx)("span",{className:Ch,children:y}),(0,r.jsxs)("div",{className:"flex flex-auto items-end gap-2",children:[(0,r.jsxs)("div",{className:"flex h-[33px] items-center gap-2",children:[!!i&&(0,r.jsx)(Kg,{}),(0,r.jsx)(Te.TriggerDropdown,{"data-chat-actions-menu":!0,modal:!1,open:E.value,onOpenChange:E.toggle,className:"group z-10",align:"start",side:"top",options:A.map((function(e){var t=e.Icon,n=e.text,a=e.shortcut,o=e.onClick;return(0,r.jsxs)("button",{onClick:o,className:"flex w-full min-w-[210px] items-center gap-2",children:[(0,r.jsx)(t,{className:"size-4"}),(0,r.jsx)("p",{className:"flex-auto caption-s text-primary-on-primary",children:n}),(0,r.jsx)("p",{className:"caption-s text-neutral-disabled",children:a})]},n)})),children:(0,r.jsx)(Te.CircleButton,{children:(0,r.jsx)(Te.IconPlus24,{className:"size-4.5"})})})]}),(0,r.jsxs)(Yg.Root,{open:Boolean(O),onOpenChange:function(e){e||_(void 0)},children:[(0,r.jsx)(Yg.Trigger,{asChild:!0,className:"flex flex-auto",onClick:function(e){e.preventDefault()},children:(0,r.jsx)("div",{children:(0,r.jsx)(rh,{itemId:t,sendCurrentMessage:u,interactionStepId:g,isExternalChat:h,currentMessage:p,handleKeyDown:d,handleChange:f})})}),(0,r.jsx)(Yg.Content,{side:"top",align:"start",className:"z-[100] w-[--radix-popover-trigger-width]",sideOffset:5,onOpenAutoFocus:function(e){e.preventDefault()},children:"emojiPicker"===O?(0,r.jsx)(q.EmojiPopup,{onSelectEmoji:function(e){l((function(e){return e}))(e),_(void 0)}}):"predefinedMessages"===O?(0,r.jsx)(Qg.ViewPredefinedMessages,{handleSelect:c,search:v,className:"w-[--radix-popover-trigger-width]",style:{maxHeight:(null!==(N=null==x?void 0:x.contentRect.height)&&void 0!==N?N:0)-19}}):null})]})]})]})}));function Th(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ph(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Th(e,t,n[t])}))}return e}var Mh=o().memo((function(e){var t=e.itemId,n=function(e){var t=(0,C.useSessionState)().privileges,n=(0,J.useInteractionProp)(e,j.isPotentialInteraction),r=(0,J.useInteractionProp)(e,j.isQualityManagementItemInMonitorMode),o=(0,J.useInteractionProp)(e,(function(e){return(0,j.isExternalContactCall)(e)&&((0,j.isDelivered)(e)||(0,j.isOnHold)(e))})),i=(0,J.useInteractionProp)(e,(function(e){return(0,j.isExternalChat)(e)&&((0,j.isDelivered)(e)||(0,j.isOnHold)(e))})),s=(0,J.useInteractionProp)(e,(function(e){return(0,j.isExternalChat)(e)&&(0,j.isOutboundInteraction)(e)})),l=(0,J.useInteractionProp)(e,j.isAfterCallWork),c=(0,J.useInteractionProp)(e,j.isNeedToShowWorkitemUI);return(0,a.useMemo)((function(){return!r&&!l&&!c&&(!(!s&&!i)||((null==t?void 0:t.CAN_START_EXTERNAL_CHAT)?n||o:void 0))}),[r,l,c,o,i,s,n,null==t?void 0:t.CAN_START_EXTERNAL_CHAT])}(t),o=Am(t),i=(0,Fe.useInteractionUIChatType)(t),s=(0,J.useInteractionProp)(t,j.getContactId),l=(0,ji.useContactsState)((function(e){var t,n;return null===(n=e.activityHistory[s])||void 0===n||null===(t=n.activityCreatedTimeByMedia)||void 0===t?void 0:t[function(e){switch(e){case"messages":return"chat";case"calls":return"voice";default:return"all"}}(i)]})),c=Dp(0,s,i);(0,a.useEffect)((function(){l||c()}),[l,c]);var u=function(e){var t=(0,p.useContactActivityHistory)(),n=t.isLoading,r=t.messages,a=n&&!r.length,o=(0,Qs.useActivitiesState)("activitiesListByContactId")[e],i=!!(null==o?void 0:o.isLoading),s=i&&!(null==o?void 0:o.data.length);return{isLoading:n||i,isInitialLoading:a||s}}(s),d=u.isLoading,f=u.isInitialLoading,m=(0,a.useMemo)((function(){return"transcript"===i?qg:vg}),[i]);return(0,a.useEffect)((function(){return function(){(0,af.unmountPlayers)({playerGroup:rf.CHAT_VOICE_RECORDING_PLAYER_GROUP})}}),[]),function(e,t,n){var r=(0,J.useInteractionProp)(e,(function(e){return null==e?void 0:e.openedBotSuggestionsUrls})),o=(0,a.useCallback)((function(e){return null==t?void 0:t.filter((function(t){return(0,of.isLinkSuggestion)(t)&&t.autoOpenURL&&!(null==e?void 0:e[t.suggestionURL])}))}),[t]),i=lf(e);(0,a.useEffect)((function(){!function(){if(n){var e=o(r);null==e||e.forEach(i)}}()}),[r,n,o,i])}(t,o,"all"===i||"transcript"===i||"messages"===i),(0,r.jsxs)("div",{className:"relative flex flex-1 flex-col justify-between overflow-hidden",children:[(0,r.jsxs)("div",{className:"relative flex flex-auto flex-col overflow-hidden bg-secondary-background","data-testid":"chat-content",children:[!f&&d&&(0,r.jsx)(Te.Loader,{size:"32",className:"top-[30px] z-10",color:"primary"}),f?(0,r.jsx)(Te.Loader,{size:"32",color:"primary",className:"z-10"}):(0,r.jsx)(m,Ph({},e))]}),n&&(0,r.jsx)(Eh,Ph({},e))]})})),Lh=(0,q.createComponentLoader)("chatCenter",(function(){return n.e(975).then(n.t.bind(n,9975,23))}),"ChatCenterInteraction").ChatCenterInteractionLoader,kh=o().memo((function(e){var t=e.itemId,n=e.scope,a=(0,J.useInteraction)(t);return Boolean(a&&(a.groupChatId||a.groupChatMembers||a.userId))?(0,r.jsx)(Lh,{scope:n,interactionId:t}):(0,r.jsx)(Mh,{itemId:t})}));const Dh="agent_ChatWindow_window_Z39HC",Rh="agent_ChatWindow_resizer_z1QUX",Fh="agent_ChatWindow_windowMinimized_idVjI",Bh="agent_ChatWindow_resizerMinimized_Z5dsd",Uh="agent_ChatWindow_avatar_KLnEP";function zh(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Hh(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Vh(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Hh(e,t,n[t])}))}return e}function Gh(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Wh(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return zh(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return zh(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var qh=function(e){var t=e.itemId,n=(0,J.useInteraction)(t),o=Wh((0,a.useState)(383),2),i=o[0],s=o[1],c=(0,J.useInteractionStateMethods)().activateItem,u=(0,Fe.useInteractionUIState)().setItemState,d=(0,l.useCommunicatorFloatingStateSetter)(),f=(0,w.useBoolean)(),m=f.value,p=f.toggle,v=(0,un.useGetUserPictureUrl)(),g=(0,Dr.useLocalSettings)();(0,a.useEffect)((function(){g.get("adChatPopupHeight").then((function(e){"number"==typeof e&&s(e)}))}),[g]);var h,b=(0,a.useCallback)((function(e){var t=e.size;g.set("adChatPopupHeight",t)}),[g]),y=(0,a.useMemo)((function(){return{id:"chat-in-window",direction:"top",minSize:383,onDragEnd:b,initialSize:i,containerClass:m?Fh:Dh,borderClass:m?Bh:Rh}}),[i,m,b]),S=(0,a.useCallback)((function(){u(t,(function(e){return Gh(Vh({},e),{chatView:"embedded"})}))}),[t,u]),x=(0,a.useCallback)((function(){S(),d((function(e){return"closed"===e?"floating":e})),c(t)}),[c,t,S,d]),I=(0,a.useMemo)((function(){var e=(0,j.getUserId)(n),t=!!e,a=(0,j.getFirstAndLastName)(n),o=v(e);return(0,r.jsx)(Hs.AvatarLegacy,Vh({className:Uh,url:o,headPhones:t,smallerWithHeadphones:!0,type:t?"user":"contact"},a))}),[v,n]);return(0,r.jsx)(q.Window,{resizeable:y,onMinimize:p,onClose:S,onRestore:x,minimized:m,title:null!==(h=null==n?void 0:n.displayData.displayName)&&void 0!==h?h:"",icon:I,children:(0,r.jsx)(kh,{itemId:t,scope:"chatWindow"})})};function Yh(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Qh(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var Kh=function(){var e=(0,C.useSessionState)(["privileges","navigationData"]),t=e.privileges,n=e.navigationData,o=(0,Oe.useBrowserTabMetaInfo)(),i=null==o?void 0:o.app,l=(0,a.useMemo)((function(){return Object.values(Dd).filter((function(e){var n=e.checkPrivileges;return!n||n(t)}))}),[t]),u=(0,a.useMemo)((function(){if(!!!Object.values(t).length||!n)return null;var e=l.find((function(e){return e.path===n.route[i]}));return e||Dd[c.AppRoutes.home]}),[l,i,n,t]);return(0,r.jsxs)(s.Routes,{children:[l.map((function(e,t){var n=e.allowSubRoutes,a=e.path,o=Qh(e,["allowSubRoutes","path"]);return(0,r.jsx)(s.Route,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Yh(e,t,n[t])}))}return e}({path:"".concat(a).concat(n?"/*":"")},o),t)})),u&&(0,r.jsx)(s.Route,{path:"*",element:(0,r.jsx)(s.Navigate,{to:u.path})})]})},$h=(0,q.createComponentLoader)("knowledgeBase",n.e(330).then(n.t.bind(n,2330,23)),"KBPage").KBPageLoader,Xh={autoOpenInteractionTab:!0,dualView:!1,multiTabs:!0,topHeader:!0},Jh=function(){var e=(0,$.useLocalizationState)().t,t=(0,l.useMainPageUIState)(["kbFloatingState","kbWidth","setKBFloatingState","setKBWidth","mainContentNode"]),n=t.kbFloatingState,a=t.kbWidth,o=t.mainContentNode,i=t.setKBFloatingState,s=t.setKBWidth,c=(0,q.useCanPin)({mainContentNode:o,floatingState:n,floatingSize:a,contentMinWidth:l.MAIN_CONTENT_MIN_WIDTH}),u=(0,r.jsx)(cl.Button,{flat:!0,icon:!0,onClick:function(){i("floating"===n?"pinned":"floating")},className:"ml-2",tooltip:"floating"===n?e.KNOWLEDGE_BASE.pin_tooltip():e.KNOWLEDGE_BASE.unpin_tooltip(),tooltipPlacement:"bottom-end",variant:"ghost",children:"pinned"===n?(0,r.jsx)(Te.IconPinFilled20,{}):(0,r.jsx)(Te.IconPin20,{})}),d="closed"===n?Te.IconChevronLeft16:Te.IconChevronRight16,f=(0,jd.useKbBridge)("settings"),m=(0,jd.useKbBridgeConnector)();return(0,jd.assertKBBridgeInterface)(m),(null==f?void 0:f.kbEnabled)?(0,r.jsx)(q.Floating,{canPin:c,className:"h-full",closeByEscape:"floating"===n,"data-testid":"kb-panel",exceptionSelectors:".tox",earIcon:d,earClassName:"top-6 h-10 w-8",initialSize:a,minSize:l.MIN_KB_WIDTH,onDragEnd:function(e){var t=e.size;s(t)},resizeable:!0,setState:function(){i("closed"===n?"floating":"closed")},side:"right",state:n,children:(0,r.jsx)($h,{features:Xh,kbBridge:m,pinButton:u})}):null},Zh=[c.AppRoutes.campaigns,c.AppRoutes.knowledgeBase,c.AppRoutes.oldOmniQm,c.AppRoutes.omniQm,c.AppRoutes.supervision],eb=(0,q.createComponentLoader)("supervision",(function(){return n.e(205).then(n.t.bind(n,3205,23))}),"RightBar").RightBarLoader,tb=function(){return(0,r.jsxs)(s.Routes,{children:[(0,r.jsx)(s.Route,{path:c.AppRoutes.supervision,Component:eb}),Zh.map((function(e){return(0,r.jsx)(s.Route,{path:e,Component:null},e)})),(0,r.jsx)(s.Route,{path:"*",Component:Jh})]})},nb=(0,q.createComponentLoader)("calendar",(function(){return n.e(662).then(n.t.bind(n,5662,23))}),"CalendarModalsAutoOpener").CalendarModalsAutoOpenerLoader,rb=function(){var e,t,n,o,i,s,u,d=(0,l.useMainPageUIState)("setMainContentNode"),f=(0,b.useSupervisionUIContext)("setMainContentNode"),m=(0,l.useMainPageUIState)((function(e){return"closed"!==e.communicator.floatingState}));$l(),xe(),(0,Dr.useAppDefaultSettings)({modals:Jl}),uc(),(0,ce.useIncomingChatMessageAudioNotifications)(m),e=(0,C.useSessionState)("privileges"),(0,a.useMemo)((function(){Object.values(Dd).forEach((function(t){var n,r;(null===(n=t.checkPrivileges)||void 0===n?void 0:n.call(t,e))&&(null===(r=t.load)||void 0===r||r.call(t))}))}),[e]),t=(0,l.useInteractionWorkspaceState)().shownWorkspaceTabs,n=(0,c.useNavigationState)(),o=n.getLocation,i=n.getParams,s=n.goTo,u=!!t,(0,a.useEffect)((function(){var e=o(),t=i(),n=e===c.AppRoutes.interactionWorkspace;if(n||!u){if(n&&!u){var r=t.returnUrl||"/";s(String(r))}}else s(c.AppRoutes.interactionWorkspace,{returnUrl:e})}),[u,s,o,i]),(0,Xl.useInteractionModalsAutoOpener)();var p=(0,Fe.useInteractionPopupItemIdSelector)();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(Xd,{}),(0,r.jsxs)("div",{className:Hd,ref:function(e){d(e),f(e)},children:[(0,r.jsx)(Kh,{}),(0,r.jsx)("div",{className:Gd,"data-incoming-messages-modals-parent-node":"true"})]}),(0,r.jsx)(tb,{}),p&&(0,r.jsx)(qh,{itemId:p}),(0,r.jsx)(nb,{})]})};function ab(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ob(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ab(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ab(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var ib=Number("0.".concat(l.MAX_COMMUNICATOR_WIDTH_IN_PERCENT)),sb=o().memo((function(e){var t=ob((0,a.useState)(null),2),n=t[0],o=t[1],i=(0,w.useResizeObserver)(n),s=(0,c.useNavigationState)("getLocation"),u=ob((0,kr.useAtom)(Fe.parallelItemsAtom),2),d=u[0],f=u[1],m=null==i?void 0:i.contentRect.width,p=(0,l.useCommunicatorUIState)((function(e){return e.setParallelInteractionsWidth})),v=(0,kr.useSetAtom)(Fe.parallelItemsHaveEnoughSpaceAtom);return(0,a.useEffect)((function(){if(m){var e=m*ib>(d.filter((function(e){return e.activeItemId})).length+2)*l.MIN_COMMUNICATOR_WIDTH;v(e)}}),[m,s,d,d.length,v]),(0,a.useEffect)((function(){if(s()===c.AppRoutes.interactionWorkspace&&d.length&&m&&m*ib<(d.length+1)*l.MIN_COMMUNICATOR_WIDTH){var e=d.length-1;f({type:"remove",payload:{index:e}}),p((function(e){return e-l.MIN_COMMUNICATOR_WIDTH}))}}),[m,s,d,d.length,f,p]),(0,r.jsx)("div",{ref:o,className:"relative flex h-full flex-auto justify-start overflow-hidden","data-testid":"main-page",children:e.children})})),lb=n(1549),cb=n(7043),ub=function(e){var t=e.children,n=(0,$.useLocalizationState)().t,o=(0,l.useCommunicatorUIState)(),i=o.floatingState,s=o.setFloatingState,c=o.openerRef,u=(0,a.useCallback)((function(){s((function(e){return"closed"===e?"floating":"closed"}))}),[s]);return(0,r.jsxs)(q.Button,{ref:c,tooltip:n.UNDEFINED.navigation_acl_tooltip(),"data-testid":"communication_panel_leftbar_btn",transparent:!0,className:W(gb.button.base,"mb-2 shrink-0"),onClick:u,children:[(0,r.jsx)("div",{className:gb.button.icon(),children:"closed"!==i?(0,r.jsx)(Te.IconPanelShow24,{}):(0,r.jsx)(Te.IconPanelHide24,{})}),t]})},db=n(4554);var fb=n(6446);function mb(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function pb(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function vb(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var gb={base:W("relative flex h-full w-[76px] shrink-0 flex-col items-center overflow-hidden px-1","border-r border-r-neutral-100 bg-[--c-main-bars-bg]"),button:{base:W("relative mb-px flex flex-col items-center justify-center rounded","text-primary-850 caption-xs","transition-colors","group"),icon:function(e){return W("flex size-[44px] shrink-0 items-center justify-center","rounded","transition-colors state-layer-bg-neutral-0","[&_path]:transition-colors","group-hover:state-layer-color-black group-hover:state-layer-opacity-4",{"state-layer-bg-primary-600 svg-color-neutral-0":"active"===e},{"svg-color-neutral-400":"disabled"===e})}},unreadBadge:W("absolute bottom-5 right-2 leading-[16px]")},hb=function(){var e,t,n,o,i,u,d,f,m,p,v,g=(e=(0,te.useChatUnread)(),t=(0,J.useInteractions)(),n=(0,a.useMemo)((function(){return t.filter(j.isInternalChat).map((function(e){return e.id}))}),[t]),e+(0,db.useGroupChatTotalUnread)((function(e){return n.includes(e.chatId)}))),h=(o=(0,$.useLocalizationState)("t"),i=(0,C.useSessionState)("privileges"),u=(0,l.useInteractionWorkspaceState)().shownWorkspaceTabs,d=(0,jd.useKbBridge)().settings,f=!!(null==u?void 0:u.length),m=(0,db.useUnreadGroupChatsQuantity)(),p=Boolean((0,s.useMatch)({path:c.AppRoutes.supervision,end:!1})),v=(0,fb.useStatsState)((function(e){return p?0:e.intentAlerts.filter((function(e){return!e.closed})).length})),(0,a.useMemo)((function(){return[{route:c.AppRoutes.interactionWorkspace,title:o.NAV_BAR.page_title_context(),icon:(0,r.jsx)(Te.IconContext,{}),disabled:!f,testId:"context-link"},{route:c.AppRoutes.calendar,title:o.NAV_BAR.page_title_calendar(),icon:(0,r.jsx)(Te.IconCalendar,{}),testId:"calendar-link"},{route:c.AppRoutes.cases,title:o.NAV_BAR.page_title_cases(),icon:(0,r.jsx)(Te.IconCases,{}),testId:"cases-link"},{route:c.AppRoutes.search,title:o.NAV_BAR.page_title_contacts(),icon:(0,r.jsx)(Te.IconContacts,{}),testId:"search-link"},{route:c.AppRoutes.campaigns,title:o.NAV_BAR.page_title_campaigns(),icon:(0,r.jsx)(Te.IconCampaigns,{}),testId:"campaigns-link"},{route:c.AppRoutes.supervision,title:o.NAV_BAR.page_title_supervisor(),icon:(0,r.jsx)(Te.IconSupervisor,{}),badge:(0,r.jsx)(q.UnreadBadge,{unreadAmount:v,className:gb.unreadBadge}),testId:"supervision-link"},{route:c.AppRoutes.chat,title:o.NAV_BAR.page_title_internal_chat(),icon:(0,r.jsx)(Te.IconChat,{}),badge:(0,r.jsx)(q.UnreadBadge,{unreadAmount:m,className:gb.unreadBadge}),testId:"chat-center-link"},{route:c.AppRoutes.omniQm,title:o.NAV_BAR.page_title_omni_qm(),icon:(0,r.jsx)(Te.IconOmniQualityManagement,{}),testId:"omni-qm-link"},{route:c.AppRoutes.knowledgeBase,title:o.NAV_BAR.page_title_kb(),titleFull:o.NAV_BAR.page_title_kb_full(),icon:(0,r.jsx)(Te.IconKnowledgeBase,{}),testId:"knowledge-base-link",hidden:!(null==d?void 0:d.kbEnabled)},{route:c.AppRoutes.home,title:o.NAV_BAR.page_title_home_page(),icon:(0,r.jsx)(Te.IconHomePage,{}),testId:"home-link"}].filter((function(e){if(e.hidden)return!1;var t=Dd[e.route].checkPrivileges;return!t||t(i)}))}),[o.NAV_BAR,f,v,m,i,null==d?void 0:d.kbEnabled]));return(0,r.jsxs)("div",{className:gb.base,"data-testid":"leftbar",children:[(0,r.jsx)(cb.ActiveStatusControl,{}),(0,r.jsx)(ub,{children:(0,r.jsx)(q.UnreadBadge,{unreadAmount:g,className:W(gb.unreadBadge,"bottom-0.5")})}),(0,r.jsx)("div",{className:"flex shrink grow flex-col justify-between border-t border-t-neutral-200 py-1",children:(0,r.jsx)("div",{className:"relative flex h-full flex-col gap-4",children:h.map((function(e){var t=e.icon,n=e.title,a=e.route,o=e.disabled,i=e.testId,s=e.badge;return(0,r.jsx)(bb,{route:a,title:n,icon:t,"data-testid":i,disabled:o,badge:s},a)}))})})]})},bb=function(e){var t=e.route,n=e.disabled,a=e.icon,o=e.badge,i=e.title,l=vb(e,["route","disabled","icon","badge","title"]),c=Dd[t].path,u=!!(0,s.useMatch)(t),d=n?"disabled":u?"active":void 0,f=(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:gb.button.icon(d),children:a}),(0,r.jsx)("div",{className:"flex max-w-full",children:(0,r.jsx)("span",{className:"truncate",children:i})}),o]});return n?(0,r.jsx)("div",{className:W(gb.button.base,"pointer-events-none text-neutral-disabled"),title:i,children:f}):(0,r.jsx)(s.NavLink,pb(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){mb(e,t,n[t])}))}return e}({to:c,title:i,"aria-label":i},l),{className:gb.button.base,children:f}))},yb=n(8631),Sb=function(e){var t=e.data,n=e.selectedService,o=function(e){if("SERVICE_NAME"!==e.metric){var t=[e.value];return"rank"in e&&t.push("(".concat(s(e.rank),")")),t.join(" ")}},i=(0,$.useLocalizationState)("t"),s=(0,a.useCallback)((function(e){if(!e)return e;var t=Number(e)%100;if(t>10&&t<14)return e+"th";switch(t%10){case 1:return e+"st";case 2:return e+"nd";case 3:return e+"rd"}return e+"th"}),[]);return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(Te.ShowMore,{className:"flex gap-4 overflow-hidden",trigger:(0,r.jsxs)(yb.Root,{openDelay:0,children:[(0,r.jsx)(yb.Trigger,{asChild:!0,children:(0,r.jsx)("button",{className:"whitespace-nowrap underline text-primary-link",children:i.GLOBAL.view_all()})}),(0,r.jsx)(yb.Portal,{children:(0,r.jsxs)(yb.Content,{className:"w-[410px] bg-neutral-0 p-4 shadow-3",align:"end",children:[(0,r.jsx)("p",{className:"font-medium text-neutral-fade button-sm",children:n}),(0,r.jsx)("div",{className:"relative flex flex-wrap gap-y-8 overflow-hidden pt-2",children:t.map((function(e,t){var n=o(e);return n&&(0,r.jsxs)("div",{className:W("min-h-[35px] min-w-9.5 shrink-0 pr-6 border-action","after:absolute after:mt-4 after:h-px after:w-full after:bg-neutral-200"),children:[(0,r.jsx)("div",{className:"text-neutral-fade caption-s",children:e.display}),(0,r.jsx)("div",{className:"font-semibold text-primary-on-primary",children:n})]},t)}))}),(0,r.jsx)("div",{className:"absolute -mt-px h-px w-full bg-neutral-0"})]})})]}),children:t.filter((function(e){return"SERVICE_NAME"!==e.metric})).map((function(e,t){var n=o(e);return n?(0,r.jsxs)("div",{className:"flex gap-1 whitespace-nowrap caption-s",children:[(0,r.jsx)("span",{className:"text-neutral-fade",children:e.display}),(0,r.jsx)("span",{className:"font-semibold text-primary-on-primary",children:n})]},t):null}))})})};function xb(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function jb(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return xb(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return xb(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Ib=function(e){var t=e.rotatePeriod,n=(0,a.useRef)(null),o=(0,fb.useStatsState)().agentStats,i=(0,Ve.useServicesDispositionsState)().services,s=(0,a.useMemo)((function(){return Object.values(i).filter((function(e){return e.id in o})).map((function(e){return{value:e.id,label:e.name}}))}),[i,o]),l=jb((0,a.useState)(),2),c=l[0],u=l[1],d=(0,a.useMemo)((function(){var e=null==c?void 0:c.value;return e&&o[e]||void 0}),[c,o]),f=(0,a.useCallback)((function(){s.length>1&&u((function(e){if(e){var t=s.findIndex((function(t){return e.value===t.value}));if(t>-1){var n=(t+1)%s.length;return s[n]}}return s[0]}))}),[s]),m=(0,a.useCallback)((function(){n.current&&clearInterval(n.current)}),[]),p=(0,a.useCallback)((function(){t&&(n.current=setInterval(f,1e3*t))}),[t,f]),v=(0,a.useCallback)((function(e){u(e),m(),p()}),[p,m]);return(0,a.useEffect)((function(){!c&&s.length&&u(s[0])}),[c,s,p]),(0,a.useEffect)((function(){!n.current&&d&&p()}),[d]),(0,a.useEffect)((function(){return m}),[]),c&&d?(0,r.jsxs)("div",{className:"flex flex-col items-start overflow-hidden px-4 has-[[data-show-more=true]]:flex-auto",children:[(0,r.jsx)(Te.TriggerDropdown,{align:"end",options:s.map((function(e){return(0,r.jsx)("button",{onClick:function(){return v(e)},children:e.label},e.value)})),children:(0,r.jsxs)("button",{className:"group flex items-center gap-0.5 font-semibold button text-neutral-on-secondary",children:[c.label,(0,r.jsx)(Te.IconArrowDown24,{className:"icon-default group-data-[state=open]:rotate-180"})]})}),(0,r.jsx)(Sb,{data:d,selectedService:c.label})]}):null},Ob=function(){var e=(0,fb.useStatsState)().dashboardConfig,t=(0,fb.useStatsStateMethods)().getDashboardConfig,n=(0,J.useInteractionStateSelector)((function(e){return!!e.activeItem}));return(0,a.useEffect)((function(){e||t()}),[]),(null==e?void 0:e.enabled)?(0,r.jsx)("div",{className:W("flex flex-auto items-center justify-end overflow-hidden",{"md:hidden":n}),children:(0,r.jsx)(Ib,{rotatePeriod:e.rotatePeriod})}):null},_b=n(5906),Cb=function(e){var t,n=e.className,a=(0,$.useLocalizationState)().t,o=null!==(t=(0,Re.useNonAssertedInteractionId)())&&void 0!==t?t:"",i=(0,l.useCommunicatorUIState)((function(e){return e.floatingState})),s=(0,J.useActiveInteractionProp)(j.getItemDisposition),c=(0,p.useDispositionsSettings)(o).useDispositions,u=(0,Fe.useInteractionUIActiveTab)(o),d=(0,Xl.useOpenDispositionPanel)(o),f=(null==s?void 0:s.id)?a.DISPOSITION.disposition_set():a.DISPOSITION.set_disposition();return c?(0,r.jsx)(cl.Button,{onClick:d,tooltip:f,state:"resolution"===u&&"closed"!==i?"disabled":"default",size:"sm",variant:"secondary",iconLeft:(null==s?void 0:s.id)?(0,r.jsx)(Te.IconCheck16,{className:"svg-color-current"}):void 0,className:W("ml-6 shrink-0",n),children:f}):null};function wb(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Nb(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){wb(e,t,n[t])}))}return e}function Ab(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Eb(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var Tb=function(e){var t=e.withStateLayer,n=Eb(e,["withStateLayer"]),a=(0,$.useLocalizationState)().t;return(0,r.jsx)("div",{className:W("rounded p-2.5","transition-colors hover:state-layer-opacity-4","state-layer-bg-[--c-main-bars-bg] state-layer-color-black state-layer-opacity-0",{"p-0":!t}),children:(0,r.jsx)(cl.Button,Ab(Nb({variant:"destructive",size:"sm",color:"danger",className:"px-3 py-0.5","data-testid":"complete-button"},n),{children:a.INTERACTIONS.end()}))})};function Pb(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Mb(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Lb(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var kb=o().memo((function(e){var t=e.isDestructive,n=e.renderIcon,a=Lb(e,["isDestructive","renderIcon"]),o=(0,$.useLocalizationState)().t;return(0,r.jsx)(cl.Button,Mb(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Pb(e,t,n[t])}))}return e}({variant:t?"destructive":"neutral",size:"sm",color:"danger",className:W({"h-7 w-12 px-3 py-0.5":t,"ml-2 h-6 px-2 py-1 text-on-error":!t}),tooltip:o.CALL_DETAILS_FORM.interaction_endCall(),"data-testid":"complete-button"},a),{children:(null==n?void 0:n())||(0,r.jsx)(Te.IconEndCall,{className:"size-5 svg-color-current"})}))}));var Db=function(e){var t=e.isActive,n=e.onClick,a=e.holdStartTime,o=e.disabled,i=e.iconClassName,s=(0,$.useLocalizationState)().t;return(0,r.jsx)(Te.CircleButton,{isActive:t,onClick:n,className:"group/hold w-auto",disabled:o,tooltip:{content:t?s.CALL_DETAILS_FORM.interaction_retrieve():s.CALL_DETAILS_FORM.interaction_hold()},"data-testid":"hold-button","data-on-hold":t||void 0,children:(0,r.jsxs)(_b.motion.div,{animate:t?{paddingRight:9}:{paddingRight:5},className:"flex items-center py-[3px] pl-[5px]",children:[(0,r.jsxs)("div",{className:W("flex gap-0.5 "),children:[(0,r.jsx)(Te.IconHold16,{className:W(i,"hidden size-4.5",{"group-hover/hold:block":t})}),(0,r.jsx)(Te.IconPause16,{className:W(i,"visible size-4.5",{"group-hover/hold:hidden":t})})]}),(0,r.jsx)(_b.AnimatePresence,{children:t&&(0,r.jsx)(_b.motion.div,{initial:{width:0},animate:{width:"auto"},exit:{width:0},children:(0,r.jsx)(q.InteractionTimer,{startTime:a})})})]})})},Rb=new w.MicrophoneVolume,Fb=function(e){var t=e.muted,n=e.className,o=(0,a.useRef)(null);return(0,a.useEffect)((function(){return t||Rb.startAnalysis((function(e){var t,n;o.current&&(t=o.current,(n=t.querySelector("linearGradient stop"))&&n.setAttribute("offset","".concat(e,"%")))})),function(){Rb.stopAnalysis()}}),[t]),t?(0,r.jsx)(Te.IconMute16,{className:W("size-4.5",n)}):(0,r.jsx)(Te.IconVoiceVolume,{className:W("size-4.5 icon-default",n),ref:o})},Bb=function(e){var t=e.isActive,n=e.disabled,a=e.onClick,o=(0,$.useLocalizationState)().t;return(0,r.jsx)(Te.CircleButton,{onClick:a,disabled:n,tooltip:{content:t?o.CALL_DETAILS_FORM.unmute_tooltip():o.CALL_DETAILS_FORM.mute_tooltip()},"data-testid":"mute-button","data-muted":t||void 0,children:(0,r.jsx)(Fb,{className:"icon-fade",muted:!!t})})},Ub=function(e){var t=e.isActive,n=e.onClick,a=e.className,o=e.disabled,i=(0,$.useLocalizationState)().t;return(0,r.jsx)(Te.CircleButton,{onClick:n,isActive:t,disabled:o,className:W(o?"icon-disabled":"icon-error",a),tooltip:{content:t?i.CALL_DETAILS_FORM.interaction_recordStop_tooltip():i.CALL_DETAILS_FORM.interaction_recordStart_tooltip()},"data-testid":"call-recording-button","data-recording-active":t||void 0,children:t?(0,r.jsx)(Te.IconRecordingActive16,{className:"size-4.5"}):(0,r.jsx)(Te.IconRecording16,{className:"size-4.5"})})},zb=function(e){var t=e.isActive,n=e.onClick,a=e.disabled,o=e.iconClassName,i=e.tooltip,s=(0,$.useLocalizationState)().t;return(0,r.jsx)(Te.CircleButton,{isActive:t,onClick:n,disabled:a,tooltip:{content:i||s.CALL_DETAILS_FORM.interaction_initiate_transfer()},"data-testid":"transfer-button","data-on-hold":t||void 0,children:(0,r.jsx)(Te.IconForward16,{className:o})})},Hb=(W("hidden items-center justify-center opacity-0","transition-opacity group-hover:flex group-hover:opacity-100"),W("ml-2 h-6 w-6 rounded-full transition-shadow first:ml-0","hover:bg-black/30 hover:shadow-[0_0_0_6px_rgba(0,0,0,0.3)]","active:bg-black/60 active:shadow-[0_0_0_6px_rgba(0,0,0,0.6)]"),W("flex items-center overflow-hidden icon-fade text-neutral-fade","w-[40vw] min-w-[416px]")),Vb=n(1079),Gb=n(5475);function Wb(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function qb(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Wb(e,t,n[t])}))}return e}function Yb(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var Qb=function(e){var t=e.icon,n=e.text,a=e.items,o=e.onClick,i=e.OptionComponent,s=e.align,l=void 0===s?"center":s;return a.length>1?(0,r.jsx)(Te.ButtonDropdown,{align:l,modal:!1,className:"flex-auto [&>*:not(:last-child)]:border-b [&>*:not(:last-child)]:border-default",options:a.map((function(e){var t=e.key,n=Yb(e,["key"]);return(0,r.jsx)("button",{onClick:function(){return o(n.value)},children:(0,r.jsx)(i,qb({},n))},t)})),button:{variant:"neutral",iconLeft:t},children:n}):(0,r.jsx)(cl.Button,{onClick:function(){return o(a[0].value)},className:"flex-auto",state:a.length?"default":"disabled",variant:"neutral",iconLeft:t,children:n})},Kb=function(e){var t,n,a=e.className,o=(0,J.useActiveInteraction)();(0,we.assertDefined)(o);var i=(0,un.useGetAvatarUrl)(),s=o.userId,l=o.contactId,c=(0,j.getFirstAndLastName)(o),u=c.firstName,d=c.lastName,f=(0,j.isGroupChat)(o)?void 0:i({userId:s,contactId:l,userType:null==o||null===(t=o.displayData)||void 0===t?void 0:t.emiUserType,photoUrl:null==o||null===(n=o.displayData)||void 0===n?void 0:n.emiPhotoUrl}),m=(0,ce.useUnread)(o);return(0,r.jsxs)("div",{className:"relative",children:[(0,r.jsx)(Te.Avatar,{className:a,type:(0,j.isGroupChat)(o)||(0,j.isCallConference)(o)||(0,j.isChatConference)(o)?"conference":l?"contact":s?"msteams_channel"===(null==o?void 0:o.displayData.emiUserType)?"msteams-channel":"msteams"===(null==o?void 0:o.displayData.emiUserType)?"msteams-user":"user":(0,j.isEmail)(o)?"case":"contact",fallback:(0,X.getInitials)(u,d),src:f,size:"32"}),(0,r.jsx)(q.UnreadBadge,{unreadAmount:m,className:"absolute bottom-0 right-0 translate-x-1/2"})]})};function $b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Xb(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var Jb=function(e){var t=e.className,n=e.as,r=void 0===n?"p":n,o=Xb(e,["className","as"]),i=(0,$.useLocalizationState)().t,s=(0,J.useActiveInteractionContactId)(),l=(0,J.useActiveInteractionProp)(j.getDisplayName),c=(0,J.useActiveInteractionProp)((function(e){return(0,j.isCallConference)(e)||(0,j.isChatConference)(e)})),u=(0,un.useContactDisplayName)(s),d=(0,J.useActiveInteractionProp)(j.getPhoneFromItem),f=u||l,m=(0,J.useActiveInteractionProp)((function(e){var t,n,r,a;return(0,j.isChatConference)(e)?null!==(r=null==e||null===(t=e.chatParties)||void 0===t?void 0:t.length)&&void 0!==r?r:0:(0,j.isCallConference)(e)&&null!==(a=null==e||null===(n=e.parties)||void 0===n?void 0:n.length)&&void 0!==a?a:0}));return(0,a.createElement)(r,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){$b(e,t,n[t])}))}return e}({className:W("cursor-default truncate font-semibold text-primary-on-primary body",t),children:c?i.INTERACTIONS.conference(m):f||(d?"".concat(i.GLOBAL.anonymous()," ").concat((0,X.formatPhone)(d)):i.GLOBAL.anonymous())},o))},Zb=function(e){var t,n,o,i,s,l,u,d,f=e.className,m=function(){return Z(),v.setFalse(),Promise.resolve()},v=(0,w.useBoolean)(),g=(0,J.useActiveInteractionProp)(j.getItemDisposition),b=(0,Ve.useServicesDispositionsStateServices)(),y=(0,J.useActiveInteractionProp)((function(e){return(0,j.canHaveDisposition)(e,b)})),S=(0,$.useLocalizationState)().t,x=(null==g?void 0:g.id)?g.name:S.DISPOSITION.set_disposition(),I=(0,a.useRef)(null),O=null!==(l=null===(t=I.current)||void 0===t?void 0:t.offsetHeight)&&void 0!==l?l:0,_=(0,c.useNavigationState)("goTo"),C=(0,J.useActiveInteraction)(),N=(0,ae.useModalComponentOpener)(Vb.QuickAddModal),A=(0,ae.useModalComponentOpener)(Vb.AddToExistingModal),E=null!==(u=null==C||null===(o=C.displayData)||void 0===o||null===(n=o.phones)||void 0===n?void 0:n.map((function(e){return{key:e.id,value:e.phone,type:e.type}})))&&void 0!==u?u:[],T=null!==(d=null==C||null===(s=C.displayData)||void 0===s||null===(i=s.emails)||void 0===i?void 0:i.map((function(e){return{key:e.id,value:e.emailAddress,type:e.type}})))&&void 0!==d?d:[],P=ed().handleContactOpen,M=jl(),L=(0,J.useActiveChatInteractionId)();(0,we.assertDefined)(L);var k=(0,Xl.useOpenDispositionPanel)(L);(0,we.assertDefined)(C);var D=(0,p.useCallHandler)(),R=(0,p.useActivityHistoryOpener)(),F=(0,h.useServiceState)().selectedService,B=(0,Ii.useDIDNumberState)().selectedDIDNumber;(0,we.assertDefined)(C);var U=C.contactId,z=C.userId,H=C.groupChatId,V=C.displayData,G=V.firstName,Y=V.lastName,Q=V.emiPhotoUrl,K=V.emiUserType,X=!U&&!z,Z=(0,Vb.useAddNewContact)(C,(function(e){M({id:e,firstName:null!=G?G:"",lastName:null!=Y?Y:"",phone:"",email:""})})),ee=(0,ji.useContactsStateMethods)().createContact;return(0,r.jsxs)(yb.Root,{open:v.value,onOpenChange:v.toggle,children:[(0,r.jsx)(yb.Trigger,{asChild:!0,children:(0,r.jsxs)("div",{ref:I,className:W("ml-2 flex items-center gap-2 overflow-hidden",f),children:[(0,r.jsx)(Kb,{}),(0,r.jsxs)("div",{className:"truncate",children:[(0,r.jsx)("div",{className:"flex",children:(0,r.jsx)(Jb,{})}),y&&x&&(0,r.jsx)("p",{className:"-mt-0.5 truncate caption-s text-neutral-fade",children:x})]})]})}),(0,r.jsx)(yb.Portal,{forceMount:!0,children:(0,r.jsxs)(yb.Content,{forceMount:!0,align:"start",style:{transform:"translate(-9px, -".concat(O+9,"px)")},className:W("z-[1] flex w-[464px] flex-col border bg-neutral-0  pt-2 shadow-4 border-default","pointer-events-none invisible size-0 opacity-0 transition-opacity",{"pointer-events-auto visible size-auto opacity-100":v.value}),children:[(0,r.jsxs)("div",{className:W("ml-2 flex items-start gap-2 pb-2 pr-2",f),children:[(0,r.jsx)(Kb,{className:"mt-[2.5px]"}),(0,r.jsxs)("div",{className:"flex-auto truncate",children:[(0,r.jsxs)("div",{className:"flex justify-between",children:[(null==C?void 0:C.contactId)?(0,r.jsx)(Jb,{onClick:function(){(null==C?void 0:C.contactId)?(_(c.AppRoutes.search),P({id:C.contactId,firstName:C.displayData.firstName,lastName:C.displayData.lastName}),v.setFalse()):console.error("No contactId found in active interaction")},as:"button",className:"inline hover:underline"}):(0,r.jsx)(Jb,{}),(0,r.jsx)(Gb.InteractionFavoriteButton,{interaction:C})]}),y&&x&&(0,r.jsx)("button",{onClick:function(){k(),v.setFalse()},className:"-mt-0.5 block whitespace-normal p-0 caption-s text-neutral-fade hover:underline",title:x,children:x})]})]}),(0,r.jsxs)("div",{className:W("flex flex-auto gap-2 border-t p-4 border-default",{"pb-2":X}),children:[(0,r.jsx)(Qb,{onClick:function(e){D({phone:e,contactId:U,userId:z,serviceId:F,firstName:G,lastName:Y,accessNumberId:B,origination:"topbar"}),v.setFalse()},OptionComponent:q.PhoneOption,icon:(0,r.jsx)(Te.IconPhone,{className:"svg-color-current"}),items:E,align:"start",text:S.INTERACTIONS.call()}),(0,r.jsx)(Qb,{onClick:function(e){R({contactId:null==C?void 0:C.contactId,userId:null==C?void 0:C.userId,phone:e,firstName:G,lastName:Y,groupChatId:H,emiPhotoUrl:Q,emiUserType:K,origination:"topbar"}),v.setFalse()},OptionComponent:q.PhoneOption,icon:(0,r.jsx)(Te.IconMessage,{className:"svg-color-current"}),text:S.INTERACTIONS.message(),items:E,align:"center"}),(0,r.jsx)(Qb,{onClick:function(e){v.setFalse(),alert("TODO: Implement email")},OptionComponent:q.EmailOption,text:S.INTERACTIONS.email(),icon:(0,r.jsx)(Te.IconEmailEnvelope24,{className:"svg-color-current"}),items:T,align:"end"})]}),X&&(0,r.jsxs)("div",{className:"flex gap-1 px-4 pb-2",children:[(0,r.jsx)(cl.Button,{size:"xs",variant:"ghost",onClick:function(){var e;N({defaultValues:{firstName:G,lastName:Y,email:null==C||null===(e=C.displayData)||void 0===e?void 0:e.email,phone:function(){var e,t;return(0,j.isWorkItem)(C)?null==C||null===(t=C.workitemData)||void 0===t?void 0:t.suggestedPhone:null==C||null===(e=C.displayData)||void 0===e?void 0:e.number}()},onSubmit:function(e){ee({contact:{first_name:e.firstName,last_name:e.lastName,emails:e.email?[{type:Eo.EmailTypes.PRIMARY,email_address:e.email}]:[],phones:e.phone?[{type:Eo.PhoneTypes.BUSINESS,phone:e.phone}]:[]}},{onSuccess:function(t){_(c.AppRoutes.search),P({id:t,firstName:e.firstName,lastName:e.lastName}),M({id:t,firstName:e.firstName,lastName:e.lastName,email:e.email,phone:e.phone})}})}}),v.setFalse()},children:S.INTERACTIONS.quick_add()}),(0,r.jsx)(cl.Button,{size:"xs",variant:"ghost",onClick:m,children:S.INTERACTIONS.new_contact()}),(0,r.jsx)(cl.Button,{size:"xs",variant:"ghost",onClick:function(){A({handleAddNewContact:m,handleAddToExisting:M}),v.setFalse()},children:S.INTERACTIONS.add_to_existing()})]})]})})]})},ey=function(e){var t=e.onDisconnect,n=e.disconnectButtonTooltip,a=(0,J.useActiveInteractionProp)(j.getMediaIcon),o=(0,J.useActiveInteractionProp)((function(e){return null==e?void 0:e.displayData.deliveredStartTime}));return(0,r.jsxs)("div",{className:Hb,children:[(0,r.jsxs)(_b.motion.div,{className:"flex items-center pl-4",whileHover:"hover",children:[(0,r.jsx)(q.InteractionMediaIcon,{className:"icon-default",icon:a}),(0,r.jsx)(q.InteractionTimer,{className:"ml-1 mr-2",startTime:o}),(0,r.jsx)(_b.motion.div,{initial:{width:0,opacity:0,pointerEvents:"none"},variants:{hover:{width:"auto",opacity:1,pointerEvents:"auto"}},children:(0,r.jsx)(Tb,{onClick:t,tooltip:n,withStateLayer:!0})})]}),(0,r.jsx)(Zb,{})]})},ty=function(e){var t=e.onDisconnect,n=(0,J.useActiveInteractionProp)(j.getMediaIcon),a=(0,J.useActiveInteractionProp)(j.getIsCallEstablished),o=(0,J.useActiveInteractionProp)((function(e){return null==e?void 0:e.displayData.pendingStartTime})),i=(0,$.useLocalizationState)().t;return(0,r.jsxs)("div",{className:Hb,children:[(0,r.jsxs)(_b.motion.div,{className:"flex items-center pl-4",whileHover:"hover",children:[(0,r.jsx)(q.InteractionMediaIcon,{icon:n,className:W("icon-default",{"animate-pulse-light":!a&&"call_outbound"===n})}),(0,r.jsx)(q.InteractionTimer,{className:"ml-1 mr-2",startTime:o,format:function(e){return"".concat(i.CALL_DETAILS_FORM.call_status_dialing()," | ").concat(e)}}),(0,r.jsx)(_b.motion.div,{initial:{width:0,opacity:0,pointerEvents:"none"},variants:{hover:{width:"auto",opacity:1,pointerEvents:"auto"}},children:(0,r.jsx)(kb,{onClick:t})})]}),(0,r.jsx)(Jb,{className:"ml-2"})]})},ny=function(e){var t=e.onDisconnect,n=(0,J.useActiveInteractionProp)(j.getMediaIcon),o=(0,J.useActiveInteractionProp)((function(e){return null==e?void 0:e.displayData.deliveredStartTime})),i=(0,J.useActiveInteractionProp)((function(e){return null==e?void 0:e.displayData.holdStartTime})),s=(0,p.useCallButtonsHandlers)(),c=s.showRecordButton,u=s.isCallEstablished,d=s.isMuted,f=s.isOnHold,m=s.isRecording,v=s.isLoading,g=s.handleHoldClick,h=s.handleMuteClick,b=s.handleRecordClick,y=(0,l.useCommunicatorUIState)().handleToggleTransferModal,S=(0,a.useCallback)((function(){return null==y?void 0:y(!0)}),[y]),x=(0,C.useSessionState)().phoneDeviceCapabilities,I=!u||(f?!x.canRetrieve:!x.canHold);return(0,r.jsxs)("div",{className:W(Hb,"pl-4"),children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(q.InteractionMediaIcon,{icon:n,className:W("icon-default",{"animate-pulse-light":!u&&"call_outbound"===n})}),o&&(0,r.jsx)(q.InteractionTimer,{startTime:o,"data-testid":"duration-timer",className:"ml-1"})]}),(0,r.jsxs)(_b.motion.div,{whileHover:"hover",className:W("group/circle-btn-parent ml-2 flex shrink-0 items-center rounded p-2.5","transition-colors state-layer-bg-[--c-main-bars-bg] state-layer-color-black state-layer-opacity-0 hover:state-layer-opacity-10"),children:[(0,r.jsxs)("section",{className:"flex gap-2.5",children:[(0,r.jsx)(Bb,{onClick:h,disabled:!u,isLoading:v.muted,isActive:d}),(0,r.jsx)(Db,{isActive:f,isLoading:v.onHold,onClick:g,holdStartTime:i,disabled:I}),c&&(0,r.jsx)(Ub,{className:W("hidden group-hover:grid",{grid:m}),isActive:m,isLoading:v.recording,onClick:b,disabled:!u||f})]}),(0,r.jsx)(_b.AnimatePresence,{children:(0,r.jsxs)(_b.motion.section,{initial:{opacity:0,width:0,marginLeft:0,pointerEvents:"none"},variants:{hover:{opacity:1,width:"auto",marginLeft:10,pointerEvents:"auto"}},className:"flex items-center gap-2.5",children:[(0,r.jsx)(zb,{disabled:!u,onClick:S}),(0,r.jsx)(kb,{onClick:t})]})})]}),(0,r.jsx)(Zb,{})]})},ry=function(){var e=(0,$.useLocalizationState)("t"),t=(0,J.useActiveInteractionProp)(j.getMediaIcon);return(0,r.jsxs)("div",{className:W(Hb,"pl-4"),children:[(0,r.jsx)(q.InteractionMediaIcon,{icon:t}),(0,r.jsx)("p",{className:"ml-1 font-semibold caption-s text-neutral-fade",children:e.DISPOSITION.ended()}),(0,r.jsx)(Cb,{className:"mr-4"}),(0,r.jsx)(Zb,{})]})},ay=function(){var e,t,n,o=(0,J.useActiveInteraction)(),i=(0,ce.useDisconnectButtonClickHandler)(),s=(0,$.useLocalizationState)("t"),l=(0,a.useCallback)((function(){return i(o)}),[o,i]);return(0,j.isOutboundInteraction)(o)&&"requesting"===(null==o||null===(e=o.callData)||void 0===e?void 0:e.callState)||"dialing"===(null==o||null===(t=o.callData)||void 0===t?void 0:t.callState)||"ringing"===(null==o||null===(n=o.callData)||void 0===n?void 0:n.callState)?(0,r.jsx)(ty,{onDisconnect:l}):(0,j.isAfterCallWork)(o)?(0,r.jsx)(ry,{}):(0,j.isCall)(o)?(0,r.jsx)(ny,{onDisconnect:l}):!o||(0,j.isPotentialInteraction)(o)?(0,r.jsx)("div",{}):(0,r.jsx)(ey,{onDisconnect:l,disconnectButtonTooltip:(0,j.isChatConference)(o)?s.INTERACTIONS.end_conference():s.INTERACTIONS.end_interaction()})},oy=n(2096);function iy(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var sy=(0,q.createComponentLoader)("knowledgeBase",n.e(330).then(n.t.bind(n,2330,23)),"KBSettings").KBSettingsLoader,ly=function(e){var t=(0,jd.useKbBridgeConnector)();return(0,jd.assertKBBridgeInterface)(t),(0,r.jsx)(sy,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){iy(e,t,n[t])}))}return e}({kbBridge:t},e))};function cy(e){var t=(0,$.useLocalizationState)().t,n=(0,C.useSessionState)(["privileges","phoneType","tenantFeatures"]),r=n.privileges,o=n.phoneType,i=n.tenantFeatures,s=(0,C.useSessionStateMethods)().startPhoneTypeSelection,l=(0,ze.useOpenChangePasswordModal)(),c=(0,ze.useOpenEMIAccountsModal)(),u=(0,ze.useOpenUserProfileModal)(),d=(0,ae.useModalComponentOpener)(ly),f=(0,ze.useOpenKeyboardShortcutsModal)(),m=(0,ze.useOpenPredefinedMessagesModal)(),p=(0,ze.useOpenVolumeModal)(),v=(0,ze.useOpenPreferencesModal)(),g=(0,ze.useOpenAboutModal)(),h=(0,ze.useOpenAudioDevicesModal)(),b=(0,ze.useOpenCalendarSettingsModal)(),y=(0,ze.useOpenPrerecordedMessagesModal)(),S=(0,ze.useOpenLogoutModal)(),x=!!r.MANAGE_KNOWLEDGE_BASE_SETTINGS,j=!!o&&["phone_type_browser","phone_type_soft_secure","phone_type_soft_unsecure"].includes(o),I=(0,a.useCallback)((function(t){return function(n){n.stopPropagation(),t(),e()}}),[e]);return(0,a.useMemo)((function(){var e=[{children:t.SETTINGS.settings_menu_userProfile(),onClick:I(u)},{children:t.DEVICE_SETUP_WINDOW.deviceSetup_heading(),onClick:I(s)},{children:t.SETTINGS.settings_menu_audioDevices(),onClick:I(h)},{children:t.CALENDAR_SETTINGS.heading(),onClick:I(b)},{children:t.SETTINGS.settings_menu_changePassword(),onClick:I((function(){return l({isForced:!0})}))},{children:t.SETTINGS.settings_menu_chatCannedResponses(),onClick:I(m)},{children:t.SETTINGS.settings_menu_preferences(),onClick:I(v)},{children:t.UNDEFINED.tab_enterprise_messaging_accounts_heading(),onClick:I(c)},{children:t.KNOWLEDGE_BASE.kb_settings(),onClick:I(d)},{children:t.SETTINGS.settings_menu_editVoicePrompts(),onClick:I(y)},{children:t.SETTINGS.settings_menu_shortcuts(),onClick:I(f)},{children:t.SETTINGS.settings_menu_ringtone_volume(),onClick:I(p)},{children:t.SETTINGS.settings_menu_about(),onClick:I(g)},{children:t.GLOBAL.logout(),onClick:I(S)}],n=x?e:e.filter((function(e){return e.children!==t.KNOWLEDGE_BASE.kb_settings()})),r=j?n:n.filter((function(e){return e.children!==t.SETTINGS.settings_menu_audioDevices()}));return(null==i?void 0:i.msTeamsIntegrationEnabled)?r:r.filter((function(e){return e.children!==t.UNDEFINED.tab_enterprise_messaging_accounts_heading()}))}),[t,I,u,s,h,b,l,m,v,c,y,f,p,g,S,d,j,null==i?void 0:i.msTeamsIntegrationEnabled,x])}var uy=(0,a.memo)((function(){var e,t,n=(0,l.useSettings)(),a=n.show,o=n.toggleShow,i=cy(o),s=(e=(0,C.useSessionState)("userId"),t=(0,un.useGetUserPictureUrl)(),{avatarSrc:e?t(e):void 0}).avatarSrc,c=(0,C.useSessionState)(["teamName","lastName","firstName"]),u=c.teamName,d=c.lastName,f=c.firstName,m=(0,oy.useUserProfileState)("userProfile"),p=(0,(0,Ce.useFormatting)().formatFullName)(f,d),v=(0,X.formatPhone)(null==m?void 0:m.extension);return(0,r.jsx)(q.PopupButton,{custom:!0,show:a,toggleShow:o,options:i,className:"flex items-center",children:(0,r.jsx)(q.Popup,{mode:"hover",content:(0,r.jsxs)(r.Fragment,{children:[!!u&&(0,r.jsx)("p",{children:u}),!!p&&(0,r.jsx)("p",{children:p}),!!v&&(0,r.jsx)("p",{children:v})]}),children:(0,r.jsx)(Hs.Avatar,{firstName:null==m?void 0:m.firstName,lastName:null==m?void 0:m.lastName,url:s})})})})),dy=W("grid size-8 place-content-center","rounded","transition-colors hover:state-layer-opacity-4 focus:state-layer-opacity-4 active:state-layer-opacity-8","state-layer-bg-[--c-main-bars-bg] state-layer-color-black state-layer-opacity-0"),fy=function(){var e=(0,$.useLocalizationState)().t,t=(0,ae.useModalComponentOpener)(Da);return(0,r.jsxs)("div",{"data-testid":"top-bar",className:"relative flex h-[--topbar-height] shrink-0 justify-end border-b bg-[--c-main-bars-bg] border-default",children:[(0,r.jsx)(ay,{}),(0,r.jsxs)("div",{className:"flex flex-auto items-center justify-end overflow-hidden",children:[(0,r.jsx)(Ob,{}),(0,r.jsxs)("section",{className:"flex items-center py-3.5 pl-4 pr-6",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(q.Button,{transparent:!0,className:dy,children:(0,r.jsx)(Te.IconTopbarNewMessage,{})}),(0,r.jsx)(q.Button,{transparent:!0,className:dy,onClick:function(){return t()},tooltip:e.GLOBAL.help(),children:(0,r.jsx)(Te.IconHelp,{})}),(0,r.jsx)(uy,{})]}),(0,r.jsx)("div",{className:"mx-4 h-4 w-px border-r border-disabled"}),(0,r.jsx)(Te.IconLogo,{})]})]})]})},my=[K.Notifications.DispositionNotSelectedError,K.Notifications.ContactCreationError,K.Notifications.ContactMergeError],py=function(e){var t=e.children;return(0,r.jsxs)("div",{className:"relative flex h-full flex-col overflow-hidden",children:[(0,r.jsx)(zd,{omit:my}),(0,r.jsx)(lb.OfflineBar,{}),(0,r.jsxs)("div",{className:"relative flex grow overflow-hidden",children:[(0,r.jsx)(hb,{}),(0,r.jsxs)("div",{id:"mainContainer",className:"relative flex flex-auto flex-col overflow-hidden",children:[(0,r.jsx)(fy,{}),(0,r.jsx)("div",{className:"flex flex-auto flex-col overflow-auto",children:t})]})]})]})};var vy=function(){var e,t,n,o,i=(0,y.useUIState)().isTabNavHighlighted;return e=(0,he.useAppConfigStateMethods)().checkWhetherToRenderReportProblemButton,t=(0,C.useSessionState)(),n=t.isLoggedIn,o=t.tenantId,(0,a.useEffect)((function(){n&&o&&e(o)}),[e,n,o]),(0,r.jsxs)("div",{className:W("h-full w-full",{"[&_*:focus-within]:!outline-none [&_*:focus]:!outline-none":!i,"[&_*:focus-within]:!outline-0 [&_*:focus]:!outline-0":!i}),children:[(0,r.jsx)(Be.DndProvider,{backend:Ue.HTML5Backend,children:(0,r.jsx)(Te.ToastProvider,{children:(0,r.jsx)(py,{children:(0,r.jsx)(sb,{children:(0,r.jsx)(rb,{})})})})}),(0,r.jsx)(q.AriaStatuses,{}),(0,r.jsx)(ze.Modals,{})]})},gy=8*w.MS_IN_HOUR,hy=new rt.QueryClient({defaultOptions:{queries:{gcTime:gy}}}),by=(0,w.createProviderWrapper)([Re.ActiveInteractionContextProvider,function(e){var t=e.children;return(0,r.jsx)(rt.QueryClientProvider,{client:hy,children:t})},Fe.InteractionUIStateProvider,h.ServiceStateProvider,c.NavigationStateProvider,ke.NavigationStateProvider,l.MainPageUIProvider,function(e){var t=e.children,n=(0,v.useScrollStateProviderBuilder)({children:t,defaultScrollStateData:g}),r=n.Provider,o=n.scrollStateRef,i=(0,a.useCallback)((function(e){o.current=f()(o.current,(function(t){delete t.interactions[e]}))}),[o]);return(0,p.useOnItemRemoved)((0,m.flow)((0,m.property)("id"),i)),r},y.UIContextProvider,S.ADShortcutsProvider,b.SupervisionUIContextProvider,function(e){var t=e.children,n=D({uploadFile:(0,O.useUploadEmailFile)(),getFormData:U});return(0,r.jsx)(B.Provider,{value:n,children:t})},De.CommunicatorUIProvider]),yy=function(){return(0,r.jsx)(Le,{platformSpecific:(0,u.createPlatformSpecific)("ad"),app:"ad",appRemoteName:"agent",children:function(){return(0,r.jsx)(by,{children:(0,r.jsx)(vy,{})})}})},Sy=n(2850);n(7445);(0,Sy.registerServiceWorker)(),(0,i.s)(document.getElementById("root")).render((0,r.jsx)(s.BrowserRouter,{basename:"/agent/",children:(0,r.jsx)(yy,{})}))}}]);
//# sourceMappingURL=221.9d1530de.chunk.js.map