/*! For license information please see 499.942c0ecf.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunk_bpinc_web_voice_transcript_ui=self.webpackChunk_bpinc_web_voice_transcript_ui||[]).push([[499],{2499:(e,t,n)=>{n.d(t,{z:()=>H,a:()=>F});var r=n(2322),a=n(6029),o=n(7500),i=n(2469),s=n(9572),l=n(7282),c=n(8202),u=n(3194),d=n(4593),f=n(6607),m=n(9196),v=n(7505),g=n(3764),p=n(4483),h=n(4778),y=n(6441);const b="voiceTranscript_Notifications_listWrapper_NVyLi",I="voiceTranscript_Notifications_listItem_5BLxr";var S={hide:0,show:300},x=function(e){var t=e.omit,n=e.show,o=e.className,i=(0,g.useNotificationsState)(),s=i.notifications,l=i.methods.hideNotificationById,c=(0,a.useMemo)((function(){var e=(0,h.truthy)(Object.values(s)).filter((function(e){return!e.delayed}));return n&&(e=e.filter((function(e){return n.includes(e.id)}))),t&&(e=e.filter((function(e){return!t.includes(e.id)}))),e.slice(0,3)}),[s,t,n]);return(0,r.jsx)("div",{className:(0,p.B)(o,b),children:(0,r.jsx)(v.SmTransition.Group,{animation:"fade down",duration:S,children:c.map((function(e){var t;return t=e.content?(0,a.isValidElement)(e.content)?(0,a.cloneElement)(e.content,{onHide:function(){return l(e.id)}}):e.content:e.message,(0,r.jsxs)("div",{className:I,children:[(0,r.jsx)("div",{children:(0,r.jsx)(v.SmMessage,{onDismiss:e.closable?function(){return l(e.id)}:void 0,content:t,error:"error"===e.type,info:"info"===e.type,warning:"warning"===e.type,success:"success"===e.type})}),(0,r.jsx)(y.AriaStatus,{children:t})]},e.id)}))})})},C=n(9486),j=n(8770),T=n(6622),A=n(3711),w=function(e){var t=e.firstName,n=e.lastName,a=e.fullName,o=e.contactId,i=e.phoneNumber,s=(0,j.useGetContactPictureUrl)();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(A.AvatarLegacy,{firstName:t,lastName:n,type:"contact",size:44,url:s(o)}),(0,r.jsxs)("div",{className:"ml-4",children:[(0,r.jsx)("div",{className:"text-xl leading-tight",children:a}),i&&(0,r.jsx)("div",{className:"self-end opacity-80",children:(0,T.formatPhone)(i)})]})]})},_=function(e){var t=e.itemId,n=e.botSuggestions;return(0,r.jsx)("div",{className:"flex h-0 flex-auto flex-col overflow-auto break-words px-4",children:null==n?void 0:n.map((function(e,n){return(0,r.jsx)(m.i9,{message:e,itemId:t,direction:"outgoing"},n)}))})},N=n(6070),O=(0,y.createComponentLoader)("knowledgeBase",n.e(330).then(n.t.bind(n,2330,23)),"KBPage").KBPageLoader,M={topHeader:!0,openInNewTab:!0},E=(0,a.memo)((function(){var e=(0,N.useKbBridgeConnector)();return(0,N.assertKBBridgeInterface)(e),(0,r.jsx)(O,{features:M,kbBridge:e})}));function k(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function L(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function P(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return k(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return k(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var D=(0,p.B)("\n        text-xl\n        text-main\n        focus:text-main \n        hover:focus:text-main\n    "),B=function(e){var t=e.itemId,n=e.botSuggestions,o=(0,C.useLocalizationState)().t,i=P((0,a.useState)("kb"),2),s=i[0],l=i[1],c=(0,f.useMainPageUIState)(["kbFloatingState","kbWidth","setKBFloatingState","setKBWidth","mainContentNode"]),u=c.kbFloatingState,d=c.kbWidth,m=c.mainContentNode,v=c.setKBFloatingState,g=c.setKBWidth,h=(0,y.useCanPin)({mainContentNode:m,floatingState:u,floatingSize:d,contentMinWidth:580}),b=(0,a.useCallback)((function(e){var t=e.size;g(t)}),[g]);return(0,r.jsx)(y.Floating,{maxSizeInPercent:60,canPin:h,className:"h-full",closeByEscape:"floating"===u,"data-testid":"kb-panel",initialSize:d,minSize:400,onDragEnd:b,resizeable:!0,setState:v,side:"right",state:u,children:(0,r.jsxs)("div",{className:"flex h-full w-full flex-col",children:[(0,r.jsxs)("header",{className:"flex items-center gap-6 px-4 pt-5",children:[(0,r.jsx)(y.LinkLikeButton,{className:(0,p.B)(L({},D,"bot"===s)),onClick:function(){l("bot")},children:o.AGENT_ASSIST.suggestions_tab()}),(0,r.jsx)(y.LinkLikeButton,{className:(0,p.B)(L({},D,"kb"===s)),onClick:function(){l("kb")},children:o.AGENT_ASSIST.kb_tab()})]}),(0,r.jsxs)("section",{className:"flex h-full flex-auto flex-col overflow-auto",children:["kb"===s&&(0,r.jsx)(E,{}),"bot"===s&&(0,r.jsx)(_,{itemId:t,botSuggestions:n})]})]})})},R=(0,p.B)("min-w-[580px] max-w-[960px]"),H=function(){var e,t,n,v=(0,f.useMainPageUIState)(["kbFloatingState","setMainContentNode"]),g=v.kbFloatingState,h=v.setMainContentNode,b=null!==(e=new URLSearchParams(window.location.search).get("interactionStepId"))&&void 0!==e?e:"",I=(0,u.useInteractionBy)("interactionStepId",b),S=(0,u.useInteractionStateSelector)((function(e){return(0,d.getAssociatedChatItem)({item:I,items:e.items})})),j=null!==(t=null==I?void 0:I.id)&&void 0!==t?t:"",T=null!==(n=null==S?void 0:S.id)&&void 0!==n?n:"",A=null==I?void 0:I.voiceTranscript,_=null==I?void 0:I.botSuggestions,N=(0,l.useFormatting)().formatFullName,O=(0,C.useLocalizationState)().t,M=null==I?void 0:I.displayData.firstName,E=null==I?void 0:I.displayData.lastName,k=null==I?void 0:I.displayData.number,L=N(M,E),P=(0,c.useInteractionChatData)((0,d.getInteractionStepId)(S));(0,m.mD)(j,_,!0);var D=(0,s.useUpdateCurrentTabState)();return(0,a.useEffect)((function(){D({app:"avt",data:{itemId:j}})}),[j,D]),j&&T?(0,r.jsx)(m.KC,{children:(0,r.jsx)(o.DndProvider,{backend:i.HTML5Backend,children:(0,r.jsxs)(y.SelectionContainer,{autoScroll:!0,className:"flex h-full flex-col",children:[(0,r.jsx)(x,{}),(0,r.jsx)("header",{className:"\n                            flex \n                            h-16 \n                            items-center\n                            bg-[color:var(--c-main-bars-bg)]\n                            px-6 \n                            text-2xl \n                            text-primary-contrast\n                        ",children:O.EXTERNAL_CHAT.voice_transcript_header(L)}),(0,r.jsxs)("div",{className:"relative flex flex-auto",children:[(0,r.jsx)("section",{ref:function(e){h(e)},className:(0,p.B)("flex flex-auto flex-col py-4","floating"===g?"items-start":"items-center"),children:(0,r.jsxs)("div",{className:(0,p.B)(R,"flex w-full flex-auto flex-col"),children:[(0,r.jsx)("header",{className:"align-center flex pl-6",children:(0,r.jsx)(w,{firstName:M,lastName:E,fullName:L,contactId:null==I?void 0:I.contactId,phoneNumber:k})}),(0,r.jsx)(m.SV,{className:"flex h-0 flex-auto flex-col",filtersClassName:"w-[477px] self-end",voiceTranscript:A,botSuggestions:_,chatMessages:null==P?void 0:P.messages,itemId:j}),(0,r.jsx)(m.RH,{itemId:T,serviceId:(0,d.getServiceId)(S)})]})}),(0,r.jsx)(B,{itemId:j,botSuggestions:_})]})]})})}):(0,r.jsx)("h1",{children:"No interaction detected"})},F=(0,y.createComponentLoader)("voiceTranscript",n.e(272).then(n.t.bind(n,6272,23)),"VoiceTranscriptPage").VoiceTranscriptPageLoader},9196:(e,t,n)=>{n.d(t,{i9:()=>bn,gZ:()=>O,RH:()=>Dr,SV:()=>qn,KC:()=>Tn,mD:()=>U});var r=n(2322),a=n(6029),o=n.n(a),i=n(9717),s=n(3830),l=n.n(s),c=n(3385),u=n(9008),d=n(3650),f=n(2122),m=n(2346),v=n(5319),g=n(3194),p=n(4593),h=n(638),y=n(5928),b=n(533),I=n(7773),S=n(9486);function x(e,t){switch(t){case"sms":return{value:t,text:e.GLOBAL.chat_type_sms()};case"web":return{value:t,text:e.GLOBAL.chat_type_web()};case"telegram":return{value:t,text:e.GLOBAL.chat_type_telegram()};case"line":return{value:t,text:e.GLOBAL.chat_type_line()};case"twitter":return{value:t,text:e.GLOBAL.chat_type_twitter()};case"facebook":return{value:t,text:e.GLOBAL.chat_type_facebook()};case"wechat":return{value:t,text:e.GLOBAL.chat_type_wechat()};case"nexmo":return{value:t,text:e.GLOBAL.chat_type_nexmo()};case"viber":return{value:t,text:e.GLOBAL.chat_type_viber()};case"whatsapp":return{value:t,text:e.GLOBAL.chat_type_whatsapp()};case"remoteassist":return{value:t,text:e.GLOBAL.chat_type_remote_assist()}}}function C(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function j(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return C(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return C(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var T={value:"sms",text:"SMS"};function A(){var e=function(){var e,t,n,r,o=(0,m.useContactsStateMethods)().getContact,i=(0,m.useContactsState)("contacts"),s=(0,I.useNonAssertedInteractionId)(),l=(0,g.useAssociatedChatInteraction)(s),c=(0,b.useServicesDispositionsState)(),u=c.services,d=c.allOutboundChatChannels,C=c.outboundChatChannels,j=(0,v.useDIDNumberState)().selectedDIDNumber,T=(0,y.useServiceState)().selectedService,A=(0,h.useRemoteAssistState)().items,w=(0,S.useLocalizationState)().t,_=(0,p.getChannel)(l),N=(0,p.getServiceId)(l),O=(0,p.getMessengers)(i,l),M=null==l?void 0:l.contactId,E=null==l||null===(e=l.externalChatData)||void 0===e?void 0:e.channel,k=(0,p.getGlobalInteractionId)(l),L=k&&"joined"===(null===(t=A[k])||void 0===t?void 0:t.clientState),P=M&&(null===(n=i[M])||void 0===n?void 0:n.isLoading),D=!!M&&!!(null===(r=i[M])||void 0===r?void 0:r.data);(0,a.useEffect)((function(){!M||P||D||o({id:M})}),[D,M,o,P]);var B=(0,a.useMemo)((function(){var e,t=function(e){e&&(n[e.value]=e)},n={};return null==O||O.forEach((0,f.flow)((0,f.property)("type"),(0,f.partial)(x,w),t)),t({value:"remoteassist",text:w.GLOBAL.chat_type_remote_assist()}),(0,p.getPhoneFromItem)(l)&&t({value:"sms",text:w.GLOBAL.chat_type_sms(),phones:null==l?void 0:l.displayData.phones}),function(){if(E){var e=x(w,E);e&&t(e)}}(),function(){for(var e in n)t(n[e])||delete n[e];function t(e){var t=N||T;if("remoteassist"===e.value)return L;if("web"===e.value)return!0;if(e.value===E)return!0;if((0,p.isCall)(l))return!0;if(t){var n=(0,p.isChatService)(t,u)?d:C[t];return null==n?void 0:n.includes(e.value.toUpperCase())}return j?"sms"===e.value:void 0}}(),(e=x(w,_))&&t(e),Object.values(n)}),[O,w,l,N,T,j,u,d,C,_,L,E]);return(0,a.useMemo)((function(){return B}),[B])}(),t=(0,d.useOpenChannel)();(0,a.useRef)(e).current=e;var n=j((0,a.useState)({}),2),r=n[0],o=n[1],i=j((0,a.useState)({}),2),s=i[0],C=i[1],A=(0,a.useCallback)((function(t){return r[t]?r[t]:e?e[0]:void 0}),[e,r]),w=(0,a.useCallback)((function(e){var t=A(e);if("sms"===(null==t?void 0:t.value)){if(s[e])return s[e];var n;if(t)return null==t||null===(n=t.phones)||void 0===n?void 0:n[0]}}),[A,s]),_=(0,a.useCallback)((function(e,t,n){return o(l()((function(n){n[e]=t}))),C(l()((function(r){var a;r[e]=n?null===(a=t.phones)||void 0===a?void 0:a.find((function(e){return e.id===n})):void 0}))),t}),[]),N=(0,a.useCallback)((function(){o({"":T})}),[]),O=(0,a.useCallback)((function(e){o(l()((function(t){delete t[e.id]})))}),[]),M=j((0,a.useState)({}),2),E=M[0],k=M[1],L=(0,a.useCallback)((function(e){return E[e||""]}),[E]),P=(0,a.useCallback)((function(e,t){k(l()((function(n){n[e]=t})))}),[]);(0,u.useOnLogout)((function(){N(),k({})})),(0,c.useOnItemRemoved)((function(e){O(e),function(e){k(l()((function(t){delete t[e.id]})))}(e)}));var D=(0,a.useCallback)((function(e,n,r){t(n.value),_(e,n,r),P(e,!0)}),[t,_,P]);return(0,a.useMemo)((function(){return{getSelectedChannel:A,getSelectedPhone:w,setSelectedChannel:D,channelOptions:e,isTouched:L,setIsTouched:P}}),[A,w,D,e,L,P])}var w="ChannelStateContext",_={getSelectedChannel:function(){return T},getSelectedPhone:function(){},isTouched:function(){return!1},channelOptions:[T],setIsTouched:(0,i.throwNoProviderError)(w),setSelectedChannel:(0,i.throwNoProviderError)(w)},N=o().createContext(_);N.displayName=w;var O=function(e){var t=A();return(0,r.jsx)(N.Provider,{value:t,children:e.children})},M=function(){return(0,a.useContext)(N)},E=n(6441),k=n(2107),L=(n(1554),n(1980)),P=n(2506),D=n(4171),B=n(9572),R=n(7110),H=n(4915);function F(e){var t=(0,R.useScreenPopStateMethods)().addTabs,n=(0,B.useBrowserTabMetaInfo)(),r=null==n?void 0:n.app,o=(0,g.useInteractionStateMethods)().saveOpenedSuggestionUrl;return(0,a.useCallback)((function(n){var a,s;if(n.suggestionURL)if(o(e,n.suggestionURL),"ad"===r&&"AGENT_DESKTOP"===n.openURLIn){var l,c=null!==(l=n.msgId)&&void 0!==l?l:n.suggestionURL;t(e,[{id:c,type:"iframe",url:n.suggestionURL,title:(0,H.formatHTMLAsOneLineString)(n.text)}])}else try{window.open((0,i.normalizeExternalURL)(n.suggestionURL),"NEW_TAB"==n.openURLIn?"_blank":void 0,"noopener,noreferrer")}catch(d){var u=(a=d,(null!=(s=Error)&&"undefined"!=typeof Symbol&&s[Symbol.hasInstance]?s[Symbol.hasInstance](a):a instanceof s)?d.message:"unknown error");console.error("error opening window for url ".concat(n.suggestionURL,": ").concat(u))}}),[r,e,t,o])}function U(e,t,n){var r=(0,g.useInteractionProp)(e,(function(e){return null==e?void 0:e.openedBotSuggestionsUrls})),o=(0,a.useCallback)((function(e){return null==t?void 0:t.filter((function(t){return(0,D.isLinkSuggestion)(t)&&t.autoOpenURL&&!(null==e?void 0:e[t.suggestionURL])}))}),[t]),i=F(e);(0,a.useEffect)((function(){!function(){if(n){var e=o(r);null==e||e.forEach(i)}}()}),[r,n,o,i])}var z=n(5715),G=n(7856);function V(e){return"string"==typeof e}function K(e){return!!e&&!V(e)&&"globalInteractionId"in e}function X(e){return!!e&&!V(e)&&"serviceId"in e&&"activityGroup"===e.displayType}function W(e){return!!e&&!X(e)&&!K(e)}function q(e){return"object"==typeof e&&"type"in e&&G.voiceTranscriptMessageTypes.includes(e.type)}function $(e){return"string"==typeof e}function Y(e){return K(e)&&"VOICE"==e.mediaType}function Z(e){return((null==e?void 0:e.scrollTop)||0)+((null==e?void 0:e.clientHeight)||0)>=((null==e?void 0:e.scrollHeight)||0)}function J(e){var t,n;return q(e)?"error"===(null===(t=e.chatMessageData)||void 0===t?void 0:t.displayType)?"".concat(e.timestamp,"-error"):e.chatMessageData?r(e.chatMessageData):"".concat((n=e).partyId,"-").concat(n.msgId,"-").concat(n.timestamp):function(e){return"object"==typeof e&&!q(e)}(e)?X(e)?function(e){var t;return"".concat(e.timestamp,"-").concat(null!==(t=e.msgId)&&void 0!==t?t:"","-").concat(e.partyId,"-").concat(e.notes?"notes":"disposition")}(e):"scenario"===re(e)?function(e){return"".concat(e.timestamp,"-").concat(e.msg,"-scenario")}(e):K(e)?function(e){var t;return"".concat(e.timestamp,"-").concat(null!==(t=e.msgId)&&void 0!==t?t:"","-").concat(e.direction)}(e):r(e):e;function r(e){var t;return"".concat(e.timestamp,"-").concat(null!==(t=e.msgId)&&void 0!==t?t:"","-").concat(e.source)}}function Q(e,t,n){var r=null==e?void 0:e.querySelector("[data-index='".concat(t,"']"));if(!r)return{id:"",offset:0};var a=((null==e?void 0:e.scrollTop)||0)-r.offsetTop;if(a>0)return Q(e,t+1,n);var o=n[t];return o?"string"==typeof o?Q(e,t+1,n):{id:J(n[t]||""),offset:a}:{id:"",offset:0}}function ee(e,t){var n=function(e,t){if(!t.name)return null;var n=(0,i.getFileNameAndExtension)(t.name),r=n.extension,a=n.name,o=[];return k.CHAT_PROHIBITED_EXTENSIONS.includes(".".concat(r))&&o.push({code:z.ErrorCode.FileInvalidType,message:e.EXTERNAL_CHAT.invalid_file_extension_error(a)}),o.length?o:null}(e,t);return n?{file:t,errors:n}:null}function te(e,t,n){return"".concat(function(e,t,n){var r=e.firstName,a=e.lastName,o=e.timestamp,s=e.mediaType,l=n(r,a),c=(0,i.formatDate)(o,"ll"),u=(0,i.formatDate)(o,"h:mm A");return"CHAT"===s?t.EXTERNAL_CHAT.disposition_message_title(l,c,u):t.VOICE_CALL.disposition_message_title(l,c,u)}(e,t,n),"\n\n")+"".concat(e.disposition,"\n\n")+"".concat(t.EXTERNAL_CHAT.disposition_message_service_name()," ").concat(e.serviceName)}function ne(e){var t=document.createElement("div");t.innerHTML=e,t.style.opacity="0",t.style.position="absolute",t.style.display="hidden",t.style.zIndex="-1000",document.body.append(t);var n=t.innerText;return t.remove(),n}function re(e){return W(e)||K(e)||X(e)?e.displayType:void 0}function ae(e,t){var n=Y(e)?e.users:void 0;if(null==n?void 0:n.length)return n.map((function(e){return t(e.firstName,e.lastName)})).join(", ");var r=W(e)?e.displayName:void 0;if(r)return r;var a=K(e)?e:{firstName:void 0,lastName:void 0},o=a.firstName,i=a.lastName;return o||i?t(o,i):void 0}function oe(e){return W(e)&&"file"===e.displayType?{fileId:e.fileId,fileError:e.fileError,fileIsMasked:e.fileIsMasked,fileProgress:e.fileProgress,fileName:e.fileName,fileType:e.fileType,refMsgId:void 0}:function(e){return K(e)&&"file"===e.displayType}(e)?{fileId:e.fileId,refMsgId:e.refMsgId,fileType:e.fileType,fileName:e.fileName,fileError:void 0,fileIsMasked:void 0,fileProgress:void 0}:void 0}var ie=n(5914),se=n(9327);var le=n(6702);function ce(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ue(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function de(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ce(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ce(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var fe=(0,le.createContext)({hasSelection:!1,setHasSelection:f.noop,messages:[],selectedMessages:[],getClipboardBuffer:function(){return""},setClipboardBuffer:f.noop,scrollContainer:null});fe.displayName="ChatMessagesContextProvider";var me=function(e){var t=e.children,n=e.messages,o=e.interactionId,s=e.scrollContainer,l=de((0,a.useState)(!1),2),c=l[0],u=l[1],d=de((0,a.useState)(""),2),f=d[0],m=d[1],v=de((0,a.useState)([]),2),g=v[0],p=v[1],h=(0,a.useRef)(),y=(0,i.useEvent)((function(){return f})),b=(0,i.useValueUpdated)(o);(0,a.useEffect)((function(){b&&(u(!1),m(""),p([]))}),[b]),(0,i.useEventListener)("mouseup",(function(e){if(h.current&&ue(e,MouseEvent)){var t=be(e.target);if(t){var r,a=n.findIndex((function(e){return J(e)===h.current})),o=n.findIndex((function(e){return J(e)===t})),i=[a,o].sort((function(e,t){return e-t})),s=n.slice(i[0],i[1]+1),l=window.getSelection(),c=(null!==(r=null==l?void 0:l.rangeCount)&&void 0!==r?r:0)>0?null==l?void 0:l.getRangeAt(0):void 0;if(s.length>1&&l&&c){var u=a<o,d=document.querySelector("[data-message-id-selection='".concat(h.current,"']")),f=document.querySelector("[data-message-id-selection='".concat(t,"']")),m=u?d:f,v=u?f:d;c.setStartBefore(m||c.startContainer),c.setEndAfter(v||c.endContainer),u?l.setBaseAndExtent(c.startContainer,c.startOffset,c.endContainer,c.endOffset):l.setBaseAndExtent(c.endContainer,c.endOffset,c.startContainer,c.startOffset)}p(s)}}}));var I=(0,a.useCallback)((function(e){h.current=be(e.target)}),[]),S=(0,a.useMemo)((function(){return{hasSelection:c,setHasSelection:u,messages:n,selectedMessages:g,setClipboardBuffer:m,getClipboardBuffer:y,scrollContainer:s}}),[y,c,n,s,g]);return(0,r.jsx)(fe.Provider,{value:S,children:(0,r.jsx)("div",{onMouseDown:I,children:t})})},ve=function(){return(0,le.useContextSelector)(fe,(function(e){return e.messages}))},ge=function(){return(0,le.useContextSelector)(fe,(function(e){return e.selectedMessages}))},pe=function(){return(0,le.useContextSelector)(fe,(function(e){return e.getClipboardBuffer}))},he=function(){return(0,le.useContextSelector)(fe,(function(e){return e.setClipboardBuffer}))},ye=function(){return(0,le.useContextSelector)(fe,(function(e){return e.scrollContainer}))};function be(e){var t,n=void 0;if(ue(e,HTMLElement))n=(null===(t=e.closest("[data-message]"))||void 0===t?void 0:t.querySelector("[data-message-id-selection]"))||void 0;else if(ue(e,Node)){var r,a;n=(null===(a=e.parentElement)||void 0===a||null===(r=a.closest("[data-message]"))||void 0===r?void 0:r.querySelector("[data-message-id-selection]"))||void 0}return(null==n?void 0:n.getAttribute("data-message-id-selection"))||void 0}var Ie=n(4778),Se=n(8202),xe=n(6607),Ce=n(1960),je=n(3764),Te=n(9190),Ae=n(4173),we=n(6070),_e=n(4483);function Ne(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Oe(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Me(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var Ee=function(e){var t=e.className,n=e.children,a=Me(e,["className","children"]);return(0,r.jsx)("button",Oe(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Ne(e,t,n[t])}))}return e}({},a),{className:(0,_e.B)("flex items-center gap-1 rounded border px-2 py-0.5 shadow-4 state-layer-bg-neutral-0 svg-color-current border-default","transition-colors","hover:state-layer-mix-dark-on-white-1","focus:state-layer-mix-dark-on-white-2","active:state-layer-mix-dark-on-white-3",t),children:n}))},ke=n(7282),Le=n(6622);function Pe(){var e=(0,S.useLocalizationState)().t,t=(0,ke.useFormatting)().formatFullName,n=(0,m.useContactsState)("contacts"),r=(0,se.useUserDetailsState)("userDetails"),o=(0,I.useNonAssertedInteractionId)(),s=(0,g.useInteraction)(o),l=(0,u.useSessionState)(["firstName","lastName"]);return(0,a.useCallback)((function(a){var o=function(){if($(a))return;if(q(a)){var o,c,u=a.endTime,d=a.partyId,f=a.text,m=null==s||null===(o=s.parties)||void 0===o?void 0:o.find((function(e){return e.id===d})),v=null==s||null===(c=s.chatParties)||void 0===c?void 0:c.find((function(e){return e.party_id===d})),g=m?t(m.firstName,m.lastName):v?t(v.first_name,v.last_name):t(l.firstName,l.lastName),p=ne(f);return{date:(0,Le.formatDate)(u,{full:!0}),name:g,text:p}}if(X(a)){var h=a.timestamp,y=a.lastName,b=a.firstName,I=a.notes||te(a,e,t);return{date:(0,Le.formatDate)(h,{full:!0}),name:t(b,y),text:I}}if(K(a)||W(a)){var S,x,C=a.timestamp,j=a.contactId,T=a.userId,A=ae(a,t),w=j?null===(S=n[j])||void 0===S?void 0:S.data:T?null===(x=r[T])||void 0===x?void 0:x.data:void 0,_=w?t(w.firstName,w.lastName):"",N=A||_,O=function(e,t){var n=oe(e);if(n)return n.fileName;if(W(e))return e.page?e.title||t.EXTERNAL_CHAT.external_chat_customer_navigates_to():ne(e.msg||"");if(Y(e)){var r=e.isMissedCall?t.ACTIVITY_HISTORY.call_message_missed():"incoming"===e.direction?t.ACTIVITY_HISTORY.call_message_incoming_text():t.ACTIVITY_HISTORY.call_message_outgoing_text();return"".concat(r,"\n\n")+"".concat((0,i.formatDate)(e.timestamp,"LT"),", ").concat(e.duration,"\n\n")}return"msg"in e&&"string"==typeof e.msg?ne(e.msg):void 0}(a,e);if(!O)return;return{date:(0,Le.formatDate)(C,{full:!0}),name:N,text:O}}return null}();return o?"[".concat(o.date,"] ").concat(o.name,"\n\n").concat(o.text,"\n\n"):""}),[n,t,null==s?void 0:s.chatParties,null==s?void 0:s.parties,l.firstName,l.lastName,e,r])}function De(e,t,n,r,a,o,i){try{var s=e[o](i),l=s.value}catch(c){return void n(c)}s.done?t(l):Promise.resolve(l).then(r,a)}function Be(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){De(o,r,a,i,s,"next",e)}function s(e){De(o,r,a,i,s,"throw",e)}i(void 0)}))}}function Re(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function He(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Re(e,t,n[t])}))}return e}function Fe(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(s){o=[6,s],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function Ue(e){var t=function(e){return(null==e?void 0:e.commonAncestorContainer.nodeType)===Node.ELEMENT_NODE?null==e?void 0:e.commonAncestorContainer:null==e?void 0:e.commonAncestorContainer.parentElement}(e);return ze(t)}function ze(e){var t,n=null==e?void 0:e.closest(et()),r=null==n?void 0:n.getAttribute("data-message-id"),a=null!==(t=null==n?void 0:n.getAttribute("data-global-interaction-id"))&&void 0!==t?t:void 0;return"current"===a&&(a=void 0),r?{messageId:r,globalInteractionId:a}:void 0}function Ge(e){if(e){var t=e.extractContents(),n=Ke(t);i.Mask.obscureHTML(n),t=document.createDocumentFragment(),Array.from(n.childNodes).forEach((function(e){t.appendChild(e)})),e.insertNode(t)}}function Ve(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=He({},t);if(e){Xe(e);var r=e.extractContents(),a=Ke(r),o=$e(a,n),s=(0,Ae.uuid)();o.classList.add("bp-masked"),o.id=s;var l=o.innerHTML;return i.Mask.obscureHTML(o),n[s]={originalText:l,maskedText:o.innerHTML},e.insertNode(o),n}}function Ke(e){var t=document.createElement("span");return e.childNodes.forEach((function(e){var n=e.cloneNode(!0);t.append(n)})),t}function Xe(e){var t=e.startContainer.parentElement;(We(t)||qe(t))&&(e.setStartBefore(e.startContainer),e.setStartBefore(e.startContainer));var n=e.endContainer.parentElement;(We(n)||qe(n))&&(e.setEndAfter(e.endContainer),e.setEndAfter(e.endContainer))}function We(e){return null==e?void 0:e.classList.contains("bp-masked")}function qe(e){return"A"===(null==e?void 0:e.nodeName)}function $e(e,t){var n=e.cloneNode(!0);return function e(n){if(n.classList.contains("bp-masked")){var r=n.id,a=(0,i.stringToHTMLFragment)(t[r].originalText);return delete t[n.id],void n.replaceWith(a)}Array.from(n.children).forEach((function(t){e(t)}))}(n),n}function Ye(e,t){return e.messageId===t.messageId&&e.globalInteractionId===t.globalInteractionId}function Ze(e){return{messageId:$(e)?e:e.msgId,globalInteractionId:$(e)||q(e)||!K(e)?void 0:e.globalInteractionId}}function Je(e){var t,n;return null!==(n=null===(t=Qe(e))||void 0===t?void 0:t.innerHTML)&&void 0!==n?n:""}function Qe(e){var t;return e.messageId?null===(t=document.querySelector(et(e)))||void 0===t?void 0:t.children[0]:void 0}function et(e){if(e){var t=e.messageId,n=e.globalInteractionId;return'[data-message-id="'.concat(t,'"][data-global-interaction-id="').concat(null!=n?n:"current",'"]')}return"[data-message-id][data-global-interaction-id]"}function tt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function nt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return tt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return tt(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var rt=o().memo((function(e){var t=e.interactionId,n=e.children,o=e.className,s=(0,S.useLocalizationState)().t,l=(0,g.useInteractionProp)(t,p.getInteractionStepId),c=ve(),u=(0,i.useBoolean)(),d=u.value,f=u.toggle,m=(0,a.useRef)(null),v=nt((0,a.useState)(),2),h=v[0],y=v[1],b=nt((0,a.useState)(),2),I=b[0],x=b[1],C=nt((0,a.useState)(),2),j=C[0],T=C[1],A=(0,a.useRef)(null),w=(0,Se.useInteractionChatStateMethods)().maskMessage,_=(0,Se.useInteractionChatDataSelector)(l,(function(e){return null==e?void 0:e.masked})),N=ye();(0,a.useEffect)((function(){var e=function(e){var t=e.target;if(t&&(0,H.isHTMLElement)(t)&&(A.current=t,t.classList.contains("bp-masked")&&t.id)){x(t.id);var n=ze(t);n&&T(n),y(t.getBoundingClientRect()),f()}},t=m.current;return null==t||t.addEventListener("click",e),function(){null==t||t.removeEventListener("click",e)}}),[f]);var O=(0,a.useCallback)((function(){var e=c.find((function(e){return j&&!q(e)&&Ye(j,Ze(e))}));if(I&&j&&!q(e)&&!$(e)){if(W(e)){var t,n,r,a,o,s,u,d,v=(null==j?void 0:j.messageId)?null==_||null===(a=_.messages)||void 0===a||null===(r=a[j.messageId])||void 0===r||null===(n=r.textChunks)||void 0===n||null===(t=n[I])||void 0===t?void 0:t.originalText:void 0;if(!v)return void f(!1);var g,p=(0,i.stringToHTMLFragment)(v);null===(o=A.current)||void 0===o||o.replaceWith(p);var h=null!==(g=null===(d=m.current)||void 0===d||null===(u=d.querySelector('[data-message-id="'.concat(e.msgId,'"]')))||void 0===u||null===(s=u.children[0])||void 0===s?void 0:s.innerHTML)&&void 0!==g?g:"";if(!h)return void f(!1);w({itemId:l,messageId:j.messageId,maskedText:h})}f(!1)}}),[l,w,null==_?void 0:_.messages,c,f,I,j]),M=(0,a.useMemo)((function(){var e,t;return{position:"fixed",top:null!==(e=null==h?void 0:h.y)&&void 0!==e?e:0,left:null!==(t=null==h?void 0:h.x)&&void 0!==t?t:0}}),[h]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{ref:m,className:o,children:n}),(0,r.jsx)(E.Popup,{show:d,"data-testid":"selection-popup",placement:"top-start",contentClassName:"border-none bg-transparent shadow-none p-0","data-visible":d,onClickOutside:f,style:M,mountNode:N,content:(0,r.jsxs)(Ee,{onClick:O,"data-testid":"unmask-content-button",children:[(0,r.jsx)(L.IconUnmask,{}),s.EMAIL.button_unMaskSelectedText_text()]})})]})})),at=function(e){var t=e.children,n=e.withMaskAction,o=e.interactionId,s=(0,le.useContextSelector)(fe,(function(e){return e.setHasSelection})),l=(0,g.useInteraction)(o);(0,Ie.assertDefined)(l);var c=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=(0,S.useLocalizationState)().t,a=ve(),o=ge(),s=(0,u.useSessionState)(),l=s.serverOrigin,c=s.loginId,d=s.sessionId,f=s.privileges,v=(0,m.useContactsStateMethods)().updateActivityHistoryMessageText,g=Pe(),h=(0,je.useNotificationsState)("methods").showNotification,y=(0,Se.useInteractionChatStateMethods)().maskMessage,b=he(),I=pe(),x=(0,Se.useInteractionChatDataSelector)((0,p.getInteractionStepId)(e),(function(e){return null==e?void 0:e.masked})),C=(0,Te.useOpenInteractionSlidingModal)(),j=(0,B.useIsCommunicator)(),T=(0,xe.useMainPageUIState)("setKBFloatingState"),A=(0,we.useKbBridgeMethods)().setupInteractionKB;return function(s){var u=s.toggleShow,m=s.selectedText,S=s.selectionData,w=(null!=S?S:{}).range,_=Ue(w),N=a.find((function(e){return _&&Ye(_,Ze(e))}));function O(){return(O=Be((function(){return Fe(this,(function(t){return u(!1),j?C(e.id,"knowledgeBase"):T((function(e){return"closed"===e?"floating":e})),A(m),[2]}))}))).apply(this,arguments)}return m?(0,r.jsxs)(r.Fragment,{children:[!(0,p.isAfterCallWork)(e)&&(0,r.jsxs)(Ee,{onClick:function(){return O.apply(this,arguments)},"data-testid":"search-kb-button",children:[(0,r.jsx)(L.IconKnowledgeBase,{className:"size-4"}),n.GLOBAL.search()]}),!(!t||$(N)||!f.CAN_MASK_INTERACTION_CONTENT||q(N)||"message"!==re(N))&&(0,r.jsxs)(Ee,{onClick:function(){if(!q(N)&&!$(N)){if(K(N)){var t=Je(Ze(N));Ge(w);var r=Je(Ze(N));(0,ie.maskActivityHistoryMessages)({loginId:c,sessionId:d,serverOrigin:l,globalInteractionId:N.globalInteractionId,messages:[{messageId:N.msgId,maskedText:r}]}).then((function(){var t=(0,p.getContactId)(e);t&&v({contactId:t,messageId:N.msgId,messageText:r})})).catch((function(e){h({type:"error",id:je.Notifications.ChatMessageMaskError,tags:["current-view"],message:n.EXTERNAL_CHAT.masking_failed_error_message(),duration:5e3}),Ce.bpLogger.error((0,i.getErrorMessage)(e));var r=Qe(Ze(N));r&&(r.innerHTML=t)}))}else if(W(N)&&N.msgId){var a,o,s=null==x||null===(o=x.messages)||void 0===o||null===(a=o[N.msgId])||void 0===a?void 0:a.textChunks,f=Ve(w,s),m=Je(Ze(N));y({itemId:(0,p.getInteractionStepId)(e),messageId:N.msgId,maskedText:m,textChunks:f})}u(!1)}},"data-testid":"mask-content-button",children:[(0,r.jsx)(L.IconMask,{}),n.EXTERNAL_CHAT.mask()]}),(0,r.jsxs)(Ee,{onClick:function(){u(!1);var e="",t="";o.length>1?t=e=o.reduce((function(e,t){return e+g(t)}),""):((0,Ie.assertDefined)(o[0]),e=m,t=g(o[0])),console.info("\u{1f4cb} Clipboard text\n",e),b(t),navigator.clipboard.writeText(e)},"data-testid":"copy",children:[(0,r.jsx)(L.IconCopy,{}),n.GLOBAL.copy()]}),!!I().length&&(0,r.jsxs)(Ee,{onClick:function(){u(!1);var e="";o.length>1?e=o.reduce((function(e,t){return e+g(t)}),""):((0,Ie.assertDefined)(o[0]),e=g(o[0]));var t=I()+e;console.info("\u{1f4cb} Clipboard text\n",t),navigator.clipboard.writeText(t),b(t)},"data-testid":"add-to-copy",children:[(0,r.jsx)(L.IconAddToCopy,{}),n.GLOBAL.add_to_copy()]})]}):null}}(l,n),d=(0,a.useCallback)((function(e){var t;s(!!(null==e||null===(t=e.range)||void 0===t?void 0:t.toString()))}),[s]),f=ye();return(0,r.jsx)(E.WithSelectionPopup,{getPopupContent:c,onSelectionChange:d,mountNode:f,popupContentClassName:"border-none bg-transparent shadow-none flex gap-1",children:n?(0,r.jsx)(rt,{interactionId:o,children:t}):t})},ot=function(e){var t=e.children,n=e.withMaskAction,a=e.messages,o=e.interactionId,i=e.scrollContainer;return(0,r.jsx)(me,{messages:a,interactionId:o,scrollContainer:i,children:(0,r.jsx)(at,{withMaskAction:n,interactionId:o,children:t})})};var it=n(7914);function st(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function lt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){st(e,t,n[t])}))}return e}function ct(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function ut(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var dt=function(e){var t=e.children,n=e.messageId,o=ut(e,["children","messageId"]),s=Pe(),l=(0,le.useContextSelector)(fe,(function(e){return e.hasSelection})),c=ve(),u=pe(),d=he(),f=ye(),m=(0,a.useMemo)((function(){return c.find((function(e){return J(e)===n}))}),[n,c]),v=(0,S.useLocalizationState)("t"),g=(0,i.useBoolean)(),p=(0,a.useCallback)((function(){if(m){var e=s(m);console.info("\u{1f4cb} Clipboard text\n",e),navigator.clipboard.writeText(e),d(e),g.setFalse()}}),[s,m,g,d]),h=(0,a.useCallback)((function(){if(m){var e=s(m),t=u()+e;navigator.clipboard.writeText(t),d(t),console.info("\u{1f4cb} Clipboard text\n",t),g.setFalse()}}),[u,s,m,g,d]);return(0,r.jsxs)(it.Root,{open:!l&&g.value,onOpenChange:g.toggle,children:[(0,r.jsx)(it.Trigger,{asChild:!0,children:(0,r.jsx)("div",ct(lt({},o),{children:t}))}),(0,r.jsx)(it.Portal,{container:f,children:(0,r.jsxs)(it.Content,{collisionBoundary:f,side:"top",align:"end",className:"z-10 flex gap-1",hideWhenDetached:!0,children:[(0,r.jsxs)(Ee,{onClick:p,children:[(0,r.jsx)(L.IconCopy,{}),v.GLOBAL.copy()]}),(0,r.jsxs)(Ee,{onClick:h,children:[(0,r.jsx)(L.IconAddToCopy,{}),v.GLOBAL.add_to_copy()]})]})})]})};n(5977);var ft=n(3346),mt=n(7777),vt=n(7005),gt=(0,vt.atom)(""),pt=(0,vt.atom)(-1),ht=(0,vt.atom)(void 0),yt=(0,vt.atom)(null);function bt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function It(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function St(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var xt=function(e){var t=function(){a(),null==o||o()},n=e.rejection,a=e.onClose,o=e.onCloseCallback,i=e.totalFilesAmount,s=St(e,["rejection","onClose","onCloseCallback","totalFilesAmount"]),l=(0,vt.useAtomValue)(yt),c=(0,S.useLocalizationState)("t"),u=(0,f.uniq)(n.flatMap((function(e){return e.errors.map((function(e){return e.message}))})));return(0,r.jsxs)(L.Modal,It(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){bt(e,t,n[t])}))}return e}({},s),{onClose:t,children:[(0,r.jsx)(L.Modal.Header,{type:"error",children:c.CHAT_CENTER.upload_failed()}),(0,r.jsxs)(L.Modal.Content,{children:[(0,r.jsx)(L.InlineAlert,{variant:"error",children:(0,r.jsx)("ul",{className:"m-0 p-0",children:u.map((function(e,t){return(0,r.jsx)("li",{children:e},t)}))})}),(0,r.jsx)("p",{className:"my-6",children:c.CHAT_CENTER.failed_to_upload(n.length,i)}),(0,r.jsx)("div",{className:"flex flex-col gap-2",children:n.map((function(e,t){return"attachment"===(0,Le.mimeTypeToExternalChatFileType)(e.file.type)?(0,r.jsx)(L.Attachment.File,{name:e.file.name,className:"pointer-events-none",isFailed:!0},t):(0,r.jsx)(L.Attachment.Image,{name:e.file.name,className:"pointer-events-none",isFailed:!0},t)}))})]}),(0,r.jsxs)(L.Modal.Actions,{children:[(0,r.jsx)(mt.Button,{variant:"secondary",onClick:function(){null==l||l.click(),t()},children:c.CHAT_CENTER.select_files()}),(0,r.jsx)(mt.Button,{variant:"primary",onClick:function(){return t()},children:c.WINDOW_POPUP_TITLES_AND_MESSAGES.window_buttonOk()})]})]}))},Ct=n(7176),jt=(n(2234),{isAttachmentsListReady:function(){return!0},getAttachmentsList:function(){return[]},addAttachment:f.noop,removeAttachment:f.noop,clearAttachmentsList:f.noop,initializeAttachmentsList:f.noop,fileRejections:[],setFileRejections:f.noop});var Tt=(0,le.createContext)(jt);Tt.displayName="ChatAttachmentsUIContext";var At=(0,Ct.createUIStateSelectorHook)(Tt,"chatAttachmentsUIState").useChatAttachmentsUIState,wt=(0,le.createContext)(jt);wt.displayName="EmailAttachmentsUIContext";(0,Ct.createUIStateSelectorHook)(wt,"emailAttachmentsUIState").useEmailAttachmentsUIState;var _t=n(2977);function Nt(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ot(e){return function(e){if(Array.isArray(e))return Nt(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Nt(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Nt(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}n(7505);n(1510);n(4692);n(5770),n(8269);var Mt=n(9552);function Et(e,t,n){var r=function(e,t,n){var r=(0,i.useAsRef)((0,m.useActivityHistoryByContactId)(t)),o=(0,i.useAsRef)((0,c.useContactActivityHistory)().getMessages);return(0,a.useCallback)((function(){var e=r.current||{},a=e.isLoading,i=e.reachedLimitByMedia;return a||"transcript"===n||(null==i?void 0:i[Le.chatTypeToMedia[n]])||!t?Promise.resolve(!1):o.current({contactId:t,type:n}).then((function(){return!0})).catch((function(e){return console.error(e||"Error while trying loadMessages when top is reached")}))}),[r,t,o,n])}(0,t,n),o=(0,a.useRef)(!1),s=(0,a.useRef)(0);return(0,a.useCallback)((function(){var e=function(){return o.current||s.current>5?Promise.resolve(!1):(o.current=!0,r().then((function(e){return s.current=0,o.current=!1,e})).catch((function(t){s.current+=1,o.current=!1,console.error(t||"Error while trying load messages again until scroll"),e()})))};e()}),[r])}const kt="voiceTranscript_NoMessages_noMessages_UX4AP",Lt="voiceTranscript_NoMessages_noRecent_7ixir",Pt="voiceTranscript_NoMessages_searchForOlder_QGkjJ";var Dt=function(e){var t=e.type,n=e.contactId,o=(0,c.useContactActivityHistory)(),i=o.isLoading,s=o.getMessages,l=(0,S.useLocalizationState)().t,u=function(e){var t=(0,m.useContactsState)("activityHistory");return(0,a.useMemo)((function(){return(0,f.get)(t[e],"reachedLimit",!0)}),[t,e])}(n),d=(0,a.useCallback)((function(){s({type:t,contactId:n})}),[n,s,t]);return(0,r.jsx)(r.Fragment,{children:!i&&u?(0,r.jsx)("div",{className:kt,children:(0,r.jsx)("p",{className:Lt,children:l.INTERNAL_CHAT.chat_history_no_recent_found(t)})}):(0,r.jsxs)("div",{className:kt,children:[(0,r.jsx)("p",{className:Lt,children:l.INTERNAL_CHAT.chat_history_no_recent_while_loading(t)}),(0,r.jsx)(E.Button,{className:Pt,onClick:d,children:l.INTERNAL_CHAT.chat_history_search_for_older(t)})]})})},Bt=function(e){var t=e.contactId,n=e.type;return"messages"!==n&&"calls"!==n?null:(0,r.jsx)(Dt,{type:n,contactId:t})},Rt=n(8770),Ht=n(3711);const Ft={messageWrapper:"voiceTranscript_Chat_messageWrapper_drgLf",messageTopInfo:"voiceTranscript_Chat_messageTopInfo_VoA3v",incoming:"voiceTranscript_Chat_incoming_6DHeo",messageBlock:"voiceTranscript_Chat_messageBlock_i7M0B",outgoing:"voiceTranscript_Chat_outgoing_JD3jd",avatar:"voiceTranscript_Chat_avatar_mUd4N",placementTop:"voiceTranscript_Chat_placementTop_Awuqp",remoteAssistMessageAvatar:"voiceTranscript_Chat_remoteAssistMessageAvatar_FEd8Z",message:"voiceTranscript_Chat_message_x5tfb",urgent:"voiceTranscript_Chat_urgent_KfI8l",messageContent:"voiceTranscript_Chat_messageContent_nw7Cp",messageContentHtml:"voiceTranscript_Chat_messageContentHtml_AuPlx",voice:"voiceTranscript_Chat_voice_GZnDG",voiceRecording:"voiceTranscript_Chat_voiceRecording_crXBM",emi:"voiceTranscript_Chat_emi_LuUC3",errorMessageContent:"voiceTranscript_Chat_errorMessageContent_4XIXs",messageTopInfoGap:"voiceTranscript_Chat_messageTopInfoGap_jZaVp",transcriptSuggestionAvatar:"voiceTranscript_Chat_transcriptSuggestionAvatar_FScZp",timeChannel:"voiceTranscript_Chat_timeChannel_N1P8J",channelIcon:"voiceTranscript_Chat_channelIcon_nzkb9",selectionPopupOption:"voiceTranscript_Chat_selectionPopupOption_UTtPT"};function Ut(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function zt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ut(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ut(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Gt="m-0 mr-1.5",Vt=function(e){var t=e.userId,n=e.displayName,o=e.isSelf,i=e.isScenarioAvatar,s=e.className,l=e.isConference,c=e.showUserAvatar,u=void 0===c||c,d=(0,Rt.useGetUserPictureUrl)(),f=(0,a.useMemo)((function(){if(!l)return!o&&t?d(t):""}),[d,l,o,t]),m=zt((0,a.useMemo)((function(){return n?n.split(" "):["",""]}),[n]),2),v=m[0],g=m[1];return i?(0,r.jsx)(Ht.Avatar,{className:(0,_e.B)(s,Ft.avatar,Gt),type:"scenario",size:"28"}):(0,r.jsx)(r.Fragment,{children:u&&(0,r.jsx)(Ht.Avatar,{className:(0,_e.B)(s,Ft.avatar,Gt),url:f,size:"28",firstName:v,lastName:g,type:l?"conference":"contact"})})};var Kt=function(e){var t,n,a,o=e.children,i=e.className,s=e.isError,l=e.messageId,c=(0,_e.B)(i,(a=s,(n=Ft.errorMessageContent)in(t={})?Object.defineProperty(t,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[n]=a,t));return(0,r.jsx)(E.SelectionItem,{"data-message-id-selection":l,focusOnSelection:!0,touchedOnly:!0,tabIndex:0,className:c,itemId:l,children:o})},Xt=function(e){var t=e.children,n=e.displayName,a=e.isOutgoing,o=e.isSystemMessage,s=e.sendTime,l=e.showTime,c=e.showName,u=(0,S.useLocalizationState)().t,d=(0,_e.B)("text-neutral-fade [&:not(:last-child)]:mr-2");return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"flex justify-between pb-1 text-sm leading-[16px]",children:(0,r.jsxs)("div",{className:(0,_e.B)("flex items-center justify-start",{"w-full justify-end":a}),children:[o&&(0,r.jsx)(L.IconRobot,{className:"mr-2"}),(c||o)&&(0,r.jsx)("span",{className:d,"data-testid":"party-display-name",children:o?u.EXTERNAL_CHAT.system_message():n}),l&&(0,r.jsx)("span",{className:d,"data-testid":"message-time",children:(0,i.formatDate)(s,"h:mm A")})]})}),t]})};function Wt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var qt=o().memo((function(e){var t,n,a=e.className,o=e.children,i=e.message,s=e.isFullWidth,l=e.messageClassName,c=e.withoutBorder,u=(0,ke.useFormatting)().formatFullName,d=i.userId,f=i.isSelf,m=i.timestamp,v=J(i),g=re(i),h=W(i),y=!!h&&!!i.page,b=h?i.source:void 0,I=X(i),S=!!I&&!!i.notes,x=!!I&&!!i.disposition,C=K(i),j=C?i.direction:void 0,T=C?i.mediaType:void 0,A="EMAIL"===T&&!I,w="VOICE"===T&&!I,_=Y(i)?i.users:void 0,N=function(e){return W(e)&&"error"===e.displayType}(i),O=!!oe(i),M=!(I||A||O||w),E="REMOTE_ASSIST"===T,k=_&&_.length>1,L="outgoing"===j||"agent"===b||"system"===b||"navigation"===g||"activityGroup"===g||N||x||f&&!w,P="activityGroup"===g||"REMOTE_ASSIST"===T,D=ae(i,u),B=L&&!f&&!(null==i?void 0:i.userId),R=Boolean(B||w&&!L&&!f||!L&&D),H=(0,p.isScenarioMessage)(g),F=L?"outgoing":"incoming",U=null!==(t=null==_?void 0:_[0].userId)&&void 0!==t?t:d,z=(0,_e.B)(Ft.messageBlock,Ft[F]);return(0,r.jsx)("div",{className:z,"data-disposition":x||void 0,"data-email":A||void 0,"data-error":N||void 0,"data-file":O||void 0,"data-incoming":!L||void 0,"data-testid":"message-item","data-link":y||void 0,"data-notes":S||void 0,"data-outgoing":L||void 0,"data-remote-assist-session":E||void 0,"data-text-message":M||void 0,children:(0,r.jsx)("div",{className:(0,_e.B)("z-0 flex max-w-[71%] flex-auto flex-col",{"w-full max-w-full":s}),children:(0,r.jsxs)("section",{className:(0,_e.B)(Ft.message,Ft[F]),children:["incoming"===F&&!c&&(0,r.jsx)(Vt,{userId:U,isConference:k,displayName:D,isScenarioAvatar:H,showUserAvatar:!0}),P?o:(0,r.jsx)(Kt,{className:(0,_e.B)("relative",{"w-full max-w-full":s},a),isError:N,messageId:v,children:(0,r.jsx)(dt,{messageId:v,className:(0,_e.B)("relative inline-block\n                                        whitespace-normal break-all rounded border p-2\n                                        border-on-secondary text-primary-on-primary before:absolute\n                                        before:-bottom-px before:z-[-1] before:h-0 before:w-0 before:rounded-b-[33%]\n                                        before:border-b-4 before:border-t-0\n                                        before:border-transparent before:border-b-secondary-100 before:content-[''] after:absolute\n                                        after:bottom-0 after:z-0 after:h-0 after:w-0 after:rounded-b-[33%] after:border-b-[9px]\n                                        after:border-t-0 after:border-transparent after:content-[''] hover:text-primary-on-primary",(n={},Wt(n,"rounded-bl-[8px] bg-secondary-50\n                                            before:left-[-5px] before:border-l-[9px] before:border-r-0\n                                            after:left-[-5px] after:border-l-[8px]\n                                            after:border-r-0 after:border-b-secondary-50","incoming"===F),Wt(n,"rounded-br-[8px] bg-primary-background\n                                            before:right-[-5px] before:border-l-0 before:border-r-[9px]\n                                            after:right-[-5px] after:border-l-0\n                                            after:border-r-[8px] after:border-b-neutral-0","outgoing"===F),n),l),children:c?o:(0,r.jsx)(Xt,{displayName:D,isOutgoing:L,isSystemMessage:B,sendTime:m,showName:R,showTime:!w||I,children:o})})})]})})})})),$t="size-1.5 rounded bg-inverse-disabled inline-block",Yt=function(){return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:(0,_e.B)($t,"ml-1.5 mr-1 animate-[dot-transform_1s_alternate_infinite]")}),(0,r.jsx)("div",{className:(0,_e.B)($t,"mr-1 animate-[dot-transform_1s_500ms_alternate_infinite]")}),(0,r.jsx)("div",{className:(0,_e.B)($t,"animate-[dot-transform_1s_1.5s_alternate_infinite]")})]})};var Zt=function(e){var t=e.party,n=e.typingParty,a=t.first_name,o=t.last_name,i=t.user_id,s=(0,S.useLocalizationState)().t,l=(0,(0,ke.useFormatting)().formatFullName)(a,o),c=l||s.EXTERNAL_CHAT.display_name_placeholder(),u=(i?s.EXTERNAL_CHAT.agent_is_typing(l):s.EXTERNAL_CHAT.party_is_typing()).replace(/\.\.\.$/,""),d=(null==t?void 0:t.timestamp)?Number(t.timestamp):Date.now().valueOf();return(0,r.jsxs)(qt,{message:{itemId:t.item_id,partyId:t.party_id,timestamp:d,type:"message",displayType:"message",displayName:c},children:[u," ",n.message,(0,r.jsx)(Yt,{})]})},Jt=function(e){var t,n=e.itemId,o=e.rangeRef,s=e.messagesRef,l=(0,a.useRef)(null),c=(0,g.useInteractionProp)(n,p.getInteractionStepId),u=(0,Se.useInteractionChatData)(c),d=(0,p.getTypingParties)(u),f=d.length>0,m=null===(t=o.current)||void 0===t?void 0:t.endIndex,v=s.current.length-1,h=(0,i.useAsRef)(v===m);return(0,a.useEffect)((function(){var e;f&&h.current&&(null===(e=l.current)||void 0===e||e.scrollIntoView({behavior:"auto",block:"start"}))}),[f,h]),(0,r.jsxs)(r.Fragment,{children:[d.map((function(e,t){return(0,r.jsx)(Zt,{party:e,typingParty:null==u?void 0:u.typingParties[e.party_id]},t)})),f&&(0,r.jsx)("div",{ref:l})]})};function Qt(e,t,n,r,o){var s=(0,P.useInteractionUIItemStateSetter)(),c=(0,i.useAsRef)(function(e){var t,n=(0,g.useInteractionProp)(e,p.getInteractionStepId),r=(0,Se.useInteractionChatData)(n),a=null==r||null===(t=r.messages)||void 0===t?void 0:t.find((function(e){return("customer"===e.source||"agent"===e.source)&&!e.isRead}));return a?J(a):null}(e)),u=(0,i.useAsRef)((0,P.useInteractionUIChatTypeTopItemId)(e,t));return(0,a.useLayoutEffect)((function(){return function(){if(r.current)if(Z(o))s(e,l()((function(e){delete e.tabTopItemId[t]})));else{var a=Q(o,r.current.startIndex,n.current),i=a.id,c=a.offset;s(e,l()((function(e){e.tabTopItemId[t]={id:i,offset:c}})))}}}),[e,n,r,o,s,t]),(0,a.useMemo)((function(){if(c.current)return{index:n.current.findIndex((function(e){return J(e)===c.current})),align:"end"};if(u.current){var e,t=n.current.findIndex((function(e){var t;return J(e)===(null===(t=u.current)||void 0===t?void 0:t.id)}));return{index:t,align:"start",offset:(null===(e=u.current)||void 0===e?void 0:e.offset)||0}}return{index:"LAST"}}),[c,n,u])}var en=o().memo((function(e){var t=e.messages,n=e.itemId,o=e.type,s=e.contactId,c=e.scrollNode,u=e.renderMessage,d=(0,S.useLocalizationState)().t,m=(0,P.useInteractionUIItemStateSetter)(),v=(0,a.useRef)(null),h=(0,a.useRef)(void 0),y=(0,i.useAsRef)(t),b=(0,a.useRef)(!1),I=(0,g.useInteraction)(n),x=(0,p.getServiceNameFromItem)(I),C=(0,p.getChannel)(I),j=(0,E.getChannelImageIcon)(C),T=Et(0,s,o);(0,a.useEffect)((function(){m(n,l()((function(e){e.scrollerApi={scrollToLast:function(){var e;null===(e=v.current)||void 0===e||e.scrollToIndex({index:"LAST"})},scrollTo:function(e,t){var n,r,a=null===(n=y.current)||void 0===n?void 0:n.findIndex((function(t){return e===J(t)}));null===(r=v.current)||void 0===r||r.scrollToIndex({index:a,align:t})}}})))}),[n,y,m]),function(e,t,n,r){var o=(0,i.useAsRef)(e),s=(0,i.usePreviousValueRef)(e),l=(0,i.useValueUpdated)(e.length);(0,a.useLayoutEffect)((function(){var e;if(n.current&&!Z(r)&&J(o.current[0])!==J((null===(e=s.current)||void 0===e?void 0:e[0])||"")&&l){var a,i=Q(r,n.current.startIndex,s.current||[]),c=i.offset,u=i.id,d=o.current.findIndex((function(e){return J(e)===u}));null===(a=t.current)||void 0===a||a.scrollToIndex({index:d,offset:c,align:"start"})}}),[l,s,o,n,r,t])}(t,v,h,c);var A=Qt(n,o,y,h,c),w=(0,a.useCallback)((function(e,t){return J(t)}),[]),_=C?"remoteassist"===C?d.ACTIVITY_HISTORY.remote_assist_title():d.GLOBAL["chat_type_".concat(C)]():"",N=(0,a.useCallback)((function(){return x?(0,r.jsx)("div",{className:"my-6 flex justify-center",children:(0,r.jsxs)("div",{className:"text-neutral-on-secondary",children:[(0,r.jsx)("p",{className:"text-center font-semibold caption-s",children:x}),(0,r.jsxs)("div",{className:"flex items-center justify-center",children:[j&&(0,r.jsx)(j,{className:"mr-1 size-4 icon-disabled"})," ",(0,r.jsx)("p",{className:"text-center caption-s",children:_})]})]})}):null}),[j,_,x]),O=(0,a.useMemo)((function(){return{Header:N,Footer:function(){return(0,r.jsx)(Jt,{itemId:n,messagesRef:y,rangeRef:h})}}}),[n,y,N]),M=(0,a.useCallback)((function(e){h.current=e}),[]),k=(0,a.useCallback)((function(e){c&&c.clientHeight>=e&&T()}),[T,c]),L=(0,a.useMemo)((function(){return(0,f.debounce)(k,100)}),[k]),D=(0,a.useCallback)((function(e){b.current?e&&T():b.current=!0}),[T]),B=(0,a.useCallback)((function(e,t){return u(t)}),[u]);return t.length<1||1==t.length&&$(t[0])?(0,r.jsx)(Bt,{type:o,contactId:s}):(0,r.jsx)(Mt.Virtuoso,{tabIndex:void 0,ref:v,followOutput:!0,data:t,itemContent:B,computeItemKey:w,atTopStateChange:D,initialTopMostItemIndex:A,customScrollParent:c||void 0,components:O,rangeChanged:M,totalListHeightChanged:L,increaseViewportBy:200})}));const tn=n.p+"21ff305d2488d9478cc624e673ec8bab.svg";const nn=n.p+"57f727bf2f169e0b19d872ec87e1ebc4.svg";const rn=n.p+"0c921db40ddee9f34a5d15b376ee0df7.svg";const an=n.p+"910dfbe6763a148f8a6af4b2866390ff.svg";const on=n.p+"3b81ec51938bfa793e8ba0cb4f274188.svg";const sn=n.p+"6157ddd8a81feea7b302231a623e132e.svg";const ln=n.p+"705a55fc7f1f462947be817d84a580cc.svg";const cn=n.p+"14effeb1e434fca9cf40a30e4b4c1cfa.svg";const un=n.p+"720e2babef2e76400cb343b776053cba.svg";const dn=n.p+"a39c903b5cca1b36c65e91151a83b019.svg";const fn={messageRow:"voiceTranscript_Message_messageRow_UOs4p",incoming:"voiceTranscript_Message_incoming_bnpcD",outgoing:"voiceTranscript_Message_outgoing_pKbZe",time:"voiceTranscript_Message_time_wb5xv",message:"voiceTranscript_Message_message_chWfh",link:"voiceTranscript_Message_link_J61uY",error:"voiceTranscript_Message_error_NKpnz",html:"voiceTranscript_Message_html_rIkTi",closable:"voiceTranscript_Message_closable_a7mGz",sentiment:"voiceTranscript_Message_sentiment_jM9aL",icon:"voiceTranscript_Message_icon_XNLkK"};function mn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var vn=o().forwardRef((function(e,t){var n,a=e.message,o=e.itemId,s=e.direction,l=e.closeButton,c=e.isLink,u=e.isHtml,d=e.content,f=a.endTime,m=a.sentiment,v=a.chatMessageData,g=(0,i.useInnerHTML)(d),p=function(e){if((0,D.isSuggestion)(e))return tn;if((0,D.isCurrentChatTranscriptMessage)(e)&&e.chatMessageData.channel)switch(e.chatMessageData.channel){case"sms":return an;case"whatsapp":return dn;case"facebook":return nn;case"line":return rn;case"telegram":return on;case"twitter":return sn;case"viber":return ln;case"web":return cn;case"wechat":return un}}(a),h=J(a),y=F(o),b=(0,r.jsxs)(E.SelectionItem,{ref:t,itemId:h,focusOnSelection:!0,touchedOnly:!0,tabIndex:0,"data-message-id-selection":h,className:(0,_e.B)(fn.message,fn[s],(n={},mn(n,fn.html,u),mn(n,fn.link,c),mn(n,fn.closable,!!l),mn(n,fn.error,"error"===(null==v?void 0:v.displayType)),n)),children:[(0,r.jsx)(dt,{messageId:h,children:(0,r.jsx)("div",{dangerouslySetInnerHTML:g,onClickCapture:function(e){c&&(e.preventDefault(),e.stopPropagation(),y(a))}})}),l]});return(0,r.jsxs)("div",{className:(0,_e.B)(fn.messageRow,fn[s]),children:[(0,r.jsx)("div",{className:(0,_e.B)(fn.time,fn[s]),children:(0,i.formatDate)(f,"h:mm A")}),b,p&&(0,r.jsx)(E.Svg,{src:p,className:(0,_e.B)(fn.icon,fn[s])}),m&&(0,r.jsx)(E.Sentiment,{sentiment:m,className:(0,_e.B)(fn.sentiment,fn[s])})]})}));function gn(e){var t=e.text,n=e.url,r=e.target,a=(0,i.normalizeExternalURL)(n);return"<a href=".concat(a,' target="').concat(r,'">').concat(t,"</a>")}function pn(e){var t,n;return{partyId:e.partyId,msgId:null!==(t=e.msgId)&&void 0!==t?t:"",text:null!==(n=e.msg)&&void 0!==n?n:"",startTime:e.timestamp,endTime:e.timestamp,sentiment:e.sentiment,type:"chatMessage",format:"HTML",isSelf:e.isSelf,chatMessageData:e}}function hn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function yn(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var bn=function(e){var t=e.message,n=e.itemId,a=yn(e,["message","itemId"]),o=t.text,i=void 0===o?"":o,s=(0,D.isHTMLSuggestion)(t),l=(0,D.isLinkSuggestion)(t),c=l?gn({text:t.text,target:n,url:t.suggestionURL}):i;return(0,r.jsx)(vn,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){hn(e,t,n[t])}))}return e}({message:t,isHtml:s,isLink:l,content:c,itemId:n},a))};n(5603);function In(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Sn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return In(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return In(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var xn=function(){},Cn={search:"",setSearch:xn,searchResult:void 0,setSearchResult:xn,showBotSuggestions:!0,toggleBotSuggestions:xn,showSMS:!0,toggleSMS:xn,showTranscript:!0,toggleTranscript:xn},jn=(0,le.createContext)(Cn);jn.displayName="VoiceTranscriptUIContext";var Tn=function(e){var t=e.children,n=Sn((0,a.useState)(Cn.search),2),o=n[0],s=n[1],l=Sn((0,a.useState)(void 0),2),c=l[0],u=l[1],d=(0,i.useBoolean)(Cn.showBotSuggestions),f=d.value,m=d.toggle,v=(0,i.useBoolean)(Cn.showSMS),g=v.value,p=v.toggle,h=(0,i.useBoolean)(Cn.showTranscript),y=h.value,b=h.toggle,I=(0,a.useMemo)((function(){return{search:o,setSearch:s,searchResult:c,setSearchResult:u,showBotSuggestions:f,toggleBotSuggestions:m,showSMS:g,toggleSMS:p,showTranscript:y,toggleTranscript:b}}),[o,c,f,g,y,m,p,b]);return(0,r.jsx)(jn.Provider,{value:I,children:t})};function An(){return(0,le.useContext)(jn)}function wn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _n(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||On(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Nn(e){return function(e){if(Array.isArray(e))return wn(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||On(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function On(e,t){if(e){if("string"==typeof e)return wn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?wn(e,t):void 0}}var Mn=function(e){var t=e.className,n=e.messagesContent,o=e.itemId,i=(0,S.useLocalizationState)().t,s=An(),l=s.search,c=s.setSearch,u=s.setSearchResult,d=s.showBotSuggestions,m=s.showSMS,v=s.showTranscript,g=s.toggleBotSuggestions,p=s.toggleSMS,h=s.toggleTranscript,y=_n((0,a.useState)(l),2),b=y[0],I=y[1],x=_n((0,a.useState)(void 0),2),C=x[0],j=x[1],T=(0,P.useInteractionUIChatScrollerApi)(o),A=(0,a.useMemo)((function(){return(0,f.debounce)((function(e){c(e)}),500)}),[c]),w=(0,a.useMemo)((function(){return l?Object.entries(n).reduce((function(e,t){var n=_n(t,2),r=n[0],a=n[1].marksCount;return Nn(Array.from({length:a}).map((function(e,t){return{messageId:r,index:t}})).reverse()).concat(Nn(e))}),[]):[]}),[l,n]);(0,a.useEffect)((function(){A(b)}),[b,A]),(0,a.useEffect)((function(){if(C){var e=w[C-1];u(e),e&&e.messageId&&(null==T||T.scrollTo(e.messageId,"center"))}else u(void 0)}),[w,T,C,u]);var _=(0,a.useCallback)((function(e){j(e)}),[]),N=(0,a.useCallback)((function(e){I(e.target.value),j(1)}),[]);return(0,r.jsxs)("div",{className:(0,_e.B)("flex items-center gap-2 px-4 py-2 bg-primary-background",t),children:[(0,r.jsx)(L.SearchField,{value:b,onChange:N,layoutClassName:"grow",placeholder:i.EXTERNAL_CHAT.search_transcript()}),!!b&&(0,r.jsx)(E.SearchResultsSwitcher,{current:C||0,total:w.length,onChange:_}),(0,r.jsxs)("div",{className:"flex items-center gap-0.5",children:[(0,r.jsx)(L.ButtonIcon,{size:"40",disabled:!d,onClick:g,className:"rounded-xs",tooltip:i.VOICE_TRANSCRIPT.bot_suggestion_btn_tooltip(),children:(0,r.jsx)(L.IconIntentFilled,{className:"size-6 icon-disabled"})}),(0,r.jsx)(L.ButtonIcon,{size:"40",disabled:!m,onClick:p,className:"rounded-xs",tooltip:i.VOICE_TRANSCRIPT.sms_btn_tooltip(),children:(0,r.jsx)(L.IconMessageExternal,{className:"size-6 icon-disabled"})}),(0,r.jsx)(L.ButtonIcon,{size:"40",tooltip:i.VOICE_TRANSCRIPT.transcript_btn_tooltip(),disabled:!v,onClick:h,className:"rounded-xs",children:(0,r.jsx)(L.IconVoiceTranscript,{className:"size-6 icon-disabled"})})]})]})};const En="voiceTranscript_VoiceTranscript_mark_t17ja",kn="voiceTranscript_VoiceTranscript_highlighted_6A15l";function Ln(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Pn(e){return function(e){if(Array.isArray(e))return Ln(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Ln(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ln(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Dn(e){var t=e.chatMessages,n=e.voiceTranscript,r=e.botSuggestions,o=An(),i=o.showBotSuggestions,s=o.showTranscript,l=o.showSMS;return(0,a.useMemo)((function(){return(l?(0,f.orderBy)(Pn(n).concat(Pn(r),Pn(t.filter((function(e){return"message"===e.displayType||"error"===e.displayType})).map(pn))),"endTime"):Pn(n)).filter((function(e){return t=e.type,{voiceTranscriptMessage:s,suggestion:i,chatMessage:l}[t];var t}))}),[r,t,i,l,s,n])}function Bn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Rn(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Hn(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var Fn=function(e){var t=e.itemContactId,n=void 0===t?"":t,o=e.itemInteractionStepId,s=void 0===o?"":o,l=e.scrollNode,c=e.isDIDChat,u=e.message,d=Hn(e,["itemContactId","itemInteractionStepId","scrollNode","isDIDChat","message"]),f=function(e){var t=e.msgId,n=e.scrollNode,r=e.mediaType,o=e.isDIDChat,s=e.itemInteractionStepId,l=e.itemContactId,c=e.itemGlobalInteractionId,u=e.source,d=e.isRead,f=e.historyMessageGlobalInteractionId,m=(0,i.usePageVisibility)(),v=(0,Se.useInteractionChatStateMethods)(),g=v.markMessageAsRead,p=v.markPersonalMessageAsRead,h=(0,Se.useInteractionChatStateSelector)((function(e){var n,r;return!!(l&&t&&f&&(null===(r=e.unreadPersonalMessages[l])||void 0===r||null===(n=r[f])||void 0===n?void 0:n[t]))})),y=(0,a.useMemo)((function(){return!!m&&(r?h:!(!s||"customer"!==u&&"agent"!==u||d))}),[s,d,r,m,u,h]),b=(0,a.useRef)(null),I=(0,i.useIntersectionObserver)(b,{root:n,enabled:y}).isIntersecting,S=(0,a.useCallback)((function(e){e&&(h?f&&p({globalInteractionId:f,messageId:t,contactId:l}):t&&(s&&g({interactionStepId:s,messageId:t}),c&&o&&l&&p({globalInteractionId:c,messageId:t,contactId:l})))}),[h,t,p,f,l,s,c,g,o]);return(0,a.useEffect)((function(){I&&y&&S(!0)}),[S,I,y]),b}({msgId:u.msgId,itemInteractionStepId:s,itemContactId:n,scrollNode:l,source:u.chatMessageData.source,isRead:u.chatMessageData.isRead,isDIDChat:c});return(0,r.jsx)(vn,Rn(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Bn(e,t,n[t])}))}return e}({message:u},d),{ref:f}))},Un=function(e){var t=e.messageId,n=e.children,o=An().searchResult,i=(0,a.useRef)(null);return(0,a.useEffect)((function(){if(i.current&&o&&o.messageId===t){var e,n,r=null===(e=i.current.querySelectorAll("mark"))||void 0===e?void 0:e[o.index];r.classList.add(kn);var a=null===(n=i.current.querySelectorAll("mark"))||void 0===n?void 0:n[o.index];return null==a||a.scrollIntoView({block:"center"}),function(){return r.classList.remove(kn)}}}),[t,o]),(0,r.jsx)("div",{ref:i,"data-message-highlight":t,children:n})},zn=o().memo((function(e){var t=e.itemId,n=e.contactId,o=e.scrollNode,i=e.messages,s=e.interactionStepId,l=e.messagesContent,c=(0,g.useInteractionProp)(t,(function(e){var t,n;return null!==(n=null==e||null===(t=e.scenarioData)||void 0===t?void 0:t.isDID)&&void 0!==n&&n})),u=(0,a.useCallback)((function(e){if(!q(e))return null;var a=J(e),i=l[a];if(!i)return null;var u=e.isSelf||"suggestion"===e.type?"outgoing":"incoming";return(0,r.jsx)(Un,{messageId:a,children:(0,r.jsx)("div",{"data-message":"true",children:(0,D.isCurrentChatTranscriptMessage)(e)?(0,r.jsx)(Fn,{isDIDChat:c,scrollNode:o,itemContactId:n,itemInteractionStepId:s,direction:u,itemId:t,message:e,content:i.content,isLink:i.isLink,isHtml:i.isHTML}):(0,r.jsx)(vn,{direction:u,itemId:t,message:e,content:i.content,isLink:i.isLink,isHtml:i.isHTML})})})}),[n,s,c,t,l,o]);return(0,r.jsx)(en,{itemId:t,contactId:n,type:"transcript",messages:i,renderMessage:u,scrollNode:o},"".concat(t,"_transcript"))}));function Gn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Vn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Gn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Gn(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Kn=[],Xn=[],Wn=[],qn=function(e){var t=e.chatMessages,n=void 0===t?Kn:t,o=e.voiceTranscript,s=void 0===o?Xn:o,l=e.botSuggestions,u=void 0===l?Wn:l,d=e.itemId,m=e.className,v=e.filtersClassName,h=(0,P.useInteractionUIChatScrollerApi)(d),y=Vn((0,a.useState)(null),2),b=y[0],I=y[1],S=(0,g.useInteraction)(d),x=(0,p.getContactId)(S),C=(0,p.getInteractionStepId)(S),j=Dn({voiceTranscript:s,chatMessages:n,botSuggestions:u}),T=function(e,t){var n=An().search;return(0,a.useMemo)((function(){return e.reduce((function(e,r){var a=r.format,o=void 0===a?"TEXT":a,i=J(r),s=r.text;(0,D.isCurrentChatTranscriptMessage)(r)&&(s=(0,c.normalizeByUrlParser)(r.text));var l="TEXT"===o?s:gn({text:r.text,target:t,url:r.suggestionURL||""}),u=(0,H.highlightHTML)({html:l,textToHighlight:n,className:En}),d=(u.match(new RegExp((0,f.escapeRegExp)(En),"g"))||[]).length;return e[i]={content:u,marksCount:d,isLink:(0,D.isLinkSuggestion)(r),isHTML:(0,D.isHTMLSuggestion)(r)},e}),{})}),[t,e,n])}(j,d),A=(0,a.useMemo)((function(){return j.map(J)}),[j]),w=(0,i.useAsRef)(A),_=(0,a.useCallback)((function(){return w.current}),[w]),N=(0,a.useCallback)((function(e){null==h||h.scrollTo(e,"center")}),[h]);return(0,r.jsxs)("div",{className:(0,_e.B)("flex h-full flex-col",m),children:[(0,r.jsx)(Mn,{className:v,messagesContent:T,itemId:d}),(0,r.jsx)(E.SelectionContainer,{startFrom:"bottom",className:"mt-1 flex h-0 flex-auto flex-col",itemsListProvider:_,onItemSelect:N,children:(0,r.jsx)("div",{className:"relative mr-1.5 flex-auto overflow-y-auto overflow-x-hidden pl-4 pr-2",ref:I,children:(0,r.jsx)(ot,{messages:j,interactionId:d,scrollContainer:b,children:(0,r.jsx)(zn,{itemId:d,contactId:x,messages:j,interactionStepId:C,scrollNode:b,messagesContent:T})})})})]})},$n=n(1360),Yn=n(4031),Zn=n(3156);var Jn=o().memo((function(e){var t,n,o=e.disabled,s=(0,I.useInteractionId)();!function(){var e=(0,I.useInteractionId)(),t=(0,g.useAssociatedChatInteractionProp)(e,p.getChannel),n=(0,g.useAssociatedChatInteractionProp)(e,(function(e){var t;return null==e||null===(t=e.displayData)||void 0===t?void 0:t.number})),r=(0,g.useAssociatedChatInteractionProp)(e,p.hasMultiplyPhones),o=M(),i=o.isTouched,s=o.setIsTouched,l=o.channelOptions,c=o.setSelectedChannel,u=(0,a.useMemo)((function(){return t?r?e():l.find((function(e){return e.value===t})):r&&n?e():l.find((function(e){return"sms"===e.value}));function e(){return l.find((function(e){var r;return t&&"sms"!==t?e.value===t:new RegExp(null!==(r=(0,f.escapeRegExp)(n))&&void 0!==r?r:"").test(e.value)}))||l[0]}}),[t,r,n,l]),d=i(e);(0,a.useEffect)((function(){!d&&u&&c(e,u)}),[d,u,e,s,c])}();var l=M(),c=l.channelOptions,u=l.getSelectedChannel,d=l.getSelectedPhone,m=l.setSelectedChannel,v=d(s),h=u(s);(0,a.useEffect)((function(){!c.length||(null==h?void 0:h.value)&&!c.every((function(e){return e.value!==h.value}))||m(s,c[0])}),[c,s,null==h?void 0:h.value,m]);var y=(0,i.useBoolean)();if((0,i.useEscapeManager)(y.setFalse,{enabled:y.value}),!c.length)return null;var b,S=(0,E.getChannelImageIcon)(null==h?void 0:h.value),x=o||c.length<2&&(null!==(b=null===(n=c[0])||void 0===n||null===(t=n.phones)||void 0===t?void 0:t.length)&&void 0!==b?b:0)<2;return(0,r.jsx)(L.TriggerDropdown,{open:y.value,onOpenChange:y.toggle,disabled:x,className:"min-w-[168px]",modal:!1,side:"top",onEscapeKeyDown:function(e){e.stopPropagation()},align:"start","data-testid":"channel-selector",options:(0,r.jsx)(r.Fragment,{children:c.map((function(e){var t=function(){var t=(0,E.getChannelImageIcon)(e.value);return(0,r.jsxs)(r.Fragment,{children:[t&&(0,r.jsx)(t,{className:"icon-neutral"}),e.text]})};return e.phones?(0,r.jsxs)(L.TriggerDropdown.Sub,{children:[(0,r.jsx)(L.TriggerDropdown.SubTrigger,{contentClassName:"flex items-center gap-2",children:t()}),(0,r.jsx)(L.TriggerDropdown.SubContent,{children:e.phones.map((function(t){return(0,r.jsx)(L.TriggerDropdown.Item,{asChild:!1,"data-selected":t.id===(null==v?void 0:v.id),"aria-selected":t.id===(null==v?void 0:v.id),onClick:function(){m(s,e,t.id)},children:(0,r.jsx)(E.PhoneOption,{value:t.phone,type:t.type})},t.id)}))})]},e.value):(0,r.jsx)(L.TriggerDropdown.Item,{onClick:function(){m(s,e)},asChild:!1,contentClassName:"flex gap-2",children:t()},e.value)}))}),children:(0,r.jsxs)(L.CircleButton,{className:"group flex w-auto shrink-0 gap-0.5 p-[7.5px]",children:[S&&(0,r.jsx)(S,{}),!x&&(0,r.jsx)(L.IconArrowDown8,{className:"group-data-[state=open]:rotate-180"})]})})}));function Qn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function er(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||nr(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tr(e){return function(e){if(Array.isArray(e))return Qn(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||nr(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function nr(e,t){if(e){if("string"==typeof e)return Qn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Qn(e,t):void 0}}function rr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ar(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return rr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return rr(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var or="chat-input",ir=o().memo((function(e){var t,n,o=e.currentMessage,s=e.handleKeyDown,l=e.handleChange,c=e.disabled,u=e.isExternalChat,d=e.interactionStepId,f=e.sendCurrentMessage,m=e.itemId,v=At("isAttachmentsListReady"),h=(0,g.useInteraction)(m);(0,Ie.assertDefined)(h);var y="potential"===(null==h?void 0:h.itemKind)&&(!h.contactId&&!(null==h||null===(t=h.displayData)||void 0===t?void 0:t.number)),b=(0,S.useLocalizationState)().t,I=function(e,t){var n=t.interactionStepId,r=void 0===n?"":n,o=t.isExternalChat,i=er((0,a.useState)(0),2),s=i[0],l=i[1],c=er((0,a.useState)(!1),2),u=c[0],d=c[1],f=er((0,a.useState)(!1),2),m=f[0],v=f[1],g=(0,Se.useInteractionChatStateMethods)(),p=g.sendAgentIsTyping,h=g.sendAgentIsNotTyping;return(0,a.useEffect)((function(){if(o){var e=setInterval((function(){l((function(e){return e+1}))}),1e3);return function(){return clearInterval(e)}}}),[o]),(0,a.useEffect)((function(){var t;if(o)return u||(d(!0),v(!1)),l(0),m||(e.filter(Boolean).length&&p(r),v(!0),t=setTimeout((function(){v(!1)}),5e3)),function(){return clearTimeout(t)}}),tr(e).concat([o])),(0,a.useEffect)((function(){o&&s>10&&u&&(h(r),d(!1))}),[u,r,h,s,o]),o?function(){d(!1),h(r)}:function(){}}([o],{interactionStepId:d,isExternalChat:u}),x=null===(n=(0,M().getSelectedChannel)(m))||void 0===n?void 0:n.value.startsWith("sms"),C=function(e){var t=(0,g.useInteractionProp)(e,p.getInteractionStepId),n=At("getAttachmentsList");return(0,a.useMemo)((function(){return n(t)}),[n,t])}(m),j=!v(null!=d?d:"")||(0,p.isAfterCallWork)(h)||y||!o.trim()&&!C.length,T=At("removeAttachment"),A=(0,a.useRef)(null),w=function(e){var t=ar((0,a.useState)(!1),2),n=t[0],r=t[1],o=(0,i.useResizeObserver)(e);return(0,a.useEffect)((function(){var e,t;if(o){var n=(e=o.target,t=parseFloat(window.getComputedStyle(e).lineHeight)||0,isNaN(t)?0:t),a=function(e){return e.clientHeight}(o.target);r(a>n)}}),[o]),n}(A);return(0,Ie.assertDefined)(d),(0,r.jsx)(L.FieldFrame,{disabled:c,contentClassName:"p-0 overflow-hidden",className:"max-h-36 flex-auto items-end overflow-hidden px-2 py-1.5","data-testid":"chat-text-area",children:(0,r.jsxs)("div",{className:"flex flex-auto flex-col gap-1 overflow-hidden",children:[(0,r.jsx)(E.AttachmentsList,{className:(0,_e.B)("flex flex-wrap gap-1 overflow-auto",{"flex-nowrap":w}),list:C,removeAttachment:T,attachmentsListGroupId:d}),(0,r.jsxs)("div",{className:"flex cursor-text items-end overflow-hidden",children:[(0,r.jsx)(E.ContentEditable,{ref:A,"data-testid":"chat-text-area-input",onKeyDown:s,onChange:l,onBlur:I,className:"h-full w-full overflow-auto",placeholder:b.INTERNAL_CHAT.message_input_placeholder(),plainTextOnly:x,"data-id":or,value:o,disabled:c}),(0,r.jsx)(L.CircleButton,{className:(0,_e.B)("size-6 state-layer-bg-primary-600","hover:state-layer-mix-dark-on-teal-1","focus-visible:state-layer-mix-dark-on-teal-2","active:state-layer-mix-dark-on-teal-3",{"bg-primary-container-disabled":j}),onClick:f,tooltip:{content:b.EXTERNAL_CHAT.send_message_btn_tooltip()},disabled:j,"data-testid":"send-button",children:(0,r.jsx)(L.IconSendFilled,{className:(0,_e.B)("size-4 icon-reversed",{"icon-disabled":j})})})]})]})})}));function sr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function lr(e,t,n,r,a,o,i){try{var s=e[o](i),l=s.value}catch(c){return void n(c)}s.done?t(l):Promise.resolve(l).then(r,a)}function cr(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){lr(o,r,a,i,s,"next",e)}function s(e){lr(o,r,a,i,s,"throw",e)}i(void 0)}))}}function ur(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return sr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return sr(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function dr(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(s){o=[6,s],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var fr=function(e){var t=e.disabled,n=void 0!==t&&t,o=e.chatItem,s=e.buttonElementAtom,l=(0,vt.useSetAtom)(s),c=At(["addAttachment","fileRejections","setFileRejections","isAttachmentsListReady","getAttachmentsList"]),u=c.addAttachment,d=c.fileRejections,h=c.setFileRejections,I=c.isAttachmentsListReady,x=c.getAttachmentsList,C=(0,p.isPotentialInteraction)(o)||(0,p.isCall)(o),j=(0,p.getInteractionStepId)(o),T=(0,S.useLocalizationState)().t,A=(0,ft.useModalComponentOpener)(xt),w=(0,a.useCallback)((function(e){var t=function(){var t=e.target;return t.files?Array.from(t.files):[]};!function(){var e=t();if(e){var n=(0,f.partial)(ee,T),r=(0,Ie.truthy)(e.map(n)),a=e.filter((0,i.not)(n));r.length&&A({rejection:r,totalFilesAmount:e.length}),j&&a.forEach((0,f.partial)(u,j))}}()}),[u,j,A,T]);(0,a.useEffect)((function(){I(j)&&d.length&&A({rejection:d,onCloseCallback:function(){return h([])},totalFilesAmount:x(j).length+d.length})}),[d,x,j,I,A,h]),(0,i.useDidUnmount)((function(){l(null),h([])}));var _=function(e){var t=e.chatItem,n=(0,je.useNotificationsState)("methods"),r=n.showNotification,a=n.hideNotificationsByTag,o=(0,m.useContactsState)("contacts"),s=M(),l=s.getSelectedChannel,c=s.getSelectedPhone,u=l(t.id),d=c(t.id),f=(0,p.getMessengers)(o,t),h=(null==d?void 0:d.phone)||(0,p.getPhoneFromItem)(t),I=(0,_t.useErrorValidation)(),S=(0,y.useServiceState)().selectedService,x=(0,v.useDIDNumberState)().selectedDIDNumber,C=(0,p.getContactId)(t),j=(0,p.getServiceId)(t),T=(0,g.useInteractionStateMethods)().initiateChat,A=j||S,w=(0,b.useServicesDispositionsState)().services,_=(0,p.getAssociatedChatServiceId)(w,S);return(0,i.useEvent)((function(){var e,n=(null==f||null===(e=f.find((function(e){return e.type===(null==u?void 0:u.value)})))||void 0===e?void 0:e.userId)||h;if(!n)return!1;var o=Ot(I.getServiceAndDIDNumbersErrors({service:A,didNumber:x,interactionType:"sms"})).concat(Ot(I.getChannelError({selectedChannel:null==u?void 0:u.value})));return o.length?(r(o[0]),!1):(a("interaction-init"),T({channel:null==u?void 0:u.value,address:n,displayData:null==t?void 0:t.displayData,serviceId:_,accessNumberId:x,contactId:C,origination:"interaction"}),!0)}))}({chatItem:o}),N=(0,a.useCallback)(cr((function(){return dr(this,(function(e){return C?[2,{selectFiles:_()}]:[2,{selectFiles:!0}]}))})),[_,C]),O=ur((0,a.useState)(null),2),E=O[0],k=O[1];return(0,a.useEffect)((function(){l(E)}),[E,l]),(0,r.jsx)(vr,{ref:function(e){var t,n;t=e,((null!=(n=HTMLButtonElement)&&"undefined"!=typeof Symbol&&n[Symbol.hasInstance]?n[Symbol.hasInstance](t):t instanceof n)||null===e)&&k(e)},onFileInputClick:N,handleUploadFiles:w,isDisabled:n})},mr=o().forwardRef((function(e,t){var n=e.onFileInputClick;return(0,r.jsx)("button",{onClick:n,ref:t,className:"invisible absolute z-[-1] w-0"})})),vr=(0,E.withFileInput)(mr),gr=n(2952),pr=n(3941),hr=n(6508);function yr(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function br(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ir(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function Sr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||Cr(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function xr(e){return function(e){if(Array.isArray(e))return br(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Cr(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Cr(e,t){if(e){if("string"==typeof e)return br(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?br(e,t):void 0}}function jr(e){var t,n,r,o,s,c,u,d=Sr((0,vt.useAtom)(ht),2),h=d[0],I=d[1],x=e.itemId,C=e.serviceId,j=Sr((0,vt.useAtom)(pt),2),T=j[0],A=j[1],w=Sr((0,vt.useAtom)(gt),2),_=w[0],N=w[1],O=(0,je.useNotificationsState)("methods"),k=O.showNotification,L=O.hideNotificationById,D=O.hideNotificationsByTag,B=(0,_t.useErrorValidation)(),R=M(),F=R.getSelectedChannel,U=R.getSelectedPhone,z=null===(t=F(x))||void 0===t?void 0:t.value,G=(0,m.useContactsState)("contacts"),V=(0,hr.useIsOffline)(),K=(0,hr.useOfflineStateMethods)().setShowOfflineAlert,X=(0,S.useLocalizationState)("t").ERROR_MESSAGES,W=(0,g.useInteraction)(x),q=null!==(c=null==W?void 0:W.id)&&void 0!==c?c:"",$=(0,p.getMessengers)(G,W),Y=(0,p.getInteractionStepId)(W),Z=(0,g.useInteractionStateMethods)().initiateChat,J=(0,Se.useInteractionChatStateMethods)(),Q=J.sendMessage,ee=J.addMessageToPending,te=J.sendFile,ne=J.openChannel,re=(0,P.useInteractionUIState)(),ae=re.getItemState,oe=re.setItemState,ie=At(["clearAttachmentsList","getAttachmentsList","isAttachmentsListReady"]),se=ie.clearAttachmentsList,le=ie.getAttachmentsList,ce=ie.isAttachmentsListReady,ue=(0,y.useServiceState)().selectedService,de=(0,gr.useDidState)("didNumbers"),fe=(0,v.useDIDNumberState)().selectedDIDNumber,me=(0,p.isCall)(W)&&(null==W||null===(n=W.callData)||void 0===n?void 0:n.incoming)?W.callData.fromNumber:null==W||null===(r=W.callData)||void 0===r?void 0:r.destination,ve=(null===(o=U(x))||void 0===o?void 0:o.phone)||(0,p.getPhoneFromItem)(W),ge=me===ve,pe=(0,a.useMemo)((function(){if((0,p.isCall)(W))if((0,p.isOutboundInteraction)(W)){var e,t=(null==W?void 0:W.accessNumberId)&&(null===(e=de[W.accessNumberId])||void 0===e?void 0:e.isSMS);if(ge&&t)return W.accessNumberId}else{var n,r;if((null==W||null===(n=W.scenarioData)||void 0===n?void 0:n.isDID)&&(!fe||(null===(r=de[fe])||void 0===r?void 0:r.isSMS))){var a=!0,o=!1,i=void 0;try{for(var s,l=Object.keys(de)[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value;if(de[c].isSMS)return c}}catch(u){o=!0,i=u}finally{try{a||null==l.return||l.return()}finally{if(o)throw i}}}}return fe}),[W,de,ge,fe]),he=(0,p.getServiceId)(W),ye=C||(ge?he:ue),be=(0,b.useServicesDispositionsState)().services,Ie=(0,p.getAssociatedChatServiceId)(be,ye)||(0,p.getAssociatedChatServiceId)(be,ue),xe=null!==(u=null===(s=ae(q))||void 0===s?void 0:s.chatMessage)&&void 0!==u?u:"",Ce=le(Y),Te=(0,a.useCallback)((function(e){oe(q,l()((function(t){t.chatMessage="string"==typeof e?e:e(t.chatMessage)})))}),[q,oe]),Ae=(0,a.useCallback)((function(){!V&&Te("")}),[V,Te]),we=(0,a.useCallback)((function(){var e,t=(0,f.get)(W,"contactId"),n=(null==$||null===(e=$.find((function(e){return e.type===z})))||void 0===e?void 0:e.userId)||ve;if(n&&z)return ee({content:xe,channel:z,type:"message"},n),Z({channel:z,address:n,serviceId:Ie,accessNumberId:pe,contactId:t,displayData:null==W?void 0:W.displayData,origination:"interaction"}),Ae()}),[z,W,$,ve,ee,xe,Z,Ie,pe,Ae]),_e=(0,a.useCallback)((function(){if((0,p.isExternalChat)(W))ce(Y)&&(xe&&Q({content:(0,H.condenseNewLines)(xe),itemId:Y,channel:z,type:"message"}),Ce.length&&(Ce.forEach((function(e){e.fileData&&te({fileData:e.fileData,itemId:Y,channel:z||"sms"})})),se(Y)),Ae());else{var e,t=(null==$||null===(e=$.find((function(e){return e.type===z})))||void 0===e?void 0:e.userId)||ve;ye&&W&&Ie&&z&&t&&(ee({content:xe,channel:z,type:"message"},t),Z({channel:z,address:t,serviceId:Ie,contactId:W.contactId,displayData:W.displayData,accessNumberId:pe,origination:"interaction"})),Ae()}}),[ve,$,z,W,ce,Y,xe,Ce,Ae,Q,se,te,ye,Ie,ee,Z,pe]),Ne=(0,a.useCallback)((function(){if(xe.startsWith("/invite")){var e=xe.split(" ");if(2!==e.length)k({id:je.Notifications.ChatChannelInviteBadFormatError,type:"error",message:X.chat_channel_invite_bad_format(),tags:["current-view"],duration:3e4,closable:!0});else{var t=e[1];if(pr.messengerTypes.includes(t)){var n;L(je.Notifications.ChatChannelInviteBadFormatError),L(je.Notifications.ChatChannelInviteUnknownMessengerError);var r=(null==$||null===(n=$.find((function(e){return e.type===t})))||void 0===n?void 0:n.userId)||ve;he&&r&&ne({channel:t,address:r,interactionStepId:Y,serviceId:he}),Ae()}else k({id:je.Notifications.ChatChannelInviteUnknownMessengerError,type:"error",tags:["current-view"],message:X.chat_channel_invite_unknown_messenger(),duration:3e4,closable:!0})}return!0}}),[$,xe,L,Y,he,ne,ve,k,Ae,X]),Oe=(0,a.useCallback)((function(){if(V)K(!0);else{if(xe){var e,t=null===(e=ae(x))||void 0===e?void 0:e.scrollerApi;null==t||t.scrollToLast()}if((0,p.isPotentialInteraction)(W)||(0,p.isCall)(W)){var n=xr(B.getServiceAndDIDNumbersErrors({service:ye,didNumber:pe,interactionType:"sms"})).concat(xr(B.getChannelError({selectedChannel:z})));if(n.length)return void k(n[0]);if(xe){var r=B.getMessageErrors({message:xe,channel:z||"sms"});if(r.length)return void k(r[0])}return D("interaction-init"),xe&&we()}var a=B.getMessageErrors({message:xe,channel:z||"sms"});if(a.length)k(a[0]);else if(Y){if(Ne())return;return(xe||Ce.length)&&_e()}}}),[V,xe,W,z,B,Y,K,ae,x,ye,pe,D,we,k,Ce.length,_e,Ne]),Me=(0,i.useEvent)((function(e){Te((function(t){return t.slice(0,T)+e+t.slice(T+1,_.length)})),N(""),I(void 0);var t=document.querySelector('[data-testid="chat-text-area-input"]');Ir(t,HTMLElement)&&setTimeout((function(){t.focus(),-1===T?(0,E.moveCursorToTheEnd)(t):(0,E.setCursorPosition)(t,T+e.length)}))})),Ee=(0,a.useCallback)((function(e){var t=function(){I(void 0),A(-1),N("")},n=Ir(e.target,HTMLElement)?e.target:void 0;if(n){var r=(0,E.getCursorPosition)(n);if(";"===e.key&&(A(r),I("predefinedMessages"))," "===e.key&&r-1===T&&t(),"Escape"===e.key&&"predefinedMessages"===h&&(t(),e.preventDefault(),e.stopPropagation()),"Enter"===e.key){if(e.shiftKey||e.ctrlKey)return;e.preventDefault(),e.stopPropagation(),Oe()}}}),[h,I,T,Oe,N,A]),ke=(0,a.useCallback)((function(e,t){var n=e.target;if((0,H.isHTMLElement)(n)){n.scrollTop=n.scrollHeight;var r=(0,E.getCursorPosition)(n);Te(t),_&&r<=T?(I(void 0),N("")):N("predefinedMessages"===h?t.slice(T+1):"")}}),[h,_,T,I,Te,N]),Le=function(e,t){return(0,a.useCallback)((function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){return e};return function(r){var a=document.querySelector(t);(0,f.flow)(n,(function(n){var r=0,o=null;return e((function(e){var s,l,c,u,d,f,m,v=function(e){return e.getFirstNode()!==e.getLastNode()},g=function(e){return e.getSelectionStartIndex()!==e.getSelectionEndIndex()},p=new i.Selection,h=null==p?void 0:p.getLastNode(),y=(null==h?void 0:h.nodeType)===Node.TEXT_NODE?null==h?void 0:h.parentElement:h,b=null==y?void 0:y.closest(t);return a?(e="<br><br>"===e.substring(e.length-8)?e.substring(0,e.length-4):e,b?p&&h?(function(e){var t;if(v(e))r=null!==(t=e.getSelectionStartIndex())&&void 0!==t?t:0,o=e.getFirstNode();else if(g(e)){var n;r=null!==(n=e.getSelectionStartIndex())&&void 0!==n?n:0,o=e.getFirstNode()}else{var a;r=null!==(a=e.getSelectionEndIndex())&&void 0!==a?a:0,o=e.getLastNode()}}(p),(v(m=p)||g(m))&&m.deleteSelected(),o&&(u=r,f=null!==(d=null==(c=o)?void 0:c.textContent)&&void 0!==d?d:"",c.textContent=(null==f?void 0:f.slice(0,u))+n+(null==f?void 0:f.slice(u))),null!==(l=null===(s=document.querySelector(t))||void 0===s?void 0:s.innerHTML)&&void 0!==l?l:e):e:e+n):e+n})),{nodeToFocus:o,offsetToFocus:r,dataToAdd:n}}),(function(e){var t=e.nodeToFocus,n=e.offsetToFocus,r=e.dataToAdd;yr(a,HTMLElement)&&(a.focus(),requestAnimationFrame((function(){var e=function(){a&&(t?o(t):a.lastChild&&i(a.lastChild))},o=function(e){var t,a,o=document.createRange();o.setStart(e,n+r.length),o.setEnd(e,n+r.length),null===(t=window.getSelection())||void 0===t||t.removeAllRanges(),null===(a=window.getSelection())||void 0===a||a.addRange(o)},i=function(e){var t,n,r,a,o,i,s=document.createRange();s.setStart(e,null!==(o=null===(t=e.textContent)||void 0===t?void 0:t.length)&&void 0!==o?o:0),s.setEnd(e,null!==(i=null===(n=e.textContent)||void 0===n?void 0:n.length)&&void 0!==i?i:0),null===(r=window.getSelection())||void 0===r||r.removeAllRanges(),null===(a=window.getSelection())||void 0===a||a.addRange(s)};e(),requestAnimationFrame(e)})))}))(r)}}),[t,e])}(Te,'[data-id="'.concat(or,'"]'));return(0,a.useMemo)((function(){return{handleSelectPredefinedMessage:Me,sendCurrentMessage:Oe,handleKeyDown:Ee,currentMessage:xe,setCurrentMessage:Te,handleTextareaChange:ke,setPredefinedMessagesSearch:N,predefinedMessagesSearch:_,updateMessage:Le}}),[Me,_,N,xe,Te,ke,Oe,Ee,Le])}var Tr=n(8715);function Ar(e,t,n,r,a,o,i){try{var s=e[o](i),l=s.value}catch(c){return void n(c)}s.done?t(l):Promise.resolve(l).then(r,a)}function wr(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(s){o=[6,s],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function _r(e){var t,n,r=e.itemId,a=e.setCurrentMessage,o=(0,vt.useAtomValue)(yt),i=(0,Te.useOpenInteractionSlidingModal)(),s=(0,vt.useSetAtom)(ht),l=(0,vt.useSetAtom)(pt),c=(0,S.useLocalizationState)("t"),u="mac"===Tr.platformInfo.platform?"\u2318":"Ctrl",d=(0,xe.useMainPageUIState)("setKBFloatingState"),f=(0,B.useIsCommunicator)(),m=(0,we.useKbBridgeMethods)().setupInteractionKB,v=(t=function(){return wr(this,(function(e){return f?i(r,"knowledgeBase"):(d((function(e){return"closed"===e?"floating":e})),m()),[2]}))},n=function(){var e=this,n=arguments;return new Promise((function(r,a){var o=t.apply(e,n);function i(e){Ar(o,r,a,i,s,"next",e)}function s(e){Ar(o,r,a,i,s,"throw",e)}i(void 0)}))},function(){return n.apply(this,arguments)});return[{Icon:L.IconSentimentGood,text:c.EXTERNAL_CHAT.add_emoji(),shortcut:"".concat(u,"E"),onClick:function(){s("emojiPicker")}},{Icon:L.IconAttachment,text:c.EXTERNAL_CHAT.attachment(),shortcut:"".concat(u,"A"),onClick:function(){return null==o?void 0:o.click()}},{Icon:L.IconPredefinedMessage,text:c.EXTERNAL_CHAT.predefined_messages(),shortcut:";",onClick:function(){var e,t,n=document.querySelector('[data-testid="chat-text-area-input"]');e=n,(null!=(t=HTMLElement)&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t)&&(l(n.innerHTML.length),a((function(e){return e+";"})),n.focus(),setTimeout((function(){(0,E.moveCursorToTheEnd)(n)}))),s("predefinedMessages")}},{Icon:L.IconKnowledgeBase,text:c.EXTERNAL_CHAT.knowledge_base(),shortcut:"".concat(u,"K"),onClick:v}]}var Nr=n(7087);var Or=n(4432),Mr=n(1539);const Er="voiceTranscript_ChatForm_smsMessageCounter_MlvOG";function kr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Lr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(l){s=!0,a=l}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return kr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return kr(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Pr(){var e,t,n=document.querySelector('[data-testid="chat-content"]');if(e=n,null!=(t=HTMLElement)&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t)return n}var Dr=o().memo((function(e){var t=e.itemId,n=e.serviceId,o=(0,Yn.useCommunicatorUIState)("interactionChatFormRef"),s=(0,I.useNonAssertedInteractionId)(),l=jr({itemId:t,serviceId:n}),c=l.updateMessage,u=l.handleSelectPredefinedMessage,f=l.sendCurrentMessage,m=l.handleKeyDown,v=l.handleTextareaChange,h=l.setCurrentMessage,y=l.currentMessage,b=(0,vt.useAtomValue)(gt);!function(e){var t=e.currentMessage,n=e.setCurrentMessage,r=e.itemId,o=e.parseVariables,i=(0,je.useNotificationsState)("methods").hideNotificationsByTag,s=(0,g.useInteractionProp)(r,(function(e){return(0,p.isExternalChat)(e)&&(0,p.isInboundInteraction)(e)})),l=(0,Nr.usePredefinedChatMessageState)().greetings,c=(0,Nr.usePredefinedChatMessageStateMethods)().resetGreeting;(0,a.useEffect)((function(){t?c(r):l[r]&&s&&(n(o(l[r])),c(r))}),[r,t,l,i,o,c,n,s])}({currentMessage:y,setCurrentMessage:h,itemId:t,parseVariables:(0,d.useChatResponsesVariablesParser)()});var x=(0,g.useInteractionProp)(t,p.getInteractionStepId),C=(0,g.useInteractionProp)(t,p.isExternalChat),j=function(e,t){var n,r=(0,Or.useAppConfigState)().enableSmsCharacterCount,o=(0,S.useLocalizationState)().t,i=null===(n=(0,M().getSelectedChannel)(e))||void 0===n?void 0:n.value;return(0,a.useMemo)((function(){if(!r||(null==i?void 0:i.startsWith("sms")))return{enabled:!1,text:""};var e=(0,Mr.getCharCount)(t),n=e.msgCount,a=e.charCount,s=e.charsPerSegment;return{enabled:!0,text:1===n?"".concat(a,"/").concat(s):a<1e3?"".concat(a," (").concat(o.EXTERNAL_CHAT.sms_messages_number(n),")"):String(a)}}),[r,i,t,o.EXTERNAL_CHAT])}(t,y),T=j.text,A=j.enabled,w=(0,i.useResizeObserver)(Pr()),_=Lr((0,vt.useAtom)(ht),2),N=_[0],O=_[1],k=(0,g.useAssociatedChatInteraction)(t);(0,Ie.assertDefined)(k);var P,D=_r({setCurrentMessage:h,itemId:t}),B=(0,i.useBoolean)();return(0,i.useEscapeManager)((function(){B.setFalse()}),{enabled:B.value}),(0,i.useEscapeManager)((function(){O(void 0)}),{enabled:Boolean(N)}),(0,r.jsxs)("div",{ref:o,className:"flex px-4 py-2.5","data-testid":"chat-bottom-panel",children:[(0,r.jsx)(fr,{chatItem:k,buttonElementAtom:yt}),A&&(0,r.jsx)("span",{className:Er,children:T}),(0,r.jsxs)("div",{className:"flex flex-auto items-end gap-2",children:[(0,r.jsxs)("div",{className:"flex h-[33px] items-center gap-2",children:[!!s&&(0,r.jsx)(Jn,{}),(0,r.jsx)(L.TriggerDropdown,{"data-chat-actions-menu":!0,modal:!1,open:B.value,onOpenChange:B.toggle,className:"group z-10",align:"start",side:"top",options:D.map((function(e){var t=e.Icon,n=e.text,a=e.shortcut,o=e.onClick;return(0,r.jsxs)("button",{onClick:o,className:"flex w-full min-w-[210px] items-center gap-2",children:[(0,r.jsx)(t,{className:"size-4"}),(0,r.jsx)("p",{className:"flex-auto caption-s text-primary-on-primary",children:n}),(0,r.jsx)("p",{className:"caption-s text-neutral-disabled",children:a})]},n)})),children:(0,r.jsx)(L.CircleButton,{children:(0,r.jsx)(L.IconPlus24,{className:"size-4.5"})})})]}),(0,r.jsxs)($n.Root,{open:Boolean(N),onOpenChange:function(e){e||O(void 0)},children:[(0,r.jsx)($n.Trigger,{asChild:!0,className:"flex flex-auto",onClick:function(e){e.preventDefault()},children:(0,r.jsx)("div",{children:(0,r.jsx)(ir,{itemId:t,sendCurrentMessage:f,interactionStepId:x,isExternalChat:C,currentMessage:y,handleKeyDown:m,handleChange:v})})}),(0,r.jsx)($n.Content,{side:"top",align:"start",className:"z-[100] w-[--radix-popover-trigger-width]",sideOffset:5,onOpenAutoFocus:function(e){e.preventDefault()},children:"emojiPicker"===N?(0,r.jsx)(E.EmojiPopup,{onSelectEmoji:function(e){c((function(e){return e}))(e),O(void 0)}}):"predefinedMessages"===N?(0,r.jsx)(Zn.ViewPredefinedMessages,{handleSelect:u,search:b,className:"w-[--radix-popover-trigger-width]",style:{maxHeight:(null!==(P=null==w?void 0:w.contentRect.height)&&void 0!==P?P:0)-19}}):null})]})]})]})}));(0,E.createComponentLoader)("chatCenter",(function(){return n.e(975).then(n.t.bind(n,9975,23))}),"ChatCenterInteraction").ChatCenterInteractionLoader},4483:(e,t,n)=>{n.d(t,{B:()=>i});var r=n(9478),a=n.n(r),o=n(324);function i(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,o.m6)(a()(t))}}}]);
//# sourceMappingURL=499.942c0ecf.chunk.js.map