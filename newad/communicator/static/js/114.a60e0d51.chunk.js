/*! For license information please see 114.a60e0d51.chunk.js.LICENSE.txt */
"use strict";(self.webpackChunk_bpinc_web_communicator_ui=self.webpackChunk_bpinc_web_communicator_ui||[]).push([[114],{8706:(e,t,n)=>{n.d(t,{Lv:()=>Vw,uU:()=>Ww,Hq:()=>K,OV:()=>Yw,VD:()=>ee});var r=n(2322),a=n(6029),o=n.n(a),i=n(3194),s=n(7773),l=n(4778),c=n(9486),u=n(7836),d=n(7505);function f(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function m(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){f(e,t,n[t])}))}return e}var p=function(e){var t=e.record,n=e.checked,o=e.handleChange,i=(0,c.useLocalizationState)().t,l=(0,u.useIntegrationApiStateMethods)().openRecord,f=(0,s.useInteractionId)(),p=(0,a.useCallback)((function(){o(t.id)}),[o,t.id]),v=(0,a.useCallback)((function(){l(t,f,{source:"user",inNewTab:!1})}),[l,t,f]);return(0,r.jsxs)("li",{className:"flex list-none items-center overflow-hidden",children:[(0,r.jsx)(d.SmCheckbox,m({id:t.id,checked:n,onChange:p,"data-testid":"crm-object-item"},n?{"data-selected":"true"}:void 0)),(0,r.jsx)("div",{onClick:v,className:"ml-3 grow cursor-pointer truncate px-1.5 py-2.5 hover:bg-menu-bg-hover",title:i.DISPOSITION.resolution_crm_object_click_tooltip(t.displayName),"data-testid":"crm-object-name",children:t.displayName})]})},v=function(){var e=(0,c.useLocalizationState)().t,t=(0,s.useInteractionId)(),n=(0,i.useInteractionStateMethods)().toggleAssociatedActivityRecord,o=(0,i.useInteractionProp)(t,(function(e){var t;return null!==(t=null==e?void 0:e.associatedObjects)&&void 0!==t?t:{list:[],selected:[],touched:!1,primary:[]}})),u=o.list,d=o.selected,f=(0,a.useCallback)((function(e){(0,l.assertDefined)(t),n(t,e)}),[n,t]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h4",{className:"first:mt-4",children:e.DISPOSITION.resolution_crm_objects_new_label()}),(0,r.jsxs)("ul",{className:"mb-3 mt-1.5 flex-[1_3_auto] overflow-auto rounded border border-main-border pl-4",children:[u.map((function(e){return(0,r.jsx)(p,{record:e,checked:d.includes(e.id),handleChange:f},e.id)})),!u.length&&(0,r.jsx)("div",{className:"mx-1.5 my-2.5",children:e.DISPOSITION.resolution_crm_objects_empty_label()})]})]})},h=o().memo((function(){return(0,r.jsx)("div",{className:"flex flex-col flex-nowrap overflow-hidden",children:(0,r.jsx)(v,{})})})),b=n(1360),y=n(9717),g=n(173),j=n(1980),I=n(3764);function S(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function O(e){return function(e){if(Array.isArray(e))return S(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return S(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return S(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var x=n(2506);function C(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function _(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function w(e){var t,n,r,o,i=(0,s.useInteractionId)(),l=(0,x.useInteractionUIState)(),c=l.items,u=l.setItemState,d=null!==(n=null===(t=c[i])||void 0===t?void 0:t.dispositionSearch)&&void 0!==n?n:"",f=(r=function(e){u(i,(function(t){return _(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){C(e,t,n[t])}))}return e}({},t),{dispositionSearch:e})}))},(o=(0,a.useRef)(r)).current=r,(0,a.useCallback)((function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];var r;return(r=o).current.apply(r,O(t))}),[])),m=(0,a.useMemo)((function(){if(!d)return e;var t=function(e){return function(t){return!!t.isGroupLabel||t.label.toLowerCase().includes(e.toLowerCase())}}(d);return e.filter(t).reduce(N,[])}),[e,d]);return(0,a.useMemo)((function(){return{searchValue:d,setSearch:f,optionsFilteredBySearch:m}}),[m,d,f])}function N(e,t,n,r){return function(e,t){return e.isGroupLabel&&(!t||t.isGroupLabel)}(t,r[n+1])||e.push(t),e}var A=n(1029),P=n(3830),E=n.n(P),D=n(9478),T=n.n(D),k=n(324);function M(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];return(0,k.m6)(T()(t))}var L=n(6441),R=function(e){var t=e.value,n=e.label,o=e.isGroupLabel,i=e.highlight,s=e.onSelect,l=(0,a.useCallback)((function(){s({value:t,label:n})}),[s,t,n]),c=M("state-layer-bg-neutral-0","hover:state-layer-mix-dark-on-white-1","focus:state-layer-mix-dark-on-white-2","data-[selected=true]:state-layer-mix-dark-on-white-2","active:state-layer-mix-dark-on-white-3","flex w-full py-2.5 pl-9 pr-3"),u=M(c,{"pointer-events-none font-bold":o});return(0,r.jsx)("div",{"data-selectable":"dispositions-accordion",onClick:l,tabIndex:o?-1:0,className:u,"data-testid":"disposition-option",children:o?n:(0,L.highlighted)({highlight:i,text:n})},t)};function F(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function B(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){F(e,t,n[t])}))}return e}function U(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function z(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function H(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function V(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return H(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return H(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var G=function(e){var t=e.className,n=e.searchValue,o=function(e){var t=e.list,n=e.searchValue,r=z(e,["list","searchValue"]);return(0,a.useMemo)((function(){var e;return t.reduce((function(t,o,i,s){var l=function(){return e&&t.push(e)};return o.isGroupLabel?((null==e?void 0:e.content.length)&&l(),e={value:o.value,title:o.label,content:[]}):(null==e||e.content.push({text:o.label,element:(0,a.createElement)(R,U(B({},o,r),{highlight:n,key:o.value}))}),i===s.length-1&&l()),t}),[])}),[n,t,r])}(e),i=V((0,a.useState)((function(){return o.map((function(e){return e.value}))})),2),s=i[0],l=i[1],c=(0,y.usePrevious)(o);(0,a.useEffect)((function(){if(!(null==c?void 0:c.length)&&o.length&&!s.length){var e=o.map((function(e){return e.value}));l(e),f(e)}}),[o,null==c?void 0:c.length,s.length]);var u=V((0,a.useState)(s),2),d=u[0],f=u[1];return(0,a.useEffect)((function(){if(n){var e=o.filter((function(e){return e.content.some((function(e){return e.text.toLowerCase().includes(n.toLowerCase())}))}));f(E()((function(t){e.forEach((function(e){t.includes(e.value)||t.push(e.value)}))})))}else f(s)}),[o,e,n,s]),(0,r.jsx)(A.Root,{type:"multiple",className:t,value:n?d:s,onValueChange:n?f:l,children:o.map((function(e){return(0,r.jsxs)(A.Item,{value:e.value,className:"caption-s",children:[(0,r.jsx)(A.Header,{children:(0,r.jsxs)(A.Trigger,{"data-testid":"disposition-item-header","data-selectable":"dispositions-accordion",className:M("group flex w-full gap-2 px-3 py-2.5","state-layer-bg-neutral-0","hover:state-layer-mix-dark-on-white-1","focus:state-layer-mix-dark-on-white-2","data-[selected=true]:state-layer-mix-dark-on-white-2","active:state-layer-mix-dark-on-white-3"),children:[(0,r.jsx)(j.IconChevronRight16,{className:"group-data-[state=open]:rotate-90"}),(0,r.jsx)("span",{className:"font-semibold",children:e.title})]})}),(0,r.jsx)(A.Content,{children:e.content.map((function(e){return e.element}))})]},e.value)}))})};function W(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function q(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var Y=o().memo((function(e){var t=e.list,n=e.className,a=q(e,["list","className"]);return(0,r.jsx)(d.SmList,{className:M(n,"mt-[8.5px] max-h-[200px] flex-auto overflow-auto rounded border border-main-border"),divided:!0,verticalAlign:"middle","data-testid":"available-dispositions",children:t.map((function(e){return(0,r.jsx)(R,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){W(e,t,n[t])}))}return e}({},a,e),e.value)}))})}));var K=o().memo((function(e){var t=e.dispositionsListClassName,n=e.accordion,o=(0,c.useLocalizationState)().t,i=(0,g.useDispositionSelect)(),s=i.options,l=i.value,u=i.onSelect,d=i.dispositionRequired,f=i.defaultOption,m=w(s),p=m.searchValue,v=m.setSearch,h=m.optionsFilteredBySearch,S=(0,y.useBoolean)(),O=(0,I.useNotificationsState)("notifications")[I.Notifications.DispositionNotSelectedError],x=(0,y.useEvent)((function(e){u(e),v(e.label),S.setFalse()})),C=(0,a.useRef)(null),_=(0,a.useRef)(null),N=(0,y.useEvent)((function(){var e;null===(e=C.current)||void 0===e||e.focus(),S.setTrue()}));return(0,a.useEffect)((function(){O&&N()}),[O,N]),(0,r.jsxs)(b.Root,{open:S.value,onOpenChange:S.toggle,children:[(0,r.jsx)(b.Trigger,{asChild:!0,className:"group",onClick:function(e){var t;e.preventDefault(),null===(t=C.current)||void 0===t||t.focus(),S.setTrue()},onKeyDown:function(e){var t,n,r,a,o=function(e){var t,n,r=Array.from(null!==(n=null===(t=_.current)||void 0===t?void 0:t.querySelectorAll('[data-selectable="dispositions-accordion"]'))&&void 0!==n?n:[]),a=r.findIndex((function(e){return e.hasAttribute("data-selected")}));if(-1===a){var o;null===(o=r[0])||void 0===o||o.setAttribute("data-selected","true")}else{r[a].removeAttribute("data-selected");var i="down"===e?(a+1)%r.length:(a-1+r.length)%r.length;r[i].setAttribute("data-selected","true"),r[i].scrollIntoView()}},i=function(){S.setTrue(),setTimeout((function(){o("down")}))};switch(e.key){case"ArrowDown":if("closed"===e.currentTarget.dataset.state)return e.preventDefault(),void i();o("down");break;case"ArrowUp":e.preventDefault(),o("up");break;case"Enter":if(e.preventDefault(),"open"===e.currentTarget.dataset.state){var s=h.filter((function(e){return!e.isGroupLabel}));if(1===s.length)return x(s[0]),void S.setFalse();a=null===(t=_.current)||void 0===t?void 0:t.querySelector('[data-selected="true"]'),n=a,(null!=(r=HTMLElement)&&"undefined"!=typeof Symbol&&r[Symbol.hasInstance]?r[Symbol.hasInstance](n):n instanceof r)&&a.click()}else i();break;case"Escape":e.preventDefault(),e.stopPropagation(),S.setFalse();break;default:(1===e.key.length&&e.key.match(/\S/)||"Backspace"===e.key)&&(S.setTrue(),u(f))}},children:(0,r.jsx)(j.FieldLayout,{error:null==O?void 0:O.message,label:o.GLOBAL.disposition(),className:"w-full",required:d,children:(0,r.jsx)(j.FieldFrame,{focused:S.value,error:Boolean(O),rightPrefix:(0,r.jsx)(j.IconArrowDown16,{className:"cursor-pointer group-data-[state=open]:rotate-180"}),children:(0,r.jsx)(j.Input,{ref:C,placeholder:o.DISPOSITION.select_disposition(),autoFocus:!0,value:p,onChange:function(e){return v(e.target.value)},onBlur:function(){p!==l.label&&v("")},"aria-label":o.DISPOSITION.disposition_search_input_hint(),"data-testid":"disposition-search-input"})})})}),(0,r.jsx)(b.Portal,{children:(0,r.jsx)(b.Content,{ref:_,sideOffset:2,collisionPadding:20,className:"w-[--radix-popover-trigger-width] border shadow-2  border-default",onOpenAutoFocus:function(e){e.preventDefault()},children:!!h.length&&(0,r.jsx)(r.Fragment,{children:n?(0,r.jsx)(G,{className:t,selectedDisposition:l,onSelect:x,list:h,searchValue:p}):(0,r.jsx)(Y,{className:t,selectedDisposition:l,onSelect:x,list:h,highlight:p})})})})]})})),$=n(2122),X=n(4593);function Q(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Z(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Q(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Q(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var J=3e3,ee=o().memo((function(e){var t=e.layoutClassName,n=(0,s.useInteractionId)(),o=(0,i.useInteractionProp)(n,X.getItemLastNote),l=Z((0,a.useState)(o),2),u=l[0],d=l[1],f=(0,i.useInteractionStateMethods)().updateNote,m=(0,a.useRef)((0,$.debounce)(f,300)).current,p=(0,c.useLocalizationState)().t,v=(0,I.useNotificationsState)("methods"),h=v.showNotification,b=v.hideNotificationById,y=(0,i.useInteractionStateConnector)();(0,a.useEffect)((function(){var e=null==y?void 0:y.dispenser.subscribe({onNoteUpdated:function(e,t){e===n&&d(t)}});return function(){null==e||e.unsubscribe()}}),[n,null==y?void 0:y.dispenser]);var g=(0,a.useCallback)((function(e){var t=e.target.value,r=t.length>J?(h({type:"error",id:I.Notifications.NotesLengthExceededError,tags:["current-view"],message:p.DISPOSITION.notes_length_error_text(String(J))}),t.substring(0,J)):(b(I.Notifications.NotesLengthExceededError),t);m({itemId:n,note:r}),d(r)}),[n,m,b,h,p.DISPOSITION]),S=(0,a.useCallback)((function(e){f({itemId:n,note:e.target.value}),setTimeout((function(){b(I.Notifications.NotesLengthExceededError)}),2e3)}),[n,b,f]);return(0,r.jsx)(j.TextAreaField,{value:u,textAreaClassName:"min-h-[85px]",label:p.DISPOSITION.note(),layoutClassName:t,placeholder:p.DISPOSITION.write_a_note(),onBlur:S,onChange:g,"data-testid":"notes-textarea"})})),te=n(3385),ne=n(635),re=n(5213);function ae(e){var t=e.additionalOnInitializeHandler,n=(0,ne.useAllTimezones)(),r=(0,ne.useFavoritesTimezones)(),o=(0,ne.useTimezonesStateMethods)(),l=(0,s.useInteractionId)(),c=(0,i.useInteraction)(l),u=(0,$.get)(c,"workitemData.suggestedTz")||(0,$.get)(r[0],"name")||(0,$.get)(n[0],"name"),d=(0,a.useMemo)((function(){return n.find((function(e){return e.id===u}))}),[n,u]);(0,a.useEffect)((function(){var e=(0,$.get)(d,"id");d&&e&&(t(e),o.addToFavorites(d))}),[t,d,o])}var oe="L";var ie=n(3346),se=n(4915);function le(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ce(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ue(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function de(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function fe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return le(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return le(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var me=function(e){var t=function(e){var t=e.target;if((0,se.isHTMLInputElement)(t)){var n=p.find((function(e){return e.value===t.value}));n&&y(n)}},n=e.onClose,o=de(e,["onClose"]),l=(0,c.useLocalizationState)().t,u=(0,i.useInteractionStateMethods)().reportProblemItem,f=(0,s.useInteractionId)(),m=(0,i.useInteractionProp)(f,X.isAfterCallWork),p=(0,a.useMemo)((function(){return[{value:"POOR_VOICE_QUALITY",label:l.CALL_DETAILS_FORM.rcp_option_poor_voice()},{value:"CALL_WENT_SILENT",label:l.CALL_DETAILS_FORM.rcp_option_silent()},{value:"CALL_DROPPED",label:l.CALL_DETAILS_FORM.rcp_option_dropped(),disabled:!m},{value:"OTHER",label:l.CALL_DETAILS_FORM.rcp_option_other()}]}),[m,l.CALL_DETAILS_FORM]),v=(0,i.useInteractionProp)(f,X.getInteractionStepId),h=fe((0,a.useState)(p[0]),2),b=h[0],y=h[1];return(0,r.jsxs)(L.Modal,ue(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){ce(e,t,n[t])}))}return e}({onClose:n,size:"tiny",className:"max-w-[354px]","aria-labelledby":"callProblemDialogHeader"},o),{children:[(0,r.jsx)(L.Modal.Header,{role:"heading",id:"callProblemDialogHeader",children:l.CALL_DETAILS_FORM.rcp_heading()}),(0,r.jsx)(L.Modal.Content,{children:(0,r.jsx)(d.SmForm,{children:p.map((function(e){return(0,r.jsx)(d.SmForm.Field,{children:(0,r.jsx)(L.Radio,{label:e.label,name:"problem",value:e.value,checked:b.value===e.value,onChange:t,disabled:e.disabled})},e.value)}))})}),(0,r.jsxs)(L.Modal.Actions,{children:[(0,r.jsx)(L.SemanticButton,{onClick:function(){return n()},tooltip:l.WINDOW_POPUP_TITLES_AND_MESSAGES.window_buttonCancel(),enabledInOffline:!0,children:l.WINDOW_POPUP_TITLES_AND_MESSAGES.window_buttonCancel()}),(0,r.jsx)(L.SemanticButton,{onClick:function(){u(b.value,v),n()},primary:!0,tooltip:l.CALL_DETAILS_FORM.button_call_problem_report_label(),children:l.CALL_DETAILS_FORM.button_call_problem_report_label()})]})]}))};var pe=n(4476),ve=n(8269);const he="communicator_Rescue_content_M19Cx",be="communicator_Rescue_pin_dS0er",ye="communicator_Rescue_links_LOIku",ge="communicator_Rescue_manualLink_KNp4y";function je(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ie(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Se(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var Oe=function(e,t){return("desktop"===e?"https://oty.com/?code=":"http://RescueMobile.com/")+t},xe=function(e){var t=e.type,n=e.onLinkPaste,o=void 0===n?$.noop:n,i=e.onClose,s=Se(e,["type","onLinkPaste","onClose"]),l=(0,c.useLocalizationState)().t,u=(0,a.useCallback)((function(e){return"NOTECHCONSOLERUNNING"===e?l.ERROR_MESSAGES.rescue_modal_no_tech_console_running():l.ERROR_MESSAGES.rescue_modal_unknown_error()}),[l.ERROR_MESSAGES]),f=(0,pe.useRescueState)(),m=f.pinCode,p=f.errorCode,v=(0,pe.useRescueStateMethods)().requestPinCode,h={desktop:Oe("desktop",m),mobile:Oe("mobile",m)},b=v,y=(0,a.useCallback)((function(){o(h.desktop)}),[h.desktop,o]),g=(0,a.useCallback)((function(){o(h.mobile)}),[h.mobile,o]);return(0,a.useEffect)((function(){v()}),[]),(0,r.jsxs)(L.Modal,Ie(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){je(e,t,n[t])}))}return e}({onClose:i,"aria-labelledby":"remoteAssistDialogHeader"},s),{children:[(0,r.jsx)(L.Modal.Header,{role:"heading",id:"remoteAssistDialogHeader",children:l.REMOTE_ASSIST_DIALOG_BOX.remote_assist_heading()}),(0,r.jsx)(L.Modal.Content,{className:he,children:(0,r.jsxs)(L.Modal.Description,{children:[p&&(0,r.jsx)(d.SmMessage,{error:!0,children:u(p)}),(0,r.jsx)("div",{className:be,children:m||"------"}),"chat"===t&&(0,r.jsx)("div",{className:ye,children:(0,r.jsx)("table",{children:(0,r.jsxs)("tbody",{children:[(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:l.REMOTE_ASSIST_DIALOG_BOX.remote_assist_paste_into_chat_text_desktop()}),(0,r.jsx)("td",{children:(0,r.jsx)("a",{href:h.desktop,target:"_blank",rel:"noopener noreferrer",children:h.desktop})}),(0,r.jsx)("td",{children:(0,r.jsx)(ve.IconInsert,{onClick:y})})]}),(0,r.jsxs)("tr",{children:[(0,r.jsx)("td",{children:l.REMOTE_ASSIST_DIALOG_BOX.remote_assist_paste_into_chat_text_mobile()}),(0,r.jsx)("td",{children:(0,r.jsx)("a",{href:h.mobile,target:"_blank",rel:"noopener noreferrer",children:h.mobile})}),(0,r.jsx)("td",{children:(0,r.jsx)(ve.IconInsert,{onClick:g})})]})]})})}),(0,r.jsxs)("div",{className:ge,children:[l.REMOTE_ASSIST_DIALOG_BOX.remote_assist_manual_url_text(),l.REMOTE_ASSIST_DIALOG_BOX.remote_assist_manual_url_address()]}),(0,r.jsx)(d.SmButton,{onClick:b,basic:!0,children:l.REMOTE_ASSIST_DIALOG_BOX.remote_assist_create_another_pin_button()})]})}),(0,r.jsx)(L.Modal.Actions,{children:(0,r.jsx)(d.SmButton,{onClick:function(){return i()},children:l.WINDOW_POPUP_TITLES_AND_MESSAGES.window_buttonClose()})})]}))};function Ce(){return(0,ie.useModalComponentOpener)(xe)}var _e=n(7777);function we(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ne(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ae(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Pe(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function Ee(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return we(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return we(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var De=function(e){var t=e.onSelect,n=e.onClose,o=Pe(e,["onSelect","onClose"]),i=Ee((0,a.useState)(""),2),s=i[0],l=i[1],u=Ee((0,a.useState)(""),2),d=u[0],f=u[1],m=(0,c.useLocalizationState)().t,p=(0,ne.useTimezonesState)().allTimezones.filter((function(e){return-1!==e.fullName.toLowerCase().indexOf(s.toLowerCase())})),v=(0,a.useCallback)((function(){t(d),n()}),[n,t,d]),h=(0,a.useCallback)((function(e){var t,n;t=e.target,(null!=(n=HTMLInputElement)&&"undefined"!=typeof Symbol&&n[Symbol.hasInstance]?n[Symbol.hasInstance](t):t instanceof n)&&l(e.target.value)}),[]),b=(0,a.useMemo)((function(){return p.map((function(e){var t=e.id;return{onClick:function(){return f(t)},onDoubleClick:function(){f(t),v()}}}))}),[p,v]);return(0,r.jsxs)(j.Modal,Ae(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Ne(e,t,n[t])}))}return e}({onClose:n,"aria-labelledby":"timezonesDialogHeader","data-testid":"timezones-modal",className:"max-w-[540px]"},o),{children:[(0,r.jsx)(j.Modal.Header,{id:"timezonesDialogHeader",role:"heading",children:m.WINDOW_POPUP_TITLES_AND_MESSAGES.window_timezones_heading()}),(0,r.jsxs)(j.Modal.Content,{className:"flex flex-col",children:[(0,r.jsx)(j.InputField,{label:m.WINDOW_POPUP_TITLES_AND_MESSAGES.window_timezones_filter_label(),placeholder:m.WINDOW_POPUP_TITLES_AND_MESSAGES.window_timezones_filter_placeholder(),value:s,onChange:h,"data-testid":"search-input"}),(0,r.jsx)("ul",{className:"flex-auto overflow-auto p-0",children:p.map((function(e,t){var n=e.fullName,a=e.id;return(0,r.jsxs)("li",{onClick:b[t].onClick,onDoubleClick:b[t].onDoubleClick,tabIndex:0,className:M("flex items-center justify-between","list-none px-3 py-4 state-layer-bg-neutral-0","hover:state-layer-mix-dark-on-white-1","focus:state-layer-mix-dark-on-white-2",{"state-layer-mix-teal-on-white-2 hover:state-layer-mix-teal-on-white-3 focus:state-layer-mix-teal-on-white-3":a===d}),role:"button","data-testid":"option",children:[n,a===d&&(0,r.jsx)(j.IconCheck24,{className:"ml-2 size-5 icon-fade"})]},a)}))})]}),(0,r.jsxs)(j.Modal.Actions,{children:[(0,r.jsx)(_e.Button,{variant:"secondary",onClick:function(){return n()},"data-testid":"cancel-button",children:m.WINDOW_POPUP_TITLES_AND_MESSAGES.window_buttonCancel()}),(0,r.jsx)(_e.Button,{variant:"primary",onClick:v,disabled:!d,"data-testid":"submit-button",children:m.WINDOW_POPUP_TITLES_AND_MESSAGES.window_buttonSelect()})]})]}))};function Te(e){var t=e.handleSelect,n=(0,ie.useModalComponentOpener)(De);return(0,a.useCallback)((function(){n({onSelect:t})}),[t,n])}function ke(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Me(e){return function(e){if(Array.isArray(e))return ke(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return ke(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ke(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Le(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Re(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Fe(e){return function(e){if(Array.isArray(e))return Le(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Le(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Le(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Be(){var e,t,n,r=(e=(0,ne.useTimezonesState)(),t=e.allTimezones,n=e.favoriteTimezones,(0,a.useMemo)((function(){return Me(n).concat(Me(t.slice(0,10).filter((function(e){return!n.find((function(t){return t.id===e.id}))})).slice(0,Math.abs(5-n.length))))}),[t,n]));return(0,a.useMemo)((function(){var e;return Fe(r.map((function(e){return{content:e.fullName,value:e.id,key:e.id,"data-testid":"option"}}))).concat([(e={content:". . .",key:"Show more timezones"},Re(e,"aria-label","Show more timezones"),Re(e,"value",Ue),Re(e,"data-testid","show-more-button"),e)])}),[r])}var Ue="show_more",ze=function(e){var t=e.selectedTimeZone,n=e.handleSelect,o=e.layoutClassName,i=e.label,s=(0,c.useLocalizationState)().t,l=Be(),u=function(e){var t=e.handleSelect,n=Te({handleSelect:t});return(0,a.useCallback)((function(e){if(e)return e===Ue?n():t(e)}),[t,n])}({handleSelect:n});return(0,r.jsx)(j.SelectField,{required:!0,layoutClassName:o,value:t,label:i,onChange:u,"aria-label":s.CALENDAR_EVENT_FORM.show_timezones_label(),options:l,"data-testid":"timezone-dropdown"})};function He(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ve(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ge(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Ve(e,t,n[t])}))}return e}function We(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function qe(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||Ke(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ye(e){return function(e){if(Array.isArray(e))return He(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Ke(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ke(e,t){if(e){if("string"==typeof e)return He(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?He(e,t):void 0}}var $e={date:"",timeFrom:"",timeTo:"",selectedTimezoneId:"",phoneOn:""},Xe="L",Qe="HH:mm",Ze="YYYY-MM-DD HH:mm:ss",Je=function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},t=e.rescheduleFrom,n=e.reschedulePhone,r=e.rescheduleTimezone,a=e.rescheduleTo,o={};return(t||a)&&(o.date=(0,y.formatDate)(t||a,Xe)),t&&(o.timeFrom=(0,y.formatDate)(t,Qe)),a&&(o.timeTo=(0,y.formatDate)(a,Qe)),n&&(o.phoneOn=n),r&&(o.selectedTimezoneId=r),o},et=function(e){var t=e.date,n=e.timeFrom,r=e.timeTo,a=e.selectedTimezoneId,o=e.phoneOn,i=e.currentState,s={},l=(0,y.convertToDayjs)("".concat(t||i.date," ").concat(n||i.timeFrom),"".concat(Xe," ").concat(Qe)),c=(0,y.convertToDayjs)("".concat(t||i.date," ").concat(r||i.timeTo),"".concat(Xe," ").concat(Qe));return c.add(l.isAfter(c)?1:0,"d"),l.isValid()&&(t||n)&&(s.rescheduleFrom=l.format(Ze)),c.isValid()&&(t||r)&&(s.rescheduleTo=c.format(Ze)),o&&(s.reschedulePhone=o),a&&(s.rescheduleTimezone=a),s},tt=function(e){return{content:e,value:e,"data-testid":"option"}},nt=o().memo((function(){var e,t=(0,s.useInteractionId)(),n=(0,i.useInteractionProp)(t,X.getItemDisposition),o=qe((0,a.useState)((function(){return n?Ge({},$e,Je(n)):$e})),2),u=o[0],d=o[1],f=(0,i.useInteractionStateMethods)().setDispositionReschedule,m=(0,c.useLocalizationState)().t,p=(0,ne.useAllTimezones)(),v=(0,ne.useTimezonesStateMethods)(),h=function(){var e=(0,c.useLocalizationState)().t;return(0,a.useMemo)((function(){return[{id:1,name:e.RESCHEDULE.rsc_afternoon(),getDateAndTime:function(){return{newTime:"12:00",newDate:(0,y.formatDate)((0,y.addTime)(new Date,"days",(new Date).getHours()>=12?1:0),oe)}}},{id:2,name:e.RESCHEDULE.rsc_evening(),getDateAndTime:function(){return{newTime:"18:00",newDate:(0,y.formatDate)((0,y.addTime)(new Date,"days",(new Date).getHours()>=18?1:0),oe)}}},{id:3,name:e.RESCHEDULE.rsc_tomorrowMorning(),getDateAndTime:function(){return{newTime:"09:00",newDate:(0,y.formatDate)((0,y.addTime)(new Date,"days",1),oe)}}},{id:4,name:e.RESCHEDULE.rsc_tomorrowAfternoon(),getDateAndTime:function(){return{newTime:"12:00",newDate:(0,y.formatDate)((0,y.addTime)(new Date,"days",1),oe)}}},{id:5,name:e.RESCHEDULE.rsc_tomorrowEvening(),getDateAndTime:function(){return{newTime:"18:00",newDate:(0,y.formatDate)((0,y.addTime)(new Date,"days",1),oe)}}},{id:6,name:e.RESCHEDULE.rsc_in1hour(),getDateAndTime:function(){var e=(0,y.addTime)(new Date,"hours",1);return{newTime:(0,y.formatDate)(e,"LT"),newDate:(0,y.formatDate)(e,oe)}}},{id:7,name:e.RESCHEDULE.rsc_in2hours(),getDateAndTime:function(){var e=(0,y.addTime)(new Date,"hours",2);return{newTime:(0,y.formatDate)(e,"LT"),newDate:(0,y.formatDate)(e,oe)}}}]}),[e])}(),b=(0,i.useInteraction)(t),g=(0,i.useInteractionProp)(t,X.getPhoneFromItem),I=(0,$.uniq)([null==b||null===(e=b.displayData)||void 0===e?void 0:e.number,g,null==n?void 0:n.reschedulePhone]).filter(Boolean),S=(0,i.useInteractionStateConnector)(),O=qe((0,a.useState)((function(){return(0,l.truthy)(I).map(tt)})),2),x=O[0],C=O[1],_=(0,y.useAsRef)(x);(0,a.useEffect)((function(){var e=null==S?void 0:S.dispenser.subscribe({onDispositionRescheduleUpdated:function(e,n){t===e&&(d((function(e){return Ge({},e,Je(n))})),n.reschedulePhone&&!_.current.some((function(e){return e.value===n.reschedulePhone}))&&C((function(e){return n.reschedulePhone?Ye(e).concat([tt(n.reschedulePhone)]):e})))}});return function(){return null==e?void 0:e.unsubscribe()}}),[t,null==S?void 0:S.dispenser,_]);var w,N=u.date,A=u.timeFrom,P=u.timeTo,E=u.selectedTimezoneId,D=u.phoneOn,T=(0,a.useCallback)((function(e){d((function(t){return Ge({},t,e)}))}),[]),k=(0,a.useCallback)((function(e){T({selectedTimezoneId:e})}),[T]),L=null!==(w=I[0])&&void 0!==w?w:"";(0,a.useEffect)((function(){L&&!u.phoneOn&&T({phoneOn:L})}),[T,L,u.phoneOn]),ae({additionalOnInitializeHandler:k});var R,F=(0,a.useCallback)((function(e){if(e){var n=p.find((function(t){return t.id===e}));if(n){v.addToFavorites(n);var r=p.find((function(e){return e.id===E}));if(r){var a=Number(n.standardOffset-r.standardOffset),o=(0,y.convertToDayjs)("".concat(N," ").concat(A),"".concat(Xe," ").concat(Qe)),i=(0,y.convertToDayjs)("".concat(N," ").concat(P),"".concat(Xe," ").concat(Qe));if(o.isValid()&&i.isValid()&&!Number.isNaN(a)){i.add(o.isAfter(i)?1:0,"d"),o.add(a,"m"),i.add(a,"m");var s={date:o.format(Xe),timeFrom:o.format(Qe),timeTo:i.format(Qe)};T(s),f(t,et(We(Ge({},s),{currentState:u})))}}}T({selectedTimezoneId:e}),f(t,{rescheduleTimezone:e})}}),[p,T,f,t,v,E,N,A,P,u]),B=(0,a.useCallback)((function(e,t){var n=t.value;if("string"!=typeof n)throw new Error("Date value must be a string");T({date:n})}),[T]),U=(0,a.useCallback)((function(e,t){var n=t.value;if("string"!=typeof n)throw new Error("Time value must be a string");T({timeFrom:n})}),[T]),z=(0,a.useCallback)((function(e,t){var n=t.value;if("string"!=typeof n)throw new Error("Time value must be a string");T({timeTo:n})}),[T]),H=(0,a.useCallback)((function(e){if("string"!=typeof e)throw new Error("Phone value must be a string");T({phoneOn:e}),f(t,{reschedulePhone:e})}),[t,f,T]),V=(0,a.useMemo)((function(){return h.map((function(e){var t=e.getDateAndTime;return{onClick:function(e){var n=t(),r=n.newDate,a=n.newTime;T({date:r,timeFrom:a}),e.preventDefault()}}}))}),[h,T]),G=(0,a.useCallback)((function(e,n,r){var a;"object"==typeof r&&"string"==typeof r.value&&f(t,et((Ve(a={},e,r.value),Ve(a,"currentState",u),a)))}),[t,u,f]),W=(0,a.useMemo)((function(){return(0,$.partial)(G,"date")}),[G]),q=(0,a.useMemo)((function(){return(0,$.partial)(G,"timeFrom")}),[G]),Y=(0,a.useMemo)((function(){return(0,$.partial)(G,"timeTo")}),[G]),K=M("w-1/4 [&_input]:w-full");return(0,r.jsxs)("div",{className:"flex flex-auto flex-col gap-6","data-testid":"reschedule",children:[(0,r.jsx)("h3",{className:"mt-6 font-semibold body",children:m.RESCHEDULE.reschedule_call()}),(0,r.jsxs)("div",{className:"flex items-end justify-between gap-4",children:[(0,r.jsx)(j.FieldLayout,{className:"w-1/2 [&_div]:!w-full",label:(0,r.jsx)(j.TriggerDropdown,{options:h.map((function(e,t){var n=e.id,a=e.name;return(0,r.jsx)("button",{onClick:V[t].onClick,"aria-label":a,"data-testid":"option",children:a},n)})),children:function(e){return(0,r.jsx)("button",{children:(0,r.jsx)(j.Tooltip,{content:m.CALENDAR_EVENT_FORM.show_date_suggestions_label(),children:(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)("span",{children:m.RESCHEDULE.next_call_date()}),(0,r.jsx)(j.IconArrowDown16,{className:e?"rotate-180":void 0})]})})})}}),children:(0,r.jsx)(re.DateInput,{value:N,onChange:B,onBlur:W,placeholder:(0,y.getLongDateFormat)(Xe),dateFormat:Xe,closable:!0,animation:"fade right",popupPosition:"bottom left",localization:navigator.language,"aria-label":m.CALENDAR_EVENT_FORM.label_date(),"data-testid":"date-picker"})}),(0,r.jsx)(j.FieldLayout,{label:m.RESCHEDULE.from(),required:!0,className:K,children:(0,r.jsx)(re.TimeInput,{value:A,onChange:U,onBlur:q,placeholder:Qe.toUpperCase(),timeFormat:"24",closable:!0,animation:"fade right",popupPosition:"bottom right",localization:navigator.language,"aria-label":m.CALENDAR_EVENT_FORM.time_from_label(),"data-testid":"time-from-picker"})}),(0,r.jsx)(j.FieldLayout,{label:m.RESCHEDULE.to(),required:!0,className:K,children:(0,r.jsx)(re.TimeInput,{value:P,onChange:z,onBlur:Y,placeholder:Qe.toUpperCase(),timeFormat:"24",closable:!0,animation:"fade right",popupPosition:"bottom right",localization:navigator.language,"aria-label":m.CALENDAR_EVENT_FORM.time_to_label(),"data-testid":"time-to-picker"})})]}),(0,r.jsx)(ze,{layoutClassName:"w-full",label:m.RESCHEDULE.time_zone(),selectedTimeZone:null!==(R=null==n?void 0:n.rescheduleTimezone)&&void 0!==R?R:"",handleSelect:F}),(0,r.jsx)(j.SearchableSelectField,{required:!0,allowCustomValue:!0,layoutClassName:"w-full",label:m.RESCHEDULE.phone(),value:D,onChange:H,"aria-label":m.CALENDAR_EVENT_FORM.phone_number_label(),options:x,"data-testid":"phone-dropdown"})]})})),rt=n(6622),at=n(9008),ot=n(4870),it=n(9190),st=n(2346),lt=n(4692);function ct(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ut(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function dt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){ut(e,t,n[t])}))}return e}function ft(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function mt(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function pt(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ct(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ct(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var vt="DD-MM-YYYY",ht="HH:mm";function bt(){var e,t,n,r=(0,at.useSessionState)(),o=(0,s.useInteractionId)(),l=(0,ot.useCalendarStateMethods)().saveCalendarEventDetails,c=pt((0,a.useState)("idle"),2),u=c[0],d=c[1],f=(0,a.useRef)(-1),m=r.userId,p=r.firstName,v=r.lastName,h=r.displayNameFormat,b=(0,x.useInteractionUIState)(),g=b.getItemState,j=b.setItemState,I=(0,i.useInteraction)(o),S=(0,it.useOpenInteractionSlidingModal)(),O=(0,it.useShowSlidingModalChecker)(o,"reschedule"),C=null!==(t=null==I?void 0:I.id)&&void 0!==t?t:"",_=null!==(n=null===(e=g(C))||void 0===e?void 0:e.rescheduleForm)&&void 0!==n?n:(0,x.getEmptyItemUIState)().rescheduleForm,w=_.dateFrom,N=_.dateTo,A=_.timeFrom,P=_.timeTo,D=_.selectedTimezoneId,T=_.remindIn,k=_.remindInUnit,M=_.completed,L=_.title,R=_.contacts,F=_.notes,B=(0,a.useCallback)((function(e){j(C,(function(t){return ft(dt({},t),{rescheduleForm:dt({},t.rescheduleForm,e)})}))}),[C,j]);(0,a.useEffect)((function(){O||(clearTimeout(f.current),d("idle"))}),[O]),function(e){var t=e.setRescheduleFormState,n=e.contacts,r=(0,s.useInteractionId)(),o=(0,i.useInteraction)(r),l=(0,st.useContactsStateMethods)().getContact;(0,a.useEffect)((function(){var e=function(e){var n,r,a,i;t({contacts:[{name:null!==(a=null==o?void 0:o.displayData.displayName)&&void 0!==a?a:"",phone:null!==(i=null==o?void 0:o.displayData.number)&&void 0!==i?i:"",createContact:!1,phoneType:lt.PhoneTypes.BUSINESS,contactId:null==o?void 0:o.contactId,phoneId:null==e||null===(r=e.phones)||void 0===r||null===(n=r.find((function(e){return e.phone===(null==o?void 0:o.displayData.number)})))||void 0===n?void 0:n.id,contactData:e}]})};if(!(null==n?void 0:n.length)){var r=null==o?void 0:o.contactId;r?l({id:r}).then((function(t){t&&e(t)})).catch((function(t){console.error(t),e()})):e()}}),[o,null==n?void 0:n.length,l,t])}({contacts:R,setRescheduleFormState:B});var U=(0,ne.useAllTimezones)(),z=(0,ne.useTimezonesStateMethods)(),H=(0,a.useCallback)((function(e,t){var n=t.value,r=t.name;B(ut({},r,n))}),[B]),V=(0,a.useCallback)((function(e,t){var n=t.name,r=t.value;B(E()(_,(function(t){t.contacts.splice(e,1,ft(dt({},t.contacts[e]),ut({},n,r)))})))}),[_,B]),G=(0,a.useCallback)((function(e){return function(t,n){var r=n.value;V(e,{name:"name",value:r}),B({name:r})}}),[V,B]),W=(0,a.useCallback)((function(e){return function(t,n){var r=n.value;V(e,{name:"phone",value:r})}}),[V]),q=(0,a.useCallback)((function(e){return function(t,n){var r=n.value;V(e,{name:"phoneType",value:r})}}),[V]),Y=(0,a.useCallback)((function(e){return function(t,n){var r=n.value;V(e,{name:"createContact",value:r})}}),[V]),K=(0,a.useCallback)((function(e){return function(t,n){var r=n.value;V(e,{name:"phoneId",value:r})}}),[V]),$=(0,a.useCallback)((function(e,t){var n=t.value;B({remindIn:n})}),[B]),Q=(0,a.useCallback)((function(e,t){var n=t.value;B({remindInUnit:n})}),[B]),Z=(0,a.useCallback)((function(e,t){var n=t.checked;B({completed:n})}),[B]),J=(0,a.useCallback)((function(e,t){var n=t.value;B({title:n})}),[B]),ee=(0,a.useCallback)((function(e,t){var n=t.value;B({notes:n})}),[B]),te=(0,a.useCallback)((function(e){if(e){var t=U.find((function(t){return t.id===e}));if(t){z.addToFavorites(t);var n=U.find((function(e){return e.id===D}));if(n){var r=Number(t.standardOffset-n.standardOffset),a=(0,y.convertToDayjs)("".concat(w," ").concat(A),"".concat(vt," ").concat(ht)),o=(0,y.convertToDayjs)("".concat(N," ").concat(P),"".concat(vt," ").concat(ht));a.isValid()&&o.isValid()&&!Number.isNaN(r)&&(o.add(a.isAfter(o)?1:0,"d"),a.add(r,"m"),o.add(r,"m"),B({dateFrom:a.format(vt),dateTo:o.format(vt),timeFrom:a.format(ht),timeTo:o.format(ht)}))}}B({selectedTimezoneId:e})}}),[U,B,z,D,w,A,N,P]),re=(0,a.useCallback)((function(){B((0,x.getEmptyItemUIState)().rescheduleForm),S(o,"reschedule")}),[B,o,S]),ae=(0,a.useCallback)((function(){var e=function(e){var t,n,r=(0,y.convertToDayjs)("".concat(e.dateFrom," ").concat(e.timeFrom),"".concat(vt," ").concat(ht)),a=(0,y.convertToDayjs)("".concat(e.dateTo," ").concat(e.timeTo),"".concat(vt," ").concat(ht)),o=r.isValid()?r.valueOf():void 0,i=a.isValid()?a.valueOf():void 0,s=(0,X.getGlobalInteractionId)(I),l=(0,X.getServiceId)(I),c=e.contacts[0],u=(null==I?void 0:I.workitemData)||{},d=u.listLinkId,f=u.listRecordId,b=null==I||null===(n=I.screenPopData)||void 0===n||null===(t=n.web)||void 0===t?void 0:t.url,g=b?{web:{type:"web",action:"OPEN_WEB_PAGE",URL:b,popup:"false",popUponAnswer:"false",keepPopupOpenAfterFinish:"false",secondaryUrls:{}},salesforce:{type:"salesforce",object_id:b,action:"SHOW_OBJECT"}}:void 0;if(o&&i&&m&&s&&l&&c)return{completed:e.completed,contacts:c.contactData?[(j=c.contactData,S=c,{addPhone:!1,addresses:j.addresses&&j.addresses.map((function(e){var t=e.addressLine1,n=e.addressLine2,r=mt(e,["addressLine1","addressLine2"]);return ft(dt({},r),{address_line1:t,address_line2:n})})),alerts:j.alerts,calendar_phone:{id:void 0,type:S.phoneType,phone:S.phone},company_id:j.companyId,company_name:j.companyName,contact_type:"STORED",create:!1,dob:j.dob,emails:j.emails&&j.emails.map((function(e){return{id:e.id,type:e.type,email_address:e.emailAddress}})),first_name:j.firstName,last_name:j.lastName,phones:j.phones,segment:j.segment,title:j.title,web_url:j.webUrl,_id:j.Id})]:[{addPhone:!1,alerts:0,calendar_phone:{id:void 0,type:c.phoneType,phone:c.phone},contact_type:"STORED",create:!1,first_name:c.name,phones:[{id:void 0,type:c.phoneType,phone:c.phone}],_id:{oid:null}}],email:null==I?void 0:I.displayData.email,startTime:o,endTime:i,globalInteractionId:s,listLinkId:d,listRecordId:f,name:null==I?void 0:I.displayData.displayName,notes:e.notes,number:null==I?void 0:I.displayData.number,remindIn:e.remindIn,remindInUnit:e.remindInUnit,screenpop:JSON.stringify(g),screenpopSize:g?1:0,serviceId:l,serviceName:(0,X.getServiceNameFromItem)(I),title:e.title,userId:m,userName:(0,rt.formatFullName)(h,p,v)};var j,S}(_);e&&e.title&&(d("loading"),l(e).then((function(){d("success"),B((0,x.getEmptyItemUIState)().rescheduleForm),f.current=setTimeout((function(){S(o,"reschedule"),d("idle")}),2500)})).catch((function(){d("error")})))}),[I,h,p,v,_,l,B,S,m]);return(0,a.useMemo)((function(){return{dateFrom:w,dateTo:N,timeFrom:A,timeTo:P,selectedTimezoneId:D,remindIn:T,remindInUnit:k,completed:M,contacts:R,title:L,notes:F,submittingState:u,setSubmittingState:d,handlers:{handleDateChange:H,handleTimeZoneSelect:te,handleRemindAmountChange:$,handleRemindUnitsChange:Q,handleCompletedCheckboxChange:Z,handleContactRecordChange:V,handleTitleChange:J,handleCancelClick:re,handleSubmitClick:ae,handleNotesChange:ee},contactHandlersFactories:{handleContactNameChangeFactory:G,handleContactPhoneChangeFactory:W,handleContactPhoneTypeChangeFactory:q,handleContactCreateContactChangeFactory:Y,handleContactPhoneIdChangeFactory:K}}}),[M,R,w,N,re,Z,Y,G,W,K,q,V,H,ee,$,Q,ae,te,J,F,T,k,D,u,A,P,L])}var yt=n(8770),gt=n(7282),jt=n(3711);function It(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function St(e){return function(e){if(Array.isArray(e))return It(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return It(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return It(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Ot="OTHER";var xt=function(e){var t=e.contact,n=e.contactHandlers,o=(0,c.useLocalizationState)().t,i=function(e){var t,n=e.contactData,r=(0,c.useLocalizationState)().t,o=(0,gt.useFormatting)().formatPhoneType,i=null==n||null===(t=n.phones)||void 0===t?void 0:t.map((function(e){return{value:e.id,text:"".concat((0,rt.formatPhone)(e.phone)," (").concat(o(e.type),")")}}));return(0,a.useMemo)((function(){return St(null!=i?i:[]).concat([{value:Ot,text:r.CALL_DETAILS_FORM.rcp_option_other()}])}),[i,r.CALL_DETAILS_FORM])}({contactData:t.contactData});return(0,r.jsxs)(d.SmForm.Group,{label:o.CALENDAR_EVENT_FORM.contact_on_label(),children:[(0,r.jsx)("label",{className:"text-main-secondary",children:o.CALENDAR_EVENT_FORM.contact_on_label()}),(0,r.jsx)(d.SmForm.Field,{"aria-label":o.CALENDAR_EVENT_FORM.contact_on_label(),control:L.Dropdown,onChange:n.handleContactPhoneIdChange,value:t.phoneId,options:i})]})},Ct=function(e){var t=e.contact,n=e.contactHandlers,o=(0,c.useLocalizationState)().t,i=(0,gt.useFormatting)().formatPhoneType,s=(0,a.useMemo)((function(){return Object.values(lt.PhoneTypes).map((function(e){return{value:e,text:i(e)}}))}),[i]);return(0,r.jsxs)(d.SmForm.Group,{className:"flex items-center",children:[(0,r.jsx)(d.SmForm.Field,{value:t.phone,onChange:n.handleContactPhoneChange,placeholder:o.CALENDAR_EVENT_FORM.contact_on_label(),control:d.SmInput}),(0,r.jsx)(d.SmForm.Field,{value:t.phoneType,control:L.Dropdown,options:s,onChange:n.handleContactPhoneTypeChange})]})},_t=function(e){var t,n,a=e.contact,o=e.contactHandlers,i=(0,st.useContactsState)("contacts"),s=(0,yt.useGetAvatarUrl)(),l=(0,gt.useFormatting)().formatFullName,c=null!==(n=null==a?void 0:a.contactId)&&void 0!==n?n:"",u=s({contactId:c}),f=a.contactData;return(0,r.jsx)(d.SmSegment,{children:(null===(t=i[c])||void 0===t?void 0:t.isLoading)?(0,r.jsx)(L.Loader,{size:"large",color:"primary",active:!0}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(d.SmForm.Field,{className:"flex items-center",children:[(0,r.jsx)(jt.AvatarLegacy,{size:36,firstName:null==f?void 0:f.firstName,lastName:null==f?void 0:f.lastName,url:u,type:"contact"}),(0,r.jsx)("p",{className:"ml-2 text-xl",children:l(null==f?void 0:f.firstName,null==f?void 0:f.lastName)})]}),(0,r.jsx)(xt,{contact:a,contactHandlers:o}),a.phoneId===Ot&&(0,r.jsx)(Ct,{contact:a,contactHandlers:o})]})})},wt=function(e){var t=e.contactHandlers,n=e.contact,o=(0,c.useLocalizationState)().t,i=(0,gt.useFormatting)().formatPhoneType,s=(0,a.useMemo)((function(){return Object.values(lt.PhoneTypes).map((function(e){return{value:e,text:i(e)}}))}),[i]);return(0,r.jsxs)(d.SmSegment,{children:[(0,r.jsx)(d.SmForm.Field,{value:n.name,onChange:t.handleContactNameChange,label:o.CALENDAR_EVENT_FORM.contact_name_placeholder(),placeholder:o.CALENDAR_EVENT_FORM.contact_name_placeholder(),control:d.SmInput}),(0,r.jsx)(d.SmForm.Field,{value:n.phone,onChange:t.handleContactPhoneChange,label:o.CALENDAR_EVENT_FORM.contact_on_label(),placeholder:o.CALENDAR_EVENT_FORM.contact_on_label(),control:d.SmInput}),(0,r.jsxs)(d.SmForm.Group,{children:[(0,r.jsx)(d.SmForm.Field,{checked:n.createContact,label:o.CALENDAR_EVENT_FORM.contact_create_box_label(),control:d.SmCheckbox,onChange:t.handleContactCreateContactChange}),(0,r.jsx)(d.SmForm.Field,{value:n.phoneType,control:L.Dropdown,options:s,onChange:t.handleContactPhoneTypeChange})]})]})},Nt=function(e){var t=e.contactHandlersFactories,n=e.contact,o=e.index,i=(0,a.useMemo)((function(){return{handleContactNameChange:t.handleContactNameChangeFactory(o),handleContactPhoneChange:t.handleContactPhoneChangeFactory(o),handleContactPhoneTypeChange:t.handleContactPhoneTypeChangeFactory(o),handleContactPhoneIdChange:t.handleContactPhoneIdChangeFactory(o),handleContactCreateContactChange:t.handleContactCreateContactChangeFactory(o)}}),[t,o]);return(0,r.jsx)(r.Fragment,{children:n.contactId?(0,r.jsx)(_t,{contact:n,contactHandlers:i}):(0,r.jsx)(wt,{contact:n,contactHandlers:i})})},At=function(e){var t=e.contactHandlersFactories,n=e.contacts;return(0,r.jsx)(r.Fragment,{children:n.map((function(e,n){return(0,r.jsx)(Nt,{index:n,contact:e,contactHandlersFactories:t},n)}))})};function Pt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Et=function(e){var t=(0,c.useLocalizationState)().t;return(0,r.jsx)(d.SmCheckbox,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Pt(e,t,n[t])}))}return e}({label:t.GLOBAL.interaction_state_completed()},e))},Dt=function(e){var t=e.amountValue,n=e.unitsValue,o=e.handleAmountChange,i=e.handleUnitsChange,s=(0,c.useLocalizationState)().t,l=(0,a.useMemo)((function(){return[{value:"MINUTES",text:s.GLOBAL.time_units_minutes()},{value:"HOURS",text:s.GLOBAL.time_units_hours()},{value:"DAYS",text:s.GLOBAL.time_units_days()}]}),[s.GLOBAL]);return(0,r.jsxs)(d.SmForm.Field,{children:[(0,r.jsx)("label",{children:s.CALENDAR_EVENT_FORM.label_reminder()}),(0,r.jsxs)(d.SmForm.Group,{children:[(0,r.jsx)(d.SmForm.Field,{className:"w-[76px]",children:(0,r.jsx)(d.SmInput,{value:t,onChange:o})}),(0,r.jsx)(d.SmForm.Field,{children:(0,r.jsx)(L.Dropdown,{selection:!0,options:l,value:n,onChange:i})})]})]})},Tt=function(e){var t=e.dateFrom,n=e.dateTo,a=e.timeFrom,o=e.timeTo,i=e.handleDateChange,s=(0,c.useLocalizationState)().t,l=M("w-1/4 [&_input]:w-full");return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(d.SmForm.Field,{children:[(0,r.jsx)("label",{children:s.GLOBAL.from()}),(0,r.jsxs)(d.SmForm.Group,{children:[(0,r.jsxs)(d.SmForm.Field,{children:[(0,r.jsx)("label",{children:s.CALENDAR_EVENT_FORM.label_date()}),(0,r.jsx)(re.DateInput,{required:!0,value:t,onChange:i,placeholder:"DD/MM/YYYY",closable:!0,animation:"fade right",popupPosition:"bottom left",localization:navigator.language,name:"dateFrom","aria-label":s.CALENDAR_EVENT_FORM.date_from_label()})]}),(0,r.jsxs)(d.SmForm.Field,{children:[(0,r.jsx)("label",{children:s.CALENDAR_EVENT_FORM.label_time()}),(0,r.jsx)(re.TimeInput,{required:!0,value:a,name:"timeFrom",onChange:i,className:l,placeholder:"HH:MM",closable:!0,animation:"fade right",popupPosition:"bottom right",localization:navigator.language,"aria-label":s.CALENDAR_EVENT_FORM.time_from_label()})]})]})]}),(0,r.jsxs)(d.SmForm.Field,{children:[(0,r.jsx)("label",{children:s.GLOBAL.to()}),(0,r.jsxs)(d.SmForm.Group,{children:[(0,r.jsxs)(d.SmForm.Field,{children:[(0,r.jsx)("label",{children:s.CALENDAR_EVENT_FORM.label_date()}),(0,r.jsx)(re.DateInput,{required:!0,value:n,name:"dateTo",onChange:i,placeholder:"DD/MM/YYYY",closable:!0,animation:"fade right",popupPosition:"bottom left",localization:navigator.language,"aria-label":s.CALENDAR_EVENT_FORM.date_to_label()})]}),(0,r.jsxs)(d.SmForm.Field,{children:[(0,r.jsx)("label",{children:s.CALENDAR_EVENT_FORM.label_time()}),(0,r.jsx)(re.TimeInput,{required:!0,value:o,name:"timeTo",onChange:i,className:l,placeholder:"HH:MM",closable:!0,animation:"fade right",popupPosition:"bottom right",localization:navigator.language,"aria-label":s.CALENDAR_EVENT_FORM.time_to_label()})]})]})]})]})};function kt(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Mt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){kt(e,t,n[t])}))}return e}function Lt(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Rt(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var Ft=function(){var e=(0,c.useLocalizationState)().t,t=bt(),n=t.selectedTimezoneId,o=t.remindIn,i=t.remindInUnit,l=t.completed,u=t.contacts,f=t.title,m=t.notes,p=t.submittingState,v=(t.setSubmittingState,t.handlers),h=v.handleDateChange,b=v.handleTimeZoneSelect,g=v.handleRemindAmountChange,j=v.handleRemindUnitsChange,I=v.handleCompletedCheckboxChange,S=v.handleTitleChange,O=v.handleCancelClick,C=v.handleSubmitClick,_=v.handleNotesChange,w=t.contactHandlersFactories,N=Rt(t,["selectedTimezoneId","remindIn","remindInUnit","completed","contacts","title","notes","submittingState","setSubmittingState","handlers","contactHandlersFactories"]),A=(0,x.useInteractionUIState)().setItemState,P=(0,s.useInteractionId)(),E=(0,a.useCallback)((function(e){A(P,(function(t){return Lt(Mt({},t),{rescheduleForm:Mt({},t.rescheduleForm,e)})}))}),[P,A]),D=(0,a.useCallback)((function(e){E({selectedTimezoneId:e})}),[E]);return function(e){var t=e.setRescheduleFormState,n=e.dateTimeState;(0,a.useEffect)((function(){var e,r,a,o;Object.values(n).every($.identity)||(e=(0,y.formatDate)(new Date,vt),r=(0,y.formatDate)(new Date,ht),a=(0,y.formatDate)((0,y.addTime)(new Date,"hours",1),vt),o=(0,y.formatDate)((0,y.addTime)(new Date,"hours",1),ht),t({dateFrom:e,timeFrom:r,dateTo:a,timeTo:o}))}),[n,t])}({setRescheduleFormState:E,dateTimeState:N}),ae({additionalOnInitializeHandler:D}),"loading"===p?(0,r.jsx)(L.Loader,{active:!0,size:"huge",color:"primary"}):"success"===p?(0,r.jsx)(ve.IconSuccess,{className:"!absolute inset-0"}):(0,r.jsxs)(d.SmForm,{children:[(0,r.jsx)(d.SmForm.Field,{control:d.SmInput,label:e.CALENDAR_EVENT_FORM.event_title(),placeholder:e.CALENDAR_EVENT_FORM.event_title(),value:f,onChange:S,required:!0}),(0,r.jsxs)("div",{className:"flex justify-end",children:[(0,r.jsx)(L.SemanticButton,{primary:!0,onClick:C,children:e.CALENDAR_EVENT_FORM.button_save_text()}),(0,r.jsx)(L.SemanticButton,{onClick:O,children:e.CALENDAR_EVENT_FORM.button_cancel_text()})]}),(0,r.jsx)(Tt,Mt({handleDateChange:h},N)),(0,r.jsx)(ze,{label:e.CALENDAR_EVENT_FORM.label_timezone(),handleSelect:b,selectedTimeZone:n}),(0,r.jsx)(Dt,{amountValue:o,unitsValue:i,handleUnitsChange:j,handleAmountChange:g}),(0,r.jsx)(d.SmForm.Field,{onChange:_,value:m,control:d.SmTextArea,label:e.CALENDAR_EVENT_FORM.label_note()}),(0,r.jsx)(Et,{onChange:I,checked:l}),(0,r.jsx)(At,{contactHandlersFactories:w,contacts:u})]})},Bt=n(533);function Ut(){var e=(0,s.useInteractionId)(),t=(0,i.useInteractionProp)(e,(function(e){return(0,X.isWorkItem)(e)||(0,X.isWorkitemCall)(e)})),n=function(){var e=(0,s.useInteractionId)(),t=(0,i.useInteractionProp)(e,X.getServiceId),n=(0,i.useInteractionProp)(e,X.getItemDisposition),r=(0,Bt.useServicesDispositionsState)().dispositions;return(0,a.useMemo)((function(){var e=r&&t?r[t]:{},a=n&&(null==e?void 0:e[n.id]);return null==a?void 0:a.type}),[r,n,t])}();return t&&"CONTINUE"===n}var zt=o().memo((function(e){var t=e.className,n=(0,s.useInteractionId)(),a=(0,te.useDispositionsSettings)(n).useDispositions,o=(0,i.useInteractionProp)(n,X.isWorkItem),l=Ut();return(0,r.jsxs)("div",{className:M("overflow-auto p-4 pb-8",t),children:[(o||a)&&(0,r.jsx)(K,{accordion:!0}),(0,r.jsx)(ee,{layoutClassName:"mt-6"}),l&&(0,r.jsx)(nt,{})]})})),Ht=n(9022),Vt=n(5886),Gt=n(9464);var Wt=n(7952);var qt=n(7194);var Yt=n(8202),Kt=n(7421),$t=new URL("http://localhost:9897");$t.searchParams.append("domain",location.hostname);var Xt=$t.toString(),Qt="bpClient/onShowDomainAuthorizationDialog",Zt=n(8715),Jt=n(3650),en="cursor-pointer text-primary-legacy",tn="ext-link",nn="ext-link-firefox",rn="plugin-link",an=function(e){var t=e.isExtAvailable,n=e.install,o=(0,c.useLocalizationState)().t.INSTALLATION_PROCESS,i=(0,Jt.useInstallationMethods)(),s=i.installChromeExtension,l=i.installFirefoxExtension,u=i.installBPClientPlugin;(0,a.useEffect)((function(){var e=document.getElementById(tn),t=document.getElementById(nn),n=document.getElementById(rn);return null==e||e.addEventListener("click",s),null==t||t.addEventListener("click",l),null==n||n.addEventListener("click",u),function(){null==e||e.removeEventListener("click",s),null==t||t.removeEventListener("click",l),null==n||n.removeEventListener("click",u)}}),[s,l,u]);var d=o.install_updateHeader(rn,en);return n&&(d="chrome"===Zt.platformInfo.browser?t?o.install_installHeader(rn,en):o.install_installHeaderChrome(tn,rn,en):"firefox"===Zt.platformInfo.browser?t?o.install_installHeader(rn,en):o.install_installHeaderFirefox(nn,rn,en):o.install_installHeader(rn,en)),(0,r.jsx)("div",{dangerouslySetInnerHTML:{__html:d}})},on=n(6508);var sn=function(e){var t=e.browserName,n=(0,c.useLocalizationState)("t").INSTALLATION_PROCESS,a=(0,at.useSessionState)("serverOrigin"),o="chrome"===Zt.platformInfo.browser,i="firefox"===Zt.platformInfo.browser,s="safari"===Zt.platformInfo.browser,l="";return o?l=Jt.URL_EXTENSION_INSTALLER_CHROME:i?l=a+Jt.URL_EXTENSION_INSTALLER_FIREFOX:s&&(l=a+Jt.URL_MAC_PLUGIN),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{children:n.bp_client_old_extension_version(t)}),(o||i||s)&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("br",{}),(0,r.jsx)("br",{}),(0,r.jsx)("span",{children:n.bp_client_update_extension_part1()}),(0,r.jsx)("a",{href:l,rel:"noopener noreferrer",target:"_blank",children:n.bp_client_update_extension_text()}),(0,r.jsx)("span",{children:n.bp_client_update_extension_part2()})]})]})},ln=n(4432),cn=function(){return location.reload()};var un=n(1960),dn=5e3;function fn(){var e,t,n,r,o,s;e=(0,at.useSessionState)("emi"),t=(0,c.useLocalizationState)("t").ERROR_MESSAGES,n=(0,I.useNotificationsState)("methods"),r=n.showNotification,o=n.hideNotificationById,s=(0,y.useEvent)((function(e){var n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:"";switch(e){case Gt.incomingEMIErrorMessageCodes.unable_to_get_access_token:return t.msteams_access_token_error_message()+n;case Gt.incomingEMIErrorMessageCodes.refresh_token_expired:return t.communicator_msteams_refresh_token_expired_error_message();case Gt.incomingEMIErrorMessageCodes.user_deauthorized:return;case Gt.incomingEMIErrorMessageCodes.no_integration_account:case Gt.incomingEMIErrorMessageCodes.feature_disabled:case Gt.incomingEMIErrorMessageCodes.no_emi_servers:return t.msteams_disabled();case Gt.incomingEMIErrorMessageCodes.integration_account_changed:case Gt.incomingEMIErrorMessageCodes.mismatched_directory_id:case Gt.incomingEMIErrorMessageCodes.mismatched_client_id:return t.communicator_msteams_reset_by_admin_message();case Gt.incomingEMIErrorMessageCodes.azure_user_deleted:return t.msteams_user_deleted();case Gt.incomingEMIErrorMessageCodes.unsufficient_privileges:return t.msteams_unsufficient_privileges();default:return n}})),(0,a.useEffect)((function(){var t;if(null==e||null===(t=e.msteams)||void 0===t?void 0:t.errorCode){var n=s(e.msteams.errorCode,e.msteams.errorMessage);if(!n)return;r({type:"error",id:I.Notifications.MSTeamsIntegrationError,message:n})}else o("msteams_error_notification_id")}),[r,o,s,null==e?void 0:e.msteams]),function(){var e=(0,i.useInteractionStateConnector)(),t=(0,I.useNotificationsState)("methods").showNotification,n=(0,c.useLocalizationState)("t").GLOBAL,r=(0,y.useEvent)((function(e){var r=e.item;(0,X.isCallWithoutCallId)(r)&&t({type:"warning",id:I.Notifications.CallFailedDueNetworkIssueWarning,message:n.notification_callWithNoAnswer_networkProblem((0,rt.formatDate)((new Date).getTime()))})}));(0,a.useEffect)((function(){return e.dispenser.subscribe({onItemCompleted:r}).unsubscribe}),[e,r])}(),function(){var e=(0,qt.useAgentState)(),t=e.notReadyReason,n=e.state,r=e.stateSetDate,o=e.systemNotReadyReasons,i=(0,I.useNotificationsState)("methods"),s=i.showNotification,l=i.hideNotificationById,u=(0,c.useLocalizationState)("t").GLOBAL,d=(0,y.useEvent)((function(){if(o)if("not_ready"===n&&t===o.noAnswer){var e=r&&(0,rt.formatDate)(r),a=u.notification_agentInNotReadyNoAnswer('"No answer"',e||"[TIME]");s({type:"warning",id:I.Notifications.IncomingInteractionNotAcceptedError,message:a})}else l(I.Notifications.IncomingInteractionNotAcceptedError)}));(0,a.useEffect)((function(){d()}),[t,d])}(),function(){var e=(0,I.useNotificationsState)("methods"),t=e.showNotification,n=e.hideNotificationById,r=(0,at.useSessionState)("phoneDeviceIn"),o=(0,c.useLocalizationState)("t").ERROR_MESSAGES,i=(0,y.useEvent)((function(){r?(n(I.Notifications.PhoneDeviceNotDetectedError),t({type:"success",id:I.Notifications.PhoneDeviceDetectedMessage,message:o.device_detected(r),duration:5e3})):t({type:"error",id:I.Notifications.PhoneDeviceNotDetectedError,message:o.device_empty(),duration:5e3,showDelay:5e3})}));(0,a.useEffect)((function(){i()}),[r,i,n])}(),function(){var e=(0,I.useNotificationsState)("methods"),t=e.showNotification,n=e.hideNotificationById,r=(0,at.useSessionStateMethods)().startPhoneTypeSelection,o=(0,at.useSessionState)("phoneTypeErrorCode"),i=(0,c.useLocalizationState)("t").AUTHORIZATION_DIALOG_LABELS,s=(0,y.useEvent)((function(){2===o&&(t({type:"error",id:I.Notifications.BadPhoneExtensionError,message:i.auth_message_undefinedExtension()}),r()),o&&0!==o||n(I.Notifications.BadPhoneExtensionError)}));(0,a.useEffect)((function(){s()}),[o,s])}(),function(){var e=(0,I.useNotificationsState)("methods"),t=e.showNotification,n=e.hideNotificationById,r=(0,qt.useAgentState)().reservedForIncomingInteraction,o=(0,at.useSessionState)("isLoggedIn"),i=(0,c.useLocalizationState)("t").GLOBAL,s=(0,y.useEvent)((function(){o&&(r?t({type:"info",id:I.Notifications.ReservedForIncomingInteractionMessage,message:i.callback_reservation_header()}):n(I.Notifications.ReservedForIncomingInteractionMessage))}));(0,a.useEffect)((function(){s()}),[r,s])}(),function(){var e=(0,Yt.useInteractionChatStateConnector)(),t=(0,I.useNotificationsState)("methods").showNotification,n=(0,c.useLocalizationState)("t").ERROR_MESSAGES,r=(0,y.useEvent)((function(e){var r,a;switch(e){case"invalid_server":r="error",a=n.chat_web_rtc_invalid_ice_server();break;case"answer_timeout":r="info",a=n.chat_web_rtc_answer_timeout();break;case"already_exists":r="warning",a=n.chat_web_rtc_only_1_call_simultaneously()}t({type:r,id:I.Notifications.ChatWebRtcError,message:a,closable:!0,duration:1e4})}));(0,a.useEffect)((function(){return e.dispenser.subscribe({onWebRtcError:r}).unsubscribe}),[e,r])}(),function(){var e=(0,Wt.useFavoritesStateConnector)(),t=(0,I.useNotificationsState)("methods").showNotification,n=(0,c.useLocalizationState)("t").FAVORITES,r=(0,y.useEvent)((function(){t({type:"error",id:I.Notifications.CallFailedDueNetworkIssueWarning,closable:!0,tags:["current-view"],message:n.favorites_limit_reached_error()})}));(0,a.useEffect)((function(){return e.dispenser.subscribe({onLimitReachedError:r}).unsubscribe}),[e,r])}()}function mn(){var e,t,n,o,i,s,l,u,f,m,p,v;e=(0,Kt.useBpClientStateConnector)(),t=(0,ie.useModalsStateMethods)(),n=t.openModal,o=t.closeModal,i=(0,c.useLocalizationState)("t"),s=(0,y.useEvent)((function(){n({id:Qt,title:i.INSTALLATION_PROCESS.bp_client_not_authorized_header(),body:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{children:i.INSTALLATION_PROCESS.bp_client_not_authorized_message_part1()}),(0,r.jsx)("a",{href:Xt,rel:"noopener noreferrer",target:"_blank",children:i.ERROR_MESSAGES.domainAuthentificationErrorAnchor()}),(0,r.jsx)("span",{children:i.INSTALLATION_PROCESS.bp_client_not_authorized_message_part2()})]}),actions:function(e){var t=e.closeModal;return(0,r.jsx)(d.SmButton,{onClick:t,children:i.WINDOW_POPUP_TITLES_AND_MESSAGES.window_buttonOk()})}})})),l=(0,y.useEvent)((function(){o(Qt)})),(0,a.useEffect)((function(){return e.dispenser.subscribe({onShowDomainAuthorizationDialog:s,onHideDomainAuthorizationDialog:l}).unsubscribe}),[e,s,l]),function(){var e=(0,c.useLocalizationState)("t").WINDOW_POPUP_TITLES_AND_MESSAGES,t=(0,Kt.useBpClientState)("isExtensionAvailable"),n=(0,Kt.useBpClientStateConnector)(),o=(0,ie.useModalsStateMethods)().openModal,i=(0,y.useEvent)((function(n){o({title:e.window_title_warning(),body:(0,r.jsx)(an,{install:n,isExtAvailable:t}),actions:{ok:{title:e.window_buttonOk()}}})}));(0,a.useEffect)((function(){return n.dispenser.subscribe({onInstallationRequired:i}).unsubscribe}),[n,i])}(),u=(0,I.useNotificationsState)("methods").showNotification,f=(0,on.useOfflineStateMethods)().setShowOfflineAlert,m=(0,on.useOfflineStateDataShowOfflineAlert)(),p=(0,on.useOfflineErrorMessages)(),v=(0,on.useIsOffline)(),(0,a.useEffect)((function(){m&&u({type:"error",id:I.Notifications.OfflineStateError,content:p.isOffline,closable:!0,duration:5e3,onHide:function(){return f(!1)}})}),[p.isOffline,f,u,m]),(0,a.useEffect)((function(){v||f(!1)}),[v,f]),function(){var e=(0,Kt.useBpClientStateConnector)(),t=(0,c.useLocalizationState)("t").WINDOW_POPUP_TITLES_AND_MESSAGES,n=(0,ie.useModalsStateMethods)().openModal,o=(0,y.useEvent)((function(e){n({title:t.window_title_warning(),body:(0,r.jsx)(sn,{browserName:e}),actions:function(e){var n=e.closeModal;return(0,r.jsx)(d.SmButton,{onClick:n,children:t.window_buttonOk()})}})}));(0,a.useEffect)((function(){return e.dispenser.subscribe({onShowExtensionIsOldDialog:o}).unsubscribe}),[e,o])}(),function(){var e=(0,I.useNotificationsState)("methods"),t=e.showNotification,n=e.hideNotificationById,o=(0,ln.useAppConfigState)("isClientOutdated"),i=(0,at.useSessionState)("isLoggedIn"),s=(0,c.useLocalizationState)("t").GLOBAL,l=(0,y.useEvent)((function(){i&&(o?t({type:"error",id:I.Notifications.OutdatedClientAppError,message:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{children:s.reload_confirm_new_msg_part1()}),(0,r.jsx)("a",{href:"#",onClick:cn,children:s.reload_confirm_action_button_text()}),(0,r.jsx)("span",{children:s.reload_confirm_new_msg_part2()})]})}):n(I.Notifications.OutdatedClientAppError))}));(0,a.useEffect)((function(){l()}),[o,l])}(),function(){var e=(0,at.useSessionStateConnector)(),t=(0,Kt.useBpClientState)("isHelperAppInstanceCreated"),n=(0,I.useNotificationsState)("methods"),r=n.showNotification,o=n.hideNotificationById,i=(0,at.useSessionState)("phoneType"),s=(0,c.useLocalizationState)("t"),l=(0,y.useEvent)((function(e){if(e.canDial||"phone_type_none"===i)un.bpLogger.info("SIP phone or external line is in service"),o(I.Notifications.PhoneOutOfServiceError);else{var n;switch(un.bpLogger.warn("SIP phone or external line is out of service"),i){case"phone_type_nailed":n=s.WINDOW_POPUP_TITLES_AND_MESSAGES.window_messages_virtual_phone_not_available();break;case"phone_type_soft_secure":case"phone_type_soft_unsecure":n=t?s.WINDOW_POPUP_TITLES_AND_MESSAGES.window_messages_phone_not_available():s.WINDOW_POPUP_TITLES_AND_MESSAGES.window_messages_helper_app_not_available();break;default:n=s.WINDOW_POPUP_TITLES_AND_MESSAGES.window_messages_phone_not_available()}r({type:"error",id:I.Notifications.PhoneOutOfServiceError,message:n,closable:!1,showDelay:dn})}})),u=(0,y.useEvent)((function(e,t){"agentServer"===e&&4===t&&r({type:"warning",id:I.Notifications.PhoneOutOfServiceError,message:s.ERROR_MESSAGES.phoneIsNotRegistered(),closable:!1,showDelay:dn})})),d=(0,y.useEvent)((function(){r({type:"warning",id:I.Notifications.PhoneOutOfServiceError,message:s.WINDOW_POPUP_TITLES_AND_MESSAGES.window_messages_3pcc_server_connectionLost(),closable:!1,showDelay:dn})})),f=(0,y.useEvent)((function(){o(I.Notifications.PhoneOutOfServiceError)}));(0,a.useEffect)((function(){return e.dispenser.subscribe({onUpdateCapabilities:l,onServerError:u,onThreePCCServerGone:d,onThreePCCServerReady:f}).unsubscribe}),[l,u,d,f,e])}(),function(){var e=(0,I.useNotificationsState)("methods"),t=e.showNotification,n=e.hideNotificationById,r=(0,c.useLocalizationState)("t").WINDOW_POPUP_TITLES_AND_MESSAGES,o=(0,at.useSessionState)("sipServer"),i=(0,y.usePreviousValueRef)(o),s=(0,y.useEvent)((function(){o?n(I.Notifications.SipServerConnectionError):i.current&&t({type:"error",id:I.Notifications.SipServerConnectionError,message:r.window_messages_3pcc_server_connectionLost()})}));(0,a.useEffect)((function(){s()}),[o,s])}(),function(){var e=(0,I.useNotificationsState)("methods"),t=e.showNotification,n=e.hideNotificationById,r=(0,c.useLocalizationState)("t").GLOBAL,o=(0,a.useRef)(0),i=(0,y.useEvent)((function(){0!==o.current||(o.current=(new Date).getTime(),fetch("/",{method:"HEAD",cache:"no-store"}).catch((function(e){return console.error(e)})).finally((function(){var e=(new Date).getTime()-o.current;if(o.current=0,e>800){var a=r.slow_connection();t({type:"error",id:I.Notifications.SlowNetworkConnectionError,message:a}),un.bpLogger.warn("Slow connection detected")}else n(I.Notifications.SlowNetworkConnectionError)})))}));(0,a.useEffect)((function(){var e=setInterval(i,5e3);return function(){return clearInterval(e)}}),[i])}(),function(){var e=(0,I.useNotificationsState)("methods"),t=e.showNotification,n=e.hideNotificationById,o=(0,Kt.useBpClientState)("isDomainAuthorized"),i=(0,c.useLocalizationState)("t").ERROR_MESSAGES,s=(0,y.useEvent)((function(){o?n(I.Notifications.DomainNotAuthorizedForBPClientError):t({type:"error",id:I.Notifications.DomainNotAuthorizedForBPClientError,closable:!1,message:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{children:i.domain_authentication_error_part1()}),(0,r.jsx)("a",{href:Xt,rel:"noopener noreferrer",target:"_blank",children:i.domainAuthentificationErrorAnchor()}),(0,r.jsx)("span",{children:i.domain_authentication_error_part2()})]})})}));(0,a.useEffect)((function(){s()}),[o,s])}()}var pn=function(e){var t=e.baseConnectors,n=e.authorizedConnectors,a=e.children;return mn(),(0,r.jsx)(r.Fragment,{children:a(t,n)})},vn=n(9572),hn=n(5100),bn=function(){var e=(0,at.useSessionState)("forceLogoutInfo"),t=(0,at.useSessionStateMethods)().closeForceLogout,n=(0,gt.useFormatting)().formatFullName,a=(0,c.useLocalizationState)().t;(0,l.assertDefined)(e);var o=n(e.firstName,e.lastName),i=(0,rt.formatDate)(e.timestamp);return(0,r.jsx)(d.SmSegment,{padded:!0,className:"absolute left-1/2 top-1/2 -translate-x-1/2 -translate-y-1/2   overflow-hidden rounded-none border-none bg-transparent shadow-none",id:"login",children:(0,r.jsxs)(L.Modal,{isOpen:!0,size:"small",className:"max-w-[570px]","aria-describedby":"forceLogoutDialogDescription","data-testid":"forced-logout-modal",children:[(0,r.jsx)(L.Modal.Header,{children:a.WINDOW_POPUP_TITLES_AND_MESSAGES.window_title_information()}),(0,r.jsx)(L.Modal.Content,{children:(0,r.jsx)(L.Modal.Description,{id:"forceLogoutDialogDescription",children:(0,r.jsx)("p",{children:function(){switch(e.errorCode){case Gt.incomingErrorMessageCodes.forced_logout_by_another_session:return a.ERROR_MESSAGES.sessionWasOverwritten();case Gt.incomingErrorMessageCodes.forced_logout_by_supervisor:return a.ERROR_MESSAGES.forcedLogout(o,i);case Gt.incomingErrorMessageCodes.forced_logout_by_disabling_tenant:case Gt.incomingErrorMessageCodes.forced_logout_by_disabling_user:return a.ERROR_MESSAGES.account_has_been_disabled()}return e.forceLogoutReason}()})})}),(0,r.jsx)(L.Modal.Actions,{children:(0,r.jsx)(d.SmButton,{onClick:t,primary:!0,"data-testid":"ok-button",children:a.WINDOW_POPUP_TITLES_AND_MESSAGES.window_buttonOk()})})]})})},yn=function(){var e=(0,vn.useCurrentTabRole)(),t=(0,at.useSessionState)(["authChecked","isLoggedIn","showLoginDialog","offerForceLogin","forceLogoutInfo"]),n=t.authChecked,a=t.isLoggedIn,o=t.showLoginDialog,i=t.offerForceLogin,s=t.forceLogoutInfo,l=!(0,c.useLocalizationState)("language")||"undecided"===e&&!n,u=!l&&(o||!a),d=!!s&&u,f=i&&!s&&u;return(0,r.jsxs)("div",{className:"mx-auto h-full w-[496px]",children:[l&&(0,r.jsx)(L.Loader,{active:!0,size:"huge",color:"primary"}),u&&(0,r.jsx)(hn.LoginPage,{}),d&&(0,r.jsx)(bn,{}),f&&(0,r.jsx)(hn.ForceLogin,{})]})},gn=o().memo((function(e){var t=e.baseConnectors,n=e.children;return(0,at.useSessionState)("isLoggedIn")?(0,r.jsx)(Vt.AuthorizedProviders,{baseConnectors:t,children:function(e){return(0,r.jsx)(pn,{baseConnectors:t,authorizedConnectors:e,children:n})}}):(0,r.jsx)(yn,{})})),jn=function(e){var t=e.baseConnectors,n=e.children,a=e.BaseConnectorsConsumer;return a?(0,r.jsx)(a,{baseConnectors:t,children:n}):n},In=function(e){var t=e.app,n=e.platformSpecific,a=e.BaseConnectorsConsumer,o=e.children;return(0,r.jsx)(Vt.BaseProviders,{platformSpecific:n,app:t,children:function(e){return(0,r.jsx)(jn,{baseConnectors:e,BaseConnectorsConsumer:a,children:(0,r.jsx)(j.Tooltip.Provider,{children:(0,r.jsx)(I.NotificationsStateProvider,{children:o(e)})})})}})},Sn=function(e){var t=e.app,n=e.platformSpecific,a=e.children,o=e.BaseConnectorsConsumer,i=e.className,s=e.appRemoteName;return(0,r.jsx)(L.AppStyleSelector,{app:s,children:(0,r.jsx)("div",{className:M("h-full",i),children:(0,r.jsx)(In,{app:t,platformSpecific:n,BaseConnectorsConsumer:o,children:function(e){return(0,r.jsx)(gn,{baseConnectors:e,children:a})}})})})},On=n(5319),xn=n(5928),Cn=n(2488),_n=n(1308),wn=n(6702),Nn=n(7176),An=n(2234),Pn={isAttachmentsListReady:function(){return!0},getAttachmentsList:function(){return[]},addAttachment:$.noop,removeAttachment:$.noop,clearAttachmentsList:$.noop,initializeAttachmentsList:$.noop,fileRejections:[],setFileRejections:$.noop},En=n(4173);function Dn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Tn(e,t,n,r,a,o,i){try{var s=e[o](i),l=s.value}catch(c){return void n(c)}s.done?t(l):Promise.resolve(l).then(r,a)}function kn(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){Tn(o,r,a,i,s,"next",e)}function s(e){Tn(o,r,a,i,s,"throw",e)}i(void 0)}))}}function Mn(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ln(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Mn(e,t,n[t])}))}return e}function Rn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Dn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Dn(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Fn(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(s){o=[6,s],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function Bn(e){var t,n=e.uploadFile,r=e.handleError,o=e.getFormData,i=Rn((0,a.useState)({}),2),s=i[0],l=i[1],c=Rn((0,a.useState)([]),2),u=c[0],d=c[1],f=(0,a.useRef)({}),m=(0,a.useRef)({pendingAmount:0,items:[]}),p=(0,a.useCallback)((function(e,t){var n;return null===(n=f.current[e])||void 0===n?void 0:n[t]}),[]),v=(0,a.useCallback)((function(e){delete f.current[e]}),[]),h=(0,a.useCallback)((function(e,t){var n;null===(n=f.current[e])||void 0===n||delete n[t]}),[]),b=(0,a.useCallback)((function(e,t){var n=p(e,t);n&&(n(),h(e,t))}),[p,h]),g=(0,a.useRef)(s),j=(0,at.useSessionState)(["sessionId","domain","loginId"]),I=j.sessionId,S=void 0===I?"":I,O=j.domain,x=void 0===O?"":O,C=j.loginId,_=void 0===C?"":C,w=(0,a.useCallback)((function(e){l((function(t){var n=e(t);return g.current=n,n}))}),[]),N=(0,a.useCallback)((function(e){var t;return e&&Object.values(null!==(t=s[e])&&void 0!==t?t:{})||[]}),[s]),A=(0,a.useCallback)((function(e,t){m.current.items=m.current.items.filter((function(n){return t!==n.id||e!==n.attachmentsGroupId}))}),[]),D=(0,a.useCallback)((function(e,t){var n=(0,En.uuid)();return w(E()((function(r){r[e]||(r[e]={}),r[e][n]=(0,P.castDraft)(Ln({id:n},t))}))),n}),[w]),T=(0,a.useCallback)((function(e,t,n){w(E()((function(r){r[e]||(r[e]={}),r[e][t]=Ln({},r[e][t],(0,P.castDraft)(n))})))}),[w]),k=(0,a.useCallback)((function(e,t){b(e,t),A(e,t),w(E()((function(n){n[e]&&delete n[e][t]})))}),[b,A,w]),M=(0,a.useCallback)(kn((function(){var e,t,a,i,s,l,c;return Fn(this,(function(u){switch(u.label){case 0:return(e=m.current).pendingAmount>=1?[2]:(t=e.items.shift())?(e.pendingAmount++,a=t.id,i=t.attachmentsGroupId,s=t.file,(new FormData).append("file",s),l={data:o(t),tenant:x,token:S,user:_,fileName:s.name,fileType:"attachment"},[4,n(l,{onSuccess:function(t){p(i,a)&&(T(i,a,{id:a,file:s,isLoading:!1,fileData:t}),h(i,a)),e.pendingAmount--,M()},onError:function(t){p(i,a)&&(k(i,a),d(E()((function(e){e.push({file:s,errors:[t]})}))),null==r||r(i,t),h(i,a)),e.pendingAmount--,M()}})]):[2];case 1:return c=u.sent(),f.current[i]||(f.current[i]={}),f.current[i][a]=c,[2]}}))})),[x,p,o,r,_,k,h,S,T,n]),L=(0,a.useCallback)((function(e,t){var n=D(e,{isLoading:!0,file:t});m.current.items.push({id:n,attachmentsGroupId:e,file:t}),M()}),[D,M]),R=(0,a.useCallback)((function(e){v(e),w(E()((function(t){t[e]={}})))}),[v,w]),F=(0,a.useCallback)((function(e){v(e),w(E()((function(t){delete t[e]})))}),[v,w]),B=(0,a.useCallback)((function(e){var t=N(e);return!(null==t?void 0:t.length)||t.every((function(e){return!e.isLoading}))}),[N]),U=function(){var e=(0,at.useSessionState)(),t=e.serverOrigin,n=e.sessionId,r=e.loginId,o=e.domain;return{generateUrl:(0,a.useCallback)((function(e){var a={token:n,user:r,tenant:o,id:e,no_disposition:0},i=Object.keys(a).map((function(e){return"".concat(e,"=").concat(a[e])})).join("&");return"".concat(t,"/agentdesktop/agentdesktop/attachmentDownload?").concat(i)}),[t,n,r,o])}}().generateUrl,z=(0,a.useCallback)((t=kn((function(e,t){var n;return Fn(this,(function(r){return n=t.map(function(){var e=kn((function(e){return Fn(this,(function(t){switch(t.label){case 0:return[4,(0,y.getFileFromUrl)(U(e.id),e.name)];case 1:return[2,t.sent()]}}))}));return function(t){return e.apply(this,arguments)}}()),Promise.all(n).then((function(t){t.forEach((function(t){L(e,t)}))})),[2]}))})),function(e,n){return t.apply(this,arguments)}),[L,U]);return(0,a.useMemo)((function(){return{fileRejections:u,setFileRejections:d,removeAttachmentsList:F,getAttachmentsList:N,removeAttachment:k,clearAttachmentsList:R,addAttachment:L,initializeAttachmentsList:z,isAttachmentsListReady:B}}),[u,F,N,k,R,L,z,B])}var Un=(0,wn.createContext)(Pn);function zn(e){var t=e.file,n=new FormData;return n.append("file",t),n}Un.displayName="ChatAttachmentsUIContext";var Hn=function(e){var t=e.children,n=Bn({uploadFile:(0,An.useUploadChatFile)(),getFormData:zn});return(0,te.useOnItemRemoved)((function(e){n.removeAttachmentsList((0,X.getInteractionStepId)(e))})),(0,r.jsx)(Un.Provider,{value:n,children:t})},Vn=(0,Nn.createUIStateSelectorHook)(Un,"chatAttachmentsUIState").useChatAttachmentsUIState,Gn=(0,wn.createContext)(Pn);Gn.displayName="EmailAttachmentsUIContext";(0,Nn.createUIStateSelectorHook)(Gn,"emailAttachmentsUIState").useEmailAttachmentsUIState;var Wn=n(638);function qn(e,t){switch(t){case"sms":return{value:t,text:e.GLOBAL.chat_type_sms()};case"web":return{value:t,text:e.GLOBAL.chat_type_web()};case"telegram":return{value:t,text:e.GLOBAL.chat_type_telegram()};case"line":return{value:t,text:e.GLOBAL.chat_type_line()};case"twitter":return{value:t,text:e.GLOBAL.chat_type_twitter()};case"facebook":return{value:t,text:e.GLOBAL.chat_type_facebook()};case"wechat":return{value:t,text:e.GLOBAL.chat_type_wechat()};case"nexmo":return{value:t,text:e.GLOBAL.chat_type_nexmo()};case"viber":return{value:t,text:e.GLOBAL.chat_type_viber()};case"whatsapp":return{value:t,text:e.GLOBAL.chat_type_whatsapp()};case"remoteassist":return{value:t,text:e.GLOBAL.chat_type_remote_assist()}}}function Yn(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Kn(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Yn(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Yn(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var $n={value:"sms",text:"SMS"};function Xn(){var e=function(){var e,t,n,r,o=(0,st.useContactsStateMethods)().getContact,l=(0,st.useContactsState)("contacts"),u=(0,s.useNonAssertedInteractionId)(),d=(0,i.useAssociatedChatInteraction)(u),f=(0,Bt.useServicesDispositionsState)(),m=f.services,p=f.allOutboundChatChannels,v=f.outboundChatChannels,h=(0,On.useDIDNumberState)().selectedDIDNumber,b=(0,xn.useServiceState)().selectedService,y=(0,Wn.useRemoteAssistState)().items,g=(0,c.useLocalizationState)().t,j=(0,X.getChannel)(d),I=(0,X.getServiceId)(d),S=(0,X.getMessengers)(l,d),O=null==d?void 0:d.contactId,x=null==d||null===(e=d.externalChatData)||void 0===e?void 0:e.channel,C=(0,X.getGlobalInteractionId)(d),_=C&&"joined"===(null===(t=y[C])||void 0===t?void 0:t.clientState),w=O&&(null===(n=l[O])||void 0===n?void 0:n.isLoading),N=!!O&&!!(null===(r=l[O])||void 0===r?void 0:r.data);(0,a.useEffect)((function(){!O||w||N||o({id:O})}),[N,O,o,w]);var A=(0,a.useMemo)((function(){var e,t=function(e){e&&(n[e.value]=e)},n={};return null==S||S.forEach((0,$.flow)((0,$.property)("type"),(0,$.partial)(qn,g),t)),t({value:"remoteassist",text:g.GLOBAL.chat_type_remote_assist()}),(0,X.getPhoneFromItem)(d)&&t({value:"sms",text:g.GLOBAL.chat_type_sms(),phones:null==d?void 0:d.displayData.phones}),function(){if(x){var e=qn(g,x);e&&t(e)}}(),function(){for(var e in n)t(n[e])||delete n[e];function t(e){var t=I||b;if("remoteassist"===e.value)return _;if("web"===e.value)return!0;if(e.value===x)return!0;if((0,X.isCall)(d))return!0;if(t){var n=(0,X.isChatService)(t,m)?p:v[t];return null==n?void 0:n.includes(e.value.toUpperCase())}return h?"sms"===e.value:void 0}}(),(e=qn(g,j))&&t(e),Object.values(n)}),[S,g,d,I,b,h,m,p,v,j,_,x]);return(0,a.useMemo)((function(){return A}),[A])}(),t=(0,Jt.useOpenChannel)();(0,a.useRef)(e).current=e;var n=Kn((0,a.useState)({}),2),r=n[0],o=n[1],l=Kn((0,a.useState)({}),2),u=l[0],d=l[1],f=(0,a.useCallback)((function(t){return r[t]?r[t]:e?e[0]:void 0}),[e,r]),m=(0,a.useCallback)((function(e){var t=f(e);if("sms"===(null==t?void 0:t.value)){if(u[e])return u[e];var n;if(t)return null==t||null===(n=t.phones)||void 0===n?void 0:n[0]}}),[f,u]),p=(0,a.useCallback)((function(e,t,n){return o(E()((function(n){n[e]=t}))),d(E()((function(r){var a;r[e]=n?null===(a=t.phones)||void 0===a?void 0:a.find((function(e){return e.id===n})):void 0}))),t}),[]),v=(0,a.useCallback)((function(){o({"":$n})}),[]),h=(0,a.useCallback)((function(e){o(E()((function(t){delete t[e.id]})))}),[]),b=Kn((0,a.useState)({}),2),y=b[0],g=b[1],j=(0,a.useCallback)((function(e){return y[e||""]}),[y]),I=(0,a.useCallback)((function(e,t){g(E()((function(n){n[e]=t})))}),[]);(0,at.useOnLogout)((function(){v(),g({})})),(0,te.useOnItemRemoved)((function(e){h(e),function(e){g(E()((function(t){delete t[e.id]})))}(e)}));var S=(0,a.useCallback)((function(e,n,r){t(n.value),p(e,n,r),I(e,!0)}),[t,p,I]);return(0,a.useMemo)((function(){return{getSelectedChannel:f,getSelectedPhone:m,setSelectedChannel:S,channelOptions:e,isTouched:j,setIsTouched:I}}),[f,m,S,e,j,I])}var Qn="ChannelStateContext",Zn={getSelectedChannel:function(){return $n},getSelectedPhone:function(){},isTouched:function(){return!1},channelOptions:[$n],setIsTouched:(0,y.throwNoProviderError)(Qn),setSelectedChannel:(0,y.throwNoProviderError)(Qn)},Jn=o().createContext(Zn);Jn.displayName=Qn;var er=function(e){var t=Xn();return(0,r.jsx)(Jn.Provider,{value:t,children:e.children})},tr=function(){return(0,a.useContext)(Jn)},nr=n(2107),rr=n(1554),ar=n(4171),or=n(7110);function ir(e){var t=(0,or.useScreenPopStateMethods)().addTabs,n=(0,vn.useBrowserTabMetaInfo)(),r=null==n?void 0:n.app,o=(0,i.useInteractionStateMethods)().saveOpenedSuggestionUrl;return(0,a.useCallback)((function(n){var a,i;if(n.suggestionURL)if(o(e,n.suggestionURL),"ad"===r&&"AGENT_DESKTOP"===n.openURLIn){var s,l=null!==(s=n.msgId)&&void 0!==s?s:n.suggestionURL;t(e,[{id:l,type:"iframe",url:n.suggestionURL,title:(0,se.formatHTMLAsOneLineString)(n.text)}])}else try{window.open((0,y.normalizeExternalURL)(n.suggestionURL),"NEW_TAB"==n.openURLIn?"_blank":void 0,"noopener,noreferrer")}catch(u){var c=(a=u,(null!=(i=Error)&&"undefined"!=typeof Symbol&&i[Symbol.hasInstance]?i[Symbol.hasInstance](a):a instanceof i)?u.message:"unknown error");console.error("error opening window for url ".concat(n.suggestionURL,": ").concat(c))}}),[r,e,t,o])}var sr=n(5715),lr=n(7856);function cr(e){return"string"==typeof e}function ur(e){return!!e&&!cr(e)&&"globalInteractionId"in e}function dr(e){return!!e&&!cr(e)&&"serviceId"in e&&"activityGroup"===e.displayType}function fr(e){return!!e&&!dr(e)&&!ur(e)}function mr(e){return"object"==typeof e&&"type"in e&&lr.voiceTranscriptMessageTypes.includes(e.type)}function pr(e){return"string"==typeof e}function vr(e){return mr(e)&&"suggestion"===e.type}function hr(e){return!vr(e)&&("string"==typeof e||"VOICE"===e.mediaType||"VOICE_TRANSCRIPT"===e.mediaType)}function br(e){return ur(e)&&"VOICE"==e.mediaType}function yr(e){return((null==e?void 0:e.scrollTop)||0)+((null==e?void 0:e.clientHeight)||0)>=((null==e?void 0:e.scrollHeight)||0)}function gr(e){var t,n;return mr(e)?"error"===(null===(t=e.chatMessageData)||void 0===t?void 0:t.displayType)?"".concat(e.timestamp,"-error"):e.chatMessageData?r(e.chatMessageData):"".concat((n=e).partyId,"-").concat(n.msgId,"-").concat(n.timestamp):function(e){return"object"==typeof e&&!mr(e)}(e)?dr(e)?function(e){var t;return"".concat(e.timestamp,"-").concat(null!==(t=e.msgId)&&void 0!==t?t:"","-").concat(e.partyId,"-").concat(e.notes?"notes":"disposition")}(e):"scenario"===_r(e)?function(e){return"".concat(e.timestamp,"-").concat(e.msg,"-scenario")}(e):ur(e)?function(e){var t;return"".concat(e.timestamp,"-").concat(null!==(t=e.msgId)&&void 0!==t?t:"","-").concat(e.direction)}(e):r(e):e;function r(e){var t;return"".concat(e.timestamp,"-").concat(null!==(t=e.msgId)&&void 0!==t?t:"","-").concat(e.source)}}function jr(e,t,n){var r=null==e?void 0:e.querySelector("[data-index='".concat(t,"']"));if(!r)return{id:"",offset:0};var a=((null==e?void 0:e.scrollTop)||0)-r.offsetTop;if(a>0)return jr(e,t+1,n);var o=n[t];return o?"string"==typeof o?jr(e,t+1,n):{id:gr(n[t]||""),offset:a}:{id:"",offset:0}}function Ir(e,t){if(!t.name)return null;var n=(0,y.getFileNameAndExtension)(t.name),r=n.extension,a=n.name,o=[];return nr.CHAT_PROHIBITED_EXTENSIONS.includes(".".concat(r))&&o.push({code:sr.ErrorCode.FileInvalidType,message:e.EXTERNAL_CHAT.invalid_file_extension_error(a)}),o.length?o:null}function Sr(e,t){var n=Ir(e,t);return n?{file:t,errors:n}:null}function Or(e){return function(t){return t.parties.reduce((function(n,r){if("USER"===r.partyType&&(r.disposition||r.notes)){var a=r;n.push(function(e,t,n){var r,a,o,i,s,l=t.Id.oid,c=(null===(r=e.startTime)||void 0===r?void 0:r.date)||t.createdTime.date,u=t.mediaType,d=e.serviceId,f=d?null===(a=t.services)||void 0===a?void 0:a.find((function(e){return e.serviceId===d})):void 0;return{mediaType:u,msgId:l,displayType:"activityGroup",notes:e.notes,disposition:e.disposition,timestamp:c?(0,y.addTime)(c,"seconds",null!==(o=e.duration)&&void 0!==o?o:0).getTime():0,serviceId:null!==(i=null==f?void 0:f.serviceId)&&void 0!==i?i:e.serviceId,serviceName:null!==(s=null==f?void 0:f.serviceName)&&void 0!==s?s:"",firstName:e.firstName,lastName:e.lastName,userId:e.userId,isSelf:e.userId===n,partyId:e.partyId}}(a,t,e))}return n}),[])}}function xr(e,t,n){var r=e.firstName,a=e.lastName,o=e.timestamp,i=e.mediaType,s=n(r,a),l=(0,y.formatDate)(o,"ll"),c=(0,y.formatDate)(o,"h:mm A");return"CHAT"===i?t.EXTERNAL_CHAT.disposition_message_title(s,l,c):t.VOICE_CALL.disposition_message_title(s,l,c)}function Cr(e){var t=document.createElement("div");t.innerHTML=e,t.style.opacity="0",t.style.position="absolute",t.style.display="hidden",t.style.zIndex="-1000",document.body.append(t);var n=t.innerText;return t.remove(),n}function _r(e){return fr(e)||ur(e)||dr(e)?e.displayType:void 0}function wr(e,t){var n=br(e)?e.users:void 0;if(null==n?void 0:n.length)return n.map((function(e){return t(e.firstName,e.lastName)})).join(", ");var r=fr(e)?e.displayName:void 0;if(r)return r;var a=ur(e)?e:{firstName:void 0,lastName:void 0},o=a.firstName,i=a.lastName;return o||i?t(o,i):void 0}function Nr(e){return fr(e)&&"error"===e.displayType}function Ar(e){return fr(e)&&"file"===e.displayType?{fileId:e.fileId,fileError:e.fileError,fileIsMasked:e.fileIsMasked,fileProgress:e.fileProgress,fileName:e.fileName,fileType:e.fileType,refMsgId:void 0}:function(e){return ur(e)&&"file"===e.displayType}(e)?{fileId:e.fileId,refMsgId:e.refMsgId,fileType:e.fileType,fileName:e.fileName,fileError:void 0,fileIsMasked:void 0,fileProgress:void 0}:void 0}var Pr=n(5914),Er=n(9327);function Dr(e){var t=e.chatData,n=e.p2pUser,r=e.session;if(!t||t.members.length>2)return{avatarType:"conference",isAgent:!0};if("TEAM"===t.type)return function(e){return{avatarType:"team-chat",fullName:e.title,isAgent:!1}}(t);var a=function(e,t){var n=e.members.find((function(e){return e.id!==t.userId}));return{avatarType:"user",firstName:null==n?void 0:n.firstName,isAgent:!0,lastName:null==n?void 0:n.lastName,url:(null==n?void 0:n.id)&&(0,Pr.constructUserPictureUrl)(t,n.id)}}(t,r);return n&&(a.isOnline="available"===n.presenceState,a.onlineStatusIcon=(0,Er.getUserStatusIcon)(n)),a}function Tr(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function kr(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function Mr(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Tr(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Tr(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Lr=(0,wn.createContext)({hasSelection:!1,setHasSelection:$.noop,messages:[],selectedMessages:[],getClipboardBuffer:function(){return""},setClipboardBuffer:$.noop,scrollContainer:null});Lr.displayName="ChatMessagesContextProvider";var Rr=function(e){var t=e.children,n=e.messages,o=e.interactionId,i=e.scrollContainer,s=Mr((0,a.useState)(!1),2),l=s[0],c=s[1],u=Mr((0,a.useState)(""),2),d=u[0],f=u[1],m=Mr((0,a.useState)([]),2),p=m[0],v=m[1],h=(0,a.useRef)(),b=(0,y.useEvent)((function(){return d})),g=(0,y.useValueUpdated)(o);(0,a.useEffect)((function(){g&&(c(!1),f(""),v([]))}),[g]),(0,y.useEventListener)("mouseup",(function(e){if(h.current&&kr(e,MouseEvent)){var t=Vr(e.target);if(t){var r,a=n.findIndex((function(e){return gr(e)===h.current})),o=n.findIndex((function(e){return gr(e)===t})),i=[a,o].sort((function(e,t){return e-t})),s=n.slice(i[0],i[1]+1),l=window.getSelection(),c=(null!==(r=null==l?void 0:l.rangeCount)&&void 0!==r?r:0)>0?null==l?void 0:l.getRangeAt(0):void 0;if(s.length>1&&l&&c){var u=a<o,d=document.querySelector("[data-message-id-selection='".concat(h.current,"']")),f=document.querySelector("[data-message-id-selection='".concat(t,"']")),m=u?d:f,p=u?f:d;c.setStartBefore(m||c.startContainer),c.setEndAfter(p||c.endContainer),u?l.setBaseAndExtent(c.startContainer,c.startOffset,c.endContainer,c.endOffset):l.setBaseAndExtent(c.endContainer,c.endOffset,c.startContainer,c.startOffset)}v(s)}}}));var j=(0,a.useCallback)((function(e){h.current=Vr(e.target)}),[]),I=(0,a.useMemo)((function(){return{hasSelection:l,setHasSelection:c,messages:n,selectedMessages:p,setClipboardBuffer:f,getClipboardBuffer:b,scrollContainer:i}}),[b,l,n,i,p]);return(0,r.jsx)(Lr.Provider,{value:I,children:(0,r.jsx)("div",{onMouseDown:j,children:t})})},Fr=function(){return(0,wn.useContextSelector)(Lr,(function(e){return e.messages}))},Br=function(){return(0,wn.useContextSelector)(Lr,(function(e){return e.selectedMessages}))},Ur=function(){return(0,wn.useContextSelector)(Lr,(function(e){return e.getClipboardBuffer}))},zr=function(){return(0,wn.useContextSelector)(Lr,(function(e){return e.setClipboardBuffer}))},Hr=function(){return(0,wn.useContextSelector)(Lr,(function(e){return e.scrollContainer}))};function Vr(e){var t,n=void 0;if(kr(e,HTMLElement))n=(null===(t=e.closest("[data-message]"))||void 0===t?void 0:t.querySelector("[data-message-id-selection]"))||void 0;else if(kr(e,Node)){var r,a;n=(null===(a=e.parentElement)||void 0===a||null===(r=a.closest("[data-message]"))||void 0===r?void 0:r.querySelector("[data-message-id-selection]"))||void 0}return(null==n?void 0:n.getAttribute("data-message-id-selection"))||void 0}var Gr=n(6607),Wr=n(6070);function qr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Yr(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Kr(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var $r=function(e){var t=e.className,n=e.children,a=Kr(e,["className","children"]);return(0,r.jsx)("button",Yr(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){qr(e,t,n[t])}))}return e}({},a),{className:M("flex items-center gap-1 rounded border px-2 py-0.5 shadow-4 state-layer-bg-neutral-0 svg-color-current border-default","transition-colors","hover:state-layer-mix-dark-on-white-1","focus:state-layer-mix-dark-on-white-2","active:state-layer-mix-dark-on-white-3",t),children:n}))};function Xr(){var e=(0,c.useLocalizationState)().t,t=(0,gt.useFormatting)().formatFullName,n=(0,st.useContactsState)("contacts"),r=(0,Er.useUserDetailsState)("userDetails"),o=(0,s.useNonAssertedInteractionId)(),l=(0,i.useInteraction)(o),u=(0,at.useSessionState)(["firstName","lastName"]);return(0,a.useCallback)((function(a){var o=function(){if(pr(a))return;if(mr(a)){var o,i,s=a.endTime,c=a.partyId,d=a.text,f=null==l||null===(o=l.parties)||void 0===o?void 0:o.find((function(e){return e.id===c})),m=null==l||null===(i=l.chatParties)||void 0===i?void 0:i.find((function(e){return e.party_id===c})),p=f?t(f.firstName,f.lastName):m?t(m.first_name,m.last_name):t(u.firstName,u.lastName),v=Cr(d);return{date:(0,rt.formatDate)(s,{full:!0}),name:p,text:v}}if(dr(a)){var h=a.timestamp,b=a.lastName,g=a.firstName,j=a.notes||function(e,t,n){return"".concat(xr(e,t,n),"\n\n")+"".concat(e.disposition,"\n\n")+"".concat(t.EXTERNAL_CHAT.disposition_message_service_name()," ").concat(e.serviceName)}(a,e,t);return{date:(0,rt.formatDate)(h,{full:!0}),name:t(g,b),text:j}}if(ur(a)||fr(a)){var I,S,O=a.timestamp,x=a.contactId,C=a.userId,_=wr(a,t),w=x?null===(I=n[x])||void 0===I?void 0:I.data:C?null===(S=r[C])||void 0===S?void 0:S.data:void 0,N=w?t(w.firstName,w.lastName):"",A=_||N,P=function(e,t){var n=Ar(e);if(n)return n.fileName;if(fr(e))return e.page?e.title||t.EXTERNAL_CHAT.external_chat_customer_navigates_to():Cr(e.msg||"");if(br(e)){var r=e.isMissedCall?t.ACTIVITY_HISTORY.call_message_missed():"incoming"===e.direction?t.ACTIVITY_HISTORY.call_message_incoming_text():t.ACTIVITY_HISTORY.call_message_outgoing_text();return"".concat(r,"\n\n")+"".concat((0,y.formatDate)(e.timestamp,"LT"),", ").concat(e.duration,"\n\n")}return"msg"in e&&"string"==typeof e.msg?Cr(e.msg):void 0}(a,e);if(!P)return;return{date:(0,rt.formatDate)(O,{full:!0}),name:A,text:P}}return null}();return o?"[".concat(o.date,"] ").concat(o.name,"\n\n").concat(o.text,"\n\n"):""}),[n,t,null==l?void 0:l.chatParties,null==l?void 0:l.parties,u.firstName,u.lastName,e,r])}function Qr(e,t,n,r,a,o,i){try{var s=e[o](i),l=s.value}catch(c){return void n(c)}s.done?t(l):Promise.resolve(l).then(r,a)}function Zr(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){Qr(o,r,a,i,s,"next",e)}function s(e){Qr(o,r,a,i,s,"throw",e)}i(void 0)}))}}function Jr(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ea(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Jr(e,t,n[t])}))}return e}function ta(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(s){o=[6,s],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function na(e){var t=function(e){return(null==e?void 0:e.commonAncestorContainer.nodeType)===Node.ELEMENT_NODE?null==e?void 0:e.commonAncestorContainer:null==e?void 0:e.commonAncestorContainer.parentElement}(e);return ra(t)}function ra(e){var t,n=null==e?void 0:e.closest(va()),r=null==n?void 0:n.getAttribute("data-message-id"),a=null!==(t=null==n?void 0:n.getAttribute("data-global-interaction-id"))&&void 0!==t?t:void 0;return"current"===a&&(a=void 0),r?{messageId:r,globalInteractionId:a}:void 0}function aa(e){if(e){var t=e.extractContents(),n=ia(t);y.Mask.obscureHTML(n),t=document.createDocumentFragment(),Array.from(n.childNodes).forEach((function(e){t.appendChild(e)})),e.insertNode(t)}}function oa(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=ea({},t);if(e){sa(e);var r=e.extractContents(),a=ia(r),o=ua(a,n),i=(0,En.uuid)();o.classList.add("bp-masked"),o.id=i;var s=o.innerHTML;return y.Mask.obscureHTML(o),n[i]={originalText:s,maskedText:o.innerHTML},e.insertNode(o),n}}function ia(e){var t=document.createElement("span");return e.childNodes.forEach((function(e){var n=e.cloneNode(!0);t.append(n)})),t}function sa(e){var t=e.startContainer.parentElement;(la(t)||ca(t))&&(e.setStartBefore(e.startContainer),e.setStartBefore(e.startContainer));var n=e.endContainer.parentElement;(la(n)||ca(n))&&(e.setEndAfter(e.endContainer),e.setEndAfter(e.endContainer))}function la(e){return null==e?void 0:e.classList.contains("bp-masked")}function ca(e){return"A"===(null==e?void 0:e.nodeName)}function ua(e,t){var n=e.cloneNode(!0);return function e(n){if(n.classList.contains("bp-masked")){var r=n.id,a=(0,y.stringToHTMLFragment)(t[r].originalText);return delete t[n.id],void n.replaceWith(a)}Array.from(n.children).forEach((function(t){e(t)}))}(n),n}function da(e,t){return e.messageId===t.messageId&&e.globalInteractionId===t.globalInteractionId}function fa(e){return{messageId:pr(e)?e:e.msgId,globalInteractionId:pr(e)||mr(e)||!ur(e)?void 0:e.globalInteractionId}}function ma(e){var t,n;return null!==(n=null===(t=pa(e))||void 0===t?void 0:t.innerHTML)&&void 0!==n?n:""}function pa(e){var t;return e.messageId?null===(t=document.querySelector(va(e)))||void 0===t?void 0:t.children[0]:void 0}function va(e){if(e){var t=e.messageId,n=e.globalInteractionId;return'[data-message-id="'.concat(t,'"][data-global-interaction-id="').concat(null!=n?n:"current",'"]')}return"[data-message-id][data-global-interaction-id]"}function ha(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ba(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ha(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ha(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var ya=o().memo((function(e){var t=e.interactionId,n=e.children,o=e.className,s=(0,c.useLocalizationState)().t,l=(0,i.useInteractionProp)(t,X.getInteractionStepId),u=Fr(),d=(0,y.useBoolean)(),f=d.value,m=d.toggle,p=(0,a.useRef)(null),v=ba((0,a.useState)(),2),h=v[0],b=v[1],g=ba((0,a.useState)(),2),I=g[0],S=g[1],O=ba((0,a.useState)(),2),x=O[0],C=O[1],_=(0,a.useRef)(null),w=(0,Yt.useInteractionChatStateMethods)().maskMessage,N=(0,Yt.useInteractionChatDataSelector)(l,(function(e){return null==e?void 0:e.masked})),A=Hr();(0,a.useEffect)((function(){var e=function(e){var t=e.target;if(t&&(0,se.isHTMLElement)(t)&&(_.current=t,t.classList.contains("bp-masked")&&t.id)){S(t.id);var n=ra(t);n&&C(n),b(t.getBoundingClientRect()),m()}},t=p.current;return null==t||t.addEventListener("click",e),function(){null==t||t.removeEventListener("click",e)}}),[m]);var P=(0,a.useCallback)((function(){var e=u.find((function(e){return x&&!mr(e)&&da(x,fa(e))}));if(I&&x&&!mr(e)&&!pr(e)){if(fr(e)){var t,n,r,a,o,i,s,c,d=(null==x?void 0:x.messageId)?null==N||null===(a=N.messages)||void 0===a||null===(r=a[x.messageId])||void 0===r||null===(n=r.textChunks)||void 0===n||null===(t=n[I])||void 0===t?void 0:t.originalText:void 0;if(!d)return void m(!1);var f,v=(0,y.stringToHTMLFragment)(d);null===(o=_.current)||void 0===o||o.replaceWith(v);var h=null!==(f=null===(c=p.current)||void 0===c||null===(s=c.querySelector('[data-message-id="'.concat(e.msgId,'"]')))||void 0===s||null===(i=s.children[0])||void 0===i?void 0:i.innerHTML)&&void 0!==f?f:"";if(!h)return void m(!1);w({itemId:l,messageId:x.messageId,maskedText:h})}m(!1)}}),[l,w,null==N?void 0:N.messages,u,m,I,x]),E=(0,a.useMemo)((function(){var e,t;return{position:"fixed",top:null!==(e=null==h?void 0:h.y)&&void 0!==e?e:0,left:null!==(t=null==h?void 0:h.x)&&void 0!==t?t:0}}),[h]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{ref:p,className:o,children:n}),(0,r.jsx)(L.Popup,{show:f,"data-testid":"selection-popup",placement:"top-start",contentClassName:"border-none bg-transparent shadow-none p-0","data-visible":f,onClickOutside:m,style:E,mountNode:A,content:(0,r.jsxs)($r,{onClick:P,"data-testid":"unmask-content-button",children:[(0,r.jsx)(j.IconUnmask,{}),s.EMAIL.button_unMaskSelectedText_text()]})})]})})),ga=function(e){var t=e.children,n=e.withMaskAction,o=e.interactionId,s=(0,wn.useContextSelector)(Lr,(function(e){return e.setHasSelection})),u=(0,i.useInteraction)(o);(0,l.assertDefined)(u);var d=function(e){var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=(0,c.useLocalizationState)().t,a=Fr(),o=Br(),i=(0,at.useSessionState)(),s=i.serverOrigin,u=i.loginId,d=i.sessionId,f=i.privileges,m=(0,st.useContactsStateMethods)().updateActivityHistoryMessageText,p=Xr(),v=(0,I.useNotificationsState)("methods").showNotification,h=(0,Yt.useInteractionChatStateMethods)().maskMessage,b=zr(),g=Ur(),S=(0,Yt.useInteractionChatDataSelector)((0,X.getInteractionStepId)(e),(function(e){return null==e?void 0:e.masked})),O=(0,it.useOpenInteractionSlidingModal)(),x=(0,vn.useIsCommunicator)(),C=(0,Gr.useMainPageUIState)("setKBFloatingState"),_=(0,Wr.useKbBridgeMethods)().setupInteractionKB;return function(i){var c=i.toggleShow,w=i.selectedText,N=i.selectionData,A=(null!=N?N:{}).range,P=na(A),E=a.find((function(e){return P&&da(P,fa(e))}));function D(){return(D=Zr((function(){return ta(this,(function(t){return c(!1),x?O(e.id,"knowledgeBase"):C((function(e){return"closed"===e?"floating":e})),_(w),[2]}))}))).apply(this,arguments)}return w?(0,r.jsxs)(r.Fragment,{children:[!(0,X.isAfterCallWork)(e)&&(0,r.jsxs)($r,{onClick:function(){return D.apply(this,arguments)},"data-testid":"search-kb-button",children:[(0,r.jsx)(j.IconKnowledgeBase,{className:"size-4"}),n.GLOBAL.search()]}),!(!t||pr(E)||!f.CAN_MASK_INTERACTION_CONTENT||mr(E)||"message"!==_r(E))&&(0,r.jsxs)($r,{onClick:function(){if(!mr(E)&&!pr(E)){if(ur(E)){var t=ma(fa(E));aa(A);var r=ma(fa(E));(0,Pr.maskActivityHistoryMessages)({loginId:u,sessionId:d,serverOrigin:s,globalInteractionId:E.globalInteractionId,messages:[{messageId:E.msgId,maskedText:r}]}).then((function(){var t=(0,X.getContactId)(e);t&&m({contactId:t,messageId:E.msgId,messageText:r})})).catch((function(e){v({type:"error",id:I.Notifications.ChatMessageMaskError,tags:["current-view"],message:n.EXTERNAL_CHAT.masking_failed_error_message(),duration:5e3}),un.bpLogger.error((0,y.getErrorMessage)(e));var r=pa(fa(E));r&&(r.innerHTML=t)}))}else if(fr(E)&&E.msgId){var a,o,i=null==S||null===(o=S.messages)||void 0===o||null===(a=o[E.msgId])||void 0===a?void 0:a.textChunks,l=oa(A,i),f=ma(fa(E));h({itemId:(0,X.getInteractionStepId)(e),messageId:E.msgId,maskedText:f,textChunks:l})}c(!1)}},"data-testid":"mask-content-button",children:[(0,r.jsx)(j.IconMask,{}),n.EXTERNAL_CHAT.mask()]}),(0,r.jsxs)($r,{onClick:function(){c(!1);var e="",t="";o.length>1?t=e=o.reduce((function(e,t){return e+p(t)}),""):((0,l.assertDefined)(o[0]),e=w,t=p(o[0])),console.info("\u{1f4cb} Clipboard text\n",e),b(t),navigator.clipboard.writeText(e)},"data-testid":"copy",children:[(0,r.jsx)(j.IconCopy,{}),n.GLOBAL.copy()]}),!!g().length&&(0,r.jsxs)($r,{onClick:function(){c(!1);var e="";o.length>1?e=o.reduce((function(e,t){return e+p(t)}),""):((0,l.assertDefined)(o[0]),e=p(o[0]));var t=g()+e;console.info("\u{1f4cb} Clipboard text\n",t),navigator.clipboard.writeText(t),b(t)},"data-testid":"add-to-copy",children:[(0,r.jsx)(j.IconAddToCopy,{}),n.GLOBAL.add_to_copy()]})]}):null}}(u,n),f=(0,a.useCallback)((function(e){var t;s(!!(null==e||null===(t=e.range)||void 0===t?void 0:t.toString()))}),[s]),m=Hr();return(0,r.jsx)(L.WithSelectionPopup,{getPopupContent:d,onSelectionChange:f,mountNode:m,popupContentClassName:"border-none bg-transparent shadow-none flex gap-1",children:n?(0,r.jsx)(ya,{interactionId:o,children:t}):t})},ja=function(e){var t=e.children,n=e.withMaskAction,a=e.messages,o=e.interactionId,i=e.scrollContainer;return(0,r.jsx)(Rr,{messages:a,interactionId:o,scrollContainer:i,children:(0,r.jsx)(ga,{withMaskAction:n,interactionId:o,children:t})})};var Ia=function(e){var t=e.fileIsMasked,n=e.canMask,o=e.interactionStepId,i=e.globalInteractionId,s=e.fileId,l=e.contactId,u=e.children,d=(0,c.useLocalizationState)().t,f=function(e){var t=e.globalInteractionId,n=e.interactionStepId,r=e.itemContactId,o=e.isActiveChat,i=e.fileId,s=(0,at.useSessionState)(),l=s.loginId,u=s.sessionId,d=s.serverOrigin,f=(0,st.useContactsStateMethods)().maskFile,m=(0,c.useLocalizationState)("t").ERROR_MESSAGES,p=(0,Yt.useInteractionChatStateMethods)().toggleFileMask,v=(0,I.useNotificationsState)("methods").showNotification;return(0,a.useCallback)((function(){o&&!t?p({itemId:n,fileId:i}):t&&(0,Pr.maskActivityHistoryMessages)({loginId:l,sessionId:u,serverOrigin:d,globalInteractionId:t,fileIds:[i]}).then((function(){r&&f({fileId:i,contactId:r})})).catch((function(e){v({type:"error",id:I.Notifications.ChatFileMaskError,tags:["current-view"],message:m.activity_history_file_masking_error(),duration:5e3}),un.bpLogger.error((0,y.getErrorMessage)(e))}))}),[m,r,i,t,n,o,l,f,d,u,v,p])}({interactionStepId:o,itemContactId:l,globalInteractionId:i,fileId:s,isActiveChat:(0,Yt.useActiveChatChecker)(o)});return(0,r.jsxs)("div",{className:"group relative",children:[t&&(0,r.jsx)(j.IconMask,{className:"absolute left-1/2 top-1/2 z-[1] size-6 -translate-x-1/2 -translate-y-1/2"}),n&&(0,r.jsxs)($r,{onClick:f,className:"absolute right-2 top-2 z-[1] opacity-0 transition-opacity group-hover:opacity-100",children:[t?(0,r.jsx)(j.IconUnmask,{}):(0,r.jsx)(j.IconMask,{}),(0,r.jsx)("p",{children:t?d.EXTERNAL_CHAT.unmask():d.EXTERNAL_CHAT.mask()})]}),(0,r.jsx)("div",{className:M("border border-transparent",{"overflow-hidden rounded-xs border-[rgba(0,0,0,0.1)]":t}),children:(0,r.jsx)("div",{className:M({"pointer-events-none blur-[6px] state-layer-bg-white state-layer-mix-dark-on-white-1":t}),children:u})})]})},Sa=n(7914);function Oa(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function xa(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Oa(e,t,n[t])}))}return e}function Ca(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function _a(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var wa=function(e){var t=e.children,n=e.messageId,o=_a(e,["children","messageId"]),i=Xr(),s=(0,wn.useContextSelector)(Lr,(function(e){return e.hasSelection})),l=Fr(),u=Ur(),d=zr(),f=Hr(),m=(0,a.useMemo)((function(){return l.find((function(e){return gr(e)===n}))}),[n,l]),p=(0,c.useLocalizationState)("t"),v=(0,y.useBoolean)(),h=(0,a.useCallback)((function(){if(m){var e=i(m);console.info("\u{1f4cb} Clipboard text\n",e),navigator.clipboard.writeText(e),d(e),v.setFalse()}}),[i,m,v,d]),b=(0,a.useCallback)((function(){if(m){var e=i(m),t=u()+e;navigator.clipboard.writeText(t),d(t),console.info("\u{1f4cb} Clipboard text\n",t),v.setFalse()}}),[u,i,m,v,d]);return(0,r.jsxs)(Sa.Root,{open:!s&&v.value,onOpenChange:v.toggle,children:[(0,r.jsx)(Sa.Trigger,{asChild:!0,children:(0,r.jsx)("div",Ca(xa({},o),{children:t}))}),(0,r.jsx)(Sa.Portal,{container:f,children:(0,r.jsxs)(Sa.Content,{collisionBoundary:f,side:"top",align:"end",className:"z-10 flex gap-1",hideWhenDetached:!0,children:[(0,r.jsxs)($r,{onClick:h,children:[(0,r.jsx)(j.IconCopy,{}),p.GLOBAL.copy()]}),(0,r.jsxs)($r,{onClick:b,children:[(0,r.jsx)(j.IconAddToCopy,{}),p.GLOBAL.add_to_copy()]})]})})]})},Na=n(5977);function Aa(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Pa(e){return function(e){if(Array.isArray(e))return Aa(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Aa(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Aa(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ea(e){var t=(0,a.useMemo)((function(){return function(e){return(0,Na.createSelector)((function(t){return t.items.find((function(t){return t.id===e}))}),(function(e){return e.items}),(function(e,t){var n=(0,X.getAssociatedItems)({item:e,items:t});return(0,l.truthy)(Pa(n).concat([e])).flatMap((function(e){var t;return null!==(t=null==e?void 0:e.botSuggestions)&&void 0!==t?t:[]}))}))}(e)}),[e]);return(0,i.useInteractionStateSelector)(t)}function Da(e){var t=(0,a.useMemo)((function(){return function(e){return(0,Na.createSelector)((function(t){return t.items.find((function(t){return t.id===e}))}),(function(e){return e.items}),(function(e,t){var n=(0,X.getAssociatedItems)({item:e,items:t});return(0,l.truthy)(Pa(n).concat([e])).reduce((function(e,t){var n;if((0,X.isCall)(t))e.voice=null!==(n=null==t?void 0:t.botSuggestions)&&void 0!==n?n:[];else if((0,X.isChat)(t)){var r;e.chat=null!==(r=null==t?void 0:t.botSuggestions)&&void 0!==r?r:[]}return e}),{voice:[],chat:[]})}))}(e)}),[e]);return(0,i.useInteractionStateSelector)(t)}var Ta=n(7005),ka=(0,Ta.atom)(""),Ma=(0,Ta.atom)(-1),La=(0,Ta.atom)(void 0),Ra=(0,Ta.atom)(null);function Fa(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ba(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Ua(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var za=function(e){var t=function(){a(),null==o||o()},n=e.rejection,a=e.onClose,o=e.onCloseCallback,i=e.totalFilesAmount,s=Ua(e,["rejection","onClose","onCloseCallback","totalFilesAmount"]),l=(0,Ta.useAtomValue)(Ra),u=(0,c.useLocalizationState)("t"),d=(0,$.uniq)(n.flatMap((function(e){return e.errors.map((function(e){return e.message}))})));return(0,r.jsxs)(j.Modal,Ba(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Fa(e,t,n[t])}))}return e}({},s),{onClose:t,children:[(0,r.jsx)(j.Modal.Header,{type:"error",children:u.CHAT_CENTER.upload_failed()}),(0,r.jsxs)(j.Modal.Content,{children:[(0,r.jsx)(j.InlineAlert,{variant:"error",children:(0,r.jsx)("ul",{className:"m-0 p-0",children:d.map((function(e,t){return(0,r.jsx)("li",{children:e},t)}))})}),(0,r.jsx)("p",{className:"my-6",children:u.CHAT_CENTER.failed_to_upload(n.length,i)}),(0,r.jsx)("div",{className:"flex flex-col gap-2",children:n.map((function(e,t){return"attachment"===(0,rt.mimeTypeToExternalChatFileType)(e.file.type)?(0,r.jsx)(j.Attachment.File,{name:e.file.name,className:"pointer-events-none",isFailed:!0},t):(0,r.jsx)(j.Attachment.Image,{name:e.file.name,className:"pointer-events-none",isFailed:!0},t)}))})]}),(0,r.jsxs)(j.Modal.Actions,{children:[(0,r.jsx)(_e.Button,{variant:"secondary",onClick:function(){null==l||l.click(),t()},children:u.CHAT_CENTER.select_files()}),(0,r.jsx)(_e.Button,{variant:"primary",onClick:function(){return t()},children:u.WINDOW_POPUP_TITLES_AND_MESSAGES.window_buttonOk()})]})]}))},Ha=n(2977);function Va(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ga(e){return function(e){if(Array.isArray(e))return Va(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Va(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Va(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Wa(e){var t=e.chatItem,n=(0,I.useNotificationsState)("methods"),r=n.showNotification,a=n.hideNotificationsByTag,o=(0,st.useContactsState)("contacts"),s=tr(),l=s.getSelectedChannel,c=s.getSelectedPhone,u=l(t.id),d=c(t.id),f=(0,X.getMessengers)(o,t),m=(null==d?void 0:d.phone)||(0,X.getPhoneFromItem)(t),p=(0,Ha.useErrorValidation)(),v=(0,xn.useServiceState)().selectedService,h=(0,On.useDIDNumberState)().selectedDIDNumber,b=(0,X.getContactId)(t),g=(0,X.getServiceId)(t),j=(0,i.useInteractionStateMethods)().initiateChat,S=g||v,O=(0,Bt.useServicesDispositionsState)().services,x=(0,X.getAssociatedChatServiceId)(O,v);return(0,y.useEvent)((function(){var e,n=(null==f||null===(e=f.find((function(e){return e.type===(null==u?void 0:u.value)})))||void 0===e?void 0:e.userId)||m;if(!n)return!1;var o=Ga(p.getServiceAndDIDNumbersErrors({service:S,didNumber:h,interactionType:"sms"})).concat(Ga(p.getChannelError({selectedChannel:null==u?void 0:u.value})));return o.length?(r(o[0]),!1):(a("interaction-init"),j({channel:null==u?void 0:u.value,address:n,displayData:null==t?void 0:t.displayData,serviceId:x,accessNumberId:h,contactId:b,origination:"interaction"}),!0)}))}const qa={dropzone:"communicator_Dropzone_dropzone_NnIGW",dropzoneDisabled:"communicator_Dropzone_dropzoneDisabled_Z62xX",dropzoneTitle:"communicator_Dropzone_dropzoneTitle_GjrhI",dropzoneSubtitle:"communicator_Dropzone_dropzoneSubtitle_3av8B"};function Ya(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ka(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Ya(e,t,n[t])}))}return e}function $a(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}var Xa=function(e){var t=e.itemId,n=(0,c.useLocalizationState)().t,o=function(){var e=(0,y.useBoolean)(),t=e.value,n=e.toggle,r=(0,a.useRef)(0);return(0,a.useEffect)((function(){var e=function(){r.current++,n(!0)},t=function(){r.current--,0===r.current&&n(!1)};return document.addEventListener("dragenter",e),document.addEventListener("dragleave",t),document.addEventListener("drop",t),function(){document.removeEventListener("dragenter",e),document.removeEventListener("dragleave",t),document.removeEventListener("drop",t)}}),[n]),t}(),s=function(e){var t=Vn("addAttachment"),n=(0,i.useInteraction)(e),r=(0,i.useInteractions)();(0,y.useAsRef)(r).current=r,(0,l.assertDefined)(n);var o=Wa({chatItem:n}),s=(0,X.isPotentialInteraction)(n)||(0,X.isCall)(n);return(0,a.useCallback)((function(e){var r;e.length&&n&&(s&&o(),r=(0,X.getInteractionStepId)(n),e.forEach((function(e){return t(r,e)})))}),[n,s,o,t])}(t),u=(0,sr.useDropzone)({onDrop:s,validator:(0,$.partial)(Ir,n)}),d=u.getRootProps,f=u.getInputProps,m=u.fileRejections,p=u.acceptedFiles,v=(0,ie.useModalComponentOpener)(za),h=(0,y.useAsRef)(p.length);return(0,a.useEffect)((function(){m.length&&v({rejection:m,totalFilesAmount:h.current+m.length})}),[h,m,v]),(0,r.jsxs)("div",$a(Ka({},d()),{className:o?qa.dropzone:qa.dropzoneDisabled,"data-testid":"attachments-dropzone","data-visible":o,children:[(0,r.jsx)("input",Ka({},f())),(0,r.jsxs)("div",{className:qa.dropzoneContent,children:[(0,r.jsx)("p",{className:qa.dropzoneTitle,children:n.GLOBAL.drop_files_here()}),(0,r.jsx)("p",{className:qa.dropzoneSubtitle,children:n.GLOBAL.drag_and_drop_subtitle()})]})]}))};function Qa(e){var t,n=(0,i.useInteractionProp)(e,X.getInteractionStepId),r=(0,Yt.useInteractionChatData)(n),a=null==r||null===(t=r.messages)||void 0===t?void 0:t.find((function(e){return("customer"===e.source||"agent"===e.source)&&!e.isRead}));return a?gr(a):null}function Za(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ja(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Za(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Za(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var eo=function(e){var t=e.itemId,n=e.scrollNode,o=(0,c.useLocalizationState)().t,s=Ja((0,a.useState)(!0),2),l=s[0],u=s[1],f=Ja((0,a.useState)(!1),2),m=f[0],p=f[1],v=(0,x.useInteractionUIChatScrollerApi)(t),h=Qa(t),b=(0,i.useInteractionProp)(t,X.getInteractionStepId),y=(0,Yt.useInteractionChatStateConnector)();(0,a.useEffect)((function(){var e=null==y?void 0:y.dispenser.subscribe({onNewMessage:function(e){e.item_id===b&&u(!1)}});return function(){null==e||e.unsubscribe()}}),[null==y?void 0:y.dispenser,b]),(0,a.useEffect)((function(){var e=(0,$.throttle)((function(){p(yr(n))}),500);return null==n||n.addEventListener("scroll",e),function(){null==n||n.removeEventListener("scroll",e)}}),[n]);var g=(0,a.useCallback)((function(){h&&(u(!0),null==v||v.scrollTo(h,"end"))}),[h,v]);return!h||l||m?null:(0,r.jsxs)(L.Button,{enabledInOffline:!0,transparent:!0,onClick:g,className:"absolute bottom-4 left-4 z-10 h-8 items-center   rounded border border-solid border-primary-legacy bg-white px-6 text-primary-legacy   hover:border-primary-hover hover:text-primary-hover   active:border-primary-active active:text-primary-active",children:[o.CHAT_CENTER.unread_messages_button_text(),(0,r.jsx)(d.SmIcon,{name:"caret down",className:"leading-[16px]"})]})};function to(){return(0,a.useCallback)((function(e,t,n){return e.reduce((function(e,a,o,i){var s,l;return 0===o?r(e,a):n&&!n(a)||(s=new Date(t(i[o-1])),l=new Date(t(a)),(0,y.areSameDays)(s,l))||r(e,a),e.push(a),e}),[]);function r(e,n){var r=(0,rt.formatChatDate)(t(n));e.push(r)}}),[])}var no=n(1510);function ro(e,t){var n=function(e){var t=(0,no.useActivitiesState)("activitiesListByContactId"),n=(0,no.useActivitiesStateMethods)().getActivitiesList,r=(0,at.useSessionState)().userId,o=t[e];return(0,a.useEffect)((function(){e&&!o&&n({id:e})}),[o,n,e]),(0,a.useMemo)((function(){var e,t;return null!==(t=null==o||null===(e=o.data)||void 0===e?void 0:e.flatMap(Or(r)))&&void 0!==t?t:[]}),[o,r])}(e);return(0,a.useMemo)((function(){var e=t;return t||(e=(new Date).getTime()),t?n.filter((function(t){return e&&t.timestamp&&t.timestamp>=e})):[]}),[t,n])}function ao(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function oo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){ao(e,t,n[t])}))}return e}function io(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function so(e){var t=(0,i.useInteraction)(e),n=tr().channelOptions,r=(0,c.useLocalizationState)().t,o=(0,Yt.useInteractionChatData)((0,X.getInteractionStepId)(t)),s=null==o?void 0:o.masked,l=(0,a.useMemo)((function(){return(0,X.isExternalChat)(t)&&(null==o?void 0:o.messages)||[]}),[t,o]),u=(0,a.useCallback)((function(e){var n=(0,X.getChatParties)(t),r=null==n?void 0:n.find((function(t){return t.party_id===e.partyId})),a=e.userId||r&&r.user_id;return io(oo({},e),{userId:a})}),[t]),d=(0,a.useCallback)((function(e){var t,n=e.msgId?null==s||null===(t=s.messages)||void 0===t?void 0:t[e.msgId]:void 0,r=e.fileId?null==s?void 0:s.files.includes(e.fileId):void 0;if(n||r){var a=oo({},e);return a.maskedText=null==n?void 0:n.maskedText,a.fileIsMasked=r,a}return e}),[s]),f=(0,a.useCallback)((function(e){if(e.eventType=e.msg,e.needLocalization&&e.msg){var t=[],a=e.partyName||"unknown party";if("external_chat_party_joined_new"===e.msg||"external_chat_party_left_new"===e.msg)return io(oo({},e),{msg:r.EXTERNAL_CHAT[e.msg]()});if("external_chat_party_joined"!==e.msg&&"external_chat_party_left"!==e.msg||(t=[a]),"external_chat_party_joined_new"===e.msg&&"whisper"===e.qmMode)return io(oo({},e),{msg:r.EXTERNAL_CHAT.external_chat_party_coaching(a)});if("message_connection_accepted"===e.msg)if("sms"===e.channel)t=[r.GLOBAL.chat_type_sms()];else{var o=n.find((function(t){return t.value===e.channel}));t=o?[null==o?void 0:o.text]:[]}if(e.msg in r.EXTERNAL_CHAT){var i=e.msg;return io(oo({},e),{msg:r.EXTERNAL_CHAT[i](t[0],t[1],t[2])})}}return e}),[n,r]),m=(0,a.useCallback)((function(e){return function(t){return e.some((function(e){return e===t.displayType}))}}),[]);return(0,a.useMemo)((function(){return{messagesList:l,addUserId:u,localizeSystemMessage:f,msgHasDisplayTypes:m,maskMessage:d}}),[l,u,f,m,d])}function lo(e){var t=so(e),n=t.messagesList,r=t.addUserId,o=t.localizeSystemMessage,i=t.maskMessage;return(0,a.useMemo)((function(){return{normalizedChatMessages:n.reduce((function(e,t){var n=(0,$.flow)(r,o,i)(t);return e.push(n),e}),[])}}),[r,o,i,n])}var co=function(e){var t,n,o,i=e.message,s=(t=i,n=(0,st.useContactsState)("contacts"),o=(0,gt.useFormatting)().formatFullName,(0,a.useMemo)((function(){var e;if("suggestion"!==t.type){var r=t.contactId&&(null===(e=n[t.contactId])||void 0===e?void 0:e.data),a=r&&o(r.firstName,r.lastName),i=o(t.firstName,t.lastName);return r?a:i}}),[n,o,t.contactId,t.firstName,t.lastName,t.type])),l=(0,te.useChatMessageSanitizer)({message:i.msg}),c=(0,y.useInnerHTML)(l);return(0,r.jsxs)("section",{className:"flex w-full gap-2.5","data-testid":"transcript-message",children:[(0,r.jsx)("div",{className:"shrink-0 caption-s text-neutral-fade","data-testid":"transcript-message-time",children:(0,y.formatDate)(i.endTimestamp,"h:mm A")}),(0,r.jsxs)("div",{className:"flex flex-col",children:[s&&(0,r.jsx)("div",{className:"break-all caption-s text-neutral-fade","data-testid":"transcript-message-name",children:s}),(0,r.jsx)("div",{className:"break-words body","data-testid":"transcript-message-text",dangerouslySetInnerHTML:c})]})]})},uo=o().memo((function(e){var t=e.contentVoiceTranscript,n=e.isOpenModal,o=void 0!==n&&n,i=(0,c.useLocalizationState)().t,s=(0,y.useBoolean)(),l=s.value,u=s.toggle,d=function(e){var t=e.isOpenModal,n=e.contentVoiceTranscript,o=e.handleCloseView,i=(0,c.useLocalizationState)().t,s=(0,it.useOpenGlobalSlidingModal)(),l=(0,it.useCloseGlobalSlidingModal)(),u="icon-default size-4",d=(0,a.useCallback)((function(){s("voiceTranscript",{contentVoiceTranscript:n})}),[s,n]),f=(0,a.useCallback)((function(){l("voiceTranscript")}),[l]);return[{optionName:t?i.ACTIVITY_HISTORY.close_transcript_option():i.ACTIVITY_HISTORY.view_transcript_option(),onClick:t?f:d,renderIcon:function(){return(0,r.jsx)(j.IconViewTranscript,{className:u})}},{optionName:i.ACTIVITY_HISTORY.download_transcript_option(),onClick:o,renderIcon:function(){return(0,r.jsx)(j.IconDownloadTranscript,{className:u})}}]}({isOpenModal:o,contentVoiceTranscript:t,handleCloseView:s.setFalse});return(0,r.jsx)(j.TriggerDropdown,{modal:!1,open:l,onClick:y.stopPropagation,onFocus:y.stopPropagation,onOpenChange:u,className:"rounded-xs",align:"end",side:"bottom",options:d.map((function(e,t){var n=e.renderIcon,a=e.optionName,o=e.onClick;return(0,r.jsxs)("button",{className:"flex items-center gap-2",onClick:o,children:[n(),(0,r.jsx)("div",{className:"min-w-[140px] caption-s text-primary-on-primary",children:a})]},t)})),children:(0,r.jsx)(j.ButtonIcon,{tooltip:l?i.ACTIVITY_HISTORY.call_message_collapse_voice_transcript():i.ACTIVITY_HISTORY.call_message_expand_voice_transcript(),"data-testid":"voice-transcript-button",className:"rounded-xs",children:(0,r.jsx)(j.IconTranscriptOptions,{className:"size-4"})})})})),fo=o().memo((function(e){var t=e.isOpenModal,n=e.hasVoiceTranscript,o=e.isMissedCall,i=e.duration,s=e.title,l=e.recordingLink,u=e.sentiment,d=e.createdTime,f=e.ariaLabel,m=e.containerClassName,p=e.audioPlayerClassName,v=(0,c.useLocalizationState)().t,h=function(e){var t=e.direction,n=e.duration,o=e.timestamp,i=e.hasVoiceRecording,s=e.recordingLink,l=e.isMissedCall,c=e.voiceTranscript,u=e.createdTime,d=e.ariaLabel,f=e.title;return(0,a.useMemo)((function(){return(0,r.jsxs)("div",{children:[s&&(0,r.jsx)(fo,{isOpenModal:!0,audioPlayerClassName:"bg-transparent shadow-none",containerClassName:"bg-primary-container-variant1 rounded-xs px-3 py-2",hasVoiceRecording:i,recordingLink:s,voiceTranscript:c,timestamp:o,duration:n,isMissedCall:l,title:f,createdTime:u,hasVoiceTranscript:!!(null==c?void 0:c.length),ariaLabel:d,direction:t}),(0,r.jsx)("div",{className:"scrollbar-general mt-4 flex select-none flex-col gap-4 overflow-y-auto","data-testid":"voice-transcript-messages",children:c&&c.map((function(e){return(0,r.jsx)(co,{message:e},gr(e))}))})]})}),[d,u,t,n,i,l,s,o,f,c])}(e),b=(0,a.useCallback)((function(){return(0,r.jsx)(r.Fragment,{children:n&&(0,r.jsx)(uo,{isOpenModal:t,contentVoiceTranscript:h})})}),[h,n,t]);return(0,r.jsxs)("div",{className:M("flex flex-col gap-1",m),"data-testid":"call-content","data-missed":o,children:[(0,r.jsxs)("div",{className:"flex items-center justify-between gap-2","aria-label":f,children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[o?(0,r.jsx)(j.IconMissedCall16,{className:"size-4","aria-hidden":!0}):(0,r.jsx)(j.IconInteractionCall,{className:"size-4 icon-default","aria-hidden":!0}),(0,r.jsx)("span",{className:"caption-s text-primary-on-primary","aria-hidden":!0,"data-testid":"call-title",children:s})]}),!!i&&(0,r.jsxs)("span",{children:[(0,r.jsx)("span",{className:"aria-description",children:v.ACTIVITY_HISTORY.call_message_duration_aria()}),(0,r.jsxs)("div",{className:"flex items-center gap-2 caption-s text-neutral-fade",children:[(0,r.jsx)("span",{"aria-hidden":!0,className:"flex size-0.5 items-center rounded-full bg-neutral-500"}),(0,r.jsx)("span",{"data-testid":"call-duration",children:i})]})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[u&&(0,r.jsx)(L.Sentiment,{sentiment:u,className:"mr-1 w-5"}),(0,r.jsxs)("span",{children:[(0,r.jsx)("span",{className:"aria-description",children:v.ACTIVITY_HISTORY.call_message_created_time_aria()}),(0,r.jsx)("span",{"data-testid":"call-start-time",className:"caption-s text-neutral-fade",children:d})]})]})]}),(0,r.jsx)("div",{className:"flex select-none flex-nowrap",children:(0,r.jsx)(L.AudioPlayer,{isNewAudioPlayerUI:!0,src:l,skipUnmount:!0,playerGroupTag:nr.CHAT_VOICE_RECORDING_PLAYER_GROUP,pauseGroupWhenPlaying:!0,renderOptionalNode:b,className:p})})]})})),mo=o().memo((function(e){var t=e.isMissedCall,n=e.duration,a=e.title,o=e.sentiment,i=e.ariaLabel,s=e.createdTime,l=(0,c.useLocalizationState)().t;return(0,r.jsxs)("div",{className:"flex items-center justify-between gap-4","aria-label":i,children:[(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[t?(0,r.jsx)(j.IconMissedCall16,{className:"size-4","aria-hidden":!0}):(0,r.jsx)(j.IconInteractionCall,{className:"size-4 icon-default","aria-hidden":!0}),(0,r.jsxs)("div",{className:M("flex items-center gap-1 caption-s text-neutral-on-secondary",{"text-on-error":t}),children:[(0,r.jsx)("span",{"aria-hidden":!0,"data-testid":"call-title",children:a}),!!n&&(0,r.jsx)("span",{"data-testid":"call-duration",children:"(".concat(n,")")})]})]}),(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[o&&(0,r.jsx)(L.Sentiment,{sentiment:o,className:"mr-1 w-5"}),(0,r.jsxs)("span",{className:"flex items-center",children:[(0,r.jsx)("span",{className:"aria-description",children:l.ACTIVITY_HISTORY.call_message_created_time_aria()}),(0,r.jsx)("span",{"data-testid":"call-start-time",className:"caption-s text-neutral-fade",children:s})]})]})]})}));function po(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function vo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){po(e,t,n[t])}))}return e}function ho(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var bo=function(e){var t=e.direction,n=e.duration,a=e.timestamp,o=e.hasVoiceRecording,i=e.recordingLink,s=e.isMissedCall,l=e.voiceTranscript,u=ho(e,["direction","duration","timestamp","hasVoiceRecording","recordingLink","isMissedCall","voiceTranscript"]),d=(0,c.useLocalizationState)().t,f=!!(null==l?void 0:l.length),m=(0,y.formatDate)(a,"LT"),p=["incoming"===t?d.ACTIVITY_HISTORY.call_message_incoming_aria_label():d.ACTIVITY_HISTORY.call_message_outgoing_aria_label(),d.ACTIVITY_HISTORY.call_message_created_time_aria()+m,d.ACTIVITY_HISTORY.call_message_duration_aria()+n].join("; "),v=s?d.ACTIVITY_HISTORY.call_message_missed():"incoming"===t?d.ACTIVITY_HISTORY.call_message_incoming_text():d.ACTIVITY_HISTORY.call_message_outgoing_text();return o&&i?(0,r.jsx)(fo,vo({hasVoiceRecording:o,recordingLink:i,voiceTranscript:l,timestamp:a,duration:n,isMissedCall:s,title:v,createdTime:m,hasVoiceTranscript:f,ariaLabel:p,direction:t},u)):(0,r.jsx)(mo,vo({timestamp:a,duration:n,isMissedCall:s,title:v,createdTime:m,ariaLabel:p,direction:t},u))},yo=n(5770),go=function(e){var t=e.caseId,n=e.caseNumber,o=e.caseTitle,i=(0,yo.useNavigationState)("setActivePage"),s=(0,a.useCallback)((function(e){e.preventDefault(),i({name:yo.AppRoutes.Cases,params:{id:t}})}),[i,t]);return(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{children:(0,r.jsx)(d.SmIcon,{name:"envelope",color:"grey"})}),(0,r.jsxs)("div",{children:[(0,r.jsx)("a",{href:"#",onClick:s,children:"#".concat(n)})," ",(0,r.jsx)("span",{children:o})]})]})};const jo="communicator_RemoteAssistMessage_remoteAssistMessage_GuCjK",Io="communicator_RemoteAssistMessage_remoteAssistMessageHeader_1NdA1",So="communicator_RemoteAssistMessage_remoteAssistMessageIcon_wYT2a",Oo="communicator_RemoteAssistMessage_remoteAssistMessageContent_BkraK",xo="communicator_RemoteAssistMessage_remoteAssistContentRow_gezxx";var Co=function(e){var t=e.duration,n=e.privateIp,a=e.publicIp,o=e.osVersion,i=(0,c.useLocalizationState)().t,s=(0,y.getMomentUTC)(1e3*t,"m:s"),l=n||i.ACTIVITY_HISTORY.remote_assist_empty_private_ip_display_value(),u=a||i.ACTIVITY_HISTORY.remote_assist_empty_public_ip_display_value(),d=o||i.ACTIVITY_HISTORY.remote_assist_empty_os_version_display_value();return(0,r.jsxs)("div",{className:jo,children:[(0,r.jsxs)("div",{className:Io,children:[(0,r.jsx)(ve.IconRemoteAssistSession,{className:So,"aria-hidden":!0}),(0,r.jsx)("span",{children:i.ACTIVITY_HISTORY.remote_assist_title()})]}),(0,r.jsxs)("div",{className:Oo,children:[(0,r.jsxs)("div",{className:xo,children:[(0,r.jsx)("span",{children:i.ACTIVITY_HISTORY.remote_assist_duration_label()}),(0,r.jsx)("span",{children:s})]}),(0,r.jsxs)("div",{className:xo,children:[(0,r.jsx)("span",{children:i.ACTIVITY_HISTORY.remote_assist_os_version_label()}),(0,r.jsx)("span",{children:d})]}),(0,r.jsxs)("div",{className:xo,children:[(0,r.jsx)("span",{children:i.ACTIVITY_HISTORY.remote_assist_private_ip_label()}),(0,r.jsx)("span",{children:l})]}),(0,r.jsxs)("div",{className:xo,children:[(0,r.jsx)("span",{children:i.ACTIVITY_HISTORY.remote_assist_public_ip_label()}),(0,r.jsx)("span",{children:u})]})]})]})};function _o(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function wo(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){_o(e,t,n[t])}))}return e}function No(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Ao(e){var t=e.selfUserId;return function(e,n){var a=n.userId===t;return(0,lt.isCall)(n)&&e.push(function(e,t){var n,a,o="INBOUND"===e.direction?"incoming":"outgoing",i=(0,rt.formatCallDuration)(e.counterpartDuration),s=null===(n=e.users)||void 0===n?void 0:n.find((function(e){return e.userId===t})),l=s&&e.users&&1===e.users.length,c=!!(null==s?void 0:s.partyFailureCause)&&"OTHER"!==(null==s?void 0:s.partyFailureCause),u=!!s&&(0===e.duration||c)&&"INBOUND"===e.direction,d=null===(a=e.transcript)||void 0===a?void 0:a.reduce((function(e,n){return(0,lt.isTranscriptMessage)(n)&&e.push(function(e,t){var n=(null==e?void 0:e.userId)===t;return No(wo({},(0,$.omit)(Eo(e,n),"channel")),{confidence:e.confidence,endTimestamp:e.endTimestamp,mediaType:"VOICE_TRANSCRIPT",sentiment:void 0!==e.sentimentScore?(0,rt.getSentimentFrom)(e.sentimentScore):void 0,type:void 0})}(n,t)),e}),[]);return{direction:o,users:e.users,timestamp:e.createdTime,mediaType:"VOICE",globalInteractionId:e.globalInteractionId,msg:(0,r.jsx)(bo,{direction:o,timestamp:e.createdTime,sentiment:e.sentiment,duration:i,isMissedCall:u,hasVoiceRecording:e.hasVoiceRecording,recordingLink:e.recordingLink,voiceTranscript:d}),msgId:"".concat(e.createdTime),isSelf:l,isMissedCall:u,hasVoiceRecording:e.hasVoiceRecording,duration:i,firstName:void 0,lastName:void 0}}(n,t)),(0,lt.isMessage)(n)&&e.push(Eo(n,a)),(0,lt.isFile)(n)&&e.push(function(e,t){return{globalInteractionId:e.globalInteractionId,direction:e.userId?"outgoing":"incoming",msgId:e.fileId||(0,En.uuid)(),displayType:"file",fileId:e.fileId,fileType:e.fileType,fileName:e.fileName,timestamp:e&&e.timestamp?Number(e.timestamp):Date.now(),mediaType:"CHAT",isSelf:t,msg:e.text,refMsgId:e.refMsgId,firstName:e.firstName,lastName:e.lastName}}(n,a)),(0,lt.isEmail)(n)&&e.push(function(e,t){var n="INBOUND"===e.direction?"incoming":"outgoing";return{msgId:e.caseId,direction:n,globalInteractionId:e.globalInteractionId,timestamp:e.createdTime,mediaType:"EMAIL",isSelf:t,firstName:e.firstName,lastName:e.lastName,msg:(0,r.jsx)(go,{caseId:e.caseId,caseNumber:e.caseNumber,caseTitle:e.caseTitle})}}(n,a)),(0,lt.isRemoteAssistSession)(n)&&e.push(function(e,t){var n,a,o,i=null===(n=e.users)||void 0===n?void 0:n.find((function(e){return!!t&&e.userId===t})),s=null===(o=e.users)||void 0===o||null===(a=o.toSorted((function(e,t){return t.startTime-e.startTime})))||void 0===a?void 0:a[0],l=i||s;return{mediaType:"REMOTE_ASSIST",direction:"outgoing",msgId:"".concat(e.createdTime),globalInteractionId:e.globalInteractionId,timestamp:e.createdTime,isSelf:!!t&&(null==l?void 0:l.userId)===t,firstName:null==l?void 0:l.firstName,lastName:null==l?void 0:l.lastName,userId:null==l?void 0:l.userId,msg:(0,r.jsx)(Co,{duration:e.counterpartDuration,privateIp:e.privateIp,publicIp:e.publicIp,osVersion:e.osVersion})}}(n,t)),e}}function Po(e){if(e)return function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t={},n=function(e){return void 0!==e};return e.forEach((function(e){var r=e.partyId,a={partyId:r,contactId:e.contactId,firstName:e.firstName,lastName:e.lastName,phone:e.phone,userId:e.userId};t[r]=wo({},t[r],(0,$.pickBy)(a,n))})),e.filter((function(e){var t=e.event;return!["party_changed","party_navigation"].includes(null!=t?t:"")})).map((function(e){return wo({},e,t[e.partyId])}))}(e).reduce((function(e,t){var n,r,a,o;t.type&&t.event&&e.push(No(wo({},t),{mediaType:"CHAT",nickName:"",createdTime:t.timestamp,phone:null!==(n=t.phone)&&void 0!==n?n:"",type:t.type,event:t.event,msg:null!==(r=t.msg)&&void 0!==r?r:"",channel:t.channel,firstName:null!==(a=t.firstName)&&void 0!==a?a:"",lastName:null!==(o=t.lastName)&&void 0!==o?o:""}));return e}),[])}function Eo(e,t){return{mediaType:"CHAT",msg:e.msg,msgId:e.msgId||String(e.timestamp),timestamp:e.timestamp,userId:e.userId,contactId:e.contactId,direction:"external"===e.type?"incoming":"outgoing",isSelf:t,globalInteractionId:e.globalInteractionId,firstName:e.firstName,lastName:e.lastName,channel:e.channel,displayType:"scenario"===e.type?"scenario":"message"}}function Do(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function To(e){return function(e){if(Array.isArray(e))return Do(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Do(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Do(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ko(e,t){var n=(0,st.useContactsState)("activityHistory"),r=(0,at.useSessionState)().userId,o=(0,no.useActivitiesState)("activities"),s=(0,i.useInteractionProp)(t,(function(e){return null==e?void 0:e.previousActivity})),l=s?o[s.globalInteractionId]:void 0;return(0,a.useMemo)((function(){var t,a=e?n[e]:void 0,o=null==a?void 0:a.messages,i=Po(null==l||null===(t=l.data)||void 0===t?void 0:t.reduce((function(e,t){var n;return(n=e).push.apply(n,To(t.messages)),e}),[]));return(o||i||[]).reduce(Ao({selfUserId:r}),[])}),[e,n,null==l?void 0:l.data,r])}function Mo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Lo(e){return function(e){if(Array.isArray(e))return Mo(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Mo(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Mo(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Ro=[];function Fo(e,t,n){return e.reduce(function(e,t){function n(e,n,r){return t&&!(t<=n.timestamp)||!vr(n)&&r&&!r(n)||e.push(n),e}function r(e,t){var n=e.length-1;return pr(e[n])?e.splice(n,1,t):e.push(t),e}return function(t,a){return pr(a)?r(t,a):"messages"===e?n(t,a,zo):"calls"===e?n(t,a,hr):n(t,a)}}(t,n),[])}function Bo(e){return e.timestamp}function Uo(e){return!("displayName"in(t=e)&&"itemId"in t&&"partyId"in t)||"navigation"!==e.displayType;var t}function zo(e){if(mr(e))return!1;if(pr(e))return!0;var t=ur(e)?e.mediaType:void 0;if("VOICE_TRANSCRIPT"===t)return!1;var n=_r(e);return"message"===n||"file"===n||"system"===n||"CHAT"===t}var Ho=n(9552);function Vo(e,t,n){var r=function(e,t,n){var r=(0,y.useAsRef)((0,st.useActivityHistoryByContactId)(t)),o=(0,y.useAsRef)((0,te.useContactActivityHistory)().getMessages);return(0,a.useCallback)((function(){var e=r.current||{},a=e.isLoading,i=e.reachedLimitByMedia;return a||"transcript"===n||(null==i?void 0:i[rt.chatTypeToMedia[n]])||!t?Promise.resolve(!1):o.current({contactId:t,type:n}).then((function(){return!0})).catch((function(e){return console.error(e||"Error while trying loadMessages when top is reached")}))}),[r,t,o,n])}(0,t,n),o=(0,a.useRef)(!1),i=(0,a.useRef)(0);return(0,a.useCallback)((function(){var e=function(){return o.current||i.current>5?Promise.resolve(!1):(o.current=!0,r().then((function(e){return i.current=0,o.current=!1,e})).catch((function(t){i.current+=1,o.current=!1,console.error(t||"Error while trying load messages again until scroll"),e()})))};e()}),[r])}const Go="communicator_NoMessages_noMessages_UX4AP",Wo="communicator_NoMessages_noRecent_7ixir",qo="communicator_NoMessages_searchForOlder_QGkjJ";var Yo=function(e){var t=e.type,n=e.contactId,o=(0,te.useContactActivityHistory)(),i=o.isLoading,s=o.getMessages,l=(0,c.useLocalizationState)().t,u=function(e){var t=(0,st.useContactsState)("activityHistory");return(0,a.useMemo)((function(){return(0,$.get)(t[e],"reachedLimit",!0)}),[t,e])}(n),d=(0,a.useCallback)((function(){s({type:t,contactId:n})}),[n,s,t]);return(0,r.jsx)(r.Fragment,{children:!i&&u?(0,r.jsx)("div",{className:Go,children:(0,r.jsx)("p",{className:Wo,children:l.INTERNAL_CHAT.chat_history_no_recent_found(t)})}):(0,r.jsxs)("div",{className:Go,children:[(0,r.jsx)("p",{className:Wo,children:l.INTERNAL_CHAT.chat_history_no_recent_while_loading(t)}),(0,r.jsx)(L.Button,{className:qo,onClick:d,children:l.INTERNAL_CHAT.chat_history_search_for_older(t)})]})})},Ko=function(e){var t=e.contactId,n=e.type;return"messages"!==n&&"calls"!==n?null:(0,r.jsx)(Yo,{type:n,contactId:t})};const $o={messageWrapper:"communicator_Chat_messageWrapper_drgLf",messageTopInfo:"communicator_Chat_messageTopInfo_VoA3v",incoming:"communicator_Chat_incoming_6DHeo",messageBlock:"communicator_Chat_messageBlock_i7M0B",outgoing:"communicator_Chat_outgoing_JD3jd",avatar:"communicator_Chat_avatar_mUd4N",placementTop:"communicator_Chat_placementTop_Awuqp",remoteAssistMessageAvatar:"communicator_Chat_remoteAssistMessageAvatar_FEd8Z",message:"communicator_Chat_message_x5tfb",urgent:"communicator_Chat_urgent_KfI8l",messageContent:"communicator_Chat_messageContent_nw7Cp",messageContentHtml:"communicator_Chat_messageContentHtml_AuPlx",voice:"communicator_Chat_voice_GZnDG",voiceRecording:"communicator_Chat_voiceRecording_crXBM",emi:"communicator_Chat_emi_LuUC3",errorMessageContent:"communicator_Chat_errorMessageContent_4XIXs",messageTopInfoGap:"communicator_Chat_messageTopInfoGap_jZaVp",transcriptSuggestionAvatar:"communicator_Chat_transcriptSuggestionAvatar_FScZp",timeChannel:"communicator_Chat_timeChannel_N1P8J",channelIcon:"communicator_Chat_channelIcon_nzkb9",selectionPopupOption:"communicator_Chat_selectionPopupOption_UTtPT"};function Xo(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Qo(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Xo(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Xo(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Zo="m-0 mr-1.5",Jo=function(e){var t=e.userId,n=e.displayName,o=e.isSelf,i=e.isScenarioAvatar,s=e.className,l=e.isConference,c=e.showUserAvatar,u=void 0===c||c,d=(0,yt.useGetUserPictureUrl)(),f=(0,a.useMemo)((function(){if(!l)return!o&&t?d(t):""}),[d,l,o,t]),m=Qo((0,a.useMemo)((function(){return n?n.split(" "):["",""]}),[n]),2),p=m[0],v=m[1];return i?(0,r.jsx)(jt.Avatar,{className:M(s,$o.avatar,Zo),type:"scenario",size:"28"}):(0,r.jsx)(r.Fragment,{children:u&&(0,r.jsx)(jt.Avatar,{className:M(s,$o.avatar,Zo),url:f,size:"28",firstName:p,lastName:v,type:l?"conference":"contact"})})};var ei=function(e){var t,n,a,o=e.children,i=e.className,s=e.isError,l=e.messageId,c=M(i,(a=s,(n=$o.errorMessageContent)in(t={})?Object.defineProperty(t,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[n]=a,t));return(0,r.jsx)(L.SelectionItem,{"data-message-id-selection":l,focusOnSelection:!0,touchedOnly:!0,tabIndex:0,className:c,itemId:l,children:o})},ti=function(e){var t=e.children,n=e.displayName,a=e.isOutgoing,o=e.isSystemMessage,i=e.sendTime,s=e.showTime,l=e.showName,u=(0,c.useLocalizationState)().t,d=M("text-neutral-fade [&:not(:last-child)]:mr-2");return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"flex justify-between pb-1 text-sm leading-[16px]",children:(0,r.jsxs)("div",{className:M("flex items-center justify-start",{"w-full justify-end":a}),children:[o&&(0,r.jsx)(j.IconRobot,{className:"mr-2"}),(l||o)&&(0,r.jsx)("span",{className:d,"data-testid":"party-display-name",children:o?u.EXTERNAL_CHAT.system_message():n}),s&&(0,r.jsx)("span",{className:d,"data-testid":"message-time",children:(0,y.formatDate)(i,"h:mm A")})]})}),t]})};function ni(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ri=o().memo((function(e){var t,n,a=e.className,o=e.children,i=e.message,s=e.isFullWidth,l=e.messageClassName,c=e.withoutBorder,u=(0,gt.useFormatting)().formatFullName,d=i.userId,f=i.isSelf,m=i.timestamp,p=gr(i),v=_r(i),h=fr(i),b=!!h&&!!i.page,y=h?i.source:void 0,g=dr(i),j=!!g&&!!i.notes,I=!!g&&!!i.disposition,S=ur(i),O=S?i.direction:void 0,x=S?i.mediaType:void 0,C="EMAIL"===x&&!g,_="VOICE"===x&&!g,w=br(i)?i.users:void 0,N=Nr(i),A=!!Ar(i),P=!(g||C||A||_),E="REMOTE_ASSIST"===x,D=w&&w.length>1,T="outgoing"===O||"agent"===y||"system"===y||"navigation"===v||"activityGroup"===v||N||I||f&&!_,k="activityGroup"===v||"REMOTE_ASSIST"===x,L=wr(i,u),R=T&&!f&&!(null==i?void 0:i.userId),F=Boolean(R||_&&!T&&!f||!T&&L),B=(0,X.isScenarioMessage)(v),U=T?"outgoing":"incoming",z=null!==(t=null==w?void 0:w[0].userId)&&void 0!==t?t:d,H=M($o.messageBlock,$o[U]);return(0,r.jsx)("div",{className:H,"data-disposition":I||void 0,"data-email":C||void 0,"data-error":N||void 0,"data-file":A||void 0,"data-incoming":!T||void 0,"data-testid":"message-item","data-link":b||void 0,"data-notes":j||void 0,"data-outgoing":T||void 0,"data-remote-assist-session":E||void 0,"data-text-message":P||void 0,children:(0,r.jsx)("div",{className:M("z-0 flex max-w-[71%] flex-auto flex-col",{"w-full max-w-full":s}),children:(0,r.jsxs)("section",{className:M($o.message,$o[U]),children:["incoming"===U&&!c&&(0,r.jsx)(Jo,{userId:z,isConference:D,displayName:L,isScenarioAvatar:B,showUserAvatar:!0}),k?o:(0,r.jsx)(ei,{className:M("relative",{"w-full max-w-full":s},a),isError:N,messageId:p,children:(0,r.jsx)(wa,{messageId:p,className:M("relative inline-block\n                                        whitespace-normal break-all rounded border p-2\n                                        border-on-secondary text-primary-on-primary before:absolute\n                                        before:-bottom-px before:z-[-1] before:h-0 before:w-0 before:rounded-b-[33%]\n                                        before:border-b-4 before:border-t-0\n                                        before:border-transparent before:border-b-secondary-100 before:content-[''] after:absolute\n                                        after:bottom-0 after:z-0 after:h-0 after:w-0 after:rounded-b-[33%] after:border-b-[9px]\n                                        after:border-t-0 after:border-transparent after:content-[''] hover:text-primary-on-primary",(n={},ni(n,"rounded-bl-[8px] bg-secondary-50\n                                            before:left-[-5px] before:border-l-[9px] before:border-r-0\n                                            after:left-[-5px] after:border-l-[8px]\n                                            after:border-r-0 after:border-b-secondary-50","incoming"===U),ni(n,"rounded-br-[8px] bg-primary-background\n                                            before:right-[-5px] before:border-l-0 before:border-r-[9px]\n                                            after:right-[-5px] after:border-l-0\n                                            after:border-r-[8px] after:border-b-neutral-0","outgoing"===U),n),l),children:c?o:(0,r.jsx)(ti,{displayName:L,isOutgoing:T,isSystemMessage:R,sendTime:m,showName:F,showTime:!_||g,children:o})})})]})})})})),ai="size-1.5 rounded bg-inverse-disabled inline-block",oi=function(){return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:M(ai,"ml-1.5 mr-1 animate-[dot-transform_1s_alternate_infinite]")}),(0,r.jsx)("div",{className:M(ai,"mr-1 animate-[dot-transform_1s_500ms_alternate_infinite]")}),(0,r.jsx)("div",{className:M(ai,"animate-[dot-transform_1s_1.5s_alternate_infinite]")})]})};var ii=function(e){var t=e.party,n=e.typingParty,a=t.first_name,o=t.last_name,i=t.user_id,s=(0,c.useLocalizationState)().t,l=(0,(0,gt.useFormatting)().formatFullName)(a,o),u=l||s.EXTERNAL_CHAT.display_name_placeholder(),d=(i?s.EXTERNAL_CHAT.agent_is_typing(l):s.EXTERNAL_CHAT.party_is_typing()).replace(/\.\.\.$/,""),f=(null==t?void 0:t.timestamp)?Number(t.timestamp):Date.now().valueOf();return(0,r.jsxs)(ri,{message:{itemId:t.item_id,partyId:t.party_id,timestamp:f,type:"message",displayType:"message",displayName:u},children:[d," ",n.message,(0,r.jsx)(oi,{})]})},si=function(e){var t,n=e.itemId,o=e.rangeRef,s=e.messagesRef,l=(0,a.useRef)(null),c=(0,i.useInteractionProp)(n,X.getInteractionStepId),u=(0,Yt.useInteractionChatData)(c),d=(0,X.getTypingParties)(u),f=d.length>0,m=null===(t=o.current)||void 0===t?void 0:t.endIndex,p=s.current.length-1,v=(0,y.useAsRef)(p===m);return(0,a.useEffect)((function(){var e;f&&v.current&&(null===(e=l.current)||void 0===e||e.scrollIntoView({behavior:"auto",block:"start"}))}),[f,v]),(0,r.jsxs)(r.Fragment,{children:[d.map((function(e,t){return(0,r.jsx)(ii,{party:e,typingParty:null==u?void 0:u.typingParties[e.party_id]},t)})),f&&(0,r.jsx)("div",{ref:l})]})};var li=o().memo((function(e){var t=e.messages,n=e.itemId,o=e.type,s=e.contactId,l=e.scrollNode,u=e.renderMessage,d=(0,c.useLocalizationState)().t,f=(0,x.useInteractionUIItemStateSetter)(),m=(0,a.useRef)(null),p=(0,a.useRef)(void 0),v=(0,y.useAsRef)(t),h=(0,a.useRef)(!1),b=(0,i.useInteraction)(n),g=(0,X.getServiceNameFromItem)(b),j=(0,X.getChannel)(b),I=(0,L.getChannelImageIcon)(j),S=Vo(0,s,o);(0,a.useEffect)((function(){f(n,E()((function(e){e.scrollerApi={scrollToLast:function(){var e;null===(e=m.current)||void 0===e||e.scrollToIndex({index:"LAST"})},scrollTo:function(e,t){var n,r,a=null===(n=v.current)||void 0===n?void 0:n.findIndex((function(t){return e===gr(t)}));null===(r=m.current)||void 0===r||r.scrollToIndex({index:a,align:t})}}})))}),[n,v,f]),function(e,t,n,r){var o=(0,y.useAsRef)(e),i=(0,y.usePreviousValueRef)(e),s=(0,y.useValueUpdated)(e.length);(0,a.useLayoutEffect)((function(){var e;if(n.current&&!yr(r)&&gr(o.current[0])!==gr((null===(e=i.current)||void 0===e?void 0:e[0])||"")&&s){var a,l=jr(r,n.current.startIndex,i.current||[]),c=l.offset,u=l.id,d=o.current.findIndex((function(e){return gr(e)===u}));null===(a=t.current)||void 0===a||a.scrollToIndex({index:d,offset:c,align:"start"})}}),[s,i,o,n,r,t])}(t,m,p,l);var O=function(e,t,n,r,o){var i=(0,x.useInteractionUIItemStateSetter)(),s=(0,y.useAsRef)(Qa(e)),l=(0,y.useAsRef)((0,x.useInteractionUIChatTypeTopItemId)(e,t));return(0,a.useLayoutEffect)((function(){return function(){if(r.current)if(yr(o))i(e,E()((function(e){delete e.tabTopItemId[t]})));else{var a=jr(o,r.current.startIndex,n.current),s=a.id,l=a.offset;i(e,E()((function(e){e.tabTopItemId[t]={id:s,offset:l}})))}}}),[e,n,r,o,i,t]),(0,a.useMemo)((function(){if(s.current)return{index:n.current.findIndex((function(e){return gr(e)===s.current})),align:"end"};if(l.current){var e,t=n.current.findIndex((function(e){var t;return gr(e)===(null===(t=l.current)||void 0===t?void 0:t.id)}));return{index:t,align:"start",offset:(null===(e=l.current)||void 0===e?void 0:e.offset)||0}}return{index:"LAST"}}),[s,n,l])}(n,o,v,p,l),C=(0,a.useCallback)((function(e,t){return gr(t)}),[]),_=j?"remoteassist"===j?d.ACTIVITY_HISTORY.remote_assist_title():d.GLOBAL["chat_type_".concat(j)]():"",w=(0,a.useCallback)((function(){return g?(0,r.jsx)("div",{className:"my-6 flex justify-center",children:(0,r.jsxs)("div",{className:"text-neutral-on-secondary",children:[(0,r.jsx)("p",{className:"text-center font-semibold caption-s",children:g}),(0,r.jsxs)("div",{className:"flex items-center justify-center",children:[I&&(0,r.jsx)(I,{className:"mr-1 size-4 icon-disabled"})," ",(0,r.jsx)("p",{className:"text-center caption-s",children:_})]})]})}):null}),[I,_,g]),N=(0,a.useMemo)((function(){return{Header:w,Footer:function(){return(0,r.jsx)(si,{itemId:n,messagesRef:v,rangeRef:p})}}}),[n,v,w]),A=(0,a.useCallback)((function(e){p.current=e}),[]),P=(0,a.useCallback)((function(e){l&&l.clientHeight>=e&&S()}),[S,l]),D=(0,a.useMemo)((function(){return(0,$.debounce)(P,100)}),[P]),T=(0,a.useCallback)((function(e){h.current?e&&S():h.current=!0}),[S]),k=(0,a.useCallback)((function(e,t){return u(t)}),[u]);return t.length<1||1==t.length&&pr(t[0])?(0,r.jsx)(Ko,{type:o,contactId:s}):(0,r.jsx)(Ho.Virtuoso,{tabIndex:void 0,ref:m,followOutput:!0,data:t,itemContent:k,computeItemKey:C,atTopStateChange:T,initialTopMostItemIndex:O,customScrollParent:l||void 0,components:N,rangeChanged:A,totalListHeightChanged:D,increaseViewportBy:200})})),ci=function(e){var t=e.isScenario,n=e.displayName,a=e.showName,o=e.timestamp,i=e.gapBeforeTime,s=e.channel,l=e.mediaType,c=e.direction,u=e.showTime,d=i||u&&a,f=(0,L.getChannelImageIcon)(s,{omit:["web"],default:void 0});return(0,r.jsxs)("p",{className:M($o.messageTopInfo,$o[c]),children:[(0,r.jsx)("span",{"data-testid":"party-display-name",children:a&&n}),(0,r.jsx)("span",{className:d?$o.messageTopInfoGap:""}),u&&(0,r.jsxs)("span",{className:M($o.timeChannel,$o[c]),children:[!t&&"EMAIL"!==l&&f&&(0,r.jsx)(f,{"data-testid":"channel","data-value":s,className:$o.channelIcon,title:s}),(0,r.jsx)("span",{"data-testid":"message-time",children:(0,y.formatDate)(o,"h:mm A")})]})]})};const ui="communicator_Chat_messageBlock_i7M0B",di="communicator_Chat_outgoing_JD3jd",fi="communicator_Chat_message_x5tfb",mi="communicator_ErrorMessage_errorMessage_LqBft",pi="communicator_ErrorMessage_errorMessageAvatar_fhbT1";var vi=function(e){var t=e.children;return(0,r.jsxs)("div",{className:M(ui,di),children:[(0,r.jsx)(ci,{direction:"outgoing",isScenario:!0,timestamp:0}),(0,r.jsx)("section",{className:M(fi,di),children:(0,r.jsx)(ei,{className:mi,isError:!0,children:t})}),(0,r.jsx)(Jo,{className:pi,isScenarioAvatar:!0})]})},hi=function(e){var t=e.title,n=e.disposition,a=e.serviceName,o=e.messageId,i=(0,c.useLocalizationState)().t,s=M("break-words font-normal caption-s text-neutral-on-secondary"),l=M("flex w-full items-center gap-1");return(0,r.jsx)(L.SelectionItem,{touchedOnly:!0,focusOnSelection:!0,tabIndex:0,itemId:o,className:"w-full rounded-xs border py-1.5 pl-2 pr-3 bg-primary-container-variant1 border-action",children:(0,r.jsx)(wa,{messageId:o,children:(0,r.jsxs)("div",{className:"flex w-full flex-col gap-2",children:[(0,r.jsxs)("div",{className:l,children:[(0,r.jsx)(j.IconACWDisposition24,{className:"size-4 icon-neutral"}),(0,r.jsx)("div",{className:"font-semibold caption-xs text-primary-on-primary",children:i.ACTIVITY_HISTORY.disposition_title()})]}),(0,r.jsx)("div",{className:M("flex w-full gap-1",s),"data-testid":"disposition-title",children:t}),(0,r.jsxs)("div",{className:l,children:[(0,r.jsx)("span",{className:s,children:i.EXTERNAL_CHAT.disposition_message_service_name()}),(0,r.jsx)("span",{className:M(s,"font-semibold"),"data-testid":"disposition-service",children:a})]}),(0,r.jsxs)("div",{className:l,"data-testid":"disposition",children:[(0,r.jsx)("span",{className:s,children:i.EXTERNAL_CHAT.disposition_message_name()}),(0,r.jsx)("span",{className:M(s,"font-semibold"),children:n})]})]})})})},bi=function(e){var t=e.children,n=(0,c.useLocalizationState)().t;return(0,r.jsxs)("div",{className:"flex w-full flex-col gap-2 rounded-xs border py-1.5 pl-2 pr-3 bg-warning-variant border-on-warning","data-testid":"notes",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(j.IconAgentNotes,{className:"size-4"}),(0,r.jsx)("div",{className:"font-semibold caption-xs text-primary-on-primary",children:n.ACTIVITY_HISTORY.agent_notes_title()})]}),(0,r.jsx)("div",{className:"w-full gap-1 break-words caption-s text-neutral-on-secondary",children:t})]})};var yi=function(e){var t=e.message,n=t.notes,o=t.disposition,i=t.serviceName,s=gr(t),l=function(e){var t=(0,c.useLocalizationState)().t,n=(0,gt.useFormatting)().formatFullName;return(0,a.useMemo)((function(){return xr(e,t,n)}),[n,e,t])}(t);return(0,r.jsxs)("div",{children:[n&&(0,r.jsx)(ri,{isFullWidth:!0,message:t,children:(0,r.jsx)(wa,{messageId:s,className:"w-full",children:(0,r.jsx)(bi,{children:n})})}),o&&(0,r.jsx)(ri,{isFullWidth:!0,message:t,children:(0,r.jsx)(hi,{messageId:s,title:l,disposition:o,serviceName:i})})]})};const gi=n.p+"21ff305d2488d9478cc624e673ec8bab.svg";const ji=n.p+"57f727bf2f169e0b19d872ec87e1ebc4.svg";const Ii=n.p+"0c921db40ddee9f34a5d15b376ee0df7.svg";const Si=n.p+"910dfbe6763a148f8a6af4b2866390ff.svg";const Oi=n.p+"3b81ec51938bfa793e8ba0cb4f274188.svg";const xi=n.p+"6157ddd8a81feea7b302231a623e132e.svg";const Ci=n.p+"705a55fc7f1f462947be817d84a580cc.svg";const _i=n.p+"14effeb1e434fca9cf40a30e4b4c1cfa.svg";const wi=n.p+"720e2babef2e76400cb343b776053cba.svg";const Ni=n.p+"a39c903b5cca1b36c65e91151a83b019.svg";const Ai={messageRow:"communicator_Message_messageRow_UOs4p",incoming:"communicator_Message_incoming_bnpcD",outgoing:"communicator_Message_outgoing_pKbZe",time:"communicator_Message_time_wb5xv",message:"communicator_Message_message_chWfh",link:"communicator_Message_link_J61uY",error:"communicator_Message_error_NKpnz",html:"communicator_Message_html_rIkTi",closable:"communicator_Message_closable_a7mGz",sentiment:"communicator_Message_sentiment_jM9aL",icon:"communicator_Message_icon_XNLkK"};function Pi(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Ei=o().forwardRef((function(e,t){var n,a=e.message,o=e.itemId,i=e.direction,s=e.closeButton,l=e.isLink,c=e.isHtml,u=e.content,d=a.endTime,f=a.sentiment,m=a.chatMessageData,p=(0,y.useInnerHTML)(u),v=function(e){if((0,ar.isSuggestion)(e))return gi;if((0,ar.isCurrentChatTranscriptMessage)(e)&&e.chatMessageData.channel)switch(e.chatMessageData.channel){case"sms":return Si;case"whatsapp":return Ni;case"facebook":return ji;case"line":return Ii;case"telegram":return Oi;case"twitter":return xi;case"viber":return Ci;case"web":return _i;case"wechat":return wi}}(a),h=gr(a),b=ir(o),g=(0,r.jsxs)(L.SelectionItem,{ref:t,itemId:h,focusOnSelection:!0,touchedOnly:!0,tabIndex:0,"data-message-id-selection":h,className:M(Ai.message,Ai[i],(n={},Pi(n,Ai.html,c),Pi(n,Ai.link,l),Pi(n,Ai.closable,!!s),Pi(n,Ai.error,"error"===(null==m?void 0:m.displayType)),n)),children:[(0,r.jsx)(wa,{messageId:h,children:(0,r.jsx)("div",{dangerouslySetInnerHTML:p,onClickCapture:function(e){l&&(e.preventDefault(),e.stopPropagation(),b(a))}})}),s]});return(0,r.jsxs)("div",{className:M(Ai.messageRow,Ai[i]),children:[(0,r.jsx)("div",{className:M(Ai.time,Ai[i]),children:(0,y.formatDate)(d,"h:mm A")}),g,v&&(0,r.jsx)(L.Svg,{src:v,className:M(Ai.icon,Ai[i])}),f&&(0,r.jsx)(L.Sentiment,{sentiment:f,className:M(Ai.sentiment,Ai[i])})]})}));function Di(e){var t=e.text,n=e.url,r=e.target,a=(0,y.normalizeExternalURL)(n);return"<a href=".concat(a,' target="').concat(r,'">').concat(t,"</a>")}function Ti(e){var t,n;return{partyId:e.partyId,msgId:null!==(t=e.msgId)&&void 0!==t?t:"",text:null!==(n=e.msg)&&void 0!==n?n:"",startTime:e.timestamp,endTime:e.timestamp,sentiment:e.sentiment,type:"chatMessage",format:"HTML",isSelf:e.isSelf,chatMessageData:e}}function ki(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Mi(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var Li=function(e){var t=e.message,n=e.itemId,a=Mi(e,["message","itemId"]),o=t.text,i=void 0===o?"":o,s=(0,ar.isHTMLSuggestion)(t),l=(0,ar.isLinkSuggestion)(t),c=l?Di({text:t.text,target:n,url:t.suggestionURL}):i;return(0,r.jsx)(Ei,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){ki(e,t,n[t])}))}return e}({message:t,isHtml:s,isLink:l,content:c,itemId:n},a))},Ri=o().memo((function(e){var t=e.message;return(0,r.jsx)("div",{className:"text-neutral-on-fade words-break flex w-full select-none items-center justify-center gap-1 px-8 py-4 caption-s","data-testid":"date-separator",children:t})})),Fi=n(5603);function Bi(e){var t=e.msgId,n=e.scrollNode,r=e.mediaType,o=e.isDIDChat,i=e.itemInteractionStepId,s=e.itemContactId,l=e.itemGlobalInteractionId,c=e.source,u=e.isRead,d=e.historyMessageGlobalInteractionId,f=(0,y.usePageVisibility)(),m=(0,Yt.useInteractionChatStateMethods)(),p=m.markMessageAsRead,v=m.markPersonalMessageAsRead,h=(0,Yt.useInteractionChatStateSelector)((function(e){var n,r;return!!(s&&t&&d&&(null===(r=e.unreadPersonalMessages[s])||void 0===r||null===(n=r[d])||void 0===n?void 0:n[t]))})),b=(0,a.useMemo)((function(){return!!f&&(r?h:!(!i||"customer"!==c&&"agent"!==c||u))}),[i,u,r,f,c,h]),g=(0,a.useRef)(null),j=(0,y.useIntersectionObserver)(g,{root:n,enabled:b}).isIntersecting,I=(0,a.useCallback)((function(e){e&&(h?d&&v({globalInteractionId:d,messageId:t,contactId:s}):t&&(i&&p({interactionStepId:i,messageId:t}),l&&o&&s&&v({globalInteractionId:l,messageId:t,contactId:s})))}),[h,t,v,d,s,i,l,p,o]);return(0,a.useEffect)((function(){j&&b&&I(!0)}),[I,j,b]),g}var Ui=o().forwardRef((function(e,t){var n=e.fileLink,a=e.fileName;return(0,r.jsx)("div",{ref:t,children:(0,r.jsx)(j.Attachment.File,{height:"44",name:a,link:n,withDownloadButton:!0})})})),zi=function(e){var t=e.fileLink;return(0,r.jsx)(L.AudioPlayer,{src:t,showDownloadButton:!0,isNewAudioPlayerUI:!0})},Hi=n(8391);function Vi(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Gi(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Vi(e,t,n[t])}))}return e}function Wi(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function qi(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var Yi=o().forwardRef((function(e,t){var n=e.fileLink,a=e.fileName,o=e.className,i=e.senderName,s=e.timestamp,l=qi(e,["fileLink","fileName","className","senderName","timestamp"]),c=(0,y.useBoolean)(!1);return(0,y.useEscapeManager)(c.setFalse,{enabled:c.value}),(0,r.jsxs)(Hi.fC,{open:c.value,onOpenChange:c.toggle,children:[(0,r.jsx)(Hi.xz,{asChild:!0,children:(0,r.jsx)("img",Wi(Gi({ref:t},l),{className:M("cursor-zoom-in rounded-xs",o),alt:a,src:n,title:a,"data-testid":"attachment","data-value":a}))}),(0,r.jsxs)(Hi.h_,{children:[(0,r.jsx)(Hi.aV,{className:M("fixed left-0 top-0 z-10 h-full w-full bg-inverse-overlay","data-[state=open]:animate-fade-in-100","data-state=[closed]:animate-fade-out-100")}),(0,r.jsxs)(Hi.VY,{className:M("fixed left-1/2 top-1/2 z-20 max-h-[90vw] max-w-[90vw] -translate-x-1/2 -translate-y-1/2","data-[state=open]:animate-fade-in-100","data-state=[closed]:animate-fade-out-100"),children:[(0,r.jsx)(Hi.x8,{className:"absolute right-0 top-0 translate-y-[calc(-100%-10px)]",children:(0,r.jsx)(j.IconClose24,{className:"size-8 icon-reversed"})}),(0,r.jsx)("img",Wi(Gi({ref:t},l),{className:"h-auto w-auto",alt:a,src:n,title:a,"data-testid":"attachment","data-value":a})),(0,r.jsx)("p",{className:"mt-2 caption-s text-inverse-disabled",children:a}),(0,r.jsxs)("p",{className:"caption-s text-inverse-disabled",children:[(0,r.jsx)("b",{className:"text-inverse-disabled",children:i}),", ",(0,r.jsx)("b",{className:"text-inverse-disabled",children:(0,rt.formatChatDate)(s)})]})]})]})]})}));function Ki(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var $i=function(e){var t=e.session,n=void 0===t?{}:t,a=e.canMask,o=e.mediaType,i=e.source,s=e.isRead,l=e.fileData,u=e.markAsReadData,d=e.globalInteractionId,f=e.msg,m=e.senderName,p=e.timestamp,v=l.refMsgId,h=l.fileId,b=void 0===h?"":h,y=l.fileType,g=void 0===y?"attachment":y,j=l.fileName,I=void 0===j?"":j,S=l.fileProgress,O=void 0===S?0:S,x=l.fileError,C=l.fileIsMasked,_=void 0!==C&&C,w=n.id,N=n.domain,A=n.loginId,P=(0,Fi.paramsToQueryString)({token:w,user:A,tenant:N,id:b,no_disposition:0}),E="".concat(Fi.requestUrls.getChatAttachmentDownload,"?").concat(P),D=(0,c.useLocalizationState)().t,T=!b&&!x,k=Bi(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Ki(e,t,n[t])}))}return e}({msgId:v,historyMessageGlobalInteractionId:d,mediaType:o,source:i,isRead:s},u));if(T&&O)return(0,r.jsx)(L.FileProgress,{progress:O});if(!b){var M=D.INTERNAL_CHAT.chat_removedAttachment_label();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{children:["[",M," ",(0,r.jsx)("del",{"data-testid":"file-name",children:I}),"]"]}),f&&(0,r.jsx)("div",{"data-testid":"message-content",children:f})]})}return x?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{"data-testid":"file-error",children:x}),f&&(0,r.jsx)("div",{"data-testid":"message-content",children:f})]}):"attachment"===g||"video"===g?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(Ia,{fileId:b,fileIsMasked:_,canMask:a,globalInteractionId:d,interactionStepId:u.itemInteractionStepId,contactId:u.itemContactId,children:(0,r.jsx)(Ui,{ref:k,fileName:I,fileLink:E})}),f&&(0,r.jsx)("div",{"data-testid":"message-content",children:f})]}):"audio"===g?(0,r.jsx)(Ia,{fileId:b,fileIsMasked:_,canMask:a,globalInteractionId:d,interactionStepId:u.itemInteractionStepId,contactId:u.itemContactId,children:(0,r.jsx)(zi,{fileLink:E})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(Ia,{fileId:b,fileIsMasked:_,canMask:a,globalInteractionId:d,interactionStepId:u.itemInteractionStepId,contactId:u.itemContactId,children:(0,r.jsx)(Yi,{ref:k,fileName:I,fileLink:E,senderName:m,timestamp:p})}),(0,r.jsx)("p",{className:"mt-1 caption-xs text-neutral-fade",children:I}),f&&(0,r.jsx)("div",{"data-testid":"message-content",children:f})]})};const Xi="communicator_FileMessage_file_JZUYk",Qi="communicator_FileMessage_isError_gJF8O",Zi="communicator_FileMessage_voice_fmzfp";function Ji(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var es=function(e){var t,n=e.message,o=e.fileData,i=e.markAsReadData,s=o.fileError,l=o.fileType,c=(0,at.useSessionState)(),u=c.sessionId,d=c.domain,f=c.loginId,m=c.privileges,p=(0,a.useMemo)((function(){return{id:u,domain:d,loginId:f}}),[u,d,f]),v=!!m.CAN_MASK_INTERACTION_CONTENT,h=ur(n)?n.globalInteractionId:void 0,b="audio"===l,y=(0,gt.useFormatting)().formatFullName;return(0,r.jsx)(ri,{message:n,className:M(Xi,(t={},Ji(t,Qi,s),Ji(t,Zi,b),t)),children:(0,r.jsx)($i,{timestamp:n.timestamp,senderName:wr(n,y),fileData:o,markAsReadData:i,canMask:v,session:p,globalInteractionId:h})})};var ts=o().memo((function(e){var t=e.message,n=(0,c.useLocalizationState)().t,o=function(e){var t=e.itemId,n=e.partyId,r=e.inviteId,o=(0,Yt.useInteractionChatStateMethods)().removeInviteFromChat;return(0,a.useCallback)((function(){o({itemId:t,partyId:n,messageId:r||""})}),[r,t,n,o])}(t);return(0,r.jsxs)("div",{className:"select-none pb-2.5","data-testid":"message-item","data-outgoing":"true","data-invitation":"true",children:[(0,r.jsx)("span",{className:"mr-[5px]",children:n.EXTERNAL_CHAT.external_chat_party_inviting()}),(0,r.jsx)(L.SemanticButton,{size:"mini",negative:!0,onClick:o,tooltip:n.WINDOW_POPUP_TITLES_AND_MESSAGES.window_buttonCancel(),"data-testid":"cancel-invitation-button",children:n.WINDOW_POPUP_TITLES_AND_MESSAGES.window_buttonCancel()})]})})),ns=function(e){var t=e.link,n=e.latitude,a=e.longitude,o=(0,c.useLocalizationState)("t").EXTERNAL_CHAT,i=t||(n&&a?function(e,t){return"https://www.google.com/maps/search/?api=1&query=".concat(e,",").concat(t)}(n,a):void 0);return(0,r.jsx)(d.SmImage,{src:ve.iconLocation,title:o.location_message_icon_tooltip(),as:"a",href:i,target:"_blank"})},rs=function(e){var t=e.message,n=t.serviceName,a=t.serviceAddress,o=t.msg,i=t.timestamp,s="".concat(n," ").concat((0,rt.formatPhone)(a)),l=gr(t),c=(0,te.useChatMessageSanitizer)({message:o}),u=(0,y.useInnerHTML)(c);return(0,r.jsxs)("div",{className:M($o.messageBlock,$o.outgoing),"data-testid":"message-item","data-outgoing-campaign":"true","data-outgoing":"true",children:[(0,r.jsxs)("div",{className:$o.messageWrapper,children:[(0,r.jsx)(ci,{direction:"outgoing",timestamp:i,showName:!0,gapBeforeTime:!0,displayName:s}),(0,r.jsx)("section",{className:M($o.message,$o.outgoing),children:(0,r.jsx)(ei,{messageId:l,children:(0,r.jsx)("span",{dangerouslySetInnerHTML:u})})})]}),(0,r.jsx)(ve.IconOutboundCampaign,{className:$o.avatar})]})},as=function(e){var t,n,a,o,s,l,u,d,f,m=e.link,p=e.title,v=e.partyId,h=(0,c.useLocalizationState)().t,b=(0,i.useActiveInteraction)(),y=null==b||null===(t=b.chatParties)||void 0===t?void 0:t.find((function(e){return e.party_id===v})),g=null==y?void 0:y.contact_id,I=null===(n=(0,st.useContact)(g))||void 0===n?void 0:n.data,S=(0,gt.useFormatting)().formatFullName,O=S(null==I?void 0:I.firstName,null==I?void 0:I.lastName),x=S(null==y?void 0:y.first_name,null==y?void 0:y.last_name),C=S(null==b||null===(a=b.externalChatData)||void 0===a?void 0:a.firstName,null==b||null===(o=b.externalChatData)||void 0===o?void 0:o.lastName),_=O||x||C||!!(null==I||null===(s=I.phones)||void 0===s?void 0:s.length)&&(null==I||null===(u=I.phones)||void 0===u||null===(l=u[0])||void 0===l?void 0:l.phone)||!!(null==I||null===(d=I.emails)||void 0===d?void 0:d.length)&&(null==I||null===(f=I.emails[0])||void 0===f?void 0:f.emailAddress)||h.EXTERNAL_CHAT.display_name_placeholder();return(0,r.jsx)("div",{className:"flex items-center justify-center bg-transparent py-4",children:(0,r.jsxs)("div",{className:"flex flex-wrap items-center justify-center",children:[(0,r.jsx)(j.IconSendInvitation,{className:"mr-2 size-4 icon-default"}),_&&(0,r.jsx)("span",{className:"mr-1 font-semibold caption-s text-neutral-on-secondary",children:_}),(0,r.jsx)("span",{className:"caption-s text-neutral-fade",children:h.ACTIVITY_HISTORY.navigate_to()}),(0,r.jsx)(j.Link,{href:m,title:m,"data-testid":"link",className:"!caption-s",children:p||h.EXTERNAL_CHAT.external_chat_customer_navigates_to()})]})})};var os=function(e){var t=e.className,n=e.confidence,o=(0,c.useLocalizationState)().t,i=function(e,t,n){var r,a,o=[];if(0===t)r=[n,n,n];else switch(o=[n*(1-t),n*(1-t*((e/=60)-(a=Math.floor(e)))),n*(1-t*(1-(e-a)))],a){case 0:r=[n,o[2],o[0]];break;case 1:r=[o[1],n,o[0]];break;case 2:r=[o[0],n,o[2]];break;case 3:r=[o[0],o[1],n];break;case 4:r=[o[2],o[0],n];break;default:r=[n,o[0],o[1]]}return"#"+r.map((function(e){return("0"+Math.round(255*e).toString(16)).slice(-2)})).join("")}(Math.floor(120*n),.66,1),s=(0,a.useMemo)((function(){return{backgroundColor:i}}),[i]),l=n>.7?"high":n>.4?"medium":"low",u=Math.floor(100*n),d=(0,a.useMemo)((function(){return{high:o.ACTIVITY_HISTORY.call_message_transcript_confidence_high(),medium:o.ACTIVITY_HISTORY.call_message_transcript_confidence_medium(),low:o.ACTIVITY_HISTORY.call_message_transcript_confidence_low()}}),[o])[l]+" (".concat(u,"%)");return(0,r.jsx)("span",{className:t,style:s,title:d,"data-testid":"message-confidence","data-value":u,"data-confidence-low":"low"===l,"data-confidence-medium":"medium"===l,"data-confidence-high":"high"===l})};const is="communicator_PlainMessage_plainMessage_gEaYP",ss="communicator_PlainMessage_sentimentLeft_Uh6NW",ls="communicator_PlainMessage_sentimentRight_kUWim",cs="communicator_PlainMessage_visible_kcCDF";function us(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var ds=function(e){var t=e.markAsReadData,n=e.message,a=t.scrollNode,o=t.itemGlobalInteractionId,i=t.itemInteractionStepId,s=t.isDIDChat,l=t.itemContactId,c=t.interactionItemId,u=n.msgId,d=n.userId,f=ur(n),m=f?n.mediaType:void 0,p=f?n.globalInteractionId:void 0,v=function(e){return ur(e)&&"VOICE_TRANSCRIPT"===e.mediaType}(n)?n.confidence:void 0,h=fr(n),b=h?n.source:void 0,g=h?n.sentiment:void 0,j=h?n.isRead:void 0,I=h?n.maskedText:void 0,S=h||f?n.msg:void 0,O=(0,te.useChatMessageSanitizer)({message:S,allowedAttributes:nr.CHAT_MESSAGE_ALLOWED_ATTRIBUTES,allowedTags:nr.CHAT_MESSAGE_ALLOWED_TAGS}),C=(0,y.useInnerHTML)(I||O),_=(0,x.useChatSentimentsOn)(c),w=Bi({msgId:u,historyMessageGlobalInteractionId:p,scrollNode:a,mediaType:m,source:b,isRead:j,itemContactId:l,isDIDChat:s,itemInteractionStepId:i,itemGlobalInteractionId:o});return(0,r.jsxs)("div",{"data-message-id":u,"data-global-interaction-id":null!=p?p:"current",ref:w,children:[d&&g&&(0,r.jsx)(L.Sentiment,{sentiment:g,className:M(us({},cs,_),ss)}),d&&v&&(0,r.jsx)(os,{confidence:v}),(0,r.jsx)("span",{dangerouslySetInnerHTML:C,className:is,"data-testid":"message-content"}),!d&&g&&(0,r.jsx)(L.Sentiment,{sentiment:g,className:M(us({},cs,_),ls)}),!d&&v&&(0,r.jsx)(os,{confidence:v})]})},fs=function(){var e=(0,c.useLocalizationState)().t,t=function(){var e=(0,c.useLocalizationState)().t;return(0,a.useCallback)((function(t){switch(t){case"external_chat_file_received":return e.EXTERNAL_CHAT.file();case"external_chat_contact_received":return e.EXTERNAL_CHAT.contact();case"external_chat_url_received":return e.EXTERNAL_CHAT.url();default:return null}}),[e.EXTERNAL_CHAT])}();return(0,a.useCallback)((function(n){var a='"'.concat(n.partyName,'"');if(n.needLocalization&&n.eventType&&n.partyName&&n.msg)switch(n.eventType){case"external_chat_party_joined_new":case"external_chat_party_left_new":return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"font-semibold caption-s text-neutral-on-secondary",children:n.partyName}),(0,r.jsx)("span",{className:"caption-s text-neutral-fade",children:n.msg})]});case"external_chat_party_coaching":return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"font-semibold caption-s text-neutral-on-secondary",children:n.partyName}),(0,r.jsx)("span",{className:"caption-s text-neutral-fade",children:e.EXTERNAL_CHAT.external_chat_party_coaching_new()})]});case"external_chat_file_received":case"external_chat_contact_received":case"external_chat_url_received":return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"caption-s text-neutral-fade",children:t(n.eventType)}),(0,r.jsx)("span",{className:"font-semibold caption-s text-neutral-on-secondary",children:a}),(0,r.jsx)("span",{children:e.EXTERNAL_CHAT.received()})]});case"external_chat_file_sent":return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"caption-s text-neutral-fade",children:e.EXTERNAL_CHAT.external_chat_file_sent_new()}),(0,r.jsx)("span",{className:"font-semibold caption-s text-neutral-on-secondary",children:a})]});default:return(0,r.jsx)("span",{className:"caption-s text-neutral-fade",children:n.msg})}}),[t,e.EXTERNAL_CHAT])},ms=function(e){var t=e.message,n=fs(),o=(0,a.useCallback)((function(e){switch(e.eventType){case"external_chat_party_joined_new":return"whisper"!==e.qmMode?(0,r.jsx)(j.IconJoin,{className:"size-4 icon-default"}):null;case"external_chat_party_left_new":return(0,r.jsx)(j.IconLeaveParty,{className:"size-4 icon-default"});default:return null}}),[]);return(0,r.jsx)("div",{className:"flex items-center justify-center pb-2.5",children:(0,r.jsx)("div",{className:"flex flex-col","data-testid":"message-item","data-system":"true",children:(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[o(t),(0,r.jsx)("div",{className:"flex items-center gap-1",children:n(t)})]})})})},ps=o().memo((function(e){var t=e.message,n=e.scrollNode,o=e.itemInteractionStepId,i=e.itemContactId,s=e.isDIDChat,l=e.itemGlobalInteractionId,c=e.interactionItemId,u=(0,a.useMemo)((function(){return{scrollNode:n,itemInteractionStepId:o,itemContactId:i,isDIDChat:s,itemGlobalInteractionId:l,interactionItemId:c}}),[c,s,i,l,o,n]),d=(0,a.useMemo)((function(){if(!vr(t))return Ar(t)}),[t]);if(vr(t))return(0,r.jsx)(Li,{itemId:c,direction:"outgoing",message:t});if(cr(t))return(0,r.jsx)(Ri,{message:t});if(dr(t))return(0,r.jsx)(yi,{message:t});if(function(e){return ur(e)&&"OUTBOUND_MESSAGING"==e.serviceType}(t))return(0,r.jsx)(rs,{message:t});if(br(t))return(0,r.jsx)(ri,{messageClassName:"w-full",className:"min-w-[300px]",message:t,children:t.msg});if(function(e){return ur(e)&&"EMAIL"==e.mediaType}(t))return(0,r.jsx)(ri,{message:t,children:t.msg});if(fr(t)){if(function(e){return fr(e)&&"system"===e.displayType}(t))return(0,r.jsx)(ms,{message:t});if(function(e){return fr(e)&&"invite"===e.displayType}(t))return(0,r.jsx)(ts,{message:t});if(Nr(t))return(0,r.jsx)(ri,{message:t,children:t.msg});if(function(e){return fr(e)&&"location"===e.displayType}(t)){var f=t.page,m=t.longitude,p=t.latitude;return(0,r.jsx)(ri,{message:t,children:(0,r.jsx)(ns,{link:f,longitude:m,latitude:p})})}var v=t.page,h=t.title,b=t.partyId;if(v)return(0,r.jsx)(ri,{message:t,isFullWidth:!0,withoutBorder:!0,messageClassName:"w-full !border-none !bg-transparent after:content-none before:content-none",children:(0,r.jsx)(as,{link:v,title:h,partyId:b})})}return d?(0,r.jsx)(es,{markAsReadData:u,message:t,fileData:d}):function(e){return ur(e)&&"REMOTE_ASSIST"==e.mediaType}(t)?(0,r.jsx)(ri,{message:t,children:t.msg}):(0,r.jsx)(ri,{message:t,children:(0,r.jsx)(ds,{message:t,markAsReadData:u})})})),vs=(0,r.jsx)(vi,{children:"Broken message"}),hs=o().memo((function(e){var t,n=e.itemId,o=e.contactId,s=e.scrollNode,l=e.interactionStepId,c=e.messages,u=e.type,d=(0,i.useInteractionProp)(n,(function(e){var t,n;return null!==(n=null==e||null===(t=e.scenarioData)||void 0===t?void 0:t.isDID)&&void 0!==n&&n})),f=null!==(t=(0,i.useInteractionProp)(n,X.getGlobalInteractionId))&&void 0!==t?t:"",m=(0,a.useCallback)((function(e){return mr(e)&&!vr(e)?null:(0,r.jsx)("div",{"data-message":"true",children:(0,r.jsx)(L.ErrorBoundary,{fallback:vs,children:(0,r.jsx)(ps,{message:e,scrollNode:s,interactionItemId:n,itemContactId:o,itemInteractionStepId:l,itemGlobalInteractionId:f,isDIDChat:d})})})}),[o,f,l,d,n,s]);return(0,r.jsx)(li,{itemId:n,contactId:o,type:u,messages:c,renderMessage:m,scrollNode:s},"".concat(n,"_").concat(u))}));const bs="communicator_ExternalMessages_messagesContainer_mpPuU",ys="communicator_ExternalMessages_messages_istRY";function gs(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function js(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||Ss(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Is(e){return function(e){if(Array.isArray(e))return gs(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Ss(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ss(e,t){if(e){if("string"==typeof e)return gs(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?gs(e,t):void 0}}var Os=o().memo((function(e){var t=e.itemId,n=(0,x.useInteractionUIChatScrollerApi)(t),o=js((0,a.useState)(null),2),s=o[0],l=o[1],c=(0,x.useInteractionUIChatType)(t),u=(0,i.useInteraction)(t),d=(0,X.getContactId)(u),f=(0,X.getInteractionStepId)(u),m=Da(t),p=(0,a.useMemo)((function(){switch(c){case"calls":return m.voice;case"messages":return m.chat;default:return Is(m.voice).concat(Is(m.chat))}}),[m.chat,m.voice,c]),v=function(e,t,n){var r,o,i=arguments.length>3&&void 0!==arguments[3]?arguments[3]:Ro,s={messages:"chat",calls:"voice",all:"all",transcript:"all"},l=to(),c=ko(t,n),u=lo(n).normalizedChatMessages,d=(0,st.useContactsState)("activityHistory"),f=null===(o=d[t])||void 0===o||null===(r=o.activityCreatedTimeByMedia)||void 0===r?void 0:r[s[e]],m=ro(t,f);return(0,a.useMemo)((function(){var t=Fo((0,$.orderBy)(Lo(c).concat(Lo(i),Lo(m),Lo(u)),"timestamp"),e,f);return{messagesWithDates:l(t,Bo,Uo)}}),[i,c,m,u,e,f,l])}(c,d,t,p).messagesWithDates,h=(0,i.useInteractionProp)(t,X.isAfterCallWork),b=(0,a.useMemo)((function(){return v.filter(xs).map(gr)}),[v]),g=(0,y.useAsRef)(b),j=(0,a.useCallback)((function(){return g.current}),[g]),I=(0,a.useCallback)((function(e,t){"keys"===t&&(null==n||n.scrollTo(e,"center"))}),[n]);return(0,r.jsxs)(L.SelectionContainer,{startFrom:"bottom",className:bs,itemsListProvider:j,onItemSelect:I,children:[!h&&(0,r.jsx)(Xa,{itemId:t}),(0,r.jsx)("div",{ref:l,className:ys,children:(0,r.jsx)(ja,{messages:v,interactionId:t,scrollContainer:s,withMaskAction:!0,children:(0,r.jsx)(hs,{messages:v,scrollNode:s,itemId:t,contactId:d,type:c,interactionStepId:f})})}),(0,r.jsx)(eo,{itemId:t,scrollNode:s})]})}));function xs(e){return!!mr(e)||!(pr(e)||ur(e)&&"REMOTE_ASSIST"===e.mediaType)}function Cs(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _s(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Cs(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Cs(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var ws=function(){},Ns={search:"",setSearch:ws,searchResult:void 0,setSearchResult:ws,showBotSuggestions:!0,toggleBotSuggestions:ws,showSMS:!0,toggleSMS:ws,showTranscript:!0,toggleTranscript:ws},As=(0,wn.createContext)(Ns);As.displayName="VoiceTranscriptUIContext";var Ps=function(e){var t=e.children,n=_s((0,a.useState)(Ns.search),2),o=n[0],i=n[1],s=_s((0,a.useState)(void 0),2),l=s[0],c=s[1],u=(0,y.useBoolean)(Ns.showBotSuggestions),d=u.value,f=u.toggle,m=(0,y.useBoolean)(Ns.showSMS),p=m.value,v=m.toggle,h=(0,y.useBoolean)(Ns.showTranscript),b=h.value,g=h.toggle,j=(0,a.useMemo)((function(){return{search:o,setSearch:i,searchResult:l,setSearchResult:c,showBotSuggestions:d,toggleBotSuggestions:f,showSMS:p,toggleSMS:v,showTranscript:b,toggleTranscript:g}}),[o,l,d,p,b,f,v,g]);return(0,r.jsx)(As.Provider,{value:j,children:t})};function Es(){return(0,wn.useContext)(As)}function Ds(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ts(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||Ms(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ks(e){return function(e){if(Array.isArray(e))return Ds(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Ms(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ms(e,t){if(e){if("string"==typeof e)return Ds(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ds(e,t):void 0}}var Ls=function(e){var t=e.className,n=e.messagesContent,o=e.itemId,i=(0,c.useLocalizationState)().t,s=Es(),l=s.search,u=s.setSearch,d=s.setSearchResult,f=s.showBotSuggestions,m=s.showSMS,p=s.showTranscript,v=s.toggleBotSuggestions,h=s.toggleSMS,b=s.toggleTranscript,y=Ts((0,a.useState)(l),2),g=y[0],I=y[1],S=Ts((0,a.useState)(void 0),2),O=S[0],C=S[1],_=(0,x.useInteractionUIChatScrollerApi)(o),w=(0,a.useMemo)((function(){return(0,$.debounce)((function(e){u(e)}),500)}),[u]),N=(0,a.useMemo)((function(){return l?Object.entries(n).reduce((function(e,t){var n=Ts(t,2),r=n[0],a=n[1].marksCount;return ks(Array.from({length:a}).map((function(e,t){return{messageId:r,index:t}})).reverse()).concat(ks(e))}),[]):[]}),[l,n]);(0,a.useEffect)((function(){w(g)}),[g,w]),(0,a.useEffect)((function(){if(O){var e=N[O-1];d(e),e&&e.messageId&&(null==_||_.scrollTo(e.messageId,"center"))}else d(void 0)}),[N,_,O,d]);var A=(0,a.useCallback)((function(e){C(e)}),[]),P=(0,a.useCallback)((function(e){I(e.target.value),C(1)}),[]);return(0,r.jsxs)("div",{className:M("flex items-center gap-2 px-4 py-2 bg-primary-background",t),children:[(0,r.jsx)(j.SearchField,{value:g,onChange:P,layoutClassName:"grow",placeholder:i.EXTERNAL_CHAT.search_transcript()}),!!g&&(0,r.jsx)(L.SearchResultsSwitcher,{current:O||0,total:N.length,onChange:A}),(0,r.jsxs)("div",{className:"flex items-center gap-0.5",children:[(0,r.jsx)(j.ButtonIcon,{size:"40",disabled:!f,onClick:v,className:"rounded-xs",tooltip:i.VOICE_TRANSCRIPT.bot_suggestion_btn_tooltip(),children:(0,r.jsx)(j.IconIntentFilled,{className:"size-6 icon-disabled"})}),(0,r.jsx)(j.ButtonIcon,{size:"40",disabled:!m,onClick:h,className:"rounded-xs",tooltip:i.VOICE_TRANSCRIPT.sms_btn_tooltip(),children:(0,r.jsx)(j.IconMessageExternal,{className:"size-6 icon-disabled"})}),(0,r.jsx)(j.ButtonIcon,{size:"40",tooltip:i.VOICE_TRANSCRIPT.transcript_btn_tooltip(),disabled:!p,onClick:b,className:"rounded-xs",children:(0,r.jsx)(j.IconVoiceTranscript,{className:"size-6 icon-disabled"})})]})]})};const Rs="communicator_VoiceTranscript_selectionContainer_ftUaB",Fs="communicator_VoiceTranscript_mark_t17ja",Bs="communicator_VoiceTranscript_highlighted_6A15l";function Us(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function zs(e){return function(e){if(Array.isArray(e))return Us(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Us(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Us(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Hs(e){var t=e.chatMessages,n=e.voiceTranscript,r=e.botSuggestions,o=Es(),i=o.showBotSuggestions,s=o.showTranscript,l=o.showSMS;return(0,a.useMemo)((function(){return(l?(0,$.orderBy)(zs(n).concat(zs(r),zs(t.filter((function(e){return"message"===e.displayType||"error"===e.displayType})).map(Ti))),"endTime"):zs(n)).filter((function(e){return t=e.type,{voiceTranscriptMessage:s,suggestion:i,chatMessage:l}[t];var t}))}),[r,t,i,l,s,n])}function Vs(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Gs(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Ws(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var qs=function(e){var t=e.itemContactId,n=void 0===t?"":t,a=e.itemInteractionStepId,o=void 0===a?"":a,i=e.scrollNode,s=e.isDIDChat,l=e.message,c=Ws(e,["itemContactId","itemInteractionStepId","scrollNode","isDIDChat","message"]),u=Bi({msgId:l.msgId,itemInteractionStepId:o,itemContactId:n,scrollNode:i,source:l.chatMessageData.source,isRead:l.chatMessageData.isRead,isDIDChat:s});return(0,r.jsx)(Ei,Gs(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Vs(e,t,n[t])}))}return e}({message:l},c),{ref:u}))},Ys=function(e){var t=e.messageId,n=e.children,o=Es().searchResult,i=(0,a.useRef)(null);return(0,a.useEffect)((function(){if(i.current&&o&&o.messageId===t){var e,n,r=null===(e=i.current.querySelectorAll("mark"))||void 0===e?void 0:e[o.index];r.classList.add(Bs);var a=null===(n=i.current.querySelectorAll("mark"))||void 0===n?void 0:n[o.index];return null==a||a.scrollIntoView({block:"center"}),function(){return r.classList.remove(Bs)}}}),[t,o]),(0,r.jsx)("div",{ref:i,"data-message-highlight":t,children:n})},Ks=o().memo((function(e){var t=e.itemId,n=e.contactId,o=e.scrollNode,s=e.messages,l=e.interactionStepId,c=e.messagesContent,u=(0,i.useInteractionProp)(t,(function(e){var t,n;return null!==(n=null==e||null===(t=e.scenarioData)||void 0===t?void 0:t.isDID)&&void 0!==n&&n})),d=(0,a.useCallback)((function(e){if(!mr(e))return null;var a=gr(e),i=c[a];if(!i)return null;var s=e.isSelf||"suggestion"===e.type?"outgoing":"incoming";return(0,r.jsx)(Ys,{messageId:a,children:(0,r.jsx)("div",{"data-message":"true",children:(0,ar.isCurrentChatTranscriptMessage)(e)?(0,r.jsx)(qs,{isDIDChat:u,scrollNode:o,itemContactId:n,itemInteractionStepId:l,direction:s,itemId:t,message:e,content:i.content,isLink:i.isLink,isHtml:i.isHTML}):(0,r.jsx)(Ei,{direction:s,itemId:t,message:e,content:i.content,isLink:i.isLink,isHtml:i.isHTML})})})}),[n,l,u,t,c,o]);return(0,r.jsx)(li,{itemId:t,contactId:n,type:"transcript",messages:s,renderMessage:d,scrollNode:o},"".concat(t,"_transcript"))}));function $s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Xs(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return $s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return $s(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Qs=[],Zs=[],Js=[],el=function(e){var t=e.chatMessages,n=void 0===t?Qs:t,o=e.voiceTranscript,s=void 0===o?Zs:o,l=e.botSuggestions,c=void 0===l?Js:l,u=e.itemId,d=e.className,f=e.filtersClassName,m=(0,x.useInteractionUIChatScrollerApi)(u),p=Xs((0,a.useState)(null),2),v=p[0],h=p[1],b=(0,i.useInteraction)(u),g=(0,X.getContactId)(b),j=(0,X.getInteractionStepId)(b),I=Hs({voiceTranscript:s,chatMessages:n,botSuggestions:c}),S=function(e,t){var n=Es().search;return(0,a.useMemo)((function(){return e.reduce((function(e,r){var a=r.format,o=void 0===a?"TEXT":a,i=gr(r),s=r.text;(0,ar.isCurrentChatTranscriptMessage)(r)&&(s=(0,te.normalizeByUrlParser)(r.text));var l="TEXT"===o?s:Di({text:r.text,target:t,url:r.suggestionURL||""}),c=(0,se.highlightHTML)({html:l,textToHighlight:n,className:Fs}),u=(c.match(new RegExp((0,$.escapeRegExp)(Fs),"g"))||[]).length;return e[i]={content:c,marksCount:u,isLink:(0,ar.isLinkSuggestion)(r),isHTML:(0,ar.isHTMLSuggestion)(r)},e}),{})}),[t,e,n])}(I,u),O=(0,a.useMemo)((function(){return I.map(gr)}),[I]),C=(0,y.useAsRef)(O),_=(0,a.useCallback)((function(){return C.current}),[C]),w=(0,a.useCallback)((function(e){null==m||m.scrollTo(e,"center")}),[m]);return(0,r.jsxs)("div",{className:M("flex h-full flex-col",d),children:[(0,r.jsx)(Ls,{className:f,messagesContent:S,itemId:u}),(0,r.jsx)(L.SelectionContainer,{startFrom:"bottom",className:"mt-1 flex h-0 flex-auto flex-col",itemsListProvider:_,onItemSelect:w,children:(0,r.jsx)("div",{className:"relative mr-1.5 flex-auto overflow-y-auto overflow-x-hidden pl-4 pr-2",ref:h,children:(0,r.jsx)(ja,{messages:I,interactionId:u,scrollContainer:v,children:(0,r.jsx)(Ks,{itemId:u,contactId:g,messages:I,interactionStepId:j,scrollNode:v,messagesContent:S})})})})]})},tl=o().memo((function(e){var t=e.itemId,n=(0,i.useInteractionStateSelector)((function(e){return(0,X.getAssociatedCallItem)({item:e.items.find((function(e){return e.id===t})),items:e.items})})),a=Ea(t),o=so(t).messagesList;return n?(0,r.jsx)(Ps,{children:(0,r.jsx)(el,{botSuggestions:a,voiceTranscript:null==n?void 0:n.voiceTranscript,chatMessages:o,itemId:null==n?void 0:n.id})}):null})),nl=n(4031),rl=n(3156);var al=o().memo((function(e){var t,n,o=e.disabled,l=(0,s.useInteractionId)();!function(){var e=(0,s.useInteractionId)(),t=(0,i.useAssociatedChatInteractionProp)(e,X.getChannel),n=(0,i.useAssociatedChatInteractionProp)(e,(function(e){var t;return null==e||null===(t=e.displayData)||void 0===t?void 0:t.number})),r=(0,i.useAssociatedChatInteractionProp)(e,X.hasMultiplyPhones),o=tr(),l=o.isTouched,c=o.setIsTouched,u=o.channelOptions,d=o.setSelectedChannel,f=(0,a.useMemo)((function(){return t?r?e():u.find((function(e){return e.value===t})):r&&n?e():u.find((function(e){return"sms"===e.value}));function e(){return u.find((function(e){var r;return t&&"sms"!==t?e.value===t:new RegExp(null!==(r=(0,$.escapeRegExp)(n))&&void 0!==r?r:"").test(e.value)}))||u[0]}}),[t,r,n,u]),m=l(e);(0,a.useEffect)((function(){!m&&f&&d(e,f)}),[m,f,e,c,d])}();var c=tr(),u=c.channelOptions,d=c.getSelectedChannel,f=c.getSelectedPhone,m=c.setSelectedChannel,p=f(l),v=d(l);(0,a.useEffect)((function(){!u.length||(null==v?void 0:v.value)&&!u.every((function(e){return e.value!==v.value}))||m(l,u[0])}),[u,l,null==v?void 0:v.value,m]);var h=(0,y.useBoolean)();if((0,y.useEscapeManager)(h.setFalse,{enabled:h.value}),!u.length)return null;var b,g=(0,L.getChannelImageIcon)(null==v?void 0:v.value),I=o||u.length<2&&(null!==(b=null===(n=u[0])||void 0===n||null===(t=n.phones)||void 0===t?void 0:t.length)&&void 0!==b?b:0)<2;return(0,r.jsx)(j.TriggerDropdown,{open:h.value,onOpenChange:h.toggle,disabled:I,className:"min-w-[168px]",modal:!1,side:"top",onEscapeKeyDown:function(e){e.stopPropagation()},align:"start","data-testid":"channel-selector",options:(0,r.jsx)(r.Fragment,{children:u.map((function(e){var t=function(){var t=(0,L.getChannelImageIcon)(e.value);return(0,r.jsxs)(r.Fragment,{children:[t&&(0,r.jsx)(t,{className:"icon-neutral"}),e.text]})};return e.phones?(0,r.jsxs)(j.TriggerDropdown.Sub,{children:[(0,r.jsx)(j.TriggerDropdown.SubTrigger,{contentClassName:"flex items-center gap-2",children:t()}),(0,r.jsx)(j.TriggerDropdown.SubContent,{children:e.phones.map((function(t){return(0,r.jsx)(j.TriggerDropdown.Item,{asChild:!1,"data-selected":t.id===(null==p?void 0:p.id),"aria-selected":t.id===(null==p?void 0:p.id),onClick:function(){m(l,e,t.id)},children:(0,r.jsx)(L.PhoneOption,{value:t.phone,type:t.type})},t.id)}))})]},e.value):(0,r.jsx)(j.TriggerDropdown.Item,{onClick:function(){m(l,e)},asChild:!1,contentClassName:"flex gap-2",children:t()},e.value)}))}),children:(0,r.jsxs)(j.CircleButton,{className:"group flex w-auto shrink-0 gap-0.5 p-[7.5px]",children:[g&&(0,r.jsx)(g,{}),!I&&(0,r.jsx)(j.IconArrowDown8,{className:"group-data-[state=open]:rotate-180"})]})})}));function ol(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function il(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||ll(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function sl(e){return function(e){if(Array.isArray(e))return ol(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||ll(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ll(e,t){if(e){if("string"==typeof e)return ol(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ol(e,t):void 0}}function cl(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ul(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return cl(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return cl(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var dl="chat-input",fl=o().memo((function(e){var t,n,o=e.currentMessage,s=e.handleKeyDown,u=e.handleChange,d=e.disabled,f=e.isExternalChat,m=e.interactionStepId,p=e.sendCurrentMessage,v=e.itemId,h=Vn("isAttachmentsListReady"),b=(0,i.useInteraction)(v);(0,l.assertDefined)(b);var g="potential"===(null==b?void 0:b.itemKind)&&(!b.contactId&&!(null==b||null===(t=b.displayData)||void 0===t?void 0:t.number)),I=(0,c.useLocalizationState)().t,S=function(e,t){var n=t.interactionStepId,r=void 0===n?"":n,o=t.isExternalChat,i=il((0,a.useState)(0),2),s=i[0],l=i[1],c=il((0,a.useState)(!1),2),u=c[0],d=c[1],f=il((0,a.useState)(!1),2),m=f[0],p=f[1],v=(0,Yt.useInteractionChatStateMethods)(),h=v.sendAgentIsTyping,b=v.sendAgentIsNotTyping;return(0,a.useEffect)((function(){if(o){var e=setInterval((function(){l((function(e){return e+1}))}),1e3);return function(){return clearInterval(e)}}}),[o]),(0,a.useEffect)((function(){var t;if(o)return u||(d(!0),p(!1)),l(0),m||(e.filter(Boolean).length&&h(r),p(!0),t=setTimeout((function(){p(!1)}),5e3)),function(){return clearTimeout(t)}}),sl(e).concat([o])),(0,a.useEffect)((function(){o&&s>10&&u&&(b(r),d(!1))}),[u,r,b,s,o]),o?function(){d(!1),b(r)}:function(){}}([o],{interactionStepId:m,isExternalChat:f}),O=null===(n=(0,tr().getSelectedChannel)(v))||void 0===n?void 0:n.value.startsWith("sms"),x=function(e){var t=(0,i.useInteractionProp)(e,X.getInteractionStepId),n=Vn("getAttachmentsList");return(0,a.useMemo)((function(){return n(t)}),[n,t])}(v),C=!h(null!=m?m:"")||(0,X.isAfterCallWork)(b)||g||!o.trim()&&!x.length,_=Vn("removeAttachment"),w=(0,a.useRef)(null),N=function(e){var t=ul((0,a.useState)(!1),2),n=t[0],r=t[1],o=(0,y.useResizeObserver)(e);return(0,a.useEffect)((function(){var e,t;if(o){var n=(e=o.target,t=parseFloat(window.getComputedStyle(e).lineHeight)||0,isNaN(t)?0:t),a=function(e){return e.clientHeight}(o.target);r(a>n)}}),[o]),n}(w);return(0,l.assertDefined)(m),(0,r.jsx)(j.FieldFrame,{disabled:d,contentClassName:"p-0 overflow-hidden",className:"max-h-36 flex-auto items-end overflow-hidden px-2 py-1.5","data-testid":"chat-text-area",children:(0,r.jsxs)("div",{className:"flex flex-auto flex-col gap-1 overflow-hidden",children:[(0,r.jsx)(L.AttachmentsList,{className:M("flex flex-wrap gap-1 overflow-auto",{"flex-nowrap":N}),list:x,removeAttachment:_,attachmentsListGroupId:m}),(0,r.jsxs)("div",{className:"flex cursor-text items-end overflow-hidden",children:[(0,r.jsx)(L.ContentEditable,{ref:w,"data-testid":"chat-text-area-input",onKeyDown:s,onChange:u,onBlur:S,className:"h-full w-full overflow-auto",placeholder:I.INTERNAL_CHAT.message_input_placeholder(),plainTextOnly:O,"data-id":dl,value:o,disabled:d}),(0,r.jsx)(j.CircleButton,{className:M("size-6 state-layer-bg-primary-600","hover:state-layer-mix-dark-on-teal-1","focus-visible:state-layer-mix-dark-on-teal-2","active:state-layer-mix-dark-on-teal-3",{"bg-primary-container-disabled":C}),onClick:p,tooltip:{content:I.EXTERNAL_CHAT.send_message_btn_tooltip()},disabled:C,"data-testid":"send-button",children:(0,r.jsx)(j.IconSendFilled,{className:M("size-4 icon-reversed",{"icon-disabled":C})})})]})]})})}));function ml(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function pl(e,t,n,r,a,o,i){try{var s=e[o](i),l=s.value}catch(c){return void n(c)}s.done?t(l):Promise.resolve(l).then(r,a)}function vl(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){pl(o,r,a,i,s,"next",e)}function s(e){pl(o,r,a,i,s,"throw",e)}i(void 0)}))}}function hl(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ml(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ml(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function bl(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(s){o=[6,s],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var yl=function(e){var t=e.disabled,n=void 0!==t&&t,o=e.chatItem,i=e.buttonElementAtom,s=(0,Ta.useSetAtom)(i),u=Vn(["addAttachment","fileRejections","setFileRejections","isAttachmentsListReady","getAttachmentsList"]),d=u.addAttachment,f=u.fileRejections,m=u.setFileRejections,p=u.isAttachmentsListReady,v=u.getAttachmentsList,h=(0,X.isPotentialInteraction)(o)||(0,X.isCall)(o),b=(0,X.getInteractionStepId)(o),g=(0,c.useLocalizationState)().t,j=(0,ie.useModalComponentOpener)(za),I=(0,a.useCallback)((function(e){var t=function(){var t=e.target;return t.files?Array.from(t.files):[]};!function(){var e=t();if(e){var n=(0,$.partial)(Sr,g),r=(0,l.truthy)(e.map(n)),a=e.filter((0,y.not)(n));r.length&&j({rejection:r,totalFilesAmount:e.length}),b&&a.forEach((0,$.partial)(d,b))}}()}),[d,b,j,g]);(0,a.useEffect)((function(){p(b)&&f.length&&j({rejection:f,onCloseCallback:function(){return m([])},totalFilesAmount:v(b).length+f.length})}),[f,v,b,p,j,m]),(0,y.useDidUnmount)((function(){s(null),m([])}));var S=Wa({chatItem:o}),O=(0,a.useCallback)(vl((function(){return bl(this,(function(e){return h?[2,{selectFiles:S()}]:[2,{selectFiles:!0}]}))})),[S,h]),x=hl((0,a.useState)(null),2),C=x[0],_=x[1];return(0,a.useEffect)((function(){s(C)}),[C,s]),(0,r.jsx)(jl,{ref:function(e){var t,n;t=e,((null!=(n=HTMLButtonElement)&&"undefined"!=typeof Symbol&&n[Symbol.hasInstance]?n[Symbol.hasInstance](t):t instanceof n)||null===e)&&_(e)},onFileInputClick:O,handleUploadFiles:I,isDisabled:n})},gl=o().forwardRef((function(e,t){var n=e.onFileInputClick;return(0,r.jsx)("button",{onClick:n,ref:t,className:"invisible absolute z-[-1] w-0"})})),jl=(0,L.withFileInput)(gl),Il=n(2952),Sl=n(3941);function Ol(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function xl(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Cl(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function _l(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||Nl(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function wl(e){return function(e){if(Array.isArray(e))return xl(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Nl(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Nl(e,t){if(e){if("string"==typeof e)return xl(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?xl(e,t):void 0}}function Al(e){var t,n,r,o,s,l,u,d=_l((0,Ta.useAtom)(La),2),f=d[0],m=d[1],p=e.itemId,v=e.serviceId,h=_l((0,Ta.useAtom)(Ma),2),b=h[0],g=h[1],j=_l((0,Ta.useAtom)(ka),2),S=j[0],O=j[1],C=(0,I.useNotificationsState)("methods"),_=C.showNotification,w=C.hideNotificationById,N=C.hideNotificationsByTag,A=(0,Ha.useErrorValidation)(),P=tr(),D=P.getSelectedChannel,T=P.getSelectedPhone,k=null===(t=D(p))||void 0===t?void 0:t.value,M=(0,st.useContactsState)("contacts"),R=(0,on.useIsOffline)(),F=(0,on.useOfflineStateMethods)().setShowOfflineAlert,B=(0,c.useLocalizationState)("t").ERROR_MESSAGES,U=(0,i.useInteraction)(p),z=null!==(l=null==U?void 0:U.id)&&void 0!==l?l:"",H=(0,X.getMessengers)(M,U),V=(0,X.getInteractionStepId)(U),G=(0,i.useInteractionStateMethods)().initiateChat,W=(0,Yt.useInteractionChatStateMethods)(),q=W.sendMessage,Y=W.addMessageToPending,K=W.sendFile,Q=W.openChannel,Z=(0,x.useInteractionUIState)(),J=Z.getItemState,ee=Z.setItemState,te=Vn(["clearAttachmentsList","getAttachmentsList","isAttachmentsListReady"]),ne=te.clearAttachmentsList,re=te.getAttachmentsList,ae=te.isAttachmentsListReady,oe=(0,xn.useServiceState)().selectedService,ie=(0,Il.useDidState)("didNumbers"),le=(0,On.useDIDNumberState)().selectedDIDNumber,ce=(0,X.isCall)(U)&&(null==U||null===(n=U.callData)||void 0===n?void 0:n.incoming)?U.callData.fromNumber:null==U||null===(r=U.callData)||void 0===r?void 0:r.destination,ue=(null===(o=T(p))||void 0===o?void 0:o.phone)||(0,X.getPhoneFromItem)(U),de=ce===ue,fe=(0,a.useMemo)((function(){if((0,X.isCall)(U))if((0,X.isOutboundInteraction)(U)){var e,t=(null==U?void 0:U.accessNumberId)&&(null===(e=ie[U.accessNumberId])||void 0===e?void 0:e.isSMS);if(de&&t)return U.accessNumberId}else{var n,r;if((null==U||null===(n=U.scenarioData)||void 0===n?void 0:n.isDID)&&(!le||(null===(r=ie[le])||void 0===r?void 0:r.isSMS))){var a=!0,o=!1,i=void 0;try{for(var s,l=Object.keys(ie)[Symbol.iterator]();!(a=(s=l.next()).done);a=!0){var c=s.value;if(ie[c].isSMS)return c}}catch(Iw){o=!0,i=Iw}finally{try{a||null==l.return||l.return()}finally{if(o)throw i}}}}return le}),[U,ie,de,le]),me=(0,X.getServiceId)(U),pe=v||(de?me:oe),ve=(0,Bt.useServicesDispositionsState)().services,he=(0,X.getAssociatedChatServiceId)(ve,pe)||(0,X.getAssociatedChatServiceId)(ve,oe),be=null!==(u=null===(s=J(z))||void 0===s?void 0:s.chatMessage)&&void 0!==u?u:"",ye=re(V),ge=(0,a.useCallback)((function(e){ee(z,E()((function(t){t.chatMessage="string"==typeof e?e:e(t.chatMessage)})))}),[z,ee]),je=(0,a.useCallback)((function(){!R&&ge("")}),[R,ge]),Ie=(0,a.useCallback)((function(){var e,t=(0,$.get)(U,"contactId"),n=(null==H||null===(e=H.find((function(e){return e.type===k})))||void 0===e?void 0:e.userId)||ue;if(n&&k)return Y({content:be,channel:k,type:"message"},n),G({channel:k,address:n,serviceId:he,accessNumberId:fe,contactId:t,displayData:null==U?void 0:U.displayData,origination:"interaction"}),je()}),[k,U,H,ue,Y,be,G,he,fe,je]),Se=(0,a.useCallback)((function(){if((0,X.isExternalChat)(U))ae(V)&&(be&&q({content:(0,se.condenseNewLines)(be),itemId:V,channel:k,type:"message"}),ye.length&&(ye.forEach((function(e){e.fileData&&K({fileData:e.fileData,itemId:V,channel:k||"sms"})})),ne(V)),je());else{var e,t=(null==H||null===(e=H.find((function(e){return e.type===k})))||void 0===e?void 0:e.userId)||ue;pe&&U&&he&&k&&t&&(Y({content:be,channel:k,type:"message"},t),G({channel:k,address:t,serviceId:he,contactId:U.contactId,displayData:U.displayData,accessNumberId:fe,origination:"interaction"})),je()}}),[ue,H,k,U,ae,V,be,ye,je,q,ne,K,pe,he,Y,G,fe]),Oe=(0,a.useCallback)((function(){if(be.startsWith("/invite")){var e=be.split(" ");if(2!==e.length)_({id:I.Notifications.ChatChannelInviteBadFormatError,type:"error",message:B.chat_channel_invite_bad_format(),tags:["current-view"],duration:3e4,closable:!0});else{var t=e[1];if(Sl.messengerTypes.includes(t)){var n;w(I.Notifications.ChatChannelInviteBadFormatError),w(I.Notifications.ChatChannelInviteUnknownMessengerError);var r=(null==H||null===(n=H.find((function(e){return e.type===t})))||void 0===n?void 0:n.userId)||ue;me&&r&&Q({channel:t,address:r,interactionStepId:V,serviceId:me}),je()}else _({id:I.Notifications.ChatChannelInviteUnknownMessengerError,type:"error",tags:["current-view"],message:B.chat_channel_invite_unknown_messenger(),duration:3e4,closable:!0})}return!0}}),[H,be,w,V,me,Q,ue,_,je,B]),xe=(0,a.useCallback)((function(){if(R)F(!0);else{if(be){var e,t=null===(e=J(p))||void 0===e?void 0:e.scrollerApi;null==t||t.scrollToLast()}if((0,X.isPotentialInteraction)(U)||(0,X.isCall)(U)){var n=wl(A.getServiceAndDIDNumbersErrors({service:pe,didNumber:fe,interactionType:"sms"})).concat(wl(A.getChannelError({selectedChannel:k})));if(n.length)return void _(n[0]);if(be){var r=A.getMessageErrors({message:be,channel:k||"sms"});if(r.length)return void _(r[0])}return N("interaction-init"),be&&Ie()}var a=A.getMessageErrors({message:be,channel:k||"sms"});if(a.length)_(a[0]);else if(V){if(Oe())return;return(be||ye.length)&&Se()}}}),[R,be,U,k,A,V,F,J,p,pe,fe,N,Ie,_,ye.length,Se,Oe]),Ce=(0,y.useEvent)((function(e){ge((function(t){return t.slice(0,b)+e+t.slice(b+1,S.length)})),O(""),m(void 0);var t=document.querySelector('[data-testid="chat-text-area-input"]');Cl(t,HTMLElement)&&setTimeout((function(){t.focus(),-1===b?(0,L.moveCursorToTheEnd)(t):(0,L.setCursorPosition)(t,b+e.length)}))})),_e=(0,a.useCallback)((function(e){var t=function(){m(void 0),g(-1),O("")},n=Cl(e.target,HTMLElement)?e.target:void 0;if(n){var r=(0,L.getCursorPosition)(n);if(";"===e.key&&(g(r),m("predefinedMessages"))," "===e.key&&r-1===b&&t(),"Escape"===e.key&&"predefinedMessages"===f&&(t(),e.preventDefault(),e.stopPropagation()),"Enter"===e.key){if(e.shiftKey||e.ctrlKey)return;e.preventDefault(),e.stopPropagation(),xe()}}}),[f,m,b,xe,O,g]),we=(0,a.useCallback)((function(e,t){var n=e.target;if((0,se.isHTMLElement)(n)){n.scrollTop=n.scrollHeight;var r=(0,L.getCursorPosition)(n);ge(t),S&&r<=b?(m(void 0),O("")):O("predefinedMessages"===f?t.slice(b+1):"")}}),[f,S,b,m,ge,O]),Ne=function(e,t){return(0,a.useCallback)((function(){var n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:function(e){return e};return function(r){var a=document.querySelector(t);(0,$.flow)(n,(function(n){var r=0,o=null;return e((function(e){var i,s,l,c,u,d,f,m=function(e){return e.getFirstNode()!==e.getLastNode()},p=function(e){return e.getSelectionStartIndex()!==e.getSelectionEndIndex()},v=new y.Selection,h=null==v?void 0:v.getLastNode(),b=(null==h?void 0:h.nodeType)===Node.TEXT_NODE?null==h?void 0:h.parentElement:h,g=null==b?void 0:b.closest(t);return a?(e="<br><br>"===e.substring(e.length-8)?e.substring(0,e.length-4):e,g?v&&h?(function(e){var t;if(m(e))r=null!==(t=e.getSelectionStartIndex())&&void 0!==t?t:0,o=e.getFirstNode();else if(p(e)){var n;r=null!==(n=e.getSelectionStartIndex())&&void 0!==n?n:0,o=e.getFirstNode()}else{var a;r=null!==(a=e.getSelectionEndIndex())&&void 0!==a?a:0,o=e.getLastNode()}}(v),(m(f=v)||p(f))&&f.deleteSelected(),o&&(c=r,d=null!==(u=null==(l=o)?void 0:l.textContent)&&void 0!==u?u:"",l.textContent=(null==d?void 0:d.slice(0,c))+n+(null==d?void 0:d.slice(c))),null!==(s=null===(i=document.querySelector(t))||void 0===i?void 0:i.innerHTML)&&void 0!==s?s:e):e:e+n):e+n})),{nodeToFocus:o,offsetToFocus:r,dataToAdd:n}}),(function(e){var t=e.nodeToFocus,n=e.offsetToFocus,r=e.dataToAdd;Ol(a,HTMLElement)&&(a.focus(),requestAnimationFrame((function(){var e=function(){a&&(t?o(t):a.lastChild&&i(a.lastChild))},o=function(e){var t,a,o=document.createRange();o.setStart(e,n+r.length),o.setEnd(e,n+r.length),null===(t=window.getSelection())||void 0===t||t.removeAllRanges(),null===(a=window.getSelection())||void 0===a||a.addRange(o)},i=function(e){var t,n,r,a,o,i,s=document.createRange();s.setStart(e,null!==(o=null===(t=e.textContent)||void 0===t?void 0:t.length)&&void 0!==o?o:0),s.setEnd(e,null!==(i=null===(n=e.textContent)||void 0===n?void 0:n.length)&&void 0!==i?i:0),null===(r=window.getSelection())||void 0===r||r.removeAllRanges(),null===(a=window.getSelection())||void 0===a||a.addRange(s)};e(),requestAnimationFrame(e)})))}))(r)}}),[t,e])}(ge,'[data-id="'.concat(dl,'"]'));return(0,a.useMemo)((function(){return{handleSelectPredefinedMessage:Ce,sendCurrentMessage:xe,handleKeyDown:_e,currentMessage:be,setCurrentMessage:ge,handleTextareaChange:we,setPredefinedMessagesSearch:O,predefinedMessagesSearch:S,updateMessage:Ne}}),[Ce,S,O,be,ge,we,xe,_e,Ne])}function Pl(e,t,n,r,a,o,i){try{var s=e[o](i),l=s.value}catch(c){return void n(c)}s.done?t(l):Promise.resolve(l).then(r,a)}function El(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(s){o=[6,s],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function Dl(e){var t,n,r=e.itemId,a=e.setCurrentMessage,o=(0,Ta.useAtomValue)(Ra),i=(0,it.useOpenInteractionSlidingModal)(),s=(0,Ta.useSetAtom)(La),l=(0,Ta.useSetAtom)(Ma),u=(0,c.useLocalizationState)("t"),d="mac"===Zt.platformInfo.platform?"\u2318":"Ctrl",f=(0,Gr.useMainPageUIState)("setKBFloatingState"),m=(0,vn.useIsCommunicator)(),p=(0,Wr.useKbBridgeMethods)().setupInteractionKB,v=(t=function(){return El(this,(function(e){return m?i(r,"knowledgeBase"):(f((function(e){return"closed"===e?"floating":e})),p()),[2]}))},n=function(){var e=this,n=arguments;return new Promise((function(r,a){var o=t.apply(e,n);function i(e){Pl(o,r,a,i,s,"next",e)}function s(e){Pl(o,r,a,i,s,"throw",e)}i(void 0)}))},function(){return n.apply(this,arguments)});return[{Icon:j.IconSentimentGood,text:u.EXTERNAL_CHAT.add_emoji(),shortcut:"".concat(d,"E"),onClick:function(){s("emojiPicker")}},{Icon:j.IconAttachment,text:u.EXTERNAL_CHAT.attachment(),shortcut:"".concat(d,"A"),onClick:function(){return null==o?void 0:o.click()}},{Icon:j.IconPredefinedMessage,text:u.EXTERNAL_CHAT.predefined_messages(),shortcut:";",onClick:function(){var e,t,n=document.querySelector('[data-testid="chat-text-area-input"]');e=n,(null!=(t=HTMLElement)&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t)&&(l(n.innerHTML.length),a((function(e){return e+";"})),n.focus(),setTimeout((function(){(0,L.moveCursorToTheEnd)(n)}))),s("predefinedMessages")}},{Icon:j.IconKnowledgeBase,text:u.EXTERNAL_CHAT.knowledge_base(),shortcut:"".concat(d,"K"),onClick:v}]}var Tl=n(7087);var kl=n(1539);const Ml="communicator_ChatForm_smsMessageCounter_MlvOG";function Ll(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Rl(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ll(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ll(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Fl(){var e,t,n=document.querySelector('[data-testid="chat-content"]');if(e=n,null!=(t=HTMLElement)&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?t[Symbol.hasInstance](e):e instanceof t)return n}var Bl=o().memo((function(e){var t=e.itemId,n=e.serviceId,o=(0,nl.useCommunicatorUIState)("interactionChatFormRef"),u=(0,s.useNonAssertedInteractionId)(),d=Al({itemId:t,serviceId:n}),f=d.updateMessage,m=d.handleSelectPredefinedMessage,p=d.sendCurrentMessage,v=d.handleKeyDown,h=d.handleTextareaChange,g=d.setCurrentMessage,S=d.currentMessage,O=(0,Ta.useAtomValue)(ka);!function(e){var t=e.currentMessage,n=e.setCurrentMessage,r=e.itemId,o=e.parseVariables,s=(0,I.useNotificationsState)("methods").hideNotificationsByTag,l=(0,i.useInteractionProp)(r,(function(e){return(0,X.isExternalChat)(e)&&(0,X.isInboundInteraction)(e)})),c=(0,Tl.usePredefinedChatMessageState)().greetings,u=(0,Tl.usePredefinedChatMessageStateMethods)().resetGreeting;(0,a.useEffect)((function(){t?u(r):c[r]&&l&&(n(o(c[r])),u(r))}),[r,t,c,s,o,u,n,l])}({currentMessage:S,setCurrentMessage:g,itemId:t,parseVariables:(0,Jt.useChatResponsesVariablesParser)()});var x=(0,i.useInteractionProp)(t,X.getInteractionStepId),C=(0,i.useInteractionProp)(t,X.isExternalChat),_=function(e,t){var n,r=(0,ln.useAppConfigState)().enableSmsCharacterCount,o=(0,c.useLocalizationState)().t,i=null===(n=(0,tr().getSelectedChannel)(e))||void 0===n?void 0:n.value;return(0,a.useMemo)((function(){if(!r||(null==i?void 0:i.startsWith("sms")))return{enabled:!1,text:""};var e=(0,kl.getCharCount)(t),n=e.msgCount,a=e.charCount,s=e.charsPerSegment;return{enabled:!0,text:1===n?"".concat(a,"/").concat(s):a<1e3?"".concat(a," (").concat(o.EXTERNAL_CHAT.sms_messages_number(n),")"):String(a)}}),[r,i,t,o.EXTERNAL_CHAT])}(t,S),w=_.text,N=_.enabled,A=(0,y.useResizeObserver)(Fl()),P=Rl((0,Ta.useAtom)(La),2),E=P[0],D=P[1],T=(0,i.useAssociatedChatInteraction)(t);(0,l.assertDefined)(T);var k,M=Dl({setCurrentMessage:g,itemId:t}),R=(0,y.useBoolean)();return(0,y.useEscapeManager)((function(){R.setFalse()}),{enabled:R.value}),(0,y.useEscapeManager)((function(){D(void 0)}),{enabled:Boolean(E)}),(0,r.jsxs)("div",{ref:o,className:"flex px-4 py-2.5","data-testid":"chat-bottom-panel",children:[(0,r.jsx)(yl,{chatItem:T,buttonElementAtom:Ra}),N&&(0,r.jsx)("span",{className:Ml,children:w}),(0,r.jsxs)("div",{className:"flex flex-auto items-end gap-2",children:[(0,r.jsxs)("div",{className:"flex h-[33px] items-center gap-2",children:[!!u&&(0,r.jsx)(al,{}),(0,r.jsx)(j.TriggerDropdown,{"data-chat-actions-menu":!0,modal:!1,open:R.value,onOpenChange:R.toggle,className:"group z-10",align:"start",side:"top",options:M.map((function(e){var t=e.Icon,n=e.text,a=e.shortcut,o=e.onClick;return(0,r.jsxs)("button",{onClick:o,className:"flex w-full min-w-[210px] items-center gap-2",children:[(0,r.jsx)(t,{className:"size-4"}),(0,r.jsx)("p",{className:"flex-auto caption-s text-primary-on-primary",children:n}),(0,r.jsx)("p",{className:"caption-s text-neutral-disabled",children:a})]},n)})),children:(0,r.jsx)(j.CircleButton,{children:(0,r.jsx)(j.IconPlus24,{className:"size-4.5"})})})]}),(0,r.jsxs)(b.Root,{open:Boolean(E),onOpenChange:function(e){e||D(void 0)},children:[(0,r.jsx)(b.Trigger,{asChild:!0,className:"flex flex-auto",onClick:function(e){e.preventDefault()},children:(0,r.jsx)("div",{children:(0,r.jsx)(fl,{itemId:t,sendCurrentMessage:p,interactionStepId:x,isExternalChat:C,currentMessage:S,handleKeyDown:v,handleChange:h})})}),(0,r.jsx)(b.Content,{side:"top",align:"start",className:"z-[100] w-[--radix-popover-trigger-width]",sideOffset:5,onOpenAutoFocus:function(e){e.preventDefault()},children:"emojiPicker"===E?(0,r.jsx)(L.EmojiPopup,{onSelectEmoji:function(e){f((function(e){return e}))(e),D(void 0)}}):"predefinedMessages"===E?(0,r.jsx)(rl.ViewPredefinedMessages,{handleSelect:m,search:O,className:"w-[--radix-popover-trigger-width]",style:{maxHeight:(null!==(k=null==A?void 0:A.contentRect.height)&&void 0!==k?k:0)-19}}):null})]})]})]})}));function Ul(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function zl(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Ul(e,t,n[t])}))}return e}var Hl=o().memo((function(e){var t=e.itemId,n=function(e){var t=(0,at.useSessionState)().privileges,n=(0,i.useInteractionProp)(e,X.isPotentialInteraction),r=(0,i.useInteractionProp)(e,X.isQualityManagementItemInMonitorMode),o=(0,i.useInteractionProp)(e,(function(e){return(0,X.isExternalContactCall)(e)&&((0,X.isDelivered)(e)||(0,X.isOnHold)(e))})),s=(0,i.useInteractionProp)(e,(function(e){return(0,X.isExternalChat)(e)&&((0,X.isDelivered)(e)||(0,X.isOnHold)(e))})),l=(0,i.useInteractionProp)(e,(function(e){return(0,X.isExternalChat)(e)&&(0,X.isOutboundInteraction)(e)})),c=(0,i.useInteractionProp)(e,X.isAfterCallWork),u=(0,i.useInteractionProp)(e,X.isNeedToShowWorkitemUI);return(0,a.useMemo)((function(){return!r&&!c&&!u&&(!(!l&&!s)||((null==t?void 0:t.CAN_START_EXTERNAL_CHAT)?n||o:void 0))}),[r,c,u,o,s,l,n,null==t?void 0:t.CAN_START_EXTERNAL_CHAT])}(t),o=Ea(t),s=(0,x.useInteractionUIChatType)(t),l=(0,i.useInteractionProp)(t,X.getContactId),c=(0,st.useContactsState)((function(e){var t,n;return null===(n=e.activityHistory[l])||void 0===n||null===(t=n.activityCreatedTimeByMedia)||void 0===t?void 0:t[function(e){switch(e){case"messages":return"chat";case"calls":return"voice";default:return"all"}}(s)]})),u=Vo(0,l,s);(0,a.useEffect)((function(){c||u()}),[c,u]);var d=function(e){var t=(0,te.useContactActivityHistory)(),n=t.isLoading,r=t.messages,a=n&&!r.length,o=(0,no.useActivitiesState)("activitiesListByContactId")[e],i=!!(null==o?void 0:o.isLoading),s=i&&!(null==o?void 0:o.data.length);return{isLoading:n||i,isInitialLoading:a||s}}(l),f=d.isLoading,m=d.isInitialLoading,p=(0,a.useMemo)((function(){return"transcript"===s?tl:Os}),[s]);return(0,a.useEffect)((function(){return function(){(0,rr.unmountPlayers)({playerGroup:nr.CHAT_VOICE_RECORDING_PLAYER_GROUP})}}),[]),function(e,t,n){var r=(0,i.useInteractionProp)(e,(function(e){return null==e?void 0:e.openedBotSuggestionsUrls})),o=(0,a.useCallback)((function(e){return null==t?void 0:t.filter((function(t){return(0,ar.isLinkSuggestion)(t)&&t.autoOpenURL&&!(null==e?void 0:e[t.suggestionURL])}))}),[t]),s=ir(e);(0,a.useEffect)((function(){!function(){if(n){var e=o(r);null==e||e.forEach(s)}}()}),[r,n,o,s])}(t,o,"all"===s||"transcript"===s||"messages"===s),(0,r.jsxs)("div",{className:"relative flex flex-1 flex-col justify-between overflow-hidden",children:[(0,r.jsxs)("div",{className:"relative flex flex-auto flex-col overflow-hidden bg-secondary-background","data-testid":"chat-content",children:[!m&&f&&(0,r.jsx)(j.Loader,{size:"32",className:"top-[30px] z-10",color:"primary"}),m?(0,r.jsx)(j.Loader,{size:"32",color:"primary",className:"z-10"}):(0,r.jsx)(p,zl({},e))]}),n&&(0,r.jsx)(Bl,zl({},e))]})})),Vl=(0,L.createComponentLoader)("chatCenter",(function(){return n.e(975).then(n.t.bind(n,9975,23))}),"ChatCenterInteraction").ChatCenterInteractionLoader,Gl=o().memo((function(e){var t=e.itemId,n=e.scope,a=(0,i.useInteraction)(t);return Boolean(a&&(a.groupChatId||a.groupChatMembers||a.userId))?(0,r.jsx)(Vl,{scope:n,interactionId:t}):(0,r.jsx)(Hl,{itemId:t})}));function Wl(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ql(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Yl(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var Kl=function(e){var t=e.children,n=e.className,a=Yl(e,["children","className"]);return(0,r.jsxs)("div",ql(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Wl(e,t,n[t])}))}return e}({className:M("flex items-center px-3 py-2 text-sm/[18px] text-chat-title",n)},a),{children:[(0,r.jsx)(ve.IconCogwheel,{className:"mr-4.5 h-6 shrink-0"}),(0,r.jsx)("div",{"data-testid":"content",children:t})]}))},$l=n(6432),Xl={type:"NATIVE"},Ql={recent:{all:Xl,messages:Xl,calls:Xl},directory:{internal:Xl,external:{type:"VIRTUAL"}},favorites:Xl},Zl=function(e){return"recent.".concat(e)},Jl=function(e){return"directory.".concat(e)},ec=function(){return"favorites"},tc=n(4077),nc=["mousemove","click","keydown","scroll"],rc=function(e){var t=e.children,n=(0,tc.useUserActivityStateMethods)().registerActivity,o=(0,a.useMemo)((function(){return(0,$.throttle)(n,5e3)}),[n]);return(0,a.useEffect)((function(){return nc.forEach((function(e){window.addEventListener(e,o)})),function(){nc.forEach((function(e){window.removeEventListener(e,o)}))}}),[o]),(0,r.jsx)(r.Fragment,{children:t})};function ac(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}var oc,ic=[it.SlidingModalContextProvider,er,Hn,On.DIDNumberStateProvider,rc],sc=[s.ActiveInteractionContextProvider,it.SlidingModalContextProvider,function(e){var t=e.children;return(0,$l.useScrollStateProviderBuilder)({children:t,defaultScrollStateData:Ql}).Provider},er,Hn,L.CountrySelectorStateProvider,On.DIDNumberStateProvider,rc],lc=[s.ActiveInteractionContextProvider,xn.ServiceStateProvider].concat(function(e){if(Array.isArray(e))return ac(e)}(oc=sc)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(oc)||function(e,t){if(e){if("string"==typeof e)return ac(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?ac(e,t):void 0}}(oc)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}(),[x.InteractionUIStateProvider,yo.NavigationStateProvider,_n.ADCShortcutsProvider,Cn.UIContextProvider,nl.CommunicatorUIProvider]),cc=n(801),uc=(0,L.createComponentLoader)("calendar",(function(){return n.e(662).then(n.t.bind(n,5662,23))}),"CalendarNavigation","CalendarViewSelect","CalendarViewTitle"),dc=uc.CalendarNavigationLoader,fc=uc.CalendarViewSelectLoader,mc=uc.CalendarViewTitleLoader,pc=o().memo((function(){return(0,r.jsxs)("div",{className:"my-2 grid grid-cols-[150px_1fr_150px] px-4 py-0",children:[(0,r.jsx)(dc,{}),(0,r.jsx)("div",{className:"align-center flex justify-center text-base",children:(0,r.jsx)(mc,{})}),(0,r.jsx)("div",{className:"flex justify-end",children:(0,r.jsx)(fc,{})})]})})),vc=(0,L.createComponentLoader)("calendar",(function(){return n.e(662).then(n.t.bind(n,5662,23))}),"CalendarBody").CalendarBodyLoader,hc=n(4878),bc=function(e){return[e&&e.firstName||"Unidentified",e&&e.lastName||""]},yc=n(2654),gc=function(e){var t=e.title,n=e.size,a=e.children;return(0,r.jsxs)("div",{className:M("flex py-1 align-top text-[15px]",{"text-[13px] text-main":"small"===n}),children:[(0,r.jsx)("div",{className:"inline-block whitespace-nowrap pr-[0.4em] text-main-text-inverted",children:"".concat(t,":")}),(0,r.jsx)("div",{className:"inline-block break-words align-top",children:a})]})},jc=function(e){var t=(0,gt.useFormatting)().formatFullName,n=(0,at.useSessionState)(),o=n.sessionId,i=n.domain,s=n.loginId,l=function(e,t,n){var a=e.event,o=e.firstName,i=e.lastName,s=e.msg,l=e.fileId,u=e.fileName,d=e.fileType,f=t(o,i)||"Chat BOT",m=(0,c.useLocalizationState)().t;switch(a){case"party_joined":return m.CASE_MESSAGE.party_joined(f);case"party_message":return(null==s?void 0:s.includes("<br>"))?"".concat(f,":<br> ").concat(s):"".concat(f,": ").concat(s);case"party_file":if(!l||!u)return;var p=n(l);return"image"===d?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("p",{children:[f,":"]}),(0,r.jsx)(Yi,{fileLink:p,fileName:u,timestamp:e.timestamp,senderName:f})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("p",{children:[f,":"]}),(0,r.jsx)(Ui,{fileName:u,fileLink:p})]});case"party_message_attributes":case"party_changed":case"party_navigation":return"";case"party_left":return m.CASE_MESSAGE.party_left(f)}}(e,t,(0,a.useCallback)((function(e){var t=(0,Fi.paramsToQueryString)({token:o,user:s,tenant:i,id:e,no_disposition:0});return"".concat(Fi.requestUrls.getChatAttachmentDownload,"?").concat(t)}),[i,s,o])),u=(0,a.isValidElement)(l)?l:null,d=(0,te.useChatMessageSanitizer)({message:l}),f=(0,y.useInnerHTML)(d);return(0,r.jsx)(gc,{title:(0,y.formatTime)(e.timestamp),children:u||(0,r.jsx)("span",{dangerouslySetInnerHTML:f})})},Ic=function(e){var t=e.data,n=e.type,a=e.services,o=(0,gt.useFormatting)().formatFullName,i=t.firstName,s=t.lastName,l=t.serviceId,c=t.disposition,u=t.startTime,d=void 0===u?"":u,f=[o(i,s),"dispositioned",n,"interaction",(0,rt.formatDate)(d,{prefixed:!0,full:!0})].filter(Boolean).join(" "),m=(a||[]).find((function(e){return e.serviceId===l}));return(0,r.jsxs)("div",{className:"rounded border border-main p-2 text-lg",children:[(0,r.jsx)("div",{className:"text-main",children:f}),(0,r.jsx)("div",{className:"mb-0.5 mt-1.5",children:c}),m&&(0,r.jsx)(gc,{title:"Service",children:m.serviceName})]})};function Sc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Oc(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function xc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Oc(e,t,n[t])}))}return e}function Cc(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Sc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Sc(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var _c=function(e){var t=e.activity,n=(0,gt.useFormatting)().formatFullName,o=(0,yt.useGetAvatarUrl)(),l=(0,hc.useCaseState)("chats"),c=t.direction,u=t.createdTime,f=t.parties,m=t.services,p=t.globalInteractionId,v="OUTBOUND"===c,h=f.find((function(e){return"USER"!==e.partyType})),b=f.find((function(e){return"USER"===e.partyType})),y=Cc(bc(h),2),g=y[0],j=y[1],I=Cc(bc(b),2),S=I[0],O=I[1],x=v||null==h?void 0:h.contactId,C=v?null==b?void 0:b.userId:void 0,_=(l[p]||{}).data,w=void 0===_?null:_,N=(0,a.useMemo)((function(){return{firstName:g,lastName:j,url:v&&b?o({userId:b.userId}):void 0,isAgent:v}}),[g,j,o,v,b]),A=n(g,j),P=(0,s.useInteractionId)(),E=((0,i.useAssociatedChatInteractionProp)(P,X.getInteractionStepId),T()("relative inline-block bg-[--c-note-content-bg] py-2 pl-2 pr-6","after:absolute after:bottom-0 after:right-0 after:h-0 after:w-0 after:border-[8px]","after:border-b-white after:border-l-[--c-note-border] after:border-r-white after:border-t-[--c-note-border]")),D=(0,r.jsxs)("span",{className:"relative -top-1 text-[0.8em]",children:[(0,r.jsx)(d.SmIcon,{name:"chat"}),(0,rt.formatDate)(u)]}),k=(0,a.useMemo)((function(){return w?function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:[],t=arguments.length>1?arguments[1]:void 0,n={},r=function(e){return void 0!==e};return(e=e.filter((function(e){var t=e.event;return t&&!["party_changed","party_navigation","party_message_attributes"].includes(t)})).map((function(e){var a=e.partyId,o=(0,$.pickBy)(e,r),i=t.find((function(e){return e.partyId===o.partyId}));return o.firstName=(null==i?void 0:i.firstName)||o.firstName,o.lastName=(null==i?void 0:i.lastName)||o.lastName,n[a]=xc({},n[a],o),o}))).map((function(e){return xc({},n[e.partyId],e)}))}(w.messages,f):[]}),[w,f]);return w?(0,r.jsxs)("div",{children:[(0,r.jsx)(yc.ContactListItem,{as:"div",contactId:x,userId:C,avatarProps:N,title:A,body:D,isAlignedToRight:v,isFitted:!0}),(0,r.jsxs)("div",{className:"my-2 rounded bg-note-bg p-2",children:[(0,r.jsx)(gc,{title:"Handled by",size:"small",children:n(S,O)}),k.map((function(e,t){return(0,r.jsx)(jc,xc({},e),t)}))]}),b&&b.notes&&(0,r.jsx)("div",{className:T()(E,"mb-2"),children:b.notes}),b&&b.disposition&&(0,r.jsx)(Ic,{data:b,type:"chat",services:m})]}):null},wc=function(e){var t=e.id,n=e.name,o=(0,at.useSessionState)(),i=o.serverOrigin,s=o.domain,l=o.sessionId,c=o.loginId,u=(0,a.useMemo)((function(){if(l&&s&&c)return(0,Fi.getAttachmentUrl)({serverOrigin:i,sessionId:l,domain:s,loginId:c,attachmentId:t})}),[s,t,c,i,l]);return u?(0,r.jsx)(L.Attachment,{name:n,link:u,className:"!mr-5 !mt-2.5 inline-block w-auto"}):null};function Nc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ac(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Pc(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Ec(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Nc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Nc(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Dc=function(e){var t=e.html,n=e.title,o=e.info,i=e.actions,s=e.partyInternal,l=e.services,c=e.attachments,u=Ec((0,a.useState)(""),2),d=u[0],f=u[1],m=(0,a.useMemo)((function(){return{__html:d}}),[d]),p=null==s?void 0:s.serviceId,v=(l||[]).find((function(e){return e.serviceId===p}));return(0,a.useEffect)((function(){f((0,se.sanitizeHtml)(t))}),[t]),(0,r.jsxs)("div",{className:"my-2 rounded bg-note-bg  p-2",children:[o&&(0,r.jsx)("div",{children:o}),n&&(0,r.jsx)("div",{className:"mb-3 font-bold [&:not(:first-child)]:mt-2",children:n}),(0,r.jsx)("div",{dangerouslySetInnerHTML:m}),null==c?void 0:c.map((function(e){return(0,a.createElement)(wc,Pc(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Ac(e,t,n[t])}))}return e}({},e),{key:e.id}))})),i,v&&(0,r.jsx)(gc,{title:"Service",children:v.serviceName})]})};function Tc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function kc(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Tc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Tc(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Mc=function(e){var t=e.activity,n=(0,gt.useFormatting)().formatFullName,o=(0,yt.useGetAvatarUrl)(),i=t.emailData,s=t.direction,l=t.parties,c=t.services,u=(i.toAddresses||[]).map((function(e){return e.name})).join(", "),f=l.find((function(e){return"USER"===e.partyType})),m=l.find((function(e){return"USER"!==e.partyType})),p="INBOUND"!==s,v=kc(bc(p?f:m),2),h=v[0],b=v[1],y=p||null==m?void 0:m.contactId,g=p?null==f?void 0:f.userId:void 0,j=(0,a.useMemo)((function(){return{firstName:h,lastName:b,url:o({userId:g,contactId:y}),isAgent:p}}),[y,h,o,p,b,g]),I=n(h,b),S=(0,r.jsxs)("span",{className:"relative -top-1 text-[0.8em]",children:[(0,r.jsx)(d.SmIcon,{name:"envelope"}),(0,rt.formatDate)(i.date)]}),O=i.subject,x=p&&u?(0,r.jsx)(gc,{title:"To",size:"small",children:u}):void 0;return(0,r.jsxs)("div",{children:[(0,r.jsx)(yc.ContactListItem,{as:"div",avatarProps:j,contactId:y,userId:g,title:I,body:S,isAlignedToRight:p,isFitted:!0}),(0,r.jsx)(Dc,{info:x,title:O,html:i.content,attachments:i.attachments,services:c,partyInternal:f}),f&&f.disposition&&(0,r.jsx)(Ic,{data:f,type:"email",services:c})]})},Lc=function(e){var t=e.activity,n=(0,gt.useFormatting)().formatFullName,o=(0,yt.useGetAvatarUrl)(),i=t.createdTime,s=t.parties.find((function(e){return"USER"===e.partyType})),l=s||{},c=l.userId,u=l.firstName,d=void 0===u?"":u,f=l.lastName,m=void 0===f?"":f,p=l.notes,v=void 0===p?"":p,h=l.disposition,b=void 0===h?"":h,y=T()("relative inline-block bg-[--c-note-content-bg] py-2 pl-2 pr-6","after:absolute after:bottom-0 after:right-0 after:h-0 after:w-0 after:border-[8px]","after:border-b-white after:border-l-[--c-note-border] after:border-r-white after:border-t-[--c-note-border]"),g=n(d,m),j=(0,a.useMemo)((function(){return{firstName:d,lastName:m,url:o({userId:c}),isAgent:!0}}),[d,o,m,c]),I=g,S=(0,r.jsx)("span",{className:"relative -top-1 text-[0.8em]",children:(0,rt.formatDate)(i)});return s&&b?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:T()(y,"mb-2"),children:v}),(0,r.jsx)(Ic,{data:s})]}):(0,r.jsxs)("div",{children:[(0,r.jsx)(yc.ContactListItem,{as:"div",avatarProps:j,title:I,body:S,userId:c,isFitted:!0,isAlignedToRight:!0}),(0,r.jsx)("div",{className:y,children:v})]})},Rc=function(e){var t=e.data,n=t.reporterId,a=t.reporterFirstName,o=t.reporterLastName,i=t.createdTime,s=(0,gt.useFormatting)().formatFullName,l=(0,yt.useGetContactPictureUrl)(),c=s(a,o),u=c?{firstName:a,lastName:o,url:n&&l(n)}:{firstName:"Unidentified"},d="".concat(c||"Unidentified",", reporter"),f=i?(0,r.jsx)("span",{className:"relative -top-1 text-[0.8em]",children:(0,rt.formatDate)(i)}):void 0;return(0,r.jsx)("div",{children:(0,r.jsx)(yc.ContactListItem,{as:"div",avatarProps:u,title:d,body:f,contactId:n,isFitted:!0})})};const Fc=n.p+"e906ca7943e06d28dc48bf55f127fbd9.svg";function Bc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Uc(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Bc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Bc(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var zc=function(e){var t=e.activity,n=e.recordings,o=e.scrollRef,i=(0,gt.useFormatting)().formatFullName,s=(0,yt.useGetAvatarUrl)(),l=t.direction,c=t.createdTime,u=t.parties,f=t.services,m=u.find((function(e){return"CONTACT"===e.partyType})),p=u.find((function(e){return"USER"===e.partyType})),v=Uc(bc(m),2),h=v[0],b=v[1],y=Uc(bc(p),2),g=y[0],j=y[1],I=i(h,b),S=i(g,j),O="OUTBOUND"===l,x=(0,a.useMemo)((function(){return{firstName:O?g:h,lastName:O?j:b,url:s({userId:O?null==p?void 0:p.userId:void 0,contactId:O||null==m?void 0:m.contactId}),isAgent:O}}),[g,j,h,b,s,O,m,p]),C=O?S:I,_=T()("relative inline-block bg-[--c-note-content-bg] py-2 pl-2 pr-6","after:absolute after:bottom-0 after:right-0 after:h-0 after:w-0 after:border-[8px]","after:border-b-white after:border-l-[--c-note-border] after:border-r-white after:border-t-[--c-note-border]"),w=(0,r.jsxs)("span",{className:"relative -top-1 text-[0.8em]",children:[(0,r.jsx)(d.SmImage,{src:Fc}),(0,rt.formatDate)(c)]});return(0,r.jsxs)("div",{children:[(0,r.jsx)(yc.ContactListItem,{as:"div",avatarProps:x,title:C,body:w,isAlignedToRight:O,isFitted:!0}),(0,r.jsxs)("div",{className:"my-2 rounded bg-note-bg p-2",children:[O&&(0,r.jsx)(gc,{title:"To",size:"small",children:I}),n&&(null==o?void 0:o.current)?n.map((function(e){return(0,r.jsx)(L.AudioPlayer,{src:e,agentName:S},e)})):(0,r.jsx)(gc,{title:"Handled by",size:"small",children:S})]}),(null==p?void 0:p.notes)&&(0,r.jsx)("div",{className:T()(_,"mb-2"),children:p.notes}),(null==p?void 0:p.disposition)&&(0,r.jsx)(Ic,{data:p,type:"call",services:f})]})},Hc=function(e){var t=e.id,n=(0,yo.useNavigationState)(["setActivePage","goBack"]),o=n.setActivePage,i=n.goBack,s=(0,gt.useFormatting)().formatFullName,l=(0,hc.useCaseState)("cases"),c=(0,hc.useCaseStateMethods)().getCase,u=l[t]||{},f=u.data,m=void 0===f?null:f,p=u.recordings,v=void 0===p?void 0:p,h=u.assignments,b=void 0===h?void 0:h,y=u.isLoading,g=void 0===y||y,j=function(e,t){var n=e&&e.personal;return n&&n.length?n.map((function(e){return t(e.firstName||"",e.lastName||"")})).join(", "):""}(b,s),I=(0,a.useCallback)((function(e){o({name:yo.AppRoutes.Cases,params:{id:t,emailId:e}})}),[o,t]);(0,a.useEffect)((function(){!l[t]&&c(t)}),[t]);var S=(0,a.useRef)(null),O=T()("[&:not(:first-child)]:mt-2");return(0,r.jsxs)("div",{className:"relative h-full overflow-auto p-4",ref:S,children:[(0,r.jsx)("div",{className:"absolute left-0 top-0 cursor-pointer px-4 py-3",children:(0,r.jsx)(d.SmButton,{icon:"angle left",onClick:i,basic:!0,compact:!0})}),g?(0,r.jsx)(L.Loader,{size:"large",color:"primary",active:!0}):m?(0,r.jsxs)("div",{children:[(0,r.jsx)("div",{className:"mb-[1em] truncate px-[3em] text-center text-[1.2em]",children:"#".concat(m.number," ").concat(m.title)}),(0,r.jsx)(Rc,{data:m}),(0,r.jsx)(gc,{title:"State",children:m.status}),j&&(0,r.jsx)(gc,{title:"Assigned to",children:j}),m.categoryName&&(0,r.jsx)(gc,{title:"Category",children:m.categoryName}),m.activities.length>0?(0,r.jsx)("div",{children:m.activities.map((function(e){return"NOTES"===e.mediaType?(0,r.jsx)("div",{className:O,children:(0,r.jsx)(Lc,{activity:e})},e.id):"EMAIL"===e.mediaType?(0,r.jsx)("div",{className:O,children:(0,r.jsx)(Mc,{activity:e,onOpenClick:I})},e.id):"VOICE"===e.mediaType?(0,r.jsx)("div",{className:O,children:(0,r.jsx)(zc,{activity:e,scrollRef:S,recordings:v})},e.id):"CHAT"===e.mediaType?(0,r.jsx)("div",{className:O,children:(0,r.jsx)(_c,{activity:e})},e.id):void 0}))}):(0,r.jsx)("div",{children:"No activities"})]}):(0,r.jsx)("div",{className:"text-center",children:"Error occurred while loading data"})]})},Vc=function(e){var t=e.id,n=(0,yo.useNavigationState)("goBack"),o=(0,hc.useCaseState)("emails"),i=(0,hc.useCaseStateMethods)().getEmail,s=o[t]||{},l=s.data,c=void 0===l?null:l,u=s.isLoading,f=void 0===u||u;return(0,a.useEffect)((function(){!o[t]&&i(t)}),[t,o]),(0,r.jsxs)("div",{className:"relative p-4",children:[(0,r.jsx)("div",{className:"absolute left-0 top-0 cursor-pointer px-4 py-3",children:(0,r.jsx)(d.SmButton,{icon:"angle left",onClick:n,basic:!0,compact:!0})}),f?(0,r.jsx)(L.Loader,{size:"large",color:"primary",active:!0}):c?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"mb-[1em] truncate px-[3em] text-center text-[1.2em]",children:c.subject}),c.fromAddresses&&c.fromAddresses.length>0&&(0,r.jsx)(gc,{title:"From",children:c.fromAddresses.map(rt.formatEmail).join(", ")}),c.toAddresses&&c.toAddresses.length>0&&(0,r.jsx)(gc,{title:"To",children:c.toAddresses.map(rt.formatEmail).join(", ")}),(0,r.jsx)(gc,{title:"Date",children:(0,rt.formatDate)(c.date)}),(0,r.jsx)(Dc,{html:c.content})]}):(0,r.jsx)("div",{className:"text-center",children:"Error occurred while loading data"})]})},Gc=n(3295),Wc=n(846),qc=n(5475);function Yc(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Kc(e,t,n,r,a,o,i){try{var s=e[o](i),l=s.value}catch(c){return void n(c)}s.done?t(l):Promise.resolve(l).then(r,a)}function $c(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){Kc(o,r,a,i,s,"next",e)}function s(e){Kc(o,r,a,i,s,"throw",e)}i(void 0)}))}}function Xc(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Qc(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Xc(e,t,n[t])}))}return e}function Zc(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Jc(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||tu(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function eu(e){return function(e){if(Array.isArray(e))return Yc(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||tu(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tu(e,t){if(e){if("string"==typeof e)return Yc(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Yc(e,t):void 0}}function nu(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(s){o=[6,s],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function ru(e){return["INBOUND","OUTBOUND","BLENDED"].includes(e.type)&&!e.notUserSelectable}function au(e){return{value:e.id,content:e.name}}function ou(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:function(e){return e.externalNumber.toString()};return{value:e.id,content:t(e)}}var iu=o().memo((function(e){var t=e.className,n=e.itemId,o=e.trackVisibility,s=void 0===o||o,l=e.labeled,u=Jc((0,a.useState)((function(){return O&&v[O]?au(v[O]).value:void 0})),2),d=u[0],f=u[1],m=(0,c.useLocalizationState)("t"),p=(0,Il.useDidState)("didNumbers"),v=(0,Bt.useServicesDispositionsState)().services,h=(0,nl.useCommunicatorUIState)("setServiceSelectorVisibility"),b=(0,On.useDIDNumberState)(),g=b.selectedDIDNumber,I=b.setDIDNumber,S=(0,xn.useServiceState)(),O=S.selectedService,x=S.setService,C=(0,Il.useDIDNumberLocalization)(),_=(0,i.useInteraction)(n),w=(0,X.getServiceId)(_),N=(0,a.useMemo)((function(){return(0,X.getServiceName)(v,_,(0,X.isExternalChat)(_))}),[v,_]);(0,a.useEffect)((function(){return s&&h(!0),function(){s&&h(!1)}}),[h,s]);var A,P=(0,a.useMemo)((function(){var e=Qc({},v);return w&&(e[w]=Zc(Qc({},e[w]),{id:w,name:N,type:"BLENDED",notUserSelectable:!1})),eu(Object.values(e).filter(ru).map(au)).concat(eu(Object.values(p).map((function(e){return ou(e,C)}))))}),[p,C,w,N,v]),E=(0,y.useEvent)((A=$c((function(e){function t(){return(t=$c((function(){return nu(this,(function(t){switch(t.label){case 0:return e?[3,3]:[4,x(e,n)];case 1:return t.sent(),[4,I(e)];case 2:return t.sent(),[3,9];case 3:return e in p?[4,I(e)]:[3,6];case 4:return t.sent(),[4,x(void 0,n)];case 5:return t.sent(),[3,9];case 6:return e in v?[4,I(void 0)]:[3,9];case 7:return t.sent(),[4,x(e,n)];case 8:t.sent(),t.label=9;case 9:return[2]}}))}))).apply(this,arguments)}return nu(this,(function(e){return function(){t.apply(this,arguments)}(),[2]}))})),function(e){return A.apply(this,arguments)}));return(0,a.useEffect)((function(){O&&v[O]?f(au(v[O]).value):g&&p[g]?f(ou(p[g]).value):f(void 0)}),[p,g,O,v]),(0,r.jsx)(j.SelectField,{clearable:!0,inPortal:!1,value:d,options:P,onChange:E,placeholder:l?m.GLOBAL.select():m.GLOBAL.service_selector_no_value(),label:l?m.GLOBAL.service_selector_label():void 0,"data-testid":"service-selector",className:"w-full px-2 py-[7.5px]",layoutClassName:M("w-full",t)})})),su=function(e){return"Id"in e},lu=function(e){return"title"in e&&"mediaType"in e},cu=function(e){return"userType"in e&&"msteams_channel"===e.userType},uu=function(e){return"userType"in e&&"msteams"===e.userType},du=function(e){var t,n,a=e.user,o=(0,yt.useGetAvatarUrl)(),i=cu(a)||lu(a)?void 0:o({contactId:su(a)?a.Id.oid:void 0,userId:su(a)?void 0:a.userId,userType:uu(a)?a.userType:void 0,photoUrl:uu(a)?a.photoUrl:void 0}),s=(0,gt.useFormatting)().getNamesFromDisplayName,l=cu(a)?jt.MS_TEAMS_CHANNEL_AVATAR_FIRST_NAME:lu(a)?null===(t=s(a.title))||void 0===t?void 0:t[0]:a.firstName,c=cu(a)?jt.MS_TEAMS_CHANNEL_AVATAR_LAST_NAME:lu(a)?null===(n=s(a.title))||void 0===n?void 0:n[1]:a.lastName,u=(0,rt.getInitials)(l,c),d=function(e){return cu(e)?"msteams-channel":uu(e)?"msteams-user":su(e)?"contact":lu(e)?(0,Wc.isHuntGroupEntry)(e)?"hunt-group":(0,Wc.isStaticVoiceEntry)(e)||(0,Wc.isStaticEmailEntry)(e)?"static-entry":"scenario-entry":"user"}(a);return(0,r.jsx)(j.Avatar,{src:i,size:"56",type:d,fallback:u})},fu=function(e){var t=e.user,n=(0,c.useLocalizationState)().t,o=(0,yo.useNavigationState)("setActivePage"),i=(0,te.useCallHandler)(),s=(0,at.useSessionState)(),u=s.userId,d=s.phoneDeviceCapabilities,f=(0,te.useActivityHistoryOpener)(),m=(0,a.useCallback)((function(){(0,l.assertDefined)(u);var e=t.userId,n=t.firstName,r=void 0===n?"":n,a=t.lastName;f({userId:e,firstName:r,lastName:void 0===a?"":a,origination:"contact-profile"}),o({name:yo.AppRoutes.Interactions})}),[u,t,f,o]),p=(0,a.useCallback)((function(){i({phone:t.extension,firstName:t.firstName,lastName:t.lastName,userId:t.userId,navigateToInteractionsPage:!0,origination:"contact-profile"})}),[i,t.extension,t.firstName,t.lastName,t.userId]);return(0,r.jsxs)("div",{className:"-mt-1 ml-auto flex flex-none items-center",children:[(0,r.jsx)(_e.Button,{onClick:m,tooltip:n.CONTACT.button_initiate_chat_text(),"data-testid":"chat-button",variant:"ghost",icon:(0,r.jsx)(j.IconChat,{})}),d.canDial&&(0,r.jsx)(_e.Button,{onClick:p,tooltip:n.CONTACT.button_start_call_text(),"data-testid":"call-button",variant:"ghost",icon:(0,r.jsx)(j.IconPhone24,{})})]})},mu=function(e){var t=e.item,n=(0,c.useLocalizationState)("t"),o=(0,at.useSessionState)().phoneDeviceCapabilities,i=(0,te.useCallHandler)(),s=(0,te.useActivityHistoryOpener)(),l=(0,y.useEvent)((function(){i({phone:t.number,userId:t.id,lastName:t.title,navigateToInteractionsPage:!0,origination:"contact-profile"})})),u=(0,y.useEvent)((function(e,n){"voice"===n?l():s({phone:e,userId:t.id,lastName:t.title,origination:"contact-profile"})})),d=(0,a.useMemo)((function(){var e;return(0,Wc.isScenarioChatEntry)(t)&&(e={channelType:"internal",media:["chat"]}),(0,Wc.isEmailServiceEntry)(t)&&(e={channelType:"email",email:""}),e?(0,r.jsx)(qc.DirectoryContactChannelFavoriteButton,{item:t,channel:e,onPhoneInteraction:u}):null}),[u,t]);return(0,r.jsxs)("div",{className:M("-mt-1 ml-auto flex flex-none items-center",{"ml-3 mt-1":!!d}),children:["voice"===t.mediaType&&o.canDial&&(0,r.jsx)(_e.Button,{onClick:l,tooltip:n.CONTACT.button_start_call_text(),"data-testid":"call-button",variant:"ghost",icon:(0,r.jsx)(j.IconPhone24,{})}),d]})};function pu(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function vu(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function hu(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function bu(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function yu(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return pu(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return pu(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var gu=function(e){var t=e.onClose,n=e.email,o=e.contactId,i=e.firstName,s=e.lastName,u=e.onConfirm,d=bu(e,["onClose","email","contactId","firstName","lastName","onConfirm"]),f=(0,c.useLocalizationState)().t,m=(0,st.useContactsStateMethods)().addEmail,p=(0,gt.useFormatting)(),v=p.formatEmailType,h=p.formatFullName,b=yu((0,a.useState)(lt.EmailTypes.PRIMARY),2),y=b[0],g=b[1],I=h(i,s),S=(0,a.useMemo)((function(){return Object.keys(lt.EmailTypes).map((function(e){return{value:e,content:v(e,!1)}}))}),[v]);return(0,r.jsxs)(j.Modal,hu(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){vu(e,t,n[t])}))}return e}({onClose:t,"data-testid":"contact-add-email-modal"},d),{children:[(0,r.jsx)(j.Modal.Header,{children:f.CONTACT.add_email_heading()}),(0,r.jsx)(j.Modal.Content,{className:"body-m",children:(0,r.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,r.jsxs)("p",{children:[f.CONTACT.add_email_description_1()," ",(0,r.jsx)("b",{children:n})," ",f.CONTACT.add_email_description_2()," ",(0,r.jsx)("b",{children:I})," ",f.CONTACT.add_email_description_3()]}),(0,r.jsxs)("p",{children:[f.CONTACT.add_email_description_4(),(0,r.jsx)(j.SelectField,{layoutClassName:"inline-block min-w-[187px] mx-4",placeholder:f.CONTACT.add_email_email_type_placeholder(),value:y,onValueChange:function(e){if(!(0,l.isStringInEnum)(lt.EmailTypes,e))throw Error("Invalid email type");g(e)},options:S,"data-testid":"phone-type-dropdown"}),f.CONTACT.add_email_description_5()]})]})}),(0,r.jsxs)(j.Modal.Actions,{children:[(0,r.jsx)(_e.Button,{variant:"secondary",onClick:function(){return t()},"data-testid":"cancel-button",children:f.WINDOW_POPUP_TITLES_AND_MESSAGES.window_buttonCancel()}),(0,r.jsx)(_e.Button,{variant:"primary",onClick:function(){o&&n&&m({contactId:o,type:y,email:n}),null==u||u(),t()},"data-testid":"add-button",children:f.CONTACT.add_email_confirmation_button()})]})]}))};function ju(){return(0,ie.useModalComponentOpener)(gu)}function Iu(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Su(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ou(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function xu(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function Cu(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Iu(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Iu(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var _u=function(e){var t=e.onClose,n=e.phone,o=e.contactId,i=e.firstName,s=e.lastName,u=e.onConfirm,d=xu(e,["onClose","phone","contactId","firstName","lastName","onConfirm"]),f=(0,c.useLocalizationState)().t,m=(0,st.useContactsStateMethods)().addPhone,p=(0,gt.useFormatting)(),v=p.formatPhoneType,h=p.formatFullName,b=Cu((0,a.useState)(lt.PhoneTypes.BUSINESS),2),y=b[0],g=b[1],I=h(i,s),S=(0,rt.formatPhone)(n),O=(0,a.useMemo)((function(){return Object.keys(lt.PhoneTypes).map((function(e){return{value:e,content:v(e)}}))}),[v]);return(0,r.jsxs)(j.Modal,Ou(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Su(e,t,n[t])}))}return e}({onClose:t,"data-testid":"contact-add-phone-modal"},d),{children:[(0,r.jsx)(j.Modal.Header,{children:f.CONTACT.add_phone_heading()}),(0,r.jsx)(j.Modal.Content,{className:"body-m",children:!!S&&(0,r.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,r.jsxs)("p",{children:[f.CONTACT.add_phone_description_1()," ",(0,r.jsx)("b",{children:S})," ",f.CONTACT.add_phone_description_2()," ",(0,r.jsx)("b",{children:I})," ",f.CONTACT.add_phone_description_3()]}),(0,r.jsxs)("p",{children:[f.CONTACT.add_phone_description_4(),(0,r.jsx)(j.SelectField,{layoutClassName:"inline-block min-w-[187px] mx-4",placeholder:f.CONTACT.add_phone_phone_type_placeholder(),value:y,onValueChange:function(e){if(!(0,l.isStringInEnum)(lt.PhoneTypes,e))throw Error("Invalid phone type");g(e)},options:O,"data-testid":"phone-type-dropdown"}),f.CONTACT.add_phone_description_5()]})]})}),(0,r.jsxs)(j.Modal.Actions,{children:[(0,r.jsx)(_e.Button,{onClick:function(){return t()},"data-testid":"cancel-button",variant:"secondary",children:f.WINDOW_POPUP_TITLES_AND_MESSAGES.window_buttonCancel()}),(0,r.jsx)(_e.Button,{onClick:function(){o&&n&&m({contactId:o,type:y,phone:n}),null==u||u(),t()},"data-testid":"add-button",variant:"primary",children:f.CONTACT.add_phone_confirmation_button()})]})]}))};function wu(){return(0,ie.useModalComponentOpener)(_u)}const Nu=n.p+"21f900e1764bd92edf6ccf942800db38.svg";function Au(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Pu(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}var Eu=function(e){return e.Id.oid},Du=function(e){var t;return e.primaryPhone?e.primaryPhone.phone:(null===(t=e.phones)||void 0===t?void 0:t.length)?e.phones[0].phone:""},Tu=function(e){return e.firstName},ku=function(e){return e.lastName},Mu=function(e){var t=e.user,n=(0,c.useLocalizationState)().t,o=[Eu(t),Du(t),Tu(t),ku(t)],s=o[0],u=o[1],d=o[2],f=o[3],m=(0,i.useInteractionStateMethods)(),p=(0,yo.useNavigationState)("setActivePage"),v=(0,i.useActiveInteractionProp)((function(e){return(0,X.isCall)(e)||(0,X.isExternalChat)(e)||(0,X.isEmail)(e)})),h=function(){var e=(0,i.useActiveInteraction)(),t=(0,i.useInteractionStateMethods)(),n=ju(),r=wu(),o=(0,X.getChannel)(e),s=(0,st.useContactsStateMethods)().getContactDetails;return(0,a.useCallback)((function(a){var i=function(e){var t;return null===(t=a.phones)||void 0===t?void 0:t.every((function(t){return t!==e}))};(0,l.assertDefined)(e);var c=a.id,u=a.firstName,d=a.lastName;if((0,X.isCall)(e)){var f=e.allParties||[];if(f.length){var m=f[0],p=m.id,v=m.theirItemId,h=m.phone;return t.useContact({partyId:p,itemId:v||"",contactId:c,firstName:u||"",lastName:d||""}),h&&i(h)&&r({phone:h,contactId:c,firstName:u,lastName:d}),Promise.resolve()}}else if((0,X.isExternalChat)(e)){var b=(0,X.getChatParties)(e);if(null==b?void 0:b.length){var y=b[0],g=y.email,j=y.item_id,I=y.party_id,S=y.first_name,O=y.last_name,x=y.phone,C=u||S||"",_=d||O||"";return t.useContact({itemId:j,partyId:I,contactId:c,firstName:C,lastName:_}),x&&i(x)&&r({phone:x,contactId:c,firstName:C,lastName:_}),g&&n({email:g,contactId:c,firstName:u,lastName:d}),(0,Gt.isMessengerChannel)(o)&&setTimeout((function(){s({id:c,force:!0})}),500),Promise.resolve()}}else if((0,X.isWorkItem)(e))return t.useContact({itemId:e.id,contactId:c,firstName:null!=u?u:"",lastName:null!=d?d:""}),Promise.resolve();return Promise.reject()}),[e,t,r,o,n,s])}(),b=(0,a.useCallback)((function(){s&&(m.createPotentialItem({phone:u,contactId:s,firstName:t.firstName,lastName:t.lastName}),p({name:yo.AppRoutes.Interactions}))}),[s,m,u,p,t.firstName,t.lastName]),y=(0,te.useCallHandler)(),g=(0,a.useCallback)((function(e){y(Pu(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Au(e,t,n[t])}))}return e}({},e),{navigateToInteractionsPage:!0}))}),[y]);return(0,r.jsxs)("div",{className:"flex flex-none items-center",children:[v&&(0,r.jsx)(_e.Button,{onClick:(0,$.partial)(h,(0,Pr.contactToShortContact)(t)),tooltip:n.UNDEFINED.button_use_contact_title(),"data-testid":"use-contact-button",variant:"ghost",icon:(0,r.jsx)(L.Svg,{src:Nu,className:"!h-3.5 !w-3.5"})}),(0,r.jsx)(_e.Button,{onClick:b,tooltip:n.CONTACT.button_initiate_chat_text(),"data-testid":"chat-button",variant:"ghost",icon:(0,r.jsx)(j.IconChat,{})}),(0,r.jsx)(L.InteractionDropdown,{searchMode:"none",callParams:{phone:u,firstName:d,lastName:f,contactId:s,origination:"contact-profile"},onCall:g,trigger:function(e){var t=e.handleCallClick,a=e.isLoading,o=e.openerRef;return(0,r.jsx)(_e.Button,{onClick:t,tooltip:n.CONTACT.button_start_call_text(),state:a?"loading":void 0,ref:o,"data-testid":"call-button",variant:"ghost",icon:(0,r.jsx)(j.IconPhone24,{})})}})]})},Lu=function(e){var t=e.user,n=(0,c.useLocalizationState)().t,o=(0,yo.useNavigationState)("setActivePage"),i=(0,at.useSessionState)().userId,s=(0,te.useActivityHistoryOpener)(),u=(0,a.useCallback)((function(){(0,l.assertDefined)(i);var e=t.channelId,n=t.title;s({userId:e,firstName:n,origination:"contact-profile"}),o({name:yo.AppRoutes.Interactions})}),[i,t,s,o]);return(0,r.jsx)("div",{className:"-mt-1 ml-auto flex flex-none items-center",children:(0,r.jsx)(_e.Button,{onClick:u,tooltip:n.CONTACT.button_initiate_chat_text(),"data-testid":"chat-button",icon:(0,r.jsx)(j.IconChat,{}),variant:"ghost"})})},Ru=function(e){var t=e.user,n=(0,c.useLocalizationState)().t,o=(0,yo.useNavigationState)("setActivePage"),i=(0,te.useCallHandler)(),s=(0,at.useSessionState)(),u=s.userId,d=s.phoneDeviceCapabilities,f=(0,te.useActivityHistoryOpener)(),m=(0,a.useCallback)((function(){(0,l.assertDefined)(u);var e=t.userId,n=t.firstName,r=void 0===n?"":n,a=t.lastName;f({userId:e,firstName:r,lastName:void 0===a?"":a,origination:"contact-profile"}),o({name:yo.AppRoutes.Interactions})}),[u,t,f,o]),p=(0,a.useCallback)((function(){i({phone:t.extension,firstName:t.firstName,lastName:t.lastName,userId:t.userId,navigateToInteractionsPage:!0,origination:"contact-profile"})}),[i,t.extension,t.firstName,t.lastName,t.userId]);return(0,r.jsxs)("div",{className:"-mt-1 ml-auto flex flex-none items-center",children:[(0,r.jsx)(_e.Button,{onClick:m,tooltip:n.CONTACT.button_initiate_chat_text(),"data-testid":"chat-button",variant:"ghost",icon:(0,r.jsx)(j.IconChat,{})}),t.extension&&d.canDial&&(0,r.jsx)(_e.Button,{onClick:p,tooltip:n.CONTACT.button_start_call_text(),"data-testid":"call-button",variant:"ghost",icon:(0,r.jsx)(j.IconPhone24,{})})]})},Fu=function(e){var t=e.user;return su(t)?(0,r.jsx)(Mu,{user:t}):cu(t)?(0,r.jsx)(Lu,{user:t}):uu(t)?(0,r.jsx)(Ru,{user:t}):lu(t)?(0,r.jsx)(mu,{item:t}):(0,r.jsx)(fu,{user:t})},Bu=n(9073);function Uu(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function zu(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Hu(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Vu(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Uu(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Uu(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Gu(e,t){var n,r,a,o=(n=t,(null==n||null===(a=n.layout)||void 0===a||null===(r=a.pages)||void 0===r?void 0:r.flatMap((function(e){return(null==e?void 0:e.fields)||[]})).flat())||[]).filter((function(e){return!function(e){return"STATIC"===e.type&&("SECTION"===e.staticType||"CONTAINER"===e.staticType)}(e.field)}));return Object.entries(e).reduce((function(e,t){var n=Vu(t,2),r=n[0],a=n[1],i=function(e){return"CUSTOM"===(null==e?void 0:e.field.type)&&(null==e?void 0:e.field.leadMappingString)?e.field.leadMappingString:"STATIC"===(null==e?void 0:e.field.type)&&"MESSENGER"===(null==e?void 0:e.field.staticType)&&(null==e?void 0:e.field.mapping)?e.field.mapping:""}(o.find((function(e){var t;return(null===(t=e.field)||void 0===t?void 0:t.name)===r})));return i?Hu(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){zu(e,t,n[t])}))}return e}({},e),zu({},i,a)):e}),{})}var Wu=n(5632);function qu(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Yu(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Ku(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var $u=function(e){var t=e.contactId,n=e.values,o=e.formDefinition,s=e.changeFormPageId,l=e.action,c=e.actionCases,u=e.children,d=e.dataKey,f=Ku(e,["contactId","values","formDefinition","changeFormPageId","action","actionCases","children","dataKey"]),m=n&&o?Gu(n||{},o):n,p=function(e){var t,n,r,o=e.contactId,s=e.actionCases,l=e.values,c=e.action,u=e.changeFormPageId,d=(0,i.useInteractionStateMethods)(),f=d.initiateCall,m=d.initiateChat,p=(0,st.useContact)(o),v=(0,Yt.useInteractionChatStateMethods)().addMessageToPending,h=(0,yo.useNavigationState)("setActivePage"),b=(0,at.useSessionState)().privileges,y=!!Object.keys(b).length&&b.CAN_START_EXTERNAL_CHAT,g=(0,i.useInteractionStateMethods)(),j=(0,Bt.useServicesDispositionsState)().services,S=(0,xn.useServiceState)().selectedService,O=(0,On.useDIDNumberState)().selectedDIDNumber,x=(0,I.useNotificationsState)("methods"),C=x.showNotification,_=x.hideNotificationsByTag,w=(0,Ha.useErrorValidation)().getServiceAndDIDNumbersErrors,N=(0,Bt.useServicesDispositionsState)().dispositions,A=(0,X.getAssociatedChatServiceId)(j,S),P=(0,a.useCallback)((function(e){null==s||s.forEach((function(t){(0,Wu.checkConditions)({conditions:null==t?void 0:t.conditions,values:l})&&e(t)}))}),[l,s]),E=(0,a.useCallback)((function(e){if(null==e?void 0:e.numberToCall){var t,n,r=w({skip:["noChatInService"],interactionType:"call"});if(r.length)return void C(r[0]);_("interaction-init"),f({phone:e.numberToCall,serviceId:S,accessNumberId:O,contactId:o,firstName:null==p||null===(t=p.data)||void 0===t?void 0:t.firstName,lastName:null==p||null===(n=p.data)||void 0===n?void 0:n.firstName,origination:"contact-profile"}),h({name:yo.AppRoutes.Interactions})}}),[null==p||null===(t=p.data)||void 0===t?void 0:t.firstName,o,w,_,f,O,S,h,C]),D=(0,a.useCallback)((function(e){if(y&&(null==e?void 0:e.numberToSMS)){var t,n;(null==e?void 0:e.messageToSMS)&&v({content:e.messageToSMS,channel:"sms",type:"message"},e.numberToSMS);var r=w({interactionType:"sms"});if(r.length)return void C(r[0]);_("interaction-init"),m({channel:"sms",address:e.numberToSMS,serviceId:A,displayData:{firstName:null==p||null===(t=p.data)||void 0===t?void 0:t.firstName,lastName:null==p||null===(n=p.data)||void 0===n?void 0:n.lastName},accessNumberId:O,contactId:o,origination:"contact-profile"}),h({name:yo.AppRoutes.Interactions})}}),[null==p||null===(n=p.data)||void 0===n?void 0:n.firstName,null==p||null===(r=p.data)||void 0===r?void 0:r.lastName,v,A,y,o,w,m,_,O,h,C]),T=(0,a.useCallback)((function(e){(null==e?void 0:e.searchText)&&h({name:yo.AppRoutes.KnowledgeBase,params:{searchText:e.searchText}})}),[h]),k=(0,a.useCallback)((function(e){e.page&&(null==u||u(e.page))}),[u]),M=(0,i.useInteractions)(),L=(0,Jt.useDisconnectButtonClickHandler)(),R=(0,a.useCallback)((function(){var e=M.find((function(e){return e.contactId===o}));e&&L(e,{completeAfterDisconnect:!0,openInteractionsPageOnError:!0})}),[o,L,M]),F=(0,a.useCallback)((function(e){var t,n,r=M.find((function(e){return e.contactId===o}));if(r){var a=e.disposition,i=(0,X.isWorkItem)(r)?null==r||null===(t=r.workitemData)||void 0===t?void 0:t.serviceId:null==r||null===(n=r.scenarioData)||void 0===n?void 0:n.serviceId,s=i?N[i]:{},l=Object.values(s).find((function(e){return e.name===a}));l&&g.setDisposition({itemId:r.id,disposition:{id:l.id,name:l.name}}),L(r,{completeAfterDisconnect:!0,openInteractionsPageOnError:!0,disposition:l})}}),[o,N,L,g,M]),B=(0,a.useCallback)((function(){P(R)}),[R,P]),U=(0,a.useCallback)((function(){P(F)}),[P,F]),z=(0,a.useCallback)((function(){P(E)}),[P,E]),H=(0,a.useCallback)((function(){P(D)}),[P,D]),V=(0,a.useCallback)((function(){P(T)}),[T,P]),G=(0,a.useCallback)((function(){P(k)}),[k,P]);return(0,a.useCallback)((function(){"Start SMS"===c&&H(),"Call number"===c&&z(),"Search Knowledge Base"===c&&V(),"Complete"===c&&B(),"Disposition"===c&&U(),"Go To Page"===c&&G()}),[c,H,z,V,B,U,G])}({contactId:t,actionCases:c,action:l,values:m,changeFormPageId:s}),v=function(e){var t=(0,at.useSessionState)(),n=t.privileges,r=t.phoneDeviceCapabilities,o=(0,xn.useServiceState)().selectedService,i=(0,Bt.useServicesDispositionsState)().outboundChatChannels;return(0,a.useMemo)((function(){var t,a=!!Object.keys(n).length&&!!n.CAN_START_EXTERNAL_CHAT;return"Start SMS"===e?a&&!(!o||!(null===(t=i[o])||void 0===t?void 0:t.includes("SMS"))):"Call number"!==e||!!r.canDial}),[i,r.canDial,n,o,e])}(l),h=function(e){var t=e.values,n=e.actionCases;return null==n?void 0:n.some((function(e){return(0,Wu.checkConditions)({values:t,conditions:null==e?void 0:e.conditions})}))}({values:m,actionCases:c}),b=!h||!v;return(0,r.jsx)(L.SemanticButton,Yu(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){qu(e,t,n[t])}))}return e}({},f),{"data-testid":d,"data-form-field":"true","data-field-type":"button","data-disabled":b||void 0,onClick:p,basic:!0,disabled:b,children:u}))};function Xu(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Qu(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}var Zu=function(e){var t=e.style,n=e.value,o=e.className,i=(0,a.useMemo)((function(){return Qu(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Xu(e,t,n[t])}))}return e}({},t),{minHeight:null==t?void 0:t.height})}),[t]);return(0,r.jsx)("img",{className:o,src:n?"data:image;base64,".concat(n):void 0,style:i,alt:"form-image"})},Ju=function(e){var t=e.height,n=(0,a.useMemo)((function(){return"number"!=typeof t?{}:{flexShrink:0,height:2*t}}),[t]);return(0,r.jsx)("div",{style:n})},ed=n(7517);function td(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function nd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){td(e,t,n[t])}))}return e}function rd(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}var ad=function(e){var t=e.label,n=e.value,o=e.type,i=e.image,s=e.button,l=e.height,u=e.contactId,f=e.userId,m=e.messenger,p=e.values,v=e.name,h=e.options,b=e.isStaticEntry,y=e.control,g=e.additionalControls,j=(0,c.useLocalizationState)().t,I=(0,te.useCallHandler)(),S=(0,te.useActivityHistoryOpener)(),O=(0,a.useId)(),x=(0,a.useId)(),C=null==p?void 0:p["Contact.first_name"],_=null==p?void 0:p["Contact.last_name"],w=M("flex flex-col border-b border-main-border px-4 py-2"),N=(0,a.useCallback)((function(e){e.preventDefault();var t=e.currentTarget,r=t.getAttribute("data-type"),a=t.getAttribute("data-value");if(r)switch(r){case"number":return a&&I({phone:a,contactId:u,firstName:C,lastName:_,navigateToInteractionsPage:!0,origination:"contact-profile"});case"email":return alert("TODO: handle email click for: "+a);case"message":return S({contactId:u,userId:f,origination:"contact-profile",firstName:C,lastName:_,phone:f?void 0:n})}}),[I,u,C,_,S,f,n]),A=(0,a.useCallback)((function(e){return(0,r.jsxs)("div",{role:"listitem",className:w,id:O,"data-testid":v,"data-form-field":"true","data-field-type":"text-view",children:[(0,r.jsx)("div",{children:t}),(0,r.jsxs)("div",{className:"!flex leading-[20px]",children:[e,g&&(0,r.jsx)("div",{className:"ml-2 inline-flex",children:g})]})]})}),[g,w,O,t,v]),P=(0,a.useCallback)((function(e){return(0,r.jsx)("a",{onClick:N,"data-type":o,"data-value":n,tabIndex:0,role:"button","aria-labelledby":"".concat(O," ").concat(x),id:x,"data-testid":"content","data-clickable":"true",className:"truncate font-bold text-primary-action",children:e})}),[O,x,N,o,n]);return s?"Augmentation"===s.action||"Create email"===s.action?null:(0,r.jsx)("div",{role:"listitem",className:w,children:(0,r.jsx)($u,rd(nd({},s),{primary:!0,contactId:u,values:p,dataKey:v,action:s.action||"Do Nothing",children:s.value}))}):i?(0,r.jsx)("div",{role:"listitem",className:w,children:(0,r.jsx)(Zu,rd(nd({},i),{value:n}))}):"spacer"===o?(0,r.jsx)("div",{role:"listitem",className:w,children:(0,r.jsx)(Ju,{height:l})}):"link"===o?(0,r.jsx)("div",{role:"listitem",className:w,"data-testid":v,"data-form-field":"true","data-field-type":"link",children:(0,r.jsx)("a",{href:"//".concat(n),target:"_blank",rel:"noopener noreferrer",children:t})}):"radio"===o&&v&&y?(0,r.jsxs)("div",{role:"listitem",className:w,"data-testid":v,"data-form-field":"true","data-field-type":"link",children:[(0,r.jsx)("div",{children:t}),(0,r.jsx)("div",{children:(0,r.jsx)(d.SmForm.Group,{className:"mx-[-9px] mb-0 mt-2",children:null==h?void 0:h.map((function(e){var t;return(0,r.jsx)(od,{control:y,name:v,label:e.name,radioValue:e.id,defaultValue:null===(t=h[0])||void 0===t?void 0:t.id},e.id)}))})})]}):A("message"===o?b?(0,r.jsx)("span",{"data-testid":"content",className:"truncate",children:n}):P(f===n?j.CONTACT.internal_messages_field_value():(0,rt.formatPhone)(n)):"messenger"===o&&m?(0,r.jsx)(ed.MessengerView,{contactId:u,messenger:m,firstName:C,lastName:_}):o?P("number"===o?(0,rt.formatPhone)(n):n):(0,r.jsx)("span",{"data-testid":"content",className:"truncate",children:n}))},od=function(e){var t=e.control,n=e.radioValue,a=e.name,o=e.defaultValue,i=e.label,s=(0,Bu.useController)({name:a,control:t,defaultValue:o}).field;return(0,r.jsx)(ed.RadioFieldRaw,{field:s,className:"!w-1/2",label:i,radioValue:n})},id=function(e){var t,n=e.user,a=e.onGoBack,o=(0,gt.useFormatting)().formatFullName,i=lu(n)||cu(n)?n.title:o(null!==(t=n.firstName)&&void 0!==t?t:"",n.lastName);return(0,r.jsxs)("div",{className:"relative border-b p-6",children:[(0,r.jsx)("h1",{className:"truncate heading-s text-primary-on-primary",children:i}),(0,r.jsx)(_e.Button,{icon:(0,r.jsx)(j.IconClose24,{}),variant:"ghost",onClick:a,className:"absolute right-6 top-1/2 -translate-y-1/2"})]})},sd=function(e){var t=e.entryId,n=(0,c.useLocalizationState)("t").CONTACT,o=(0,i.useActiveInteractionId)(),s=(0,yo.useNavigationState)("goBack"),l=(0,te.useCallHandler)(),u=(0,te.useActivityHistoryOpener)(),d=(0,Gc.useDirectoryState)("categoryEntries"),f=Object.values(d).flat().find((function(e){return e.id===t})),m=(0,a.useMemo)((function(){return f?(0,Wc.isScenarioVoiceEntry)(f)||(0,Wc.isHuntGroupEntry)(f)?[{type:"number",value:f.number,label:n.description_field_label(),favoritesChannel:{channelType:"internal",number:f.number,media:["voice"]}}]:(0,Wc.isStaticVoiceEntry)(f)?[{value:n.phone_field_label(),label:n.type_field_label()},{type:"number",value:f.number,label:n.description_field_label(),favoritesChannel:{channelType:"phone",number:f.number,media:["voice","chat"]}}]:(0,Wc.isStaticEmailEntry)(f)?[{value:n.email_field_label(),label:n.type_field_label()},{type:"email",value:f.email,label:n.description_field_label(),favoritesChannel:{channelType:"email",email:f.email}}]:[]:[]}),[f,n]),p=(0,y.useEvent)((function(e,n){"voice"===n?l({userId:t,phone:e,lastName:null==f?void 0:f.title,navigateToInteractionsPage:!0,origination:"contact-profile"}):u({userId:t,phone:e,lastName:null==f?void 0:f.title,origination:"contact-profile"})}));return(0,r.jsx)("div",{className:"flex min-h-0 flex-auto flex-col overflow-y-auto overflow-x-hidden py-3","data-testid":"contact-details",children:f?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(id,{user:f,onGoBack:s}),(0,r.jsxs)("div",{className:"flex items-center gap-2 px-6 pb-2 pt-4",children:[(0,r.jsx)(iu,{itemId:o}),(0,r.jsx)(Fu,{user:f})]}),(0,r.jsxs)("div",{className:"flex shrink-0 gap-8 px-6 py-4",children:[(0,r.jsx)(du,{user:f}),!!m.length&&(0,r.jsx)("div",{role:"list",className:"flex grow flex-col overflow-y-auto overflow-x-hidden px-4",children:m.map((function(e,n){return(0,r.jsx)(ad,{isStaticEntry:!0,label:e.label,type:e.type,value:e.value,userId:t,additionalControls:e.favoritesChannel&&(0,r.jsx)(qc.DirectoryContactChannelFavoriteButton,{item:f,channel:e.favoritesChannel,onPhoneInteraction:p})},n)}))})]})]}):(0,r.jsx)(L.Loader,{size:"large",color:"primary",active:!0})})};function ld(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function cd(e){return function(e){if(Array.isArray(e))return ld(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return ld(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ld(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var ud=function(e){var t=e.userId,n=(0,c.useLocalizationState)("t").CONTACT,o=(0,i.useActiveInteractionId)(),s=(0,Er.useUserDetailsOnceGetter)(),l=(0,yo.useNavigationState)("goBack"),u=(0,te.useCallHandler)(),d=(0,te.useActivityHistoryOpener)(),f=function(e){var t,n,r=(0,Gc.useDirectoryState)(["users","searchResults","emiUsers"]),o=r.users,i=r.searchResults,s=r.emiUsers,l=(0,Er.useUserDetailsById)(e);return(0,a.useMemo)((function(){var t,n,r,a,c,u=null!==(r=null===(n=i.dialpad)||void 0===n||null===(t=n.data)||void 0===t?void 0:t.users)&&void 0!==r?r:[],d=null!==(a=s[Wc.MS_TEAMS_CHATS_CATEGORY_ID])&&void 0!==a?a:[],f=null!==(c=s[Wc.MS_TEAMS_CHANNELS_CATEGORY_ID])&&void 0!==c?c:[];return cd(o).concat(cd(u),cd(d)).find((function(t){return t.userId===e}))||f.find((function(t){return t.channelId===e}))||(null==l?void 0:l.data)}),[s,null===(n=i.dialpad)||void 0===n||null===(t=n.data)||void 0===t?void 0:t.users,null==l?void 0:l.data,e,o])}(t),m=f&&!cu(f)?f.firstName:void 0,p=f&&!cu(f)?f.lastName:void 0,v=f&&(uu(f)||cu(f))?f.userType:void 0,h=f&&(uu(f)||cu(f))?f.photoUrl:void 0;(0,a.useEffect)((function(){f||s({userIds:[t]})}),[]);var b=(0,a.useMemo)((function(){if(!f)return[];if(cu(f))return[];if(uu(f)||"userType"in(r=f)&&"msteams"===r.userType&&"msTeamsPhones"in r){var e,t=uu(f)?f.phones:null!==(e=f.msTeamsPhones)&&void 0!==e?e:[];return Object.values(t).reduce((function(e,t){return e.push({type:"number",value:t.phone,label:n.phone_field_label(),favoritesChannel:{channelType:"phone",number:t.phone,numberType:t.type,media:["voice"]}}),e}),[])}var r;return f.extension?[{type:"number",value:f.extension,label:n.phone_field_label(),favoritesChannel:{channelType:"internal",number:f.extension,media:["voice","chat"]}}]:[]}),[f,n]),g=(0,y.useEvent)((function(e,n){"voice"===n?u({userId:t,phone:e,firstName:m,lastName:p,navigateToInteractionsPage:!0,origination:"contact-profile"}):d({userId:t,phone:e,firstName:m,lastName:p,emiUserType:v,emiPhotoUrl:h,origination:"contact-profile"})}));return(0,r.jsx)("div",{className:"flex min-h-0 flex-auto flex-col overflow-y-auto overflow-x-hidden py-3","data-testid":"contact-details",children:f?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(id,{user:f,onGoBack:l}),(0,r.jsxs)("div",{className:"flex items-center gap-2 px-6 pb-2 pt-4",children:[(0,r.jsx)(iu,{itemId:o}),(0,r.jsx)(Fu,{user:f})]}),(0,r.jsxs)("div",{className:"flex shrink-0 gap-8 px-6 py-4",children:[(0,r.jsx)(du,{user:f}),!!b.length&&(0,r.jsx)("div",{role:"list",className:"flex grow flex-col overflow-y-auto overflow-x-hidden px-4",children:b.map((function(e,n){return(0,r.jsx)(ad,{label:e.label,type:e.type,value:e.value,userId:t,isStaticEntry:lu(f),additionalControls:e.favoritesChannel&&(0,r.jsx)(qc.DirectoryContactChannelFavoriteButton,{item:f,channel:e.favoritesChannel,onPhoneInteraction:g})},n)}))})]})]}):(0,r.jsx)(L.Loader,{size:"large",color:"primary",active:!0})})},dd=function(){var e=(0,c.useLocalizationState)().t.WINDOW_POPUP_TITLES_AND_MESSAGES.window_title_warning();return(0,r.jsx)(r.Fragment,{children:e})},fd=function(){var e=(0,c.useLocalizationState)().t;return(0,r.jsx)("p",{children:e.CONTACT.unsaved_warning_message()})},md=function(e){var t=(0,c.useLocalizationState)().t,n=e.closeModal,o=e.onConfirm,i=(0,a.useCallback)((function(){n(),o()}),[n,o]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(L.SemanticButton,{enabledInOffline:!0,primary:!0,onClick:n,"data-testid":"cancel-button",children:t.UNDEFINED.button_cancel_contact_text()}),(0,r.jsx)(L.SemanticButton,{enabledInOffline:!0,onClick:i,"data-testid":"continue-button",children:t.GLOBAL.continue()})]})},pd=n(2534),vd=n(1460);function hd(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function bd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){hd(e,t,n[t])}))}return e}function yd(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function gd(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var jd=function(e){var t=e.options,n=e.onChange,o=e.className,i=e.name,s=e.label,l=e.error,c=e.value,u=e.noValueLabel,d=void 0===u?"Please select":u,f=e.inputRef,m=e.placeholder,p=e.labelClassName,v=e.errorClassName,h=gd(e,["options","onChange","className","name","label","error","value","noValueLabel","inputRef","placeholder","labelClassName","errorClassName"]),b=(0,a.useCallback)((function(e){var t=e.target;if(t){var r=t.value||void 0;n(r,{name:i})}}),[i,n]);return(0,r.jsxs)("div",{className:M(o,"relative flex min-w-0 justify-between",{"text-red-500":l}),children:[s&&(0,r.jsx)("label",{className:M(p,"mt-1.5 flex-1"),children:s}),(0,r.jsxs)("select",yd(bd({placeholder:m,ref:f,value:c||"",onChange:b},h),{className:"max-w-full flex-[2] rounded-md border border-gray-400 bg-white p-1",children:[d&&(0,r.jsx)("option",{value:"",children:d}),null==t?void 0:t.map((function(e,t){return(0,r.jsx)("option",{value:e.value,children:e.label||e.value},t)}))]})),l&&(0,r.jsx)("p",{className:v,role:"alert aria-atomic",children:l})]})};function Id(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Sd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Id(e,t,n[t])}))}return e}function Od(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function xd(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function Cd(e){var t=e.ref,n=e.options,a=e.onChange,o=e.label,i=xd(e,["ref","options","onChange","label"]),s=(0,En.uuid)();return(0,r.jsx)(jd,Od(Sd({},i),{inputRef:t,label:o,placeholder:o,errorClassName:"self-end text-red-500","aria-labelledby":s,options:n,onChange:a}))}function _d(e){return(0,r.jsx)(vd.FieldRawConstructor,Od(Sd({},e),{renderElement:Cd}))}function wd(e){return(0,r.jsx)(vd.FieldConstructor,Od(Sd({},e),{renderElement:Cd}))}function Nd(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ad(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Nd(e,t,n[t])}))}return e}function Pd(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Ed(e){return(0,r.jsx)(j.InputField,Ad({},e))}function Dd(e){return(0,r.jsx)(vd.FieldRawConstructor,Pd(Ad({},e),{renderElement:Ed}))}function Td(e){return(0,r.jsx)(vd.FieldConstructor,Pd(Ad({},e),{renderElement:Ed}))}var kd=function(e){var t=e.index,n=e.remove,o=(0,a.useCallback)((function(){n(t)}),[t,n]);return(0,r.jsx)("div",{className:"flex shrink-0 items-center",children:(0,r.jsx)("button",{onClick:o,"data-index":t,"aria-label":"Remove entry",title:"Remove entry",className:"cursor-pointer border-[none] bg-[none]",children:(0,r.jsx)(ve.IconCloseCircle,{})})})},Md=function(e){var t=e.index,n=e.control,o=e.name,i=e.remove,s=e.typeClassName,l=e.layoutClassName,u=e.style,d=(0,c.useLocalizationState)().t,f=(0,gt.useFormatting)().formatAddressType,m=(0,a.useMemo)((function(){return Object.keys(pd.STATES).map((function(e){return{value:e,label:pd.STATES[e]}}))}),[]),p=(0,a.useMemo)((function(){return Object.keys(lt.AddressTypes).map((function(e){return{value:e,label:f(e)}}))}),[f]),v=(0,Bu.useController)({name:"".concat(o,".").concat(t,".type"),control:n}).field,h=(0,Bu.useController)({name:"".concat(o,".").concat(t,".address_line1"),control:n}).field,b=(0,Bu.useController)({name:"".concat(o,".").concat(t,".address_line2"),control:n}).field,y=(0,Bu.useController)({name:"".concat(o,".").concat(t,".city"),control:n}).field,g=(0,Bu.useController)({name:"".concat(o,".").concat(t,".state"),control:n}).field,j=(0,Bu.useController)({name:"".concat(o,".").concat(t,".postcode"),control:n}).field;return(0,r.jsxs)("div",{role:"row",className:M("flex items-start",l),children:[(0,r.jsx)(_d,{style:u,className:s,field:v,options:p,placeholder:d.FORMS.address_type(),"aria-label":d.FORMS.address_type()}),(0,r.jsxs)("div",{className:M("flex min-w-0 flex-col",l),children:[(0,r.jsx)(Dd,{style:u,field:h,placeholder:d.FORMS.address_line_1(),"aria-label":d.FORMS.address_line_1()}),(0,r.jsx)(Dd,{style:u,field:b,placeholder:d.FORMS.address_line_2(),"aria-label":d.FORMS.address_line_2()}),(0,r.jsx)(Dd,{style:u,field:y,"aria-label":d.FORMS.city(),placeholder:d.FORMS.city()}),(0,r.jsxs)("div",{role:"row",className:M("flex items-start",l),children:[(0,r.jsx)(_d,{style:u,field:g,options:m,placeholder:d.FORMS.state()}),(0,r.jsx)(Dd,{style:u,field:j,"aria-label":d.FORMS.zip(),placeholder:d.FORMS.zip()})]})]}),(0,r.jsx)(kd,{index:t,remove:i})]})};function Ld(e){var t=e.append,n=e.AddButtonIcon,o=e.initialValues,i=e.addButtonText,s=(0,c.useLocalizationState)().t,l=(0,a.useCallback)((function(){t(o)}),[t,o]);return(0,r.jsx)("div",{children:(0,r.jsxs)("button",{onClick:l,className:"group/add-btn flex cursor-pointer border-[none] bg-[none] pl-0",title:s.CONTACT.add_entry_button_tooltip(),children:[(0,r.jsx)(n,{"aria-hidden":!0}),i&&(0,r.jsx)("span",{className:"ml-1 align-middle text-main-secondary group-hover/add-btn:text-black",children:i})]})})}var Rd=function(e){var t=e.label,n=e.layoutClassName,a=e.children;return(0,r.jsxs)("div",{className:M("flex min-w-0 flex-col",n),children:[t&&(0,r.jsx)("label",{children:t}),a]})},Fd=function(e){var t=e.control,n=e.name,a=e.AddButtonIcon,o=e.addButtonText,i=e.renderComponents,s=e.layoutClassName,l=e.initialValues,c=e.label,u=e.className,d=(0,Bu.useFieldArray)({control:t,name:n}),f=d.fields,m=d.append,p=d.remove;return(0,r.jsxs)("div",{className:M("flex flex-col",s,u),children:[f.map((function(e,t){return(0,r.jsx)(Rd,{layoutClassName:s,label:c,children:i(t,p,f.length)},t)})),(0,r.jsx)(Ld,{append:m,initialValues:l,AddButtonIcon:a,addButtonText:o})]})},Bd={address_line1:"",address_line2:"",city:"",postcode:""},Ud=function(e){var t=e.name,n=e.style,o=e.control,i=e.className,s=e.typeClassName,l=e.layoutClassName,c=(0,a.useCallback)((function(e,a){return(0,r.jsx)(Md,{style:n,layoutClassName:l,typeClassName:s,remove:a,name:t,control:o,index:e})}),[n,l,o,t,s]);return(0,r.jsx)(Fd,{className:i,layoutClassName:l,control:o,name:t,initialValues:Bd,renderComponents:c,AddButtonIcon:ve.IconAddAddress})},zd=function(e){var t=e.label,n=e.value,a=e.viewStyle;return(0,r.jsxs)("div",{className:"flex w-full items-center gap-x-[--form-cellPadding] gap-y-[--form-rowHeight] overflow-hidden",children:[(0,r.jsx)("span",{className:"w-[--form-fieldLabelWidth] min-w-[--form-fieldLabelWidth] max-w-[--form-fieldLabelWidth]",children:t}),(0,r.jsx)("div",{className:"flex-auto",style:a,children:n})]})},Hd=function(e){var t=e.pageItem,n=e.field,o=(0,wn.useContext)(Qf),i=o.form,s=o.view,l=(0,gt.useFormatting)().formatAddressType,c=(0,a.useId)(),u=(0,a.useId)();if(s){var d=i.getValues()[n.name||""],f=(0,Wu.getPageItemCSSProperties)(t.style);return(0,r.jsx)(r.Fragment,{children:null==d?void 0:d.map((function(e,t){var n=[e.address_line1,e.address_line2,e.city,pd.STATES[e.state],e.postcode].filter(Boolean).join(", ");return(0,r.jsx)(zd,{viewStyle:f,label:l(e.type),value:(0,r.jsx)("a",{tabIndex:0,"aria-labelledby":"".concat(c," ").concat(u),id:u,children:n})},t)}))})}var m=(0,Wu.getPageItemCSSProperties)(t.editStyle);return(0,r.jsx)(Ud,{name:n.name||"",control:i.control,style:m,layoutClassName:"gap-x-[--form-cellPadding] gap-y-[--form-rowHeight]",typeClassName:"w-[--form-fieldLabelWidth] min-w-[--form-fieldLabelWidth] max-w-[--form-fieldLabelWidth]"})};function Vd(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Gd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Vd(e,t,n[t])}))}return e}function Wd(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var qd=o().forwardRef((function(e,t){var n=e.id,a=e.className,o=e.inputClassName,i=e.label,s=e.error,l=e.value,c=e.onChange,u=e.onKeyDown,d=e.onBlur,f=e.minRows,m=void 0===f?1:f,p=e.maxRows,v=void 0===p?8:p,h=e.placeholder,b=void 0===h?"":h,y=e.labelClassName,g=e.wrapperClassName,I=e.errorClassName,S=Wd(e,["id","className","inputClassName","label","error","value","onChange","onKeyDown","onBlur","minRows","maxRows","placeholder","labelClassName","wrapperClassName","errorClassName"]);return(0,r.jsxs)("div",{className:M(g,"flex w-full flex-row"),children:[i&&(0,r.jsx)("label",{className:M("my-1 block",y),htmlFor:n,children:i}),(0,r.jsxs)("div",{className:"flex w-full flex-col",children:[(0,r.jsx)("div",{className:M(a,"box-border w-full flex-1 rounded border border-[#abb6bb] bg-white p-2","focus:border-[#4b85a0] focus:shadow-inner","hover:border-[#96a7b0] hover:shadow-inner",{"self-end border-[#ff8997] bg-[#ffdee2] text-red-500":s}),children:(0,r.jsx)(j.TextArea,Gd({ref:t,className:M(o,"m-0 box-border block w-full resize-none overflow-auto border-none bg-transparent p-0 leading-tight focus:outline-none"),value:l,onChange:c,onKeyDown:u,onBlur:d,minRows:m,maxRows:v,placeholder:b,id:n},S))}),s&&(0,r.jsx)("p",{className:I,role:"alert aria-atomic",children:s})]})]})}));function Yd(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Kd(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Yd(e,t,n[t])}))}return e}function $d(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Xd(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function Qd(e){var t=e.errorClassName,n=Xd(e,["errorClassName"]),a=(0,En.uuid)();return(0,r.jsx)(qd,$d(Kd({},n),{"aria-labelledby":a,errorClassName:M("self-end text-red-500",t)}))}function Zd(e){return(0,r.jsx)(vd.FieldConstructor,$d(Kd({},e),{renderElement:Qd}))}var Jd=function(e){var t=e.pageItem,n=e.control,a=e.multiline,o=e.placeholder,i=e.label,s=e.required,l=e.name,c=e.type,u=void 0===c?"text":c,d=e.minRows,f=(0,Wu.getFormElementStyle)(t),m=(0,Wu.getPageItemCSSProperties)(t.editStyle);return a?(0,r.jsx)(Zd,{placeholder:o,label:i,required:s,name:l,control:n,minRows:d,wrapperClassName:"flex items-center gap-x-[--form-cellPadding] gap-y-[--form-rowHeight]",style:f,labelClassName:"w-[--form-fieldLabelWidth] min-w-[--form-fieldLabelWidth] max-w-[--form-fieldLabelWidth]"}):(0,r.jsx)(Td,{placeholder:o,label:i,required:s,name:l,control:n,style:m,type:u})},ef=function(e){var t=e.pageItem,n=e.field,a=(0,wn.useContext)(Qf),o=a.form;if(a.view){var i=(0,Wu.getPageItemCSSProperties)(t.style),s=o.getValues()[n.name||""];return n.hideEmpty&&!s?null:(0,r.jsx)(zd,{viewStyle:i,label:n.label||"",value:s})}return(0,r.jsx)(Jd,{placeholder:n.emptyText||"",label:n.label,required:n.required,type:"number",name:n.name||"",control:o.control,pageItem:t,minRows:n.initialLinesNumber,multiline:n.multiline},n.key)},tf=function(e){var t=e.field,n=(0,wn.useContext)(Qf),a=n.form,o=n.formDefinition,i=n.changeFormPageId;return(0,r.jsx)($u,{actionCases:t.properties.actionCase,action:t.properties.action,values:a.getValues(),formDefinition:o,changeFormPageId:i,children:t.value})};function nf(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function rf(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){nf(e,t,n[t])}))}return e}function af(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function of(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function sf(e){var t=e.value,n=e.type,a=void 0===n?"checkbox":n,o=e.radioValue,i=of(e,["value","type","radioValue"]),s="checkbox"===a?t:t===o;return"checkbox"===a?(0,r.jsx)(L.Checkbox,af(rf({},i),{type:"checkbox",checked:s})):(0,r.jsx)(L.Checkbox,af(rf({},i),{type:"radio",checked:s,value:null!=o?o:""}))}function lf(e){return(0,r.jsx)(vd.FieldConstructor,af(rf({},e),{renderElement:sf}))}var cf=function(e){var t=e.pageItem,n=e.field,a=(0,wn.useContext)(Qf),o=a.form;if(a.view){var i=o.getValues()[n.name||""],s=(0,Wu.getPageItemCSSProperties)(t.style);return i?(0,r.jsx)(zd,{viewStyle:s,label:n.label||"",value:(0,r.jsx)(L.Checkbox,{checked:i,onChange:$.noop})}):null}var l=(0,Wu.getFormElementStyle)(t),c=o.getValues(n.name||"");return(0,r.jsx)(lf,{name:n.name||"",control:o.control,className:T()("flex items-center gap-x-[--form-cellPadding] gap-y-[--form-rowHeight]",{"line-through":n.crossOutWhenChecked&&c}),style:l,label:n.label,required:n.required,disabled:n.intentCheckOnly,type:"checkbox"})};function uf(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function df(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){uf(e,t,n[t])}))}return e}function ff(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function mf(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function pf(e){var t=e.ref,n=e.error,a=mf(e,["ref","error"]);return(0,r.jsxs)("div",{children:[(0,r.jsx)(d.SmRef,{innerRef:t,children:(0,r.jsx)(vd.DateTimeBase,df({},a))}),n&&(0,r.jsx)("p",{className:"self-end text-red-500",role:"alert aria-atomic",children:n})]})}function vf(e){return(0,r.jsx)(vd.FieldConstructor,ff(df({},e),{renderElement:pf}))}var hf=function(e){var t=e.pageItem,n=e.field,a=(0,wn.useContext)(Qf),o=a.form;if(a.view){var i=o.getValues()[n.name||""],s=(0,Wu.getPageItemCSSProperties)(t.style);if(n.hideEmpty&&!i)return null;var l=i?(0,rt.formatDate)(i):"";return(0,r.jsx)(zd,{viewStyle:s,label:n.label||"",value:l})}var c,u=(0,Wu.getPageItemCSSProperties)(t.editStyle);return(0,r.jsx)(vf,{placeholder:n.emptyText||"",label:n.label||"",required:n.required,control:o.control,style:u,name:n.name||"",className:T()("w-full","[&>.field]:w-full [&>.field>*]:w-full","[&>.field>*>input]:p-[5px] [&>.field>*>input]:flex-auto","[&>.field>*>input]:border [&>.field>*>input]:border-default [&>.field>*>input]:rounded-none [&>.field>*>input]:leading-6"),labelClassName:"!leading-3 caption-s text-primary-on-primary cursor-pointer",displayFormat:null!==(c=n.displayFormat)&&void 0!==c?c:void 0})},bf=function(e){var t=e.pageItem,n=e.field,a=(0,wn.useContext)(Qf),o=a.form;if(a.view){var i=o.getValues()[n.name||""],s=(0,Wu.getPageItemCSSProperties)(t.style);return i?(0,r.jsx)(zd,{viewStyle:s,label:n.label||"",value:(0,r.jsx)("a",{"data-value":i,tabIndex:0,children:i})}):null}return(0,r.jsx)(Jd,{placeholder:n.emptyText||"",label:n.label,required:n.required,type:"email",name:n.name||"",control:o.control,pageItem:t,minRows:n.initialLinesNumber,multiline:n.multiline},n.key)};function yf(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function gf(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){yf(e,t,n[t])}))}return e}function jf(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function If(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function Sf(e){var t=e.ref,n=If(e,["ref"]);return(0,r.jsx)(d.SmRef,{innerRef:t,children:(0,r.jsx)("input",gf({hidden:!0,"data-form-field":"true","data-field-type":"hidden-field"},n))})}function Of(e){return(0,r.jsx)(vd.FieldRawConstructor,jf(gf({},e),{renderElement:Sf}))}var xf=function(e){var t,n=e.idFieldName,a=e.selectFieldName,o=e.textFieldName,i=e.textFiledRules,s=e.style,l=e.control,c=e.index,u=e.options,d=e.remove,f=e.inputType,m=e.typeClassName,p=e.layoutClassName,v=(0,Bu.useController)({name:n,control:l}).field,h=(0,Bu.useController)({name:a,control:l}).field,b=(0,Bu.useController)({name:o,control:l,rules:i}),y=b.field,g=null===(t=b.fieldState.error)||void 0===t?void 0:t.message;return(0,r.jsxs)("div",{role:"row",className:M(p,"flex flex-row"),children:[(0,r.jsx)(Of,{field:v}),(0,r.jsx)(_d,{className:m,field:h,style:s,options:u}),(0,r.jsx)(Dd,{field:y,style:s,type:f,error:g}),(0,r.jsx)(kd,{index:c,remove:d})]})},Cf={type:lt.EmailTypes.BUSINESS,email_address:""},_f=function(e){var t=e.name,n=e.control,o=e.className,i=e.typeClassName,s=e.layoutClassName,l=e.style,c=(0,gt.useFormatting)().formatEmailType,u=(0,vd.useEmailValidationRules)(),d=(0,a.useMemo)((function(){return Object.keys(lt.EmailTypes).map((function(e){return{value:e,label:c(e)}}))}),[c]),f=(0,a.useCallback)((function(e,a){return(0,r.jsx)(xf,{idFieldName:"".concat(t,".").concat(e,".id"),selectFieldName:"".concat(t,".").concat(e,".type"),textFieldName:"".concat(t,".").concat(e,".email_address"),control:n,layoutClassName:s,typeClassName:i,index:e,options:d,textFiledRules:u,inputType:"email",remove:a,style:l})}),[s,i,t,n,d,u,l]);return(0,r.jsx)(Fd,{className:o,layoutClassName:s,control:n,name:t,initialValues:Cf,renderComponents:f,AddButtonIcon:ve.IconAddEmail})},wf=function(e){var t=e.pageItem,n=e.field,o=(0,wn.useContext)(Qf),i=o.form,s=o.view,l=(0,gt.useFormatting)().formatEmailType,c=(0,a.useId)(),u=(0,a.useId)();if(s){var d=i.getValues()[n.name||""],f=(0,Wu.getPageItemCSSProperties)(t.style);return(0,r.jsx)(r.Fragment,{children:null==d?void 0:d.map((function(e,t){return(0,r.jsx)(zd,{viewStyle:f,label:l(e.type),value:(0,r.jsx)("a",{tabIndex:0,"aria-labelledby":"".concat(c," ").concat(u),id:u,children:e.email_address})},t)}))})}var m=(0,Wu.getPageItemCSSProperties)(t.editStyle);return(0,r.jsx)(_f,{name:n.name||"",control:i.control,style:m,layoutClassName:"gap-x-[--form-cellPadding] gap-y-[--form-rowHeight]",typeClassName:"w-[--form-fieldLabelWidth] min-w-[--form-fieldLabelWidth] max-w-[--form-fieldLabelWidth]"})};function Nf(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Af(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Nf(e,t,n[t])}))}return e}var Pf=function(e){var t=e.pageItem,n=e.field,a=(0,wn.useContext)(Qf),o=a.form;if(a.view){var i=o.getValues()[n.name||""],s=(0,Wu.getPageItemCSSProperties)(t.style),l=(0,Wu.getFormElementStyle)(t);return i?(0,r.jsx)(Zu,{style:Af({},s,l),value:i}):null}return null},Ef=function(e){var t=e.field,n=(0,wn.useContext)(Qf).runtimeVariables,a=(0,Wu.parseTemplateToString)(t.value||"",n);return(0,r.jsx)("h4",{children:a})},Df=function(e){var t=e.field;return(0,r.jsx)("a",{href:t.linkUrl,target:"_blank",rel:"noopener noreferrer",className:"underline",children:t.initialValue||t.linkUrl})},Tf=["telegram","twitter"],kf=function(e){var t=e.control,n=e.userNameFieldName,o=e.typeFiledName,i=e.userIdFieldName,s=e.accountIdFieldName,l=e.availableMessengers,u=e.userNameDefault,d=e.accountIdDefault,f=e.userIdDefault,m=e.typeClassName,p=e.style,v=(0,c.useLocalizationState)().t,h=(0,Bu.useController)({name:s,defaultValue:d||"",control:t}).field,b=(0,Bu.useController)({name:o,control:t}).field,y=(0,Bu.useController)({name:i,control:t,defaultValue:f||""}).field,g=(0,Bu.useController)({name:n,control:t,defaultValue:u||""}).field,j=(0,Bu.useWatch)({control:t,name:s}),I=(0,a.useMemo)((function(){var e;return null===(e=l.find((function(e){return e.id===j})))||void 0===e?void 0:e.type}),[j,l]),S=!!I&&Tf.includes(I),O=(0,L.useGetMessengerName)(),x=(0,a.useMemo)((function(){return l.map((function(e){return{value:e.id,label:O(e.type)}}))}),[l,O]);return(0,a.useEffect)((function(){b.onChange(I)}),[I,b]),(0,a.useEffect)((function(){S||g.onChange("")}),[S,g]),(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(_d,{className:m,style:p,field:h,placeholder:v.UNDEFINED.contact_messenger(),options:x}),(0,r.jsx)(Of,{field:b}),(0,r.jsx)(Dd,{style:p,placeholder:v.UNDEFINED.contact_messenger_user_id_placeholder(),field:y}),S&&(0,r.jsx)(Dd,{style:p,placeholder:v.UNDEFINED.contact_messenger_username_placeholder(),field:g})]})},Mf={type:null,user_name:"",user_id:"",account_id:""},Lf=function(e){var t=e.availableMessengers,n=e.name,o=e.control,i=e.className,s=e.layoutClassName,l=e.typeClassName,c=e.style,u=(0,Bu.useFieldArray)({control:o,name:n}),d=u.fields,f=u.append,m=u.remove,p=(0,a.useCallback)((function(e,a,i){return(0,r.jsxs)("div",{role:"row",className:M(s,"flex flex-row"),children:[(0,r.jsx)(kf,{control:o,typeFiledName:"".concat(n,".").concat(a,".type"),userIdFieldName:"".concat(n,".").concat(a,".user_id"),userNameFieldName:"".concat(n,".").concat(a,".user_name"),accountIdFieldName:"".concat(n,".").concat(a,".account_id"),availableMessengers:t,accountIdDefault:e.account_id,userIdDefault:e.user_id,userNameDefault:e.user_name,typeClassName:l,style:c}),(0,r.jsx)(kd,{index:a,remove:i})]})}),[t,o,s,n,c,l]);return(0,r.jsxs)("div",{className:M("flex flex-col",s,i),children:[d.map((function(e,t){return(0,r.jsx)(Rd,{children:p(e,t,m)},t)})),Boolean(t.length)&&(0,r.jsx)(Ld,{append:f,initialValues:Mf,AddButtonIcon:ve.IconAddMessenger})]})};function Rf(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ff(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Rf(e,t,n[t])}))}return e}var Bf=function(e){var t=e.pageItem,n=e.field,a=(0,wn.useContext)(Qf),o=a.form,i=a.view,s=a.contactData,l=(0,Yt.useInteractionChatState)("messengers"),c=(0,L.useGetMessengerName)();if(i){var u=o.getValues()[n.name||""],d=(0,Wu.getPageItemCSSProperties)(t.style);return u?(0,r.jsx)(r.Fragment,{children:null==u?void 0:u.map((function(e,t){return(0,r.jsx)(zd,{viewStyle:d,label:c(e.type),value:(0,r.jsx)(ed.MessengerView,Ff({messenger:e},s))},t)}))}):null}var f=(0,Wu.getPageItemCSSProperties)(t.editStyle);return(0,r.jsx)(Lf,{name:n.name||"",control:o.control,style:f,availableMessengers:l,layoutClassName:"gap-x-[--form-cellPadding] gap-y-[--form-rowHeight]",typeClassName:"w-[--form-fieldLabelWidth] min-w-[--form-fieldLabelWidth] max-w-[--form-fieldLabelWidth]"})},Uf=function(e){var t=e.pageItem,n=e.field,a=(0,wn.useContext)(Qf).form;return(0,r.jsx)(Jd,{placeholder:n.emptyText||"",label:n.label,required:n.required,name:n.name||"",control:a.control,pageItem:t,minRows:n.initialLinesNumber,multiline:n.multiline},n.key)},zf=function(e){var t,n,o,s=e.phone,l=(t=(0,i.useInteractionStateMethods)(),n=(0,xn.useServiceState)().selectedService,o=(0,On.useDIDNumberState)().selectedDIDNumber,(0,a.useCallback)((function(e){e.preventDefault();var r=e.currentTarget.getAttribute("data-phone");r&&t.initiateCall({phone:r,serviceId:n,accessNumberId:o})}),[n,o,t]));return(0,r.jsx)("a",{onClick:l,"data-phone":s,tabIndex:0,children:(0,rt.formatPhone)(s)})},Hf=function(e){var t=e.pageItem,n=e.field,a=(0,wn.useContext)(Qf),o=a.form;if(a.view){var i=o.getValues()[n.name||""],s=(0,Wu.getPageItemCSSProperties)(t.style);return i?(0,r.jsx)(zd,{viewStyle:s,label:n.label||"",value:(0,r.jsx)(zf,{phone:i})}):null}return(0,r.jsx)(Jd,{placeholder:n.emptyText||"",label:n.label,required:n.required,type:"tel",name:n.name||"",control:o.control,pageItem:t,minRows:n.initialLinesNumber,multiline:n.multiline},n.key)},Vf={type:lt.PhoneTypes.BUSINESS,phone:""},Gf=function(e){var t=e.name,n=e.style,o=e.control,i=e.className,s=e.typeClassName,l=e.layoutClassName,c=(0,gt.useFormatting)().formatPhoneType,u=(0,vd.usePhoneValidationRules)(),d=(0,a.useMemo)((function(){return Object.keys(lt.PhoneTypes).map((function(e){return{value:e,label:c(e)}}))}),[c]),f=(0,a.useCallback)((function(e,a){return(0,r.jsx)(xf,{idFieldName:"".concat(t,".").concat(e,".id"),selectFieldName:"".concat(t,".").concat(e,".type"),textFieldName:"".concat(t,".").concat(e,".phone"),control:o,typeClassName:s,index:e,options:d,textFiledRules:u,inputType:"tel",remove:a,layoutClassName:l,style:n})}),[s,t,o,d,u,l,n]);return(0,r.jsx)(Fd,{layoutClassName:l,className:i,control:o,name:t,initialValues:Vf,renderComponents:f,AddButtonIcon:ve.IconAddPhone})},Wf=function(e){var t=e.pageItem,n=e.field,a=(0,wn.useContext)(Qf),o=a.form,i=a.view,s=(0,gt.useFormatting)().formatPhoneType;if(i){var l=o.getValues()[n.name||""],c=(0,Wu.getPageItemCSSProperties)(t.style);return(0,r.jsx)(r.Fragment,{children:null==l?void 0:l.map((function(e,t){return(0,r.jsx)(zd,{viewStyle:c,label:s(e.type),value:(0,r.jsx)(zf,{phone:e.phone})},t)}))})}var u=(0,Wu.getPageItemCSSProperties)(t.editStyle);return(0,r.jsx)(Gf,{name:n.name||"",control:o.control,style:u,layoutClassName:"gap-x-[--form-cellPadding] gap-y-[--form-rowHeight]",typeClassName:"w-[--form-fieldLabelWidth] min-w-[--form-fieldLabelWidth] max-w-[--form-fieldLabelWidth]"})},qf=function(e){var t=e.pageItem,n=e.field,o=(0,wn.useContext)(Qf),i=o.form,s=o.view,l=(0,a.useMemo)((function(){return n.listNameDataItems.map((function(e){return{value:e.id,label:e.name}||[]}))}),[n]),c=(0,Wu.getPageItemCSSProperties)(t.editStyle);if(s){var u,d=i.getValues()[n.name||""],f=null==l||null===(u=l.find((function(e){return e.value===d})))||void 0===u?void 0:u.label,m=(0,Wu.getPageItemCSSProperties)(t.style);return n.hideEmpty&&!d?null:(0,r.jsx)(zd,{viewStyle:m,label:n.label||"",value:f})}return(0,r.jsx)(wd,{name:n.name||"",placeholder:n.emptyText||"",label:n.label||"",required:n.required,control:i.control,style:c,options:l,className:"flex items-center gap-x-[--form-cellPadding] gap-y-[--form-rowHeight]",labelClassName:"w-[--form-fieldLabelWidth] min-w-[--form-fieldLabelWidth] max-w-[--form-fieldLabelWidth]"})},Yf=function(e){var t=e.pageItem,n=(0,Wu.getFormElementStyle)(t).height;return(0,r.jsx)(Ju,{height:n})},Kf=function(e){var t=e.pageItem,n=e.field,a=(0,wn.useContext)(Qf),o=a.form;if(a.view){var i=o.getValues()[n.name||""],s=(0,Wu.getPageItemCSSProperties)(t.style);return n.hideEmpty&&!i?null:(0,r.jsx)(zd,{viewStyle:s,label:n.label||"",value:i})}return(0,r.jsx)(Jd,{placeholder:n.emptyText||"",label:n.label,required:n.required,name:n.name||"",control:o.control,minRows:n.initialLinesNumber,multiline:n.multiline,pageItem:t})};var $f=function(e){var t=e.pageItem,n=t.field,o=function(e){var t=(0,wn.useContext)(Qf),n=t.intents,r=t.runtimeVariables;return(0,a.useMemo)((function(){return!(0,Wu.isFieldWithConditions)(e)||!!(0,Wu.checkConditions)({conditions:e.conditions,values:r,intents:n})}),[e,r,n])}(n);if(!o)return null;if("CUSTOM"===(null==n?void 0:n.type))switch(null==n?void 0:n.customType){case"TEXT":return(0,r.jsx)(Kf,{pageItem:t,field:n});case"EMAIL":return(0,r.jsx)(bf,{pageItem:t,field:n});case"PHONE":return(0,r.jsx)(Hf,{pageItem:t,field:n});case"PHONE_LIST":return(0,r.jsx)(Wf,{pageItem:t,field:n});case"EMAIL_LIST":return(0,r.jsx)(wf,{pageItem:t,field:n});case"ADDRESS_LIST":return(0,r.jsx)(Hd,{pageItem:t,field:n});case"DATETIME":return(0,r.jsx)(hf,{pageItem:t,field:n});case"CHECKBOX":return(0,r.jsx)(cf,{pageItem:t,field:n});case"KEY_VALUE_LIST":return(0,r.jsx)(qf,{pageItem:t,field:n});case"NOTES":return(0,r.jsx)(Uf,{pageItem:t,field:n});case"AMOUNT":return(0,r.jsx)(ef,{pageItem:t,field:n});case"IMAGE":return(0,r.jsx)(Pf,{pageItem:t,field:n})}if("STATIC"===(null==n?void 0:n.type))switch(null==n?void 0:n.staticType){case"LINK":return(0,r.jsx)(Df,{field:n});case"TEXT":return(0,r.jsx)(Ef,{field:n});case"SPACER":return(0,r.jsx)(Yf,{pageItem:t});case"BUTTON":return(0,r.jsx)(tf,{field:n});case"MESSENGER":return(0,r.jsx)(Bf,{pageItem:t,field:n})}return"STATIC"===(null==n?void 0:n.type)&&"CONTAINER"===(null==n?void 0:n.staticType)||"STATIC"===(null==n?void 0:n.type)&&"SECTION"===(null==n?void 0:n.staticType)||console.warn("Not supported field type",n),null};function Xf(){var e,t=(0,wn.useContext)(Qf),n=t.formDefinition,o=t.pageIndex,i=(0,a.useMemo)((function(){var e,t,r;return(null==n||null===(r=n.layout)||void 0===r||null===(t=r.pages)||void 0===t||null===(e=t[o])||void 0===e?void 0:e.fields)||[]}),[null==n||null===(e=n.layout)||void 0===e?void 0:e.pages,o]),s=i.filter((function(e){return!(0,Wu.checkIsLayout)(e.field)}));return(0,r.jsx)(r.Fragment,{children:s.map((function(e){return(0,r.jsx)($f,{pageItem:e},e.field.id)}))})}var Qf,Zf=function(e){var t=e.contentItem;return(0,Wu.isRecuriveFormLayout)(t)?(0,r.jsx)("div",{"data-testid":t.key,className:"gap-6",style:(0,Wu.calculateContainerStyle)(t),children:t.content.map((function(e){var t=(0,Wu.isRecuriveFormLayout)(e)?e.key:e.field.id;return(0,r.jsx)(Zf,{contentItem:e},t)}))}):(0,r.jsx)($f,{pageItem:t})};function Jf(){var e,t=(0,wn.useContext)(Qf),n=t.formDefinition,o=t.pageIndex,i=(0,a.useMemo)((function(){var e,t,r;return(null==n||null===(r=n.layout)||void 0===r||null===(t=r.pages)||void 0===t||null===(e=t[o])||void 0===e?void 0:e.fields)||[]}),[null==n||null===(e=n.layout)||void 0===e?void 0:e.pages,o]),s=(0,a.useMemo)((function(){return(0,Wu.transformFormDefinitionsToLayout)(i)}),[i]);return(0,r.jsx)(r.Fragment,{children:s.map((function(e){return(0,r.jsx)(Zf,{contentItem:e},e.key)}))})}function em(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var tm=function(e){var t=e.variables,n=void 0===t?{}:t,o=e.formDefinition,i=e.intents,s=void 0===i?[]:i,l=e.pageIndex,c=void 0===l?0:l,u=e.changeFormPageId,d=e.view,f=void 0!==d&&d,m=e.onFormAvailable,p=e.contactData,v=e.defaultValues,h=e.shouldResetOnChange,b=void 0!==h&&h,y=e.compact,g=void 0!==y&&y,j=(0,Bu.useForm)({defaultValues:v,mode:"onChange",reValidateMode:"onChange"}),I=(0,a.useRef)(!1);(0,a.useEffect)((function(){I.current?b&&(j.reset(v),setTimeout(j.trigger)):I.current=!0}),[b,v,j]),(0,a.useEffect)((function(){null==m||m(j)}),[j,m]);var S=j.watch(),O=(0,a.useMemo)((function(){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){em(e,t,n[t])}))}return e}({},n,(0,Wu.createLeadMappingStringToFormValueMap)(S,o))}),[o,n,S]),x=(0,a.useMemo)((function(){return(0,Wu.getFormCSSVariables)(o)}),[o]),C=(0,a.useMemo)((function(){return{formDefinition:o,pageIndex:c,changeFormPageId:u,view:f,contactData:p,form:j,runtimeVariables:O,intents:s,compact:g}}),[o,c,u,f,p,j,O,s,g]);return Qf||(Qf=(0,wn.createContext)(C)),(0,r.jsxs)(Qf.Provider,{value:C,children:[(0,r.jsx)("div",{style:x,className:"   flex   flex-auto   flex-col   gap-6   bg-[--form-backgroundColor]   text-[--form-textColor]   ",children:g?(0,r.jsx)(Xf,{}):(0,r.jsx)(Jf,{})}),!1]})},nm=n(4995);function rm(e){var t=e.form,n=e.contactId,o=e.toggleEditMode,i=(0,c.useLocalizationState)().t,s=(0,I.useNotificationsState)("methods").showNotification,u=(0,st.useContactsStateMethods)().saveContactDetails,d=(0,st.useContactFormDefinition)("CONTACT_DETAIL"),f=(0,a.useCallback)((function(){(0,l.assertDefined)(t);var e=(0,vd.dirtyValues)(t.formState.dirtyFields,t.getValues()),r=function(){return o()},a=function(){o(),s({type:"error",id:I.Notifications.ContactSaveError,tags:["current-view"],message:i.CONTACT.save_error()})};t.handleSubmit((function(){if((0,l.assertDefined)(d),Object.keys(e).length){var t=(0,Wu.createLeadMappingStringToFormValueMap)(e,d),i=(0,nm.unflatten)(t);u(n,i,{onSuccess:r,onError:a})}else o()}))()}),[t,n,u,s,i.CONTACT,o,d]);return(0,r.jsxs)("div",{className:"flex items-center justify-end gap-2 border-t px-6 py-4",children:[(0,r.jsx)(_e.Button,{onClick:o,tooltip:i.UNDEFINED.button_cancel_contact_title(),"data-testid":"cancel-edit-button",variant:"ghost",children:i.UNDEFINED.button_cancel_contact_text()}),(0,r.jsx)(_e.Button,{onClick:f,tooltip:i.UNDEFINED.button_save_contact_title(),"data-testid":"save-edit-button",variant:"primary",children:i.UNDEFINED.button_save_contact_text()})]})}function am(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function om(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return am(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return am(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var im=function(e){var t=e.toggleEditMode,n=e.contactId,o=(0,c.useLocalizationState)().t,i=(0,st.useContactFormDefinition)("CONTACT_DETAIL"),s=(0,st.useContact)(n),l=null==s?void 0:s.details,u=i&&l?(0,Wu.createFormValues)(i,l):void 0,d=om((0,a.useState)(),2),f=d[0],m=d[1];return i?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex flex-auto flex-col overflow-y-auto overflow-x-hidden px-6",children:[(0,r.jsx)("div",{className:"flex h-16 shrink-0 items-center pb-2 pt-4",children:(0,r.jsx)("h2",{children:o.CONTACT.external_contact()})}),(0,r.jsxs)("div",{className:"flex shrink-0 gap-8 px-6 py-4",children:[(null==s?void 0:s.data)&&(0,r.jsx)(du,{user:null==s?void 0:s.data}),(0,r.jsx)(tm,{formDefinition:i,onFormAvailable:m,defaultValues:u,compact:!0})]})]}),(0,r.jsx)(rm,{form:f,toggleEditMode:t,contactId:n}),!1]}):null};function sm(){var e=(0,st.useContactFormDefinition)("CONTACT_DETAIL");return(0,a.useMemo)((function(){var t,n,r,a,o=((null==e||null===(r=e.layout)||void 0===r||null===(n=r.pages)||void 0===n||null===(t=n[0])||void 0===t?void 0:t.fields)||[]).filter((function(e){return!(0,Wu.checkIsLayout)(e.field)}));return null!==(a=null==o?void 0:o.map(Wu.createFormElement))&&void 0!==a?a:[]}),[e])}function lm(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function cm(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function um(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){cm(e,t,n[t])}))}return e}function dm(e){return function(e){if(Array.isArray(e))return lm(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return lm(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return lm(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var fm=["Contact.phones","Contact.emails","Contact.addresses","Contact.messengers"];function mm(e){var t=e.elements,n=e.values,r=e.srcValues,o=(0,gt.useFormatting)(),i=o.formatPhoneType,s=o.formatEmailType,u=o.formatAddressType,d=o.formatFullName,f=(0,c.useLocalizationState)().t,m=(0,L.useGetMessengerName)(),p=!!r&&!!n;return(0,a.useMemo)((function(){var e=dm(t),a=um({},n),o=um({},r);return p&&(!function(){(0,$.remove)(e,(function(e){return"Contact.first_name"===e.mapping||"Contact.last_name"===e.mapping}));var t=d(null==n?void 0:n["Contact.first_name"],null==n?void 0:n["Contact.last_name"]);if(e.unshift({name:"Contact.name",mapping:"Contact.name",value:t,label:f.CONTACT.full_name(),type:"text"}),a["Contact.name"]=t,r){var i=d(null==o?void 0:o["Contact.first_name"],null==o?void 0:o["Contact.last_name"]);o["Contact.name"]=i}}(),e=dm(e).reduce((function(e,t){var n=function(n,r){"string"==typeof n&&"string"==typeof r&&e.push({name:t.mapping,mapping:t.mapping,label:t.label,type:"radio",options:[{id:n,name:n},{id:r,name:r}]})};if(t.mapping&&(null==o?void 0:o[t.mapping])&&!fm.includes(t.mapping)){var r=t.mapping;(0,l.assertDefined)(r),n(o[r],a[r])}else e.push(t);return e}),[])),e.reduce((function(e,t){if(t.mapping){var o=null==a?void 0:a[t.mapping],l=null==r?void 0:r[t.mapping];if("radio"===t.type)e.push({type:"radio",name:t.mapping,options:t.options,label:t.label});else if("spacer"===t.type){var c;e.push({type:"spacer",height:null==t||null===(c=t.style)||void 0===c?void 0:c.height,name:t.mapping})}else if("button"===t.type){var d=(0,$.omit)(t,["viewStyle","editStyle","containerId"]);e.push({type:"button",button:d,name:t.mapping})}else if("image"===t.type)e.push({type:"image",image:t,value:o,name:t.mapping});else if("messengers"===t.type){var f=t,p=(0,vd.parseMessengers)(null==n?void 0:n[f.mapping]);null==p||p.filter((function(e){return e.type})).forEach((function(n){e.push({type:"messenger",label:t.label||m(n.type),messenger:n})}))}else if("phoneList"===t.type){var v,h=o||[];null===(v=dm(l||[]).concat(dm(h)))||void 0===v||v.forEach((function(n){n.phone&&e.push({label:i(n.type),value:n.phone,type:"number",name:t.mapping})}))}else if("emailList"===t.type){var b,y=o||[];null===(b=dm(l||[]).concat(dm(y)))||void 0===b||b.forEach((function(n){n.email_address&&e.push({label:s(n.type),value:n.email_address,type:"email",name:t.mapping})}))}else if("addressList"===t.type){var g,j=o||[];null===(g=dm(l||[]).concat(dm(j)))||void 0===g||g.forEach((function(n){e.push({label:u(n.type),value:[n.address_line1,n.address_line2,n.city,pd.STATES[n.state],n.postcode].filter(Boolean).join(", "),name:t.mapping})}))}else if("label"===t.type&&t.value)e.push({label:t.value,name:t.mapping});else if(!t.hideEmpty||o&&"string"==typeof o){var I=o;if("select"===t.type){var S,O,x=null==t||null===(O=t.options)||void 0===O||null===(S=O.find((function(e){return e.id===I})))||void 0===S?void 0:S.name;t.label&&e.push({value:x,label:t.label,name:t.mapping})}else"email"===t.type?t.label&&e.push({type:"email",value:I,label:t.label,name:t.mapping}):"link"===t.type?e.push({type:"link",value:t.linkUrl,label:t.value||t.linkUrl,name:t.mapping}):"dateTime"===t.type?t.label&&e.push({label:t.label,value:I&&(0,rt.formatDate)(I,{birthday:!0}),name:t.mapping}):t.label&&e.push({label:t.label,value:I,name:t.mapping})}}return e}),[])}),[t,u,s,d,i,m,p,r,f.CONTACT,n])}var pm=function(){var e=(0,c.useLocalizationState)().t.WINDOW_POPUP_TITLES_AND_MESSAGES.window_title_warning();return(0,r.jsx)(r.Fragment,{children:e})},vm=function(e){var t=e.name,n=(0,c.useLocalizationState)().t;return(0,r.jsx)("div",{children:(0,r.jsx)("p",{children:n.UNDEFINED.contact_deleting_confirmation(t)})})},hm=function(e){var t=(0,c.useLocalizationState)().t,n=e.closeModal,o=e.onConfirm,i=(0,a.useCallback)((function(){n(),o()}),[n,o]);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(L.SemanticButton,{enabledInOffline:!0,onClick:n,"data-testid":"cancel-button",children:t.WINDOW_POPUP_TITLES_AND_MESSAGES.window_buttonCancel()}),(0,r.jsx)(L.SemanticButton,{primary:!0,onClick:i,"data-testid":"confirm-button",children:t.WINDOW_POPUP_TITLES_AND_MESSAGES.window_buttonOk()})]})};function bm(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ym(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){bm(e,t,n[t])}))}return e}function gm(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function jm(e){var t=(0,yo.useNavigationState)("goBack"),n=(0,c.useLocalizationState)("t").CONTACT,o=(0,gt.useFormatting)().formatFullName,i=(0,I.useNotificationsState)("methods").showNotification,s=(0,st.useContactsState)("contacts"),l=(0,st.useContactsStateMethods)().deleteContact,u=(0,yt.useGetDirectLink)(),d=s[e]||{},f=d.data,m=d.details,p=(0,ie.useModalsStateMethods)().openModal,v=(0,a.useCallback)((function(){var t=u(void 0,e);y.clipboard.copy(t)}),[e,u]),h=(0,a.useCallback)((function(){var e=function(){return i({type:"error",id:I.Notifications.ContactDeleteError,tags:["current-view"],message:n.delete_error()})},a=o(null==f?void 0:f.firstName,null==f?void 0:f.lastName)||"No name";p(function(e,t){var n=t.name;return{dataKey:"delete-contact-warning-button",title:(0,r.jsx)(pm,{}),body:(0,r.jsx)(vm,{name:n}),actions:function(t){var n=t.closeModal;return(0,r.jsx)(hm,{closeModal:n,onConfirm:e})}}}((function(){f?l(f.Id.oid).then(t).catch(e):e()}),{name:a}))}),[f,l,o,t,p,i,n]),b=(0,it.useOpenGlobalSlidingModal)();return{handleDelete:h,handleCopyLink:v,handleMerge:(0,a.useCallback)((function(){b("mergeContacts",{srcContactDetails:gm(ym({},m),{id:e}),onMerge:function(){un.bpLogger.warn("TODO: Some server method is needed in order to replace","outdated contact in entries like recent or favorites")}})}),[m,e,b])}}function Im(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Sm(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Im(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Im(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Om=function(e){var t=e.handleMerge,n=e.handleCopyLink,o=Sm((0,a.useState)(0),2),i=o[0],s=o[1],l=(0,c.useLocalizationState)().t,u=(0,y.useBoolean)(),f=u.value,m=u.toggle,p=function(e){var t=e.setLinkClicks,n=e.toggleShow,r=e.handleMerge,o=e.handleCopyLink,i=(0,c.useLocalizationState)().t,s=(0,a.useCallback)((function(){n()}),[n]),l=(0,a.useCallback)((function(){o(),t((function(e){return++e})),n()}),[n,t,o]),u=(0,a.useCallback)((function(){r(),n()}),[n,r]);return(0,a.useMemo)((function(){return[{children:i.CONTACT.open_in_crm(),onClick:s},{children:i.GLOBAL.copy_shareable_link(),onClick:l},{children:i.CONTACT.merge_to_existing(),onClick:u}]}),[i,s,l,u])}({setLinkClicks:s,toggleShow:m,handleMerge:t,handleCopyLink:n});return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(j.TriggerDropdown,{modal:!1,open:f,onOpenChange:m,className:"group z-10",align:"start",options:(0,r.jsx)(r.Fragment,{children:p.map((function(e,t){return(0,r.jsx)(j.ButtonDropdown.Item,{onClick:e.onClick,children:e.children},t)}))}),children:(0,r.jsx)(_e.Button,{variant:"ghost",icon:(0,r.jsx)(j.IconMenu24,{})})}),!!i&&(0,r.jsx)(d.SmLabel,{pointing:"left",className:"animate-copied-label select-none",children:l.CONTACT.copied_confirmation_label_text()},i)]})},xm=function(e){var t=e.toggleEditMode,n=e.contactId,a=(0,at.useSessionState)().privileges,o=(0,c.useLocalizationState)().t,i=jm(n),s=i.handleDelete,l=i.handleCopyLink,u=i.handleMerge;return(0,r.jsxs)("div",{className:"flex items-center gap-2 px-6 pb-2 pt-4",children:[(0,r.jsx)("h2",{children:o.CONTACT.external_contact()}),!!a.EDIT_CONTACTS&&(0,r.jsx)(_e.Button,{onClick:t,variant:"ghost",tooltip:o.UNDEFINED.button_edit_contact_title(),"data-testid":"edit-contact-button",icon:(0,r.jsx)(j.IconEdit24,{})}),!!a.DELETE_CONTACTS&&(0,r.jsx)(_e.Button,{onClick:s,variant:"ghost",tooltip:o.UNDEFINED.button_delete_contact_title(),"data-testid":"delete-contact-button",icon:(0,r.jsx)(j.IconDelete24,{}),children:o.UNDEFINED.button_delete_contact_text()}),(0,r.jsx)(Om,{handleCopyLink:l,handleMerge:u})]})};function Cm(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var _m=function(e){var t=e.toggleEditMode,n=e.contactId,a=(0,te.useCallHandler)(),o=(0,te.useActivityHistoryOpener)(),i=sm(),s=(0,st.useContact)(n),l=null==s?void 0:s.details,c=mm({elements:i,values:l}),u=(0,y.useEvent)((function(e,t){var r,i,l,c;"voice"===t?a({contactId:n,phone:e,firstName:null==s||null===(r=s.data)||void 0===r?void 0:r.firstName,lastName:null==s||null===(i=s.data)||void 0===i?void 0:i.lastName,navigateToInteractionsPage:!0,origination:"contact-profile"}):o({contactId:n,phone:e,firstName:null==s||null===(l=s.data)||void 0===l?void 0:l.firstName,lastName:null==s||null===(c=s.data)||void 0===c?void 0:c.lastName,origination:"contact-profile"})}));return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(xm,{contactId:n,toggleEditMode:t}),(0,r.jsxs)("div",{className:"flex shrink-0 gap-8 px-6 py-4",children:[(null==s?void 0:s.data)&&(0,r.jsx)(du,{user:null==s?void 0:s.data}),(0,r.jsx)("div",{role:"list",className:"grow",children:c.map((function(e,t){return e.value||e.messenger?(0,r.jsx)(ad,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Cm(e,t,n[t])}))}return e}({values:l,contactId:n,additionalControls:(0,r.jsx)(qc.ExternalContactFieldFavoriteButton,{contactId:n,field:e,onPhoneInteraction:u})},e),t):null}))})]})]})},wm=function(e){var t=e.contactId,n=(0,yo.useNavigationState)("goBack"),o=(0,c.useLocalizationState)().t,s=(0,ie.useModalsStateMethods)().openModal,l=(0,i.useActiveInteractionId)(),u=(0,st.useContact)(t),d=(0,st.useContactsState)("formDefinitionsLoading"),f=(0,st.useContactsStateMethods)(),m=f.getContact,p=f.getContactDetails,v=f.getContactFormsDefinitions,h=u||{},b=h.data,g=h.contactDetailsUpdating,j=h.contactDetailsLoading,S=h.isLoading,O=(0,y.useBoolean)(),x=O.value,C=O.toggle,_=(0,a.useCallback)((function(){var e=function(){C(!1),n()};x?s(function(e){return{dataKey:"contact-details-go-back-modal",title:(0,r.jsx)(dd,{}),body:(0,r.jsx)(fd,{}),actions:function(t){var n=t.closeModal;return(0,r.jsx)(md,{closeModal:n,onConfirm:e})}}}(e)):e()}),[x,n,s,C]),w=(0,I.useNotificationsState)("methods").showNotification;(0,a.useEffect)((function(){Promise.all([m({id:t}),v({}),p({id:t})]).then((function(e){if(!e.every(Boolean))throw Error()})).catch((function(){n(),w({type:"error",id:I.Notifications.ContactOpenError,tags:["current-view"],message:o.CONTACT.open_error(),duration:7e3})}))}),[]);var N=!b||d||j||S||g;return(0,r.jsx)("div",{className:"flex min-h-0 flex-auto flex-col overflow-y-auto overflow-x-hidden","data-testid":"contact-details",children:N?(0,r.jsx)(L.Loader,{size:"large",color:"primary",active:!0}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(id,{user:b,onGoBack:_}),x?(0,r.jsx)(im,{toggleEditMode:C,contactId:t}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex items-center gap-2 px-6 pb-2 pt-4",children:[(0,r.jsx)(iu,{itemId:l}),(0,r.jsx)(Fu,{user:b})]}),(0,r.jsx)(_m,{toggleEditMode:C,contactId:t})]})]})})},Nm=function(e){var t=e.phone,n=e.firstName,o=e.lastName,s=(0,i.useInteractionStateMethods)(),l=(0,yo.useNavigationState)("setActivePage"),u=(0,c.useLocalizationState)().t,d=(0,a.useCallback)((function(){t&&(s.createPotentialItem({phone:t,firstName:n,lastName:o}),l({name:yo.AppRoutes.Interactions}))}),[s,t,n,o,l]),f=(0,te.useCallHandler)(),m=(0,$.partial)(f,{firstName:n,lastName:o,phone:t,navigateToInteractionsPage:!0});return(0,r.jsxs)("div",{className:"-mr-1 ml-auto flex flex-none items-center",children:[(0,r.jsx)(L.CircleButton,{noActiveState:!0,onClick:d,tooltip:u.CONTACT.button_initiate_chat_text(),className:"!h-10 !w-10","data-testid":"chat-button",children:(0,r.jsx)(ve.IconChat,{})}),(0,r.jsx)(L.CircleButton,{noActiveState:!0,onClick:m,tooltip:u.CONTACT.button_start_call_text(),className:"!h-10 !w-10","data-testid":"call-button",children:(0,r.jsx)(ve.IconPhone,{})})]})};function Am(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Pm(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Am(e,t,n[t])}))}return e}function Em(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var Dm=function(e){var t=e.title,n=e.onGoBack,a=e.recentItem,o=Em(e,["title","onGoBack","recentItem"]);return(0,r.jsxs)("div",{className:"relative flex pr-3.5",children:[(0,r.jsx)("div",{className:"mr-4 shrink-0",children:(0,r.jsx)(L.GoBackButton,{onClick:n})}),(0,r.jsx)(jt.AvatarLegacy,{size:60,type:"unknown"}),(0,r.jsxs)("div",{className:"flex grow items-center overflow-hidden",children:[t&&(0,r.jsxs)("div",{className:"ml-2 flex overflow-hidden text-2xl font-bold leading-[30px]",role:"alert","data-testid":"name",children:[(0,r.jsx)("div",{className:"truncate",children:t}),!!a&&(0,r.jsx)(qc.RecentFavoriteButton,{item:a,className:"ml-2 text-lg"})]}),(o.messengerId||o.phone)&&(0,r.jsx)(Nm,Pm({},o))]})]})},Tm=function(e){var t=e.firstName,n=e.lastName,a=e.id,o=e.phone,i=e.email,s=e.className,l=(0,gt.useFormatting)().formatFullName,c=(0,yt.useGetContactPictureUrl)(),u=l(t,n);return(0,r.jsxs)("section",{className:M(s,"flex"),children:[(0,r.jsx)(jt.AvatarLegacy,{size:60,firstName:t,lastName:n,initialsClassName:"text-2xl",url:c(a),type:a?"contact":"unknown"}),(0,r.jsxs)("div",{className:"ml-2",children:[u&&(0,r.jsx)("h4",{className:"mx-0 mb-0 mt-0.5 text-base",children:u}),o&&(0,r.jsx)("p",{className:"mx-0 mb-0 mt-1 text-main-secondary",children:(0,rt.formatPhone)(o)}),i&&(0,r.jsx)("p",{className:"mx-0 mb-0 mt-1 text-main-secondary",children:i})]})]})};function km(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Mm(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Lm(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Mm(e,t,n[t])}))}return e}function Rm(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Fm(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||Um(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Bm(e){return function(e){if(Array.isArray(e))return km(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Um(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Um(e,t){if(e){if("string"==typeof e)return km(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?km(e,t):void 0}}function zm(e){var t=e.handleSubmit,n=e.contactId,r=e.distContactDetails,o=e.onMerge,i=e.srcContactDetails,s=Fm((0,a.useState)(!1),2),l=s[0],u=s[1],d=(0,c.useLocalizationState)().t,f=(0,I.useNotificationsState)("methods").showNotification,m=(0,it.useOpenGlobalSlidingModal)(),p=(0,gt.useFormatting)().getNamesFromDisplayName,v=(0,st.useContactsStateMethods)();return{submitting:l,onSubmit:(0,a.useMemo)((function(){return t((function(e){if(n){u(!0);var t=(0,nm.unflatten)(function(e){var t=Lm({},e),n=t["Contact.name"];if("string"==typeof n){var r=Fm(p(n),2),a=r[0],o=r[1];delete t["Contact.name"],t["Contact.first_name"]=a,t["Contact.last_name"]=o}return t}(Lm({},r,fm.reduce((function(e,t){return Lm({},e,function(e){var t,n;return Mm({},e,Bm(null!==(t=null==i?void 0:i[e])&&void 0!==t?t:[]).concat(Bm(null!==(n=null==r?void 0:r[e])&&void 0!==n?n:[])))}(t))}),{}),(0,nm.flatten)(e))));v.saveContactDetails(n,t,{onSuccess:function(){null==o||o(Rm(Lm({},t),{id:n}),i),m("mergeContacts"),u(!1)},onError:function(){u(!1),f({type:"error",id:I.Notifications.ContactMergeError,tags:["current-view"],message:d.VALIDATION.CONTACT_MERGE_ERROR(),duration:1e4})}})}}))}),[n,v,r,p,t,o,f,i,d.VALIDATION,m])}}function Hm(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Vm(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}var Gm=function(e){var t=e.mergeFormPreparing,n=e.srcContactDetails,a=e.distContactDetails,o=e.contactId,i=e.onMerge,s=(0,c.useLocalizationState)().t,l=(0,Bu.useForm)(),u=l.control,f=l.handleSubmit,m=mm({elements:sm(),values:a,srcValues:n}),p=zm({srcContactDetails:n,onMerge:i,contactId:o,handleSubmit:f,distContactDetails:a}),v=p.submitting,h=p.onSubmit;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(d.SmForm,{className:"overflow-hidden pt-5 text-left",children:[(0,r.jsx)("h3",{className:"m-0 text-xl",children:s.CONTACT.merge_form_title()}),(0,r.jsx)("section",{className:"pt-4",children:!t&&(0,r.jsx)(d.SmList,{divided:!0,relaxed:!0,children:m.map((function(e,t){return(0,r.jsx)(ad,Vm(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Hm(e,t,n[t])}))}return e}({values:a,contactId:o},e),{control:u}),t)}))})}),(0,r.jsx)(L.SemanticButton,{className:"mt-3.5 h-8 px-6",onClick:h,disabled:v,primary:!0,children:s.CONTACT.merge_contacts()}),(0,r.jsx)(L.Loader,{active:v,color:"primary",size:"big"})]}),!1]})};function Wm(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function qm(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ym(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){qm(e,t,n[t])}))}return e}function Km(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function $m(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Wm(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Wm(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Xm(e){return{value:e.id,as:function(t){return(0,r.jsx)(d.SmDropdown.Item,Km(Ym({},t),{className:"!px-4 !py-1",children:(0,r.jsx)(Tm,Ym({},e))}))}}}function Qm(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Zm(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Qm(e,t,n[t])}))}return e}function Jm(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}var ep=function(e){var t=e.srcContactDetails,n=e.onMerge,o=(0,c.useLocalizationState)().t,i=(0,st.useContactsStateMethods)().getContactFormsDefinitions;(0,a.useEffect)((function(){i({})}),[i]);var s=function(){var e=$m((0,a.useState)(),2),t=e[0],n=e[1],r=$m((0,a.useState)(!1),2),o=r[0],i=r[1],s=$m((0,a.useState)(""),2),l=s[0],c=s[1],u=(0,st.useContactsStateMethods)(),d=$m((0,a.useState)(!1),2),f=d[0],m=d[1],p=$m((0,a.useState)([]),2),v=p[0],h=p[1],b=(0,y.useAsRef)(l),g=(0,a.useCallback)((function(e){var t=function(e){return b.current!==e};if(t(e))return h([]),void m(!1);u.getContactList({query:e}).then((function(n){n&&!t(e)&&h(null==n?void 0:n.map(Xm))})).finally((function(){m(!1)}))}),[u,b]),j=(0,a.useRef)((0,$.debounce)(g,300)).current,I=(0,a.useCallback)((function(e,t){var n=t.searchQuery;n?(m(!0),j(n)):h([]),c(n)}),[j]),S=(0,a.useCallback)((function(e,t){var r=t.value;"string"==typeof r&&(i(!0),u.getContactDetails({id:r,force:!0}).then((function(e){e&&n(Km(Ym({},e),{id:r}))})).catch((function(e){un.bpLogger.error((0,y.getErrorMessage)(e))})).finally((function(){i(!1)})))}),[u]),O=(0,a.useCallback)((function(){return f||o?[]:v}),[f,o,v]);return{mergeFormPreparing:o,distContactDetails:t,searchQuery:l,contactsAreLoading:f,options:v,methods:{search:O,handleSearchChange:I,handleSelect:S}}}(),l=s.distContactDetails,u=s.searchQuery,d=s.contactsAreLoading,f=s.mergeFormPreparing,m=s.options,p=s.methods,v=p.search,h=p.handleSearchChange,b=p.handleSelect,g=(null==t?void 0:t.id)||(null==l?void 0:l.id);return(0,r.jsxs)("div",{className:"flex-auto overflow-auto pt-[5px] ",children:[(0,r.jsx)(L.Dropdown,{fluid:!0,search:v,clearable:!0,selection:!0,searchQuery:u,loading:d,placeholder:o.CONTACT.search_contact_to_merge(),onSearchChange:h,onChange:b,options:m,menuClassName:"[&>:global(.visible.menu)]:!max-h-[calc(100vh-260px)] !max-h-[calc(100vh-260px)]"}),!l&&(0,r.jsx)(Tm,Jm(Zm({},(0,Pr.contactDetailsToContactShortType)(t)),{className:"mt-4 text-left text-lg"})),g&&t&&l&&!f&&(0,r.jsx)(Gm,{mergeFormPreparing:f,contactId:g,srcContactDetails:t,distContactDetails:l,onMerge:n}),(0,r.jsx)(L.Loader,{active:f,color:"primary",size:"big"})]})},tp=(0,Ta.atom)(!1),np=(0,Ta.atom)(void 0),rp=(0,Ta.atom)(null),ap=(0,Ta.atom)(null);var op=n(2443),ip=n(8823),sp=n(5733);function lp(e){return"userId"in e}function cp(e){return"mediaType"in e&&"title"in e}function up(e){return cp(e)?e.title:e.firstName+e.lastName}function dp(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function fp(e){return function(e){if(Array.isArray(e))return dp(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return dp(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return dp(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var mp="0123456789",pp=(0,$.fromPairs)(fp(Array.from("abcdefghijklmnopqrstuvwxyz").map((function(e){return["Key".concat(e.toUpperCase()),e]}))).concat(fp(Array.from(mp).map((function(e){return["Digit".concat(e),e]}))),fp(Array.from(mp).map((function(e){return["Numpad".concat(e),e]}))))),vp=function(e,t){return-1!=="+*#:,".indexOf(e)?e:pp[t]},hp=function(e){var t=e.split(":"),n=t.length>1?t[0]+":"+t.slice(1).join():e;return(0,X.digitizePhone)(("+"===n[0]?"+":"")+n.replace(/[^\d*#,:a-z|A-Z]/g,""))},bp=n(1201);function yp(){var e=(0,L.useCountrySelectorState)("countrySelectorValue");return(0,a.useCallback)((function(t){if(e===L.ALL_COUNTRIES_ID)return{formattedNumber:t};var n=bp.phoneNumberFormatter.format(t,e);return{formattedNumber:n.success?gp(n.formatted.E164):t,meta:n}}),[e])}function gp(e){if(e)return"+"===e[0]?e.substring(1):e}function jp(){var e=(0,nl.useCommunicatorUIState)("dialpad").searchValue,t=yp();return(0,a.useMemo)((function(){var n=(0,X.digitizePhone)(e),r=t(n),a=r.formattedNumber,o=r.meta,i=void 0===o?{success:!1,countryCodeSource:0}:o;return{phoneNumber:a,isValidPhoneNumber:i.success,countryCodeSourceFromPrefix:!i.success||i.countryCodeSource===bp.PhoneNumberUtilCountryCodeSource.FROM_DEFAULT_COUNTRY}}),[e,t])}function Ip(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Sp(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ip(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ip(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Op(e){var t,n=(0,at.useSessionState)().privileges,r=(t=(0,at.useSessionState)().userId,(0,a.useCallback)((function(e){return t&&e===t}),[t])),o=(0,Gc.useDirectoryState)("searchResults"),i=(0,Gc.useDirectoryStateMethods)().findContacts,s=!!Object.keys(n).length,l=(0,a.useMemo)((function(){var t,a,i=s&&n.CAN_VIEW_DIRECTORY&&null!==(a=null===(t=o.dialpad)||void 0===t?void 0:t.data.users)&&void 0!==a?a:[];return(null==e?void 0:e.length)&&i.length?i.filter((function(t){var n=t.extension,a=t.userId;return n.includes(e)&&!r(a)&&function(e){return new RegExp(sp.PHONE_NUMBER_VALID_SYMBOLS_REGEX).test(e)}(n)})):i}),[n.CAN_VIEW_DIRECTORY,s,e,o]),c=(0,a.useMemo)((function(){return(0,$.partialRight)(i,"dialpad",0)}),[i]),u=(0,a.useMemo)((function(){var e,t;return null!==(t=null===(e=o.dialpad)||void 0===e?void 0:e.isLoading)&&void 0!==t&&t}),[o]);return(0,a.useMemo)((function(){return{internalContacts:l,getInternalContactsByQuery:c,internalContactsLoading:u}}),[c,l,u])}function xp(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Cp(e){return function(e){if(Array.isArray(e))return xp(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return xp(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return xp(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function _p(){var e=(0,Ta.useAtomValue)(np),t=!!(0,Ta.useAtomValue)(np),n=jp().phoneNumber,r=Op(n),o=r.internalContacts,i=r.internalContactsLoading,s=r.getInternalContactsByQuery,l=(0,c.useLocalizationState)().language,u=function(){var e=(0,st.useContactsStateMethods)().getContactList,t=(0,st.useContactsState)(["contactListLoading","contactList"]),n=t.contactList,r=t.contactListLoading,o=(0,a.useCallback)((function(t){return e({query:"phone: ".concat(t,"*")})}),[e]);return(0,a.useMemo)((function(){return{externalContacts:n,externalContactsLoading:r,getExternalContactsByQuery:o}}),[n,r,o])}(),d=u.externalContacts,f=u.externalContactsLoading,m=u.getExternalContactsByQuery,p=function(e){var t=(0,Gc.useDirectoryState)("categoryEntries");return(0,a.useMemo)((function(){var n=[];return Object.values(t).map((function(t){t.forEach((function(t){var r;e&&!(null===(r=t.number)||void 0===r?void 0:r.includes(e))||n.push(t)}))})),n}),[t,e])}(n),v=function(e){var t=e.searchQuery,n=e.skipSearch,r=e.getExternalContactsByQuery,o=e.getInternalContactsByQuery,i=Sp((0,a.useState)(!1),2),s=i[0],l=i[1],c=(0,yo.useNavigationState)().activePage.params,u=(0,$.get)(c,"prev");return(0,a.useEffect)((function(){var e,a=function(){t&&(o(t),r(t)),l(!1)};return n||(u===yo.AppRoutes.ContactDetails?a():(l(!0),e=setTimeout(a,500))),function(){l(!1),e&&clearTimeout(e)}}),[r,o,u,n,t,l]),s}({searchQuery:n,skipSearch:t,getExternalContactsByQuery:m,getInternalContactsByQuery:s}),h=i||f||v,b=(0,a.useMemo)((function(){var e=Cp(o).concat(Cp(d),Cp(p)).sort((function(e,t){return up(e).localeCompare(up(t),l,{sensitivity:"base"})}));return n?e:[]}),[o,d,p,n,l]),y=(0,a.useMemo)((function(){return e?b.filter((function(t){var n=lp(t)?t.userId:t.id;return e===n})):b}),[b,e]);return(0,a.useMemo)((function(){return{contacts:y,isLoading:h}}),[y,h])}function wp(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Np(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ap(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Pp(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||Dp(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ep(e){return function(e){if(Array.isArray(e))return wp(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||Dp(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Dp(e,t){if(e){if("string"==typeof e)return wp(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?wp(e,t):void 0}}var Tp=null,kp=function(){var e=Pp((0,Ta.useAtom)(tp),2),t=e[0],n=e[1],r=(0,Ta.useSetAtom)(np),o=_p().contacts,s=(0,nl.useCommunicatorUIState)("dialpad"),d=s.searchValue,f=s.setSearchValue,m=(0,Ta.useAtomValue)(rp),p=(0,xn.useServiceState)().selectedService,v=(0,On.useDIDNumberState)().selectedDIDNumber,h=(0,i.useInteractionStateMethods)(),b=(0,te.useActivityHistoryOpener)(),y=(0,u.useIntegrationApiStateRef)(),g=(0,yo.useNavigationState)("setActivePage"),j=(0,I.useNotificationsState)("methods"),S=j.showNotification,O=j.hideNotificationsByTag,x=(0,Ha.useErrorValidation)(),C=(0,c.useLocalizationState)().t,_=yp(),w=(0,op.useLocalSettings)(),N=(0,a.useCallback)((function(e){n(e)}),[n]),A=(0,a.useCallback)((function(){return N(!1)}),[N]),P=(0,a.useCallback)((function(){return N(!0)}),[N]),E=(0,a.useMemo)((function(){return{noNumber:C.DIAL_PAD.error_empty_number}}),[C]),D=(0,a.useCallback)((function(e,n){r(n),O("interaction-init"),t||P(),f(e)}),[r,O,t,P,f]),T=o[0],k=o.length,M=(0,a.useMemo)((function(){return 1!==k?{}:cp(T)?T.number===d?{userId:T.id,firstName:T.title}:{}:lp(T)?T.extension===d?{userId:T.userId,firstName:T.firstName,lastName:T.lastName}:{}:T.phone===d?{contactId:T.id,firstName:T.firstName,lastName:T.lastName}:{}}),[k,T,d]),L=(0,a.useCallback)((function(e){if(!e)return{start:0,end:0};if(m){var t=Pp((0,ip.getInputCaretPos)(m),2),n=t[0],r=t[1],a=n+e.length;return Tp={input:m,pos:[a,a]},{start:n,end:r}}}),[m]),R=(0,a.useCallback)((function(e){if(!e)return!1;if(!m)return D(d+e),!0;var t=L(e);if(t){var n=hp(d.slice(0,t.start)+e+d.slice(t.end));return D(n),requestAnimationFrame((function(){Tp&&(0,ip.setInputCaretPos)(Tp.input,Tp.pos)})),d!==n}}),[D,d,L,m]),F=(0,i.useActiveInteractionProp)((function(e){var t;return null==e||null===(t=e.callData)||void 0===t?void 0:t.callId})),B=(0,i.useActiveInteractionProp)((function(e){return"delivered"===(null==e?void 0:e.state)&&"voice"===(null==e?void 0:e.mediaType)})),U=(0,a.useCallback)((function(e){O("interaction-init"),R(e),B&&F&&h.sendDtmf({dtmf:e.trim(),callId:F})}),[F,O,h,B,R]),z=(0,a.useCallback)((function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},r=n.contactId,a=n.userId,o=n.firstName,i=n.lastName;O("interaction-init");var s=(0,X.digitizePhone)(e),l=_(s).formattedNumber;(a||s)&&(b({contactId:r,userId:a,phone:l,firstName:o,lastName:i,origination:t}),f(""))}),[f,O,_,b]),H=(0,a.useCallback)((function(){w.get("adLastCalledNumber").then((function(e){e&&f(e)}))}),[w,f]),V=(0,a.useCallback)((function(){d?z(d,"dialpad",M):H()}),[d,z,M,H]),G=(0,a.useCallback)((function(e,t,n){var r=Ep(x.getNumberErrors({number:d||e,errorMessages:E})).concat(Ep(x.getServiceAndDIDNumbersErrors({skip:["noChatInService"],interactionType:"call"})));if(r.length)S(r[0]);else if(O("interaction-init"),e){var a=(0,X.digitizePhone)(e),o=_(a).formattedNumber;(0,l.assertDefined)(o);var i=y.current.deferredDialData,s=(null==i?void 0:i.number)===e&&(null==i?void 0:i.objects.length)?i.objects:null==n?void 0:n.associatedRecords;h.initiateCall(Ap(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Np(e,t,n[t])}))}return e}({},n),{phone:o,serviceId:p,accessNumberId:v,associatedRecords:s,origination:t})),g({name:yo.AppRoutes.Interactions}),f("")}}),[x,d,E,_,O,S,y,h,p,v,g,f]),W=(0,a.useMemo)((function(){return function(){return d?G(d,"dialpad",M):H()}}),[G,M,d,H]),q=(0,a.useCallback)((function(e){var t=e.id,n=e.phone;P(),D(n,t);var r=n.length;m&&(m.focus(),Tp={input:m,pos:[r,r]})}),[P,D,m]);return(0,a.useMemo)((function(){return{callNumber:G,closeDialpad:A,initiateChatWith:z,onButtonClick:U,onCallClick:W,onChatClick:V,onContactSelect:q,onInputValueChange:D,openDialpad:P,updateCaretPosition:L}}),[G,A,z,U,W,V,q,D,P,L])},Mp=function(e){var t=e.value,n=e.additionalValue;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("p",{className:"flex flex-col items-center justify-center text-[22px] leading-[26px]",children:t}),void 0!==n&&(0,r.jsx)("span",{className:"h-3 text-[9px] uppercase tracking-[1.44px]",children:n})]})};function Lp(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Rp(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Fp(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Bp(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function Up(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Lp(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Lp(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var zp=function(e){var t=e.onClick,n=e.onHold,o=e.children,i=Bp(e,["onClick","onHold","children"]),s=Up((0,a.useState)(),2),l=s[0],c=s[1],u=Up((0,a.useState)(!1),2),d=u[0],f=u[1];(0,a.useEffect)((function(){return function(){l&&clearTimeout(l)}}));var m=(0,a.useCallback)((function(e){c(void 0),n&&n(e)}),[n]),p=(0,a.useCallback)((function(e){var t=setTimeout((function(){return m(e)}),1e3);c(t)}),[m]),v=(0,a.useCallback)((function(e){l&&(clearTimeout(l),c(void 0),t&&t(e))}),[t,l]),h=(0,a.useCallback)((function(e,t,n){if(n){if(d)return;f(!0)}else f(!1);"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),t(e))}),[d]),b=(0,a.useCallback)((function(e){return h(e,p,!0)}),[h,p]),y=(0,a.useCallback)((function(e){return h(e,v)}),[h,v]);return(0,r.jsx)(L.Button,Fp(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Rp(e,t,n[t])}))}return e}({onMouseDown:p,onMouseUp:v,onTouchStart:p,onTouchEnd:v,onKeyDownCapture:b,onKeyUp:y},i),{children:o}))};var Hp=function(e){return"*"===e?"asterisk":"#"===e?"hashtag":e},Vp=function(e){var t=e.handleButtonClick,n=e.allowLetterBasedDialing;!function(e){var t=e.allowLetterBasedDialing,n=void 0===t||t,r=e.handleButtonClick;(0,a.useEffect)((function(){var e=function(e){if(!(0,y.isSelectOrTextField)(document.activeElement)&&!e.altKey&&!e.ctrlKey){var t=vp(e.key,e.code)||"";/^[/d*#+:a-z|A-Z]$/.test(t)&&setTimeout(r(t),0)}};return n&&document.addEventListener("keydown",e),function(){n&&document.removeEventListener("keydown",e)}}),[n,r])}({handleButtonClick:t,allowLetterBasedDialing:void 0===n||n});var o=(0,c.useLocalizationState)().t,i=(0,a.useMemo)((function(){return[[{value:"1",additionalValue:""},{value:"2",additionalValue:o.DIAL_PAD.letter2()},{value:"3",additionalValue:o.DIAL_PAD.letter3()}],[{value:"4",additionalValue:o.DIAL_PAD.letter4()},{value:"5",additionalValue:o.DIAL_PAD.letter5()},{value:"6",additionalValue:o.DIAL_PAD.letter6()}],[{value:"7",additionalValue:o.DIAL_PAD.letter7()},{value:"8",additionalValue:o.DIAL_PAD.letter8()},{value:"9",additionalValue:o.DIAL_PAD.letter9()}],[{value:"*",label:(0,r.jsx)("span",{className:"h-3.5 text-[25px]",children:"*"})},{value:"0",holdAction:!0,additionalValue:"+"},{value:"#",label:(0,r.jsx)("span",{className:"text-xl",children:"#"})}]]}),[o]),s=M("flex h-full w-full flex-col items-center justify-center","rounded-full","font-noto text-neutral-on-secondary","transition-colors state-layer-bg-neutral-50","hover:state-layer-mix-dark-on-white-1","focus:state-layer-mix-dark-on-white-2","active:state-layer-mix-dark-on-white-3");return(0,r.jsx)("div",{className:"grid gap-2.5",children:i.map((function(e,n){return(0,r.jsx)("div",{className:"flex items-center gap-[11px]",children:e.map((function(e){return(0,r.jsx)("div",{className:M("flex h-[55px] w-[55px] items-center justify-center"),children:e.holdAction&&e.additionalValue?(0,r.jsx)(zp,{className:s,onClick:t(e.value),onHold:t(e.additionalValue),"data-testid":"keypad-".concat(Hp(e.value),"-button"),children:(0,r.jsx)(Mp,{value:e.label||e.value,additionalValue:e.additionalValue})}):(0,r.jsx)(L.Button,{className:s,onClick:t(e.value),"data-testid":"keypad-".concat(Hp(e.value),"-button"),children:(0,r.jsx)(Mp,{value:e.label||e.value,additionalValue:e.additionalValue})})},e.value)}))},n)}))})},Gp=function(){var e=(0,c.useLocalizationState)().t,t=(0,Ta.useAtomValue)(tp),n=(0,Ta.useAtomValue)(rp),o=kp(),i=o.onButtonClick,s=o.closeDialpad,l=o.openDialpad,u=(0,a.useCallback)((function(e){e.deltaY<-10&&s()}),[s]),d=(0,a.useCallback)((function(e){return function(){i(e),null==n||n.focus()}}),[i,n]);return(0,r.jsxs)("div",{className:M("absolute inset-x-0 bottom-0 overflow-hidden","flex flex-col","border-t bg-white","transition-all duration-300",{"h-[calc(100%-105px)]":t,"h-14":!t}),children:[(0,r.jsxs)("div",{className:"flex w-full items-center justify-between px-6 py-3",children:[(0,r.jsxs)("div",{className:"flex items-center gap-1",children:[(0,r.jsx)(ve.IconDialpad,{}),(0,r.jsx)("div",{className:"uppercase tracking-[0.8px] caption-xs text-neutral-disabled",children:e.DIAL_PAD.dialpad()})]}),(0,r.jsx)(_e.Button,{variant:"ghost",size:"sm",icon:t?(0,r.jsx)(j.IconArrowDown24,{}):(0,r.jsx)(j.IconArrowUp24,{}),onClick:t?s:l,"aria-label":e.DIAL_PAD.hide_controls_label(),"data-testid":"collapse-keypad"})]}),t&&(0,r.jsx)("div",{className:"relative flex flex-1 items-center justify-center py-4",onWheel:u,children:(0,r.jsx)(Vp,{handleButtonClick:d})})]})};function Wp(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function qp(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Yp(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){qp(e,t,n[t])}))}return e}function Kp(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Wp(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Wp(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var $p=function(){var e=Kp((0,a.useState)(!1),2),t=e[0],n=e[1],o=(0,c.useLocalizationState)().t,i=(0,gt.useFormatting)().renderWithOptionalPostfix,s=(0,nl.useDirectoryUIState)(),l=s.toggleCreateContactMode,u=s.setCreateContactFormValues,f=s.createContactFormValues,m=(0,yo.useNavigationState)("setActivePage"),p=(0,I.useNotificationsState)("methods").showNotification,v=(0,st.useContactsStateMethods)().createContact,h=(0,Bu.useForm)({defaultValues:f,reValidateMode:"onBlur"}),b=h.control,g=h.handleSubmit,j=h.getValues,S=(0,vd.useEmailValidationRules)(),O=(0,vd.usePhoneValidationRules)(),x=(0,vd.usePauseSymbolsValidation)(),C=(0,a.useMemo)((function(){return(0,$.merge)(O,x)}),[O,x]),_=(0,y.usePersistedFormValues)({clearPersistedValues:function(){return u(nl.emptyDirectoryUIState.createContactFormValues)},setPersistedValues:function(){return u(j())}}).controlledUnmountRef,w=(0,a.useMemo)((function(){return g((function(e){var t,r;n(!0),v({contact:Yp({first_name:e.firstName,last_name:e.lastName},e.email?{emails:[{type:"PRIMARY",email_address:e.email}]}:{},e.phone?{phones:[{type:"BUSINESS",phone:e.phone}]}:{},(null===(t=e.messenger)||void 0===t?void 0:t.type)&&(null===(r=e.messenger)||void 0===r?void 0:r.user_id)?{messengers:[{type:e.messenger.type,user_id:e.messenger.user_id,user_name:e.messenger.user_name,account_id:e.messenger.account_id}]}:{})},{onSuccess:function(e){_.current=!0,n(!1),l(),m({name:yo.AppRoutes.ContactDetails,params:{contactId:e}})},onError:function(){n(!1),p({type:"error",id:I.Notifications.ContactCreationError,tags:["current-view"],message:o.VALIDATION.CONTACT_CREATION_ERROR(),duration:1e4})}})}))}),[_,v,g,m,p,o.VALIDATION,l]),N=(0,a.useCallback)((function(){_.current=!0,l()}),[_,l]),A=(0,Yt.useInteractionChatState)("messengers");return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(Dm,{onGoBack:N}),(0,r.jsxs)(d.SmForm,{className:"overflow-y-auto overflow-x-hidden rounded pb-2 pr-3.5 pt-[21px]",children:[(0,r.jsx)(ed.TextField,{name:"firstName",autoFocus:!0,control:b,label:i(o.UNDEFINED.contact_first_name()),placeholder:o.UNDEFINED.contact_first_name()}),(0,r.jsx)(ed.TextField,{name:"lastName",control:b,required:!0,label:o.UNDEFINED.contact_last_name(),placeholder:o.UNDEFINED.contact_last_name()}),(0,r.jsx)(ed.TextField,{name:"phone",className:"w-1/2",control:b,label:i(o.UNDEFINED.contact_phone()),placeholder:o.UNDEFINED.contact_phone(),rules:C}),(0,r.jsx)(ed.TextField,{name:"email",control:b,className:"w-1/2",label:i(o.UNDEFINED.contact_email()),placeholder:o.UNDEFINED.contact_email(),rules:S}),(0,r.jsx)(ed.MessengerFieldBase,{withoutPadding:!0,control:b,label:o.UNDEFINED.contact_messenger(),availableMessengers:A,className:"first:!px-0",accountIdFieldName:"messenger.account_id",typeFiledName:"messenger.type",userIdFieldName:"messenger.user_id",userNameFieldName:"messenger.user_name"}),(0,r.jsx)(L.SemanticButton,{basic:!0,size:"mini",onClick:w,children:o.CONTACT.create_contact()}),(0,r.jsx)(L.SemanticButton,{basic:!0,size:"mini",onClick:w,children:o.CONTACT.create_and_open_in_crm()})]}),!1,t&&(0,r.jsx)(L.Loader,{active:!0,color:"primary",size:"big",className:"pr-3.5"})]})};function Xp(e){var t=(0,nl.useDirectoryUIState)().setFirstFoundItemId;(0,a.useEffect)((function(){t((0,Jt.getDirectoryItemUniqueId)(e[0]))}),[e,t])}function Qp(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Zp(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Qp(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Qp(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Jp(e,t,n){var r=Zp((0,a.useState)(!1),2),o=r[0],i=r[1],s=(0,y.useEvent)(t);return(0,a.useEffect)((function(){var t;return e&&(n?(i(!0),t=setTimeout((function(){s(e),i(!1)}),n)):s(e)),function(){t&&(i(!1),clearTimeout(t))}}),[e,n,s]),o}var ev=n(9624);function tv(e,t){var n=(0,ev.useServiceDetailsState)(),r=n.serviceDetails,o=n.huntGroupsDetails,i=e&&r[e],s=t?o[t]:void 0;return(0,a.useMemo)((function(){return i?Number(i.agentsReady)?"readyService":Number(i.agentsLogged)?"notReadyService":"loggedOut":s?s.agentsLogged?"readyService":s.phonesRegistered?"notReadyService":"loggedOut":void 0}),[i,s])}var nv=function(e){var t=e.item,n=e.highlight;if((0,Wc.isScenarioVoiceEntry)(t)||(0,Wc.isStaticVoiceEntry)(t)||(0,Wc.isHuntGroupEntry)(t)){var a=(0,rt.formatPhone)(t.number);return(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[(0,r.jsx)(j.IconPhone16Filled,{className:"my-px mr-1 inline-block shrink-0 icon-neutral"}),(0,r.jsx)("span",{"data-testid":"phone",className:"truncate caption-s text-neutral-on-secondary",children:(0,L.highlighted)({highlight:n,text:a})})]})}return(0,Wc.isStaticEmailEntry)(t)?(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[(0,r.jsx)(j.IconEmail16,{className:"my-px mr-1 inline-block shrink-0 icon-neutral"}),(0,r.jsx)("span",{"data-testid":"email",className:"truncate caption-s text-neutral-on-secondary",children:(0,L.highlighted)({highlight:n,text:t.email})})]}):null};function rv(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function av(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return rv(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return rv(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var ov=function(e){var t=e.item,n=e.transferMode,a=e.onCall,o=e.onChat,i=e.onEmail,s=e.onDetails,u=(0,c.useLocalizationState)("t").CONTACT,d=(0,at.useSessionState)().phoneDeviceCapabilities,f=av((0,(0,gt.useFormatting)().getNamesFromDisplayName)(t.title),2),m=f[0],p=f[1],v="calls"!==n&&d.canDial&&"voice"===t.mediaType&&!!a&&!!t.number,h="messages"!==n&&(0,Wc.isStaticVoiceEntry)(t)&&!!o&&!!t.number,b=(0,Wc.isStaticEmailEntry)(t)&&!!i&&!!t.email,g=(0,y.useEvent)((function(){(0,l.assertDefined)(a),(0,l.assertDefined)(t.number),a({phone:t.number,userId:t.id,firstName:m,lastName:p,serviceId:t.serviceId,origination:"directory"})})),I=(0,y.useEvent)((function(){(0,l.assertDefined)(o),(0,l.assertDefined)(t.number),o({phone:t.number,userId:t.id,firstName:m,lastName:p})})),S=(0,y.useEvent)((function(){(0,l.assertDefined)(i),(0,l.assertDefined)(t.email),i({emailAddress:t.email})})),O=(0,y.useEvent)((function(){null==s||s({entryId:t.id})}));return(0,r.jsxs)("div",{className:"flex gap-0.5",children:[v&&(0,r.jsx)(j.ButtonIcon,{onClick:g,tooltip:u.button_start_call_text(),"data-testid":"call-button",children:(0,r.jsx)(j.IconPhone16Filled,{})}),h&&(0,r.jsx)(j.ButtonIcon,{onClick:I,tooltip:u.button_initiate_chat_text(),"data-testid":"chat-button",children:(0,r.jsx)(j.IconRoundChat16Filled,{})}),b&&(0,r.jsx)(j.ButtonIcon,{onClick:S,tooltip:u.button_send_email_text(),"data-testid":"email-button",children:(0,r.jsx)(j.IconEmail16,{})}),(0,r.jsx)(j.ButtonIcon,{tooltip:u.button_show_contact_details_text(),"data-testid":"user-info-button",onPressed:O,children:(0,r.jsx)(j.IconInformation,{})})]})},iv=function(e){var t=e.metrics,n=(0,c.useLocalizationState)("t").DIRECTORY,a=void 0!==t.agentsLogged&&void 0!==t.phonesRegistered?[n.logged_in(t.agentsLogged),n.phones_registered(t.phonesRegistered)]:void 0!==t.agentsLogged?[n.logged_in(t.agentsLogged)]:void 0!==t.phonesRegistered?[n.phones_registered(t.phonesRegistered)]:[];return(0,r.jsx)("div",{"data-testid":"rt-metrics",className:"flex flex-col overflow-hidden caption-s text-neutral-fade",children:a.map((function(e){return(0,r.jsx)("span",{children:e},e)}))})},sv=function(e){var t=e.metrics,n=(0,c.useLocalizationState)("t").DIRECTORY,a=(0,ln.useAppConfigState)(["primaryMetric","secondaryMetric"]),o=a.primaryMetric,i=a.secondaryMetric,s=(0,y.useEvent)((function(){return[o,i].map((function(e){switch(e){case"in_calls_waiting":var r=Number(t.inCallsWaiting);return n.waiting(r);case"in_max_wait_time":var a=Number(t.inMaxWaitTime),o=(0,y.toHHMMSS)(a);return n.max_wait(o);case"in_ewt":var i=Number(t.inEwt),s=(0,y.toHHMMSS)(i);return n.ewt(s);case"service_level":var l=Number(t.serviceLevel);return n.svc_level(l);case"agents_ready":var c=Number(t.agentsReady);return n.ready(c);case"agents_logged":var u=Number(t.agentsLogged);return n.logged_in(u)}})).filter(l.isDefined)}))();return(0,r.jsx)("div",{"data-testid":"rt-metrics",className:"flex flex-col overflow-hidden caption-s text-neutral-fade",children:s.map((function(e){return(0,r.jsx)("span",{className:"truncate",children:e},e)}))})},lv=function(e){var t=e.item,n=(0,ev.useServiceDetailsState)(),a=n.huntGroupsDetails,o=n.serviceDetails,i=t.huntGroupId?a[t.huntGroupId]:void 0,s=t.serviceId?o[t.serviceId]:void 0;return i?(0,r.jsx)(iv,{metrics:i}):s?(0,r.jsx)(sv,{metrics:s}):null};function cv(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function uv(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var dv=function(e){var t=e.transferMode,n=e.transferNumberInput,o=e.transferControlsStyle,i=e.item,s=e.onCall,c=e.onChat,u=e.onEmail,d=e.onDetails,f=e.highlight,m=e.onClick,p=e.onDoubleClick,v=e.showFavoriteButton,h=void 0===v||v,b=uv(e,["transferMode","transferNumberInput","transferControlsStyle","item","onCall","onChat","onEmail","onDetails","highlight","onClick","onDoubleClick","showFavoriteButton"]),g=tv(i.serviceId,i.huntGroupId),j=function(e){return(0,Wc.isHuntGroupEntry)(e)?"hunt-group":(0,Wc.isStaticVoiceEntry)(e)||(0,Wc.isStaticEmailEntry)(e)?"static-entry":"scenario-entry"}(i),I=(0,a.useMemo)((function(){return{fullName:i.title,avatarType:j,isAgent:!0,onlineStatusIcon:g}}),[j,i.title,g]),S=(0,a.useMemo)((function(){return(0,r.jsxs)("span",{className:"flex gap-1",children:[(0,r.jsx)("b",{"data-testid":"name",className:"inline-block truncate font-semibold body text-primary-on-primary",children:(0,L.highlighted)({highlight:f,text:i.title})}),h&&(0,r.jsx)(qc.DirectoryFavoriteButton,{forContactListItem:!0,item:i})]})}),[f,h,i]),O=(0,r.jsx)(nv,{item:i,highlight:f}),x=(0,r.jsx)(lv,{item:i}),C=(0,r.jsx)(ov,{item:i,transferMode:t,onCall:s,onChat:c,onEmail:u,onDetails:d}),_=(0,y.useEvent)((function(e){e.preventDefault(),e.stopPropagation(),(0,l.assertDefined)(i.number),null==s||s({phone:i.number,userId:i.id,firstName:i.title,origination:"directory"})})),w=(0,y.useEvent)((function(e){null==m||m(e,i)})),N=(0,y.useEvent)((function(){null==p||p(i)}));return(0,r.jsx)(yc.ContactListItem,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){cv(e,t,n[t])}))}return e}({as:L.SelectionItem,keyHandlerElement:"directory-item",transferMode:t,transferNumberInput:n,transferControlsStyle:o,userId:i.id,number:i.number,avatarProps:I,title:S,body:O,stats:x,controls:C,onClick:m?w:_,onDoubleClick:p&&N,isStaticEntry:!0,containerProps:{focusOnSelection:!0,itemId:i.id,tabIndex:0,"data-testid":"directory-item","data-entry-point":"true"}},b))},fv=function(e){var t=e.contact,n=e.highlight;if(t.phone){var a=(0,rt.formatPhone)(t.phone);return(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[(0,r.jsx)(j.IconPhone16Filled,{className:"my-px mr-1 inline-block shrink-0 icon-neutral"}),(0,r.jsx)("span",{"data-testid":"phone",className:"truncate caption-s text-neutral-on-secondary",children:(0,L.highlighted)({highlight:n,text:a})})]})}return t.email?(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[(0,r.jsx)(j.IconEmail16,{className:"my-px mr-1 inline-block shrink-0 icon-neutral"}),(0,r.jsx)("span",{"data-testid":"email",className:"truncate caption-s text-neutral-on-secondary",children:(0,L.highlighted)({highlight:n,text:t.email})})]}):null};function mv(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function pv(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){mv(e,t,n[t])}))}return e}function vv(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function hv(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var bv=function(e){var t,n=e.contactId,a=e.tooltip,o=e.popupOpen,i=e.optionsExtractor,s=e.OptionComponent,c=e.onPressed,u=e.onPopupOpenChange,d=e.children,f=hv(e,["contactId","tooltip","popupOpen","optionsExtractor","OptionComponent","onPressed","onPopupOpenChange","children"]),m=(0,st.useContactsStateMethods)().getContact,p=null!==(t=(0,st.useContact)(n))&&void 0!==t?t:{},v=p.data,h=p.isLoading,b=(0,y.useEvent)((function(){m({id:n}).then((function(e){if(e){var t=i(e);t.length>1?u(!0):1===t.length&&c(t[0].value)}}))})),g=(0,y.useEvent)((function(e){u&&"Escape"===e.key&&(e.stopPropagation(),u(!o))}));if(!v)return h?(0,r.jsx)(j.ButtonIcon,{tooltip:a,className:"relative [&>span]:h-4 [&>span]:w-4",children:(0,r.jsx)(L.Loader,{active:!0,size:"mini"})}):(0,r.jsx)(j.ButtonIcon,vv(pv({onClick:b,tooltip:a},f),{children:d}));var I=i(v);return I.length>1?(0,r.jsx)(j.TriggerDropdown,{modal:!1,inPortal:!1,align:"start",open:o,onOpenChange:u,onKeyDown:g,onClick:y.stopPropagation,onFocus:y.stopPropagation,className:"[&>*:not(:last-child)]:border-b [&>*:not(:last-child)]:border-default",options:I.map((function(e){var t=e.key,n=hv(e,["key"]);return(0,r.jsx)("button",{onClick:function(){return c(n.value)},children:(0,r.jsx)(s,pv({},n))},t)})),children:function(e){return(0,r.jsx)(j.ButtonIcon,{tooltip:a,"data-focused":e,iconRight:e?(0,r.jsx)(j.IconArrowUp16,{}):(0,r.jsx)(j.IconArrowDown16,{}),children:d})}}):(0,r.jsx)(j.ButtonIcon,vv(pv({onClick:function(){(0,l.assertDefined)(I[0]),c(I[0].value)},tooltip:a,disabled:!I.length},f),{children:d}))};function yv(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function gv(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return yv(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return yv(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var jv=function(e){var t=e.contact,n=e.transferMode,o=e.onCall,i=e.onChat,s=e.onEmail,u=e.onDetails,d=e.onPopupOpenChange,f=void 0===d?$.noop:d,m=(0,c.useLocalizationState)("t").CONTACT,p=(0,at.useSessionState)("phoneDeviceCapabilities"),v=(0,vn.useIsCommunicator)(),h=gv((0,a.useState)(!1),2),b=h[0],g=h[1],I=gv((0,a.useState)(!1),2),S=I[0],O=I[1],x=gv((0,a.useState)(!1),2),C=x[0],_=x[1],w=!!t.phone&&"-"!==t.phone&&p.canDial&&"calls"!==n&&!!o,N=!!t.phone&&"messages"!==n&&!!i,A=!v&&!!t.email&&!!s;(0,a.useEffect)((function(){f(b||S||C)}),[f,b,S,C]);var P=(0,y.useEvent)((function(e){(0,l.assertDefined)(o),o({phone:e,contactId:t.id,firstName:t.firstName,lastName:t.lastName,origination:"directory"})})),E=(0,y.useEvent)((function(e){(0,l.assertDefined)(i),i({phone:e,contactId:t.id,firstName:t.firstName,lastName:t.lastName})})),D=(0,y.useEvent)((function(e){(0,l.assertDefined)(s),s({contactId:t.id,emailAddress:e})})),T=(0,y.useEvent)((function(){null==u||u({contactId:t.id})}));return(0,r.jsxs)(r.Fragment,{children:[w&&(0,r.jsx)(bv,{"data-testid":"call-button",tooltip:m.button_start_call_text(),popupOpen:b,contactId:t.id,optionsExtractor:lt.externalContact.callOptions,OptionComponent:L.PhoneOption,onPopupOpenChange:g,onPressed:P,children:(0,r.jsx)(j.IconPhone16Filled,{})}),N&&(0,r.jsx)(bv,{"data-testid":"chat-button",tooltip:m.button_initiate_chat_text(),popupOpen:S,contactId:t.id,optionsExtractor:lt.externalContact.chatOptions,OptionComponent:L.PhoneOption,onPopupOpenChange:O,onPressed:E,children:(0,r.jsx)(j.IconRoundChat16Filled,{})}),A&&(0,r.jsx)(bv,{"data-testid":"email-button",tooltip:m.button_send_email_text(),popupOpen:C,contactId:t.id,optionsExtractor:lt.externalContact.emailOptions,OptionComponent:L.EmailOption,onPopupOpenChange:_,onPressed:D,children:(0,r.jsx)(j.IconEmail16,{})}),(0,r.jsx)(j.ButtonIcon,{tooltip:m.button_show_contact_details_text(),"data-testid":"user-info-button",onPressed:T,children:(0,r.jsx)(j.IconInformation,{})})]})};function Iv(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Sv(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ov(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function xv(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Iv(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Iv(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Cv=function(e){var t=e.transferMode,n=e.transferNumberInput,i=e.transferControlsStyle,s=e.contact,l=e.onCall,c=e.onChat,u=e.onEmail,d=e.onDetails,f=e.onClick,m=(e.noControls,e.onDoubleClick),p=e.highlight,v=e.showFavoriteButton,h=void 0===v||v,b=Ov(e,["transferMode","transferNumberInput","transferControlsStyle","contact","onCall","onChat","onEmail","onDetails","onClick","noControls","onDoubleClick","highlight","showFavoriteButton"]),g=(0,yt.useGetContactPictureUrl)(),j=(0,gt.useFormatting)().formatFullName,I=xv((0,a.useState)(!1),2),S=I[0],O=I[1],x=function(e){return e.id}(s),C=(0,a.useMemo)((function(){return{firstName:s.firstName,lastName:s.lastName,url:g(x)}}),[g,s.firstName,x,s.lastName]),_=(0,a.useMemo)((function(){return(0,r.jsxs)("span",{className:"flex gap-1",children:[(0,r.jsx)("b",{"data-testid":"name",className:"inline-block truncate font-semibold body text-primary-on-primary",children:(0,L.highlighted)({highlight:p,text:j(s.firstName,s.lastName)})}),h&&(0,r.jsx)(qc.ExternalContactFavoriteButton,{forContactListItem:!0,item:s})]})}),[j,p,h,s]),w=(0,r.jsx)(fv,{contact:s,highlight:p}),N=(0,r.jsx)(jv,{contact:s,transferMode:t,onPopupOpenChange:O,onChat:c,onCall:l,onEmail:u,onDetails:d}),A=(0,y.useEvent)((function(e){e.preventDefault(),e.stopPropagation(),null==c||c({contactId:x,firstName:s.firstName,lastName:s.lastName,phone:s.phone})})),P=o().useRef(null),E=(0,y.useEvent)((function(e){null==f||f(e,s)})),D=(0,y.useEvent)((function(){null==m||m(s,{onCall:function(){var e;null===(e=P.current)||void 0===e||e.click()}})}));return(0,r.jsx)(yc.ContactListItem,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Sv(e,t,n[t])}))}return e}({as:L.SelectionItem,keyHandlerElement:"directory-item",transferMode:t,transferNumberInput:n,transferControlsStyle:i,contactId:x,number:s.phone,avatarProps:C,title:_,body:w,controls:N,onClick:f?E:A,onDoubleClick:m&&D,containerProps:{itemId:s.id,focusOnSelection:!0,tabIndex:0,"data-testid":"directory-item","data-external-contact":"true"},forceHover:S},b))};function _v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function wv(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){_v(e,t,n[t])}))}return e}function Nv(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Av(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var Pv=function(e){var t=e.items,n=e.tooltip,a=e.popupOpen,o=e.OptionComponent,i=e.onPressed,s=e.onPopupOpenChange,c=e.children,u=Av(e,["items","tooltip","popupOpen","OptionComponent","onPressed","onPopupOpenChange","children"]),d=(0,y.useEvent)((function(e){s&&"Escape"===e.key&&(e.stopPropagation(),s(!a))}));return t.length>1?(0,r.jsx)(j.TriggerDropdown,{modal:!1,inPortal:!1,align:"start",open:a,onOpenChange:s,onKeyDown:d,onClick:y.stopPropagation,onFocus:y.stopPropagation,className:"[&>*:not(:last-child)]:border-b [&>*:not(:last-child)]:border-default",options:t.map((function(e){var t=e.key,n=Av(e,["key"]);return(0,r.jsx)("button",{onClick:function(){return i(n.value)},children:(0,r.jsx)(o,wv({},n))},t)})),children:function(e){return(0,r.jsx)(j.ButtonIcon,{tooltip:n,"data-focused":e,iconRight:e?(0,r.jsx)(j.IconArrowUp16,{}):(0,r.jsx)(j.IconArrowDown16,{}),children:c})}}):1===t.length?(0,r.jsx)(j.ButtonIcon,Nv(wv({onClick:function(){(0,l.assertDefined)(t[0]),i(t[0].value)},tooltip:n,disabled:!t.length},u),{children:c})):null};function Ev(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Dv(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ev(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ev(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Tv=function(e){var t=e.user,n=e.transferMode,o=e.onCall,i=e.onChat,s=e.onEmail,u=e.onDetails,d=e.onPopupOpenChange,f=void 0===d?$.noop:d,m=(0,c.useLocalizationState)("t").CONTACT,p=(0,at.useSessionState)(),v=p.userId,h=p.phoneDeviceCapabilities,b=(0,vn.useIsCommunicator)(),g=Dv((0,a.useState)(!1),2),I=g[0],S=g[1],O=Dv((0,a.useState)(!1),2),x=O[0],C=O[1],_=Dv((0,a.useState)(!1),2),w=_[0],N=_[1],A=!(t.userId===v)&&h.canDial&&"calls"!==n&&!!o,P="messages"!==n&&!!i,E=!b&&!!s,D=Wc.internalUser.callOptions(t),T=Wc.internalUser.chatOptions(t),k=Wc.internalUser.emailOptions(t);(0,a.useEffect)((function(){f(I||x||w)}),[f,I,x,w]);var M=(0,y.useEvent)((function(e){(0,l.assertDefined)(o),o({phone:e,userId:t.userId,firstName:t.firstName,lastName:t.lastName,origination:"directory"})})),R=(0,y.useEvent)((function(e){(0,l.assertDefined)(i),i({phone:e,userId:t.userId,firstName:t.firstName,lastName:t.lastName})})),F=(0,y.useEvent)((function(e){(0,l.assertDefined)(s),s({emailAddress:e})})),B=(0,y.useEvent)((function(){null==u||u({userId:t.userId})}));return(0,r.jsxs)("div",{className:"flex gap-0.5",children:[A&&(0,r.jsx)(Pv,{"data-testid":"call-button",items:D,tooltip:m.button_start_call_text(),popupOpen:I,OptionComponent:L.PhoneOption,onPopupOpenChange:S,onPressed:M,children:(0,r.jsx)(j.IconPhone16Filled,{})}),P&&(0,r.jsx)(Pv,{"data-testid":"chat-button",items:T,tooltip:m.button_initiate_chat_text(),popupOpen:x,OptionComponent:L.PhoneOption,onPopupOpenChange:C,onPressed:R,children:(0,r.jsx)(j.IconRoundChat16Filled,{})}),E&&(0,r.jsx)(Pv,{"data-testid":"email-button",items:k,tooltip:m.button_send_email_text(),popupOpen:w,OptionComponent:L.EmailOption,onPopupOpenChange:N,onPressed:F,children:(0,r.jsx)(j.IconEmail16,{})}),(0,r.jsx)(j.ButtonIcon,{tooltip:m.button_show_contact_details_text(),"data-testid":"user-info-button",onPressed:B,children:(0,r.jsx)(j.IconInformation,{})})]})};function kv(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Mv(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return kv(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return kv(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Lv=function(e){var t=e.details,n=(0,at.useSessionState)("tenantFeatures"),o=Mv((0,a.useReducer)((function(e){return e+1}),0),2),i=(o[0],o[1]),s=(0,Er.getStateDuration)(t);return(0,a.useEffect)((function(){var e=setInterval(i,1e3);return function(){return clearInterval(e)}})),t&&(null==n?void 0:n.rtDataEnabled)?(0,r.jsxs)("span",{"data-testid":"online-status",className:"flex max-w-[138px] gap-1 overflow-hidden caption-s",children:[(0,r.jsx)("span",{className:"font-semibold",children:(0,r.jsx)(Rv,{userDetails:null==t?void 0:t.data})}),!!s&&(0,r.jsx)("span",{className:"text-neutral-fade",children:"(".concat((0,y.formatDurationShort)(s),")")})]}):null},Rv=function(e){var t=e.userDetails,n=function(e){return(0,r.jsx)("span",{className:"line-clamp-2 truncate text-on-warning",children:e})},a=function(e){return(0,r.jsx)("span",{className:"line-clamp-2 truncate text-on-success",children:e})},o=function(e){return(0,r.jsx)("span",{className:"line-clamp-2 truncate text-on-error",children:e})},i=function(e){return(0,r.jsx)("span",{className:"line-clamp-2 truncate text-neutral-disabled",children:e})},s=function(e){return(0,r.jsx)("span",{className:"line-clamp-2 truncate text-primary-on-primary",children:e})},l=(0,c.useLocalizationState)("t").AGENT_STATE_CONTROL;if(!t)return null;if(!t.isLogged)return i(l.presence_offline());if(t.presenceState&&!t.acdState&&!t.isSuper&&!t.userType)switch(t.presenceState){case"available":return a(l.presence_available());case"busy":return s(function(){return e("voice")||e("workitem")?l.acd_busy_call():e("chat")?l.acd_busy_chat():e("email")?l.acd_busy_email():l.acd_busy();function e(e){var n;return null==t||null===(n=t.items)||void 0===n?void 0:n.some((function(t){return t.mediaType===e}))}}());default:return o(l.presence_dnd())}if(void 0!==t.acdState)switch(t.acdState){case"":return i(l.acd_supervision());case"ready":return a(l.acd_ready());case"not_ready":var u;return n(null!==(u=t.reason)&&void 0!==u?u:l.acd_not_ready());case"busy":var d;return s(null!==(d=t.reason)&&void 0!==d?d:l.acd_busy());case"after_call_work":var f;return s(null!==(f=t.reason)&&void 0!==f?f:l.acd_acw_long())}if(t.capacity){var m=function(e){var n=t.capacity&&t.capacity[e];return n&&n.usedSlots>0};if(m("voice")||m("workitem"))return s(l.acd_busy_call());if(m("chat"))return s(l.acd_busy_chat());if(m("email"))return s(l.acd_busy_email())}switch(t.presenceState){case"available":return a(l.presence_available());case"offline":return i(l.presence_offline());case"away":return n(l.presence_away());case"dnd":return o(l.presence_dnd());case"busy":return s(l.acd_busy())}return t.isSuper?i(l.acd_supervision()):null};function Fv(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Bv(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Uv(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function zv(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Fv(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Fv(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Hv=function(e){var t,n=e.transferMode,o=e.transferNumberInput,i=e.transferControlsStyle,s=e.user,l=e.onCall,c=e.onChat,u=e.onEmail,d=e.onDetails,f=e.highlight,m=e.onClick,p=e.onDoubleClick,v=e.showFavoriteButton,h=void 0===v||v,b=Uv(e,["transferMode","transferNumberInput","transferControlsStyle","user","onCall","onChat","onEmail","onDetails","highlight","onClick","onDoubleClick","showFavoriteButton"]),g=(0,at.useSessionState)().tenantFeatures,I=(0,gt.useFormatting)().formatFullName,S=(0,Er.useUserDetailsById)(s.userId),O=(0,a.useRef)(Date.now()),x=function(e){return"userType"in e&&"internal"===e.userType&&"acdState"in e&&"isLoggedIn"in e}(s)?{data:s,lastUpdated:O.current}:S,C=zv((0,a.useState)(!1),2),_=C[0],w=C[1],N=(0,yt.useGetAvatarUrl)(),A=(0,Er.getUserStatusIcon)(null==x?void 0:x.data),P="available"===(null==x||null===(t=x.data)||void 0===t?void 0:t.presenceState),E=(0,a.useMemo)((function(){var e=A;return!(null==g?void 0:g.rtDataEnabled)&&A&&"loggedOut"!==A&&(e="ready"),e}),[A,null==g?void 0:g.rtDataEnabled]),D=(0,a.useMemo)((function(){return{firstName:s.firstName,lastName:s.lastName,url:N({userId:s.userId,photoUrl:"photoId"in s?s.photoId:void 0}),isAgent:!0,isOnline:P,onlineStatusIcon:E}}),[s,P,E,N]),T=(0,a.useMemo)((function(){return(0,r.jsxs)("span",{className:"flex gap-1",children:[(0,r.jsx)("b",{"data-testid":"name",className:"inline-block truncate font-semibold body text-primary-on-primary",children:(0,L.highlighted)({highlight:f,text:I(s.firstName,s.lastName)})}),h&&(0,r.jsx)(qc.DirectoryFavoriteButton,{forContactListItem:!0,item:s})]})}),[I,f,h,s]),k=(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[(0,r.jsx)(j.IconPhone16Filled,{className:"my-px mr-1 inline-block shrink-0 icon-neutral"}),(0,r.jsx)("span",{"data-testid":"phone",className:"truncate caption-s text-neutral-on-secondary",children:(0,L.highlighted)({highlight:f,text:s.extension})})]}),M=(0,r.jsx)(Lv,{details:x}),R=(0,r.jsx)(Tv,{user:s,transferMode:n,onPopupOpenChange:w,onChat:c,onCall:l,onEmail:u,onDetails:d}),F=(0,y.useEvent)((function(e){e.preventDefault(),e.stopPropagation(),null==c||c({userId:s.userId,firstName:s.firstName,lastName:s.lastName,phone:s.extension})})),B=(0,y.useEvent)((function(e){null==m||m(e,s)})),U=(0,y.useEvent)((function(){null==p||p(s)}));return(0,r.jsx)(yc.ContactListItem,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Bv(e,t,n[t])}))}return e}({as:L.SelectionItem,keyHandlerElement:"directory-item",transferMode:n,transferNumberInput:o,transferControlsStyle:i,userId:s.userId,number:s.extension,avatarProps:D,title:T,body:k,stats:M,controls:R,onClick:m?B:F,onDoubleClick:p&&U,containerProps:{itemId:s.userId,focusOnSelection:!0,tabIndex:0,"data-testid":"directory-item","data-internal-user":"true"},forceHover:_},b))},Vv=function(e){var t=e.item,n=e.transferMode,a=e.onChat,o=e.onDetails,i=(0,c.useLocalizationState)("t").CONTACT,s="messages"!==n&&!!a,u=(0,y.useEvent)((function(){(0,l.assertDefined)(a),a({phone:"",userId:t.channelId,firstName:"",lastName:t.title,userType:t.userType,photoUrl:t.photoUrl})})),d=(0,y.useEvent)((function(){null==o||o({userId:t.channelId})}));return(0,r.jsxs)("div",{className:"flex gap-0.5",children:[s&&(0,r.jsx)(j.ButtonIcon,{onClick:u,tooltip:i.button_initiate_chat_text(),"data-testid":"chat-button",children:(0,r.jsx)(j.IconRoundChat16Filled,{})}),(0,r.jsx)(j.ButtonIcon,{tooltip:i.button_show_contact_details_text(),"data-testid":"user-info-button",onPressed:d,children:(0,r.jsx)(j.IconInformation,{})})]})};function Gv(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Wv(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var qv=function(e){var t=e.transferMode,n=e.transferControlsStyle,o=e.item,i=e.onDetails,s=e.onChat,l=e.highlight,c=e.onClick,u=e.onDoubleClick,d=e.showFavoriteButton,f=void 0===d||d,m=Wv(e,["transferMode","transferControlsStyle","item","onDetails","onChat","highlight","onClick","onDoubleClick","showFavoriteButton"]),p=(0,a.useMemo)((function(){return{firstName:jt.MS_TEAMS_CHANNEL_AVATAR_FIRST_NAME,lastName:jt.MS_TEAMS_CHANNEL_AVATAR_LAST_NAME}}),[]),v=(0,a.useMemo)((function(){return(0,r.jsxs)("span",{className:"flex gap-1",children:[(0,r.jsx)("b",{"data-testid":"name",className:"inline-block truncate font-semibold body text-primary-on-primary",children:(0,L.highlighted)({highlight:l,text:o.title})}),f&&(0,r.jsx)(qc.DirectoryFavoriteButton,{forContactListItem:!0,item:o})]})}),[l,o.title,f,o]),h=(0,r.jsx)(Vv,{item:o,transferMode:t,onChat:s,onDetails:i}),b=(0,y.useEvent)((function(e){c?c(e,o):s&&s({userId:o.channelId,firstName:o.title,lastName:"",phone:"",userType:o.userType,photoUrl:o.photoUrl})})),g=(0,y.useEvent)((function(){null==u||u(o)}));return(0,r.jsx)(yc.ContactListItem,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Gv(e,t,n[t])}))}return e}({as:L.SelectionItem,keyHandlerElement:"directory-item",transferMode:t,transferControlsStyle:n,isStaticEntry:!0,userId:o.channelId,userType:o.userType,avatarProps:p,title:v,controls:h,onClick:b,onDoubleClick:g,containerProps:{itemId:o.channelId,focusOnSelection:!0,tabIndex:0,"data-testid":"directory-item","data-ms-teams-channel":"true","data-element":"directory-item"}},m))},Yv=n(5970),Kv=function(e){var t=e.user,n=e.transferMode,a=e.onCall,o=e.onChat,i=e.onDetails,s=(0,c.useLocalizationState)("t").CONTACT,u=(0,at.useSessionState)().phoneDeviceCapabilities,d=(0,Yv.getMsTeamsUserPrimaryPhoneNumber)(t.phones),f=Object.values(t.phones).map((function(e){return{key:e.phone,type:e.type.toUpperCase(),value:e.phone}})),m="calls"!==n&&u.canDial&&!!a,p="messages"!==n&&t.hasChat&&!!o,v=(0,y.useEvent)((function(e){(0,l.assertDefined)(a),a({phone:e,userId:t.userId,firstName:t.firstName,lastName:t.lastName,origination:"directory"})})),h=(0,y.useEvent)((function(){(0,l.assertDefined)(o),o({userId:t.userId,firstName:t.firstName,lastName:t.lastName,userType:t.userType,phone:null!=d?d:"",photoUrl:t.photoUrl})})),b=(0,y.useEvent)((function(){null==i||i({userId:t.userId})}));return(0,r.jsxs)("div",{className:"flex gap-0.5",children:[m&&(0,r.jsx)(Pv,{"data-testid":"call-button",items:f,tooltip:s.button_start_call_text(),OptionComponent:L.PhoneOption,onPressed:v,children:(0,r.jsx)(j.IconPhone16Filled,{})}),p&&(0,r.jsx)(j.ButtonIcon,{onClick:h,tooltip:s.button_initiate_chat_text(),"data-testid":"chat-button",children:(0,r.jsx)(j.IconRoundChat16Filled,{})}),(0,r.jsx)(j.ButtonIcon,{tooltip:s.button_show_contact_details_text(),"data-testid":"user-info-button",onPressed:b,children:(0,r.jsx)(j.IconInformation,{})})]})};function $v(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Xv(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var Qv=function(e){var t=e.transferMode,n=e.transferControlsStyle,o=e.user,i=e.onChat,s=e.onCall,l=e.onDetails,c=e.highlight,u=e.onClick,d=e.onDoubleClick,f=e.showFavoriteButton,m=void 0===f||f,p=Xv(e,["transferMode","transferControlsStyle","user","onChat","onCall","onDetails","highlight","onClick","onDoubleClick","showFavoriteButton"]),v=(0,gt.useFormatting)().formatFullName,h=(0,yt.useGetAvatarUrl)(),b=(0,Er.useUserDetailsById)(o.userId),g=(0,Er.getUserStatusIcon)(null==b?void 0:b.data,o.presenceState),I=(0,Yv.getMsTeamsUserPrimaryPhoneNumber)(o.phones),S=(0,a.useMemo)((function(){return{firstName:o.firstName,lastName:o.lastName,isAgent:!0,url:h({userId:o.userId,userType:o.userType,photoUrl:o.photoUrl}),onlineStatusIcon:g,isOnline:"ready"===g}}),[h,g,o]),O=(0,a.useMemo)((function(){return(0,r.jsxs)("span",{className:"flex gap-1",children:[(0,r.jsx)("b",{"data-testid":"name",className:"inline-block truncate font-semibold body text-primary-on-primary",children:(0,L.highlighted)({highlight:c,text:v(o.firstName,o.lastName)})}),m&&(0,r.jsx)(qc.DirectoryFavoriteButton,{forContactListItem:!0,item:o})]})}),[v,c,m,o]),x=(0,a.useMemo)((function(){return I?(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[(0,r.jsx)(j.IconPhone16Filled,{className:"my-px mr-1 inline-block shrink-0 icon-neutral"}),(0,r.jsx)("span",{"data-testid":"phone",className:"truncate caption-s text-neutral-on-secondary",children:(0,L.highlighted)({highlight:c,text:I,sanitizeText:rt.prepareHighlightFormattedPhone})})]}):null}),[I,c]),C=(0,r.jsx)(Lv,{details:b}),_=(0,r.jsx)(Kv,{user:o,transferMode:t,onChat:i,onCall:s,onDetails:l}),w=(0,y.useEvent)((function(e){e.preventDefault(),e.stopPropagation(),null==i||i({userId:o.userId,firstName:o.firstName,lastName:o.lastName,userType:o.userType,phone:null!=I?I:""})})),N=(0,y.useEvent)((function(e){null==u||u(e,o)})),A=(0,y.useEvent)((function(){null==d||d(o)}));return(0,r.jsx)(yc.ContactListItem,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){$v(e,t,n[t])}))}return e}({as:L.SelectionItem,keyHandlerElement:"directory-item",transferMode:t,transferControlsStyle:n,userId:o.userId,userType:o.userType,hasChat:o.hasChat,number:I,avatarProps:S,title:O,body:x,stats:C,controls:_,onClick:u?N:w,onDoubleClick:d&&A,containerProps:{itemId:o.userId,focusOnSelection:!0,tabIndex:0,"data-testid":"directory-item","data-ms-teams-user":"true"}},p))};function Zv(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Jv(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Zv(e,t,n[t])}))}return e}function eh(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function th(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var nh=o().memo((function(e){var t=e.item,n=e.listNode,o=e.className,i=th(e,["item","listNode","className"]),s=(0,a.useRef)(null),l=(0,y.useIntersectionObserver)(s,{root:n});!function(e,t){(0,Er.useSubscribeForUserDetails)((0,Jt.isUserWithDetails)(e)?e.userId:void 0,t),(0,ev.useSubscribeForServiceDetails)((0,Jt.isDirectoryEntry)(e)?e.serviceId:void 0,t),(0,ev.useSubscribeForHuntGroupDetails)((0,Jt.isHuntGroup)(e)?e.huntGroupId:void 0,t)}(t,null==l?void 0:l.isIntersecting);var c=(0,a.useMemo)((function(){return(0,Jt.isMsTeamsChannel)(t)?(0,r.jsx)(qv,eh(Jv({},i),{item:t})):(0,Jt.isMsTeamsUser)(t)?(0,r.jsx)(Qv,eh(Jv({},i),{user:t})):(0,Jt.isExternalUser)(t)?(0,r.jsx)(Cv,eh(Jv({},i),{contact:t})):(0,Jt.isDirectoryEntry)(t)?(0,r.jsx)(dv,eh(Jv({},i),{item:t})):(0,r.jsx)(Hv,eh(Jv({},i),{user:t}))}),[i,t]);return(0,r.jsx)("div",{ref:s,className:o,children:c})})),rh=function(){var e=(0,c.useLocalizationState)().t,t=(0,nl.useDirectoryUIState)((function(e){return e.toggleCreateContactMode}));return(0,at.useSessionState)("privileges").EDIT_CONTACTS?(0,r.jsx)("div",{className:"mb-2 flex",children:(0,r.jsx)(_e.Button,{variant:"ghost",size:"sm",className:"shrink-0",onClick:t,iconLeft:(0,r.jsx)(j.IconPlus16,{className:"icon-primary"}),children:e.CONTACT.create_new_contact_button_text()})}):null},ah=/^(address|company_name|dob|email|first_name|last_name|name|phone|position|segment|title|url):/;function oh(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ih(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function sh(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function lh(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return oh(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return oh(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var ch=function(){return!0},uh=function(e){var t=e.query,n=e.transferMode,o=e.transferControlsStyle,s=e.noControls,l=e.onClick,u=e.selectedId,d=e.onDoubleClick,f=e.scrollParent,m=e.withCreateContact,p=void 0===m||m,v=e.searchInputRef,h=e.filter,b=void 0===h?ch:h,g=e.isHighlighted,j=(0,c.useLocalizationState)("t"),I=(0,i.useDefaultTransferMode)(),S=n||I,O=(0,st.useContactsState)(["contactList","contactListLoaded","contactListByChunks","contactListLoading","contactListByChunksLoading"]),x=O.contactList,C=O.contactListLoaded,_=O.contactListByChunks,w=O.contactListLoading,N=O.contactListByChunksLoading,A=(0,st.useContactsStateMethods)(),P=A.getContactListByChunks,E=A.getContactList,D=(0,yo.useNavigationState)("setActivePage"),T=(0,hc.useCaseStateMethods)().createCaseEmail,k=function(e){return(0,a.useMemo)((function(){if(e)return e.replace(ah,"").trim()}),[e])}(t),R=(0,te.useCallHandler)(),F=(0,te.useContactDetailsOpener)(),B=!!t,U=(0,a.useMemo)((function(){return B?x.filter(b):_.filter(b)}),[B,x,b,_]),z=Jp(t,(function(e){return E({query:e})}),500),H=(0,i.useInteractionStateMethods)().createPotentialItem,V=lh((0,a.useState)(void 0),2),G=V[0],W=V[1],q=(0,a.useRef)(null),Y=(0,y.useEvent)((function(e,t){return t.id})),K=(0,$l.useVirtualScrollDataManager)(Jl("external"),q),$=(0,a.useMemo)((function(){return U.map((function(e,t){return Y(t,e)}))}),[U,Y]),X=(0,y.useAsRef)($),Q=(0,y.useEvent)((function(){return X.current})),Z=(0,y.useEvent)((function(e,t){if("keys"===t){var n,r,a=null===(n=X.current)||void 0===n?void 0:n.findIndex((function(t){return e===t}));null===(r=q.current)||void 0===r||r.scrollIntoView({index:a})}})),J=(0,y.useEvent)((function(e){if(!B){var t=U[e];P({limit:20,start:{last_name:t.lastName,id:t.id}})}}));(0,a.useEffect)((function(){!(B||_.length||N||C)&&P({limit:20})}),[_.length,N,C,P,B]);var ee=(0,y.useEvent)((function(e){R(sh(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){ih(e,t,n[t])}))}return e}({},e),{navigateToInteractionsPage:!0}))})),ne=(0,y.useEvent)((function(e){var t=e.contactId,n=e.phone,r=e.firstName,a=e.lastName;t&&(H({phone:n,contactId:t,firstName:r,lastName:a}),D({name:yo.AppRoutes.Interactions}))})),re=(0,y.useEvent)((function(e){T(e)})),ae=(0,a.useCallback)((function(e,n){var a=Y(e,n),i=u===a;return(0,r.jsx)(L.ErrorBoundary,{fallback:null,children:(0,r.jsx)(nh,{as:L.SelectionItem,listNode:G,item:n,onCall:ee,onChat:ne,onEmail:re,onClick:l,onDoubleClick:d,onDetails:F,isSelected:(null==g?void 0:g(n))||i,transferMode:S,transferNumberInput:t,transferControlsStyle:o,noControls:s,highlight:k,containerProps:{itemId:a,focusOnSelection:!0,tabIndex:0,touchedOnly:!0}})})}),[Y,k,s,ee,ne,l,d,re,F,t,G,u,o,S]),oe=(0,a.useMemo)((function(){var e=t?j.DIRECTORY.no_results_external_for_query(t):j.DIRECTORY.no_results_external();return(0,r.jsx)("div",{className:"w-full text-center",children:e})}),[j.DIRECTORY,t]);Xp(U);var ie=(0,a.useCallback)((function(e){switch(e.key){case"Escape":var t;null==v||null===(t=v.current)||void 0===t||t.focus();break;case"Home":var n;null===(n=q.current)||void 0===n||n.scrollIntoView({index:0,done:function(){dh(G,X.current[0])}});break;case"End":var r,a,o=(null===(r=X.current)||void 0===r?void 0:r.length)-1;null===(a=q.current)||void 0===a||a.scrollIntoView({index:o,done:function(){dh(G,X.current[o])}})}}),[X,G,v]),se=w||z;return(0,r.jsxs)("div",{className:"relative flex flex-auto flex-col overflow-hidden",children:[p&&(0,r.jsx)(rh,{}),(0,r.jsx)("div",{ref:function(e){return W(e||void 0)},className:M("scrollbar-on-hover relative !m-0 flex min-h-0 flex-auto flex-col overflow-y-auto overflow-x-hidden",{"overflow-y-hidden":se}),children:se?(0,r.jsx)("div",{className:"absolute inset-x-0",children:(0,r.jsx)(yc.ContactListPlaceholder,{amount:15})}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(L.SelectionContainer,{itemsListProvider:Q,onItemSelect:Z,circular:!N,onKeyDown:ie,children:(0,r.jsx)(Ho.Virtuoso,{ref:q,tabIndex:void 0,data:U,itemContent:ae,computeItemKey:Y,customScrollParent:f||G,endReached:J,restoreStateFrom:K})}),!U.length&&oe]})}),(0,r.jsx)(L.Loader,{active:!se&&N,size:"medium",color:"primary",className:"absolute bottom-0 top-auto z-10"})]})};function dh(e,t){var n;null==e||null===(n=e.querySelector('[data-id="'.concat(t,'"]')))||void 0===n||n.focus()}function fh(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var mh=function(e){return(0,nl.useDirectoryUIState)((function(e){return e.createContactMode}))?(0,r.jsx)($p,{}):(0,r.jsx)(uh,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){fh(e,t,n[t])}))}return e}({},e))},ph=["ArrowDown","ArrowUp","Home","End"];function vh(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function hh(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}var bh=function(e){return function(t){return t.teamId===e}},yh=function(e,t){return e.map((function(e){return e.id===t&&void 0!==e.usersCount?hh(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){vh(e,t,n[t])}))}return e}({},e),{usersCount:e.usersCount-1}):e}))},gh=function(e){var t=e.transferMode,n=e.transferNumberInput,o=e.transferControlsStyle,i=e.items,s=e.highlight,l=e.listRef,c=e.selectedId,u=e.noControls,d=e.contentClassName,f=e.onCall,m=e.onChat,p=e.onEmail,v=e.onDetails,h=e.onClick,b=e.onDoubleClick,y=e.isHighlighted,g=(0,a.useRef)(null),j=l||g;return(0,r.jsx)("div",{ref:g,className:M("[&>div]:border-b [&>div]:border-main-border [&>div]:last:border-b-0","ui divided relaxed list"),children:i.map((function(e,a){var i=c===(0,Jt.getDirectoryItemUniqueId)(e);return(0,r.jsx)(L.ErrorBoundary,{fallback:null,children:(0,r.jsx)(nh,{onDoubleClick:b,listNode:j.current,noControls:u,item:e,onCall:f,onChat:m,onEmail:p,isSelected:(null==y?void 0:y(e))||i,showControls:i,onDetails:v,transferMode:t,transferNumberInput:n,transferControlsStyle:o,highlight:s,contentClassName:d,onClick:h})},a)}))})};function jh(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ih(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Sh(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function Oh(e){return function(e){if(Array.isArray(e))return jh(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return jh(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return jh(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var xh=[void 0,"msteams","msteams_channels"];function Ch(e,t){var n=xh.indexOf(e.userType),r=xh.indexOf(t.userType);return n>r?1:n<r?-1:0}function _h(e,t){return(0,Jt.isMsTeamsChannel)(t)||(0,Jt.isDirectoryEntry)(t)?t.title:e(t.firstName,t.lastName)}function wh(e,t,n){var r=_h.bind(null,e),a=r(t).toLowerCase(),o=r(n).toLowerCase();return a>o?1:a<o?-1:0}var Nh=function(e){var t=(0,i.useDefaultTransferMode)(),n=(0,nl.useDirectoryUIState)((function(e){return e.selected})),o=(0,gt.useFormatting)().formatFullName,s=e.query,c=e.transferMode,u=void 0===c?t:c,d=e.filteredSearchResults,f=e.filteredDirectoryEntries,m=e.emptyMessage,p=Sh(e,["query","transferMode","filteredSearchResults","filteredDirectoryEntries","emptyMessage"]),v=(0,at.useSessionState)().userId,h=(0,a.useMemo)((function(){var e=d.data.emiUsers,t=wh.bind(null,o),n=d.data,r=n.directoryEntries,a=n.users,i=Object.values(f).flat(1);console.log("@@@ filteredSearchResults:",d);var s=r.map((function(e){var t=e.id;return i.find((function(e){return e.id===t}))})).filter(l.isDefined);return Oh(function(e,t){return e.filter((function(e){return e.userId!==t}))}(a,v)).concat(Oh(s.sort(t)),Oh(Object.keys(e).reduce((function(t,n){var r;return null===(r=e[n])||void 0===r||r.forEach((function(e){return t.push(e)})),t}),[]).sort(t).sort(Ch)))}),[f,d.data,o,v]);return Xp(h),0===h.length?(0,r.jsx)(a.Fragment,{children:m}):(0,r.jsx)(gh,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Ih(e,t,n[t])}))}return e}({transferMode:u,transferNumberInput:s,items:h,highlight:s,selectedId:n},p))},Ah="TEAM",Ph="CATEGORY",Eh="SEARCH_TEAM",Dh="SEARCH_CATEGORY",Th="EMI_CATEGORY";function kh(e){return e.isSearchMode?"adcDirectoryInternalActiveGroupForSearch":"adcDirectoryInternalActiveGroup"}var Mh=function(e){var t=e.type,n=e.folderItem,a=e.users,o=e.directoryEntries,i=e.emiUsers,s=e.searchQuery,l=function(){switch(t){case Ah:return"usersCount"in n?n.usersCount:a.filter(bh(n.id)).length;case Ph:var e;return null===(e=o[n.id])||void 0===e?void 0:e.length;case Th:var r;return(0,Wc.assertEmiCategoryId)(n.id),null===(r=i[n.id])||void 0===r?void 0:r.length}}(),c=void 0!==l;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{"data-testid":"category-title",className:"body text-primary-on-primary",children:s?(0,r.jsx)(L.Highlight,{text:s,children:n.name}):n.name}),c&&(0,r.jsxs)("span",{className:"ml-2 font-semibold caption-s text-neutral-disabled ",children:["(",l,")"]})]})};function Lh(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Rh(e){return function(e){if(Array.isArray(e))return Lh(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Lh(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Lh(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Fh(e,t){return e>t?1:e<t?-1:0}var Bh=o().memo((function(e){var t=e.filteredUsers,n=e.filteredDirectoryEntries,o=e.filteredEmiUsers,i=e.type,s=e.item,l=e.opened,c=e.query,u=e.transferMode,d=e.transferControlsStyle,f=e.listRef,m=e.toggleDirectoryFolder,p=e.onCall,v=e.onChat,h=e.onEmail,b=e.onDetails,g=e.onClick,I=e.isHighlighted,S=e.onDoubleClick,O=(0,a.useId)(),x=function(e,t,n){var r=n.users,o=void 0===r?[]:r,i=n.categoryEntries,s=void 0===i?{}:i,l=n.emiUsers,c=void 0===l?{}:l;return(0,a.useMemo)((function(){switch(e){case Ah:case Eh:return Rh(o).filter(bh(t.id));case Ph:case Dh:return Rh(s[t.id]||[]).sort((function(e,t){var n,r;return Fh("".concat(e.title," ").concat(null!==(n=e.number)&&void 0!==n?n:e.email).toLowerCase(),"".concat(t.title," ").concat(null!==(r=t.number)&&void 0!==r?r:t.email).toLowerCase())}));case Th:return Rh(c[t.id]||[]).sort((function(e,t){return Fh(e.title||"",t.title||"")}));default:return[]}}),[s,c,t.id,e,o])}(i,s,{users:t,categoryEntries:n,emiUsers:o}),C=(0,y.useEvent)((function(){m(s.id)})),_=l?j.IconChevronDown16:j.IconChevronRight16;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)(L.SelectionItem,{focusOnSelection:!0,className:"flex w-full cursor-pointer items-center px-1 py-1.5 bg-primary-background",tabIndex:0,"data-testid":"directory-folder","data-element":"directory-item","aria-expanded":l?"true":"false","aria-controls":O,onClick:C,children:[(0,r.jsx)(_,{className:"mr-2"}),(0,r.jsx)(Mh,{type:i,folderItem:s,users:t,directoryEntries:n,emiUsers:o,searchQuery:c})]}),(0,r.jsx)("div",{id:O,children:l&&(0,r.jsx)(gh,{listRef:f,transferMode:u,transferNumberInput:c,transferControlsStyle:d,items:x,onCall:p,onChat:v,onEmail:h,onDetails:b,highlight:c,onClick:g,onDoubleClick:S,isHighlighted:I})})]})}));function Uh(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function zh(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Hh(){var e=(0,hc.useCaseStateMethods)().createCaseEmail,t=(0,te.useCallHandler)(),n=(0,te.useActivityHistoryOpener)(),r=(0,y.useEvent)((function(e){t(zh(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Uh(e,t,n[t])}))}return e}({},e),{navigateToInteractionsPage:!0}))}));return{onChat:n,onCall:r,onEmail:(0,y.useEvent)((function(t){e(t)}))}}function Vh(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Gh(e){return function(e){if(Array.isArray(e))return Vh(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Vh(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Vh(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Wh(e){var t=e.filteredCategories,n=e.isSearchMode,r=e.filteredSearchResults,o=(0,Gc.useDirectoryState)(["teams","emiCategories"]),i=o.teams,s=o.emiCategories,l=(0,at.useSessionState)().teamId;return(0,a.useMemo)((function(){return n?function(e){if(!e)return[];var t=e.data,n=t.directoryCategories;return Gh(t.teams.map((function(e){return{type:Eh,item:e}}))).concat(Gh(n.map((function(e){return{type:Dh,item:e}})))).sort(qh)}(r):Yh(yh(i,l),t,s)}),[t,s,r,n,l,i])}function qh(e,t){return e.item.name.toLowerCase()>t.item.name.toLowerCase()?1:e.item.name.toLowerCase()<t.item.name.toLowerCase()?-1:0}var Yh=function(e,t,n){return Gh(e.map((function(e){return{type:Ah,item:e}}))).concat(Gh(t.map((function(e){return{type:Ph,item:e}}))),Gh(n.map((function(e){return{type:Th,item:e}})))).sort(qh)};function Kh(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function $h(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Kh(e,t,n[t])}))}return e}function Xh(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}var Qh=function(){var e=(0,s.useNonAssertedInteractionId)(),t=(0,i.useAssociatedChatInteractionProp)(e,X.getChatParties),n=(0,at.useSessionState)().userId;return(0,a.useCallback)((function(e){return!(null==t?void 0:t.find((function(t){return t.user_id&&t.user_id===e.userId||t.contact_id&&t.contact_id===e.contactId})))&&e.userId!=n}),[t,n])},Zh=function(){var e=(0,at.useSessionState)().userId,t=(0,s.useNonAssertedInteractionId)(),n=(0,i.useInteractionProp)(t,(function(e){return null==e?void 0:e.parties}));return(0,a.useCallback)((function(t){return!(null==n?void 0:n.find((function(e){return e.userId&&e.userId===t.userId||e.contactId&&e.contactId===t.contactId})))&&t.userId!=e}),[n,e])};function Jh(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function eb(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Jh(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Jh(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function tb(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function nb(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return tb(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return tb(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var rb={list:[],diff:{added:[],removed:[]}};function ab(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ob(e){return function(e){if(Array.isArray(e))return ab(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return ab(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ab(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function ib(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function sb(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ib(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ib(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var lb=function(e){var t,n,o,s=(0,i.useDefaultTransferMode)(),l=(0,Gc.useDirectoryState)("isTeamsLoading"),u=e.query,d=e.transferMode,f=void 0===d?s:d,m=e.transferControlsStyle,p=e.onClick,v=e.onDoubleClick,h=e.filter,b=e.isHighlighted,g=sb(function(e){var t=(0,op.useLocalSettings)(),n=(0,y.useValueUpdated)(e),r=nb((0,a.useState)(rb),2),o=r[0],i=r[1],s=nb((0,a.useState)(rb),2),l=s[0],c=s[1];return(0,a.useEffect)((function(){n&&(c(rb),t.set(kh({isSearchMode:!0}),[]))}),[t,n]),e?[l,c]:[o,i]}(u),2),j=g[0],I=g[1],S=(0,c.useLocalizationState)("t").DIRECTORY,O=!!u,x=function(e){var t=e.transferMode,n=e.filter,r=void 0===n?function(){return!0}:n,o=(0,Gc.useDirectoryState)(["categories","categoryEntries","emiUsers"]),i=o.categories,s=o.categoryEntries,l=o.emiUsers,c=(0,Gc.useDirectorySearchResultsState)(),u=(0,at.useSessionState)().privileges,d=!!Object.keys(u).length,f=(0,a.useCallback)((function(e){return"messages"===t?e.hasChat:"calls"!==t||void 0!==(0,Yv.getMsTeamsUserPrimaryPhoneNumber)(e.phones)}),[t]),m=(0,a.useCallback)((function(e){return!t}),[t]),p=(0,a.useMemo)((function(){var e,t;return Xh($h({},c),{count:c.count?Number(c.count):void 0,data:Xh($h({},c.data),{directoryEntries:c.data.directoryEntries,emiUsers:{msteamsUsers:null===(e=c.data.emiUsers.msteamsUsers)||void 0===e?void 0:e.filter((function(e){return f(e)&&r(e)})),msteamsChannels:null===(t=c.data.emiUsers.msteamsChannels)||void 0===t?void 0:t.filter((function(e){return m(e)&&r(e)}))},users:d&&u.CAN_VIEW_DIRECTORY?c.data.users.filter(r):[],usersWithoutCurrentUser:d&&u.CAN_VIEW_DIRECTORY?c.data.usersWithoutCurrentUser.filter(r):[],teams:d&&u.CAN_VIEW_DIRECTORY?c.data.teams:[]})})}),[r,c,f,m,d,u.CAN_VIEW_DIRECTORY]),v=(0,a.useMemo)((function(){return(0,$.pickBy)((0,$.mapValues)(s,(function(e){return e.filter(r)})),(function(e){return e.length}))}),[s,r]),h=(0,a.useMemo)((function(){return i.filter((function(e){return e.id in v}))}),[i,v]),b=(0,a.useMemo)((function(){var e,t,n;return Kh(n={},Wc.MS_TEAMS_CHATS_CATEGORY_ID,null===(e=l[Wc.MS_TEAMS_CHATS_CATEGORY_ID])||void 0===e?void 0:e.filter(f)),Kh(n,Wc.MS_TEAMS_CHANNELS_CATEGORY_ID,null===(t=l[Wc.MS_TEAMS_CHANNELS_CATEGORY_ID])||void 0===t?void 0:t.filter(m)),n}),[l,m,f]);return{filteredSearchResults:p,filteredDirectoryEntries:v,filteredCategories:h,filteredEmiUsers:b}}({transferMode:f,filter:h}),C=x.filteredSearchResults,_=x.filteredDirectoryEntries,w=x.filteredCategories,N=x.filteredEmiUsers,A=function(e){var t=e.transferMode,n=e.filter,r=void 0===n?function(){return!0}:n,o=(0,Gc.useDirectoryState)("usersWithoutCurrentUser"),i=Qh(),s=Zh();return(0,a.useMemo)((function(){return"messages"===t?o.filter((function(e){return i(e)&&r(e)})):"calls"===t?o.filter((function(e){return s(e)&&r(e)})):o.filter(r)}),[t,o,i,r,s])}({transferMode:f,filter:h}),P=Wh({isSearchMode:O,filteredSearchResults:C,filteredCategories:w}),E=(0,Gc.useDirectoryStateMethods)().findContacts,D=Hh(),T=D.onCall,k=D.onChat,R=D.onEmail,F=(0,te.useContactDetailsOpener)();Jp(u,(function(e){return E(e,"directory")})),t=(0,at.useSessionState)().privileges,n=(0,Gc.useDirectoryStateMethods)(),o=!!Object.keys(t).length,(0,a.useEffect)((function(){o&&t.CAN_VIEW_DIRECTORY&&n.getAgentTeams()}),[n,t.CAN_VIEW_DIRECTORY,o]),function(e){var t=e.openFolders,n=e.foldersList,r=(0,Gc.useDirectoryStateMethods)(),o=(0,a.useRef)(!0);(0,a.useEffect)((function(){var e=n.filter((function(e){var n=e.item;return-1!==t.diff.added.indexOf(n.id)})),a=e.filter((function(e){var t=e.type;return t===Ah||t===Eh})),i=e.reduce((function(e,t){var n=t.item;return t.type===Th&&e.push(n.id),e}),[]);if(i.forEach((function(e){r.getCategoryUsers(e)})),o.current||a.length){var s=n.filter((function(e){var n=e.item;return-1!==t.list.indexOf(n.id)})),l=s.filter((function(e){var t=e.type;return t===Ah||t===Eh})).map((function(e){return e.item.id}));l.length&&(r.getLoggedUsers(l),o.current=!1)}}),[o,r,t,n.length])}({openFolders:j,foldersList:P});var B,U,z=function(e){var t=e.isSearchMode,n=e.setOpenFolders,r=(0,op.useLocalSettings)(),o=eb((0,a.useState)(!1),2),i=o[0],s=o[1];return(0,a.useEffect)((function(){s(!1),r.get(kh({isSearchMode:t})).then((function(e){void 0!==e&&n({list:e,diff:{added:[],removed:[]}}),s(!0)}))}),[t,r,n]),i}({isSearchMode:O,setOpenFolders:I}),H=(0,a.useMemo)((function(){return O?!C.isLoading:!!P.length&&z}),[C.isLoading,O,P.length,z]),V=(0,$l.useNativeScrollDataManager)(Jl("internal"),{retrieveScrollCondition:H}),G=function(e){var t=e.isSearchMode,n=e.setOpenFolders,r=(0,op.useLocalSettings)();return(0,y.useEvent)((function(e){n((function(n){var a,o;return n.list.includes(e)?(a=n.list.filter((function(t){return t!==e})),o={added:[],removed:[e]}):(a=ob(n.list).concat([e]),o={added:[e],removed:[]}),r.set(kh({isSearchMode:t}),a),{list:a,diff:o}}))}))}({isSearchMode:O,setOpenFolders:I}),W=(0,a.useMemo)((function(){if(C.count)return(0,r.jsx)("div",{className:"text-center","data-testid":"too-many-search-results",children:S.too_many_results_found()});var e=u?S.no_results_internal_for_query(u):S.no_results_internal();return(0,r.jsx)("div",{className:"text-center",children:e})}),[C.count,u,S]),q=(B=V,U="directory-item",(0,a.useCallback)((function(e){var t;if(e.target&&(0,se.isHTMLElement)(e.target)){var n=null===(t=e.target.dataset)||void 0===t?void 0:t.element;if(n&&n===U&&ph.includes(e.key)&&B.current){var r,a=Array.from(B.current.querySelectorAll('[data-element="directory-item"]'));if(!a.length)return;var o=null!==(r=a.indexOf(e.target))&&void 0!==r?r:0;switch(e.key){case"ArrowDown":return a[o=o<a.length-1?o+1:0].focus();case"ArrowUp":return a[o=o>0?o-1:a.length-1].focus();case"Home":return a[o=0].focus();case"End":return a[o=a.length-1].focus()}}}}),[B,U]));(0,y.useEventListener)("keydown",q);var Y=O&&C.isLoading||l&&!P.length;return(0,r.jsx)(L.SelectionContainer,{className:M("scrollbar-on-hover flex-auto overflow-auto","[&:not(:first-child)]:mt-0 [&:not(:last-child)]:mb-0","[&:not(:last-child)]:border-b [&:not(:last-child)]:border-main-border",{"overflow-y-hidden":Y}),children:(0,r.jsx)("div",{className:"bg-primary-background",children:Y?(0,r.jsx)("div",{className:"mt-2",children:(0,r.jsx)(yc.ContactListPlaceholder,{amount:15})}):(0,r.jsxs)(r.Fragment,{children:[P.map((function(e){var t=e.type,n=e.item;return(0,r.jsx)(Bh,{type:t,item:n,opened:j.list.includes(n.id),query:u,transferMode:f,transferControlsStyle:m,listRef:V,filteredUsers:A,filteredDirectoryEntries:_,filteredEmiUsers:N,toggleDirectoryFolder:G,onCall:T,onChat:k,onEmail:R,onDetails:F,onClick:p,onDoubleClick:v,isHighlighted:b},n.id)})),O&&!C.isLoading?(0,r.jsx)(Nh,{transferMode:f,transferControlsStyle:m,query:u,filteredSearchResults:C,filteredDirectoryEntries:_,emptyMessage:W,onCall:T,onChat:k,onEmail:R,onDetails:F,onClick:p,onDoubleClick:v,isHighlighted:b}):null,O||P.length?null:W]})})})};function cb(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function ub(e){if("ArrowDown"===e.key||"ArrowUp"===e.key){var t=e.currentTarget,n=e.target,r=t.querySelectorAll('[data-combined-directory="internal"] [data-element="directory-item"]'),a=r[r.length-1],o=t.querySelectorAll('[data-combined-directory="external"] [data-element="directory-item"]'),i=o[0],s=o[1];switch(e.key){case"ArrowDown":n===a&&cb(i,HTMLElement)&&(i.focus(),e.stopPropagation()),n===i&&cb(s,HTMLElement)&&(s.focus(),e.stopPropagation());break;case"ArrowUp":n===s&&cb(i,HTMLElement)&&(i.focus(),e.stopPropagation()),n===i&&cb(a,HTMLElement)&&(a.focus(),e.stopPropagation())}}}function db(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function fb(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return db(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return db(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var mb,pb=function(e){var t=e.query,n=e.transferMode,o=e.onClick,i=e.transferControlsStyle,s=e.filter,l=e.isHighlighted,u=(0,c.useLocalizationState)().t,d=(0,st.useContactsState)(["contactList","contactListByChunks","contactListLoading"]),f=d.contactList,m=d.contactListByChunks,p=d.contactListLoading,v=(0,Gc.useDirectorySearchResultsState)(),h=v.isLoading,b=v.count,y=(0,a.useId)(),g=fb((0,a.useState)(!1),2),I=g[0],S=g[1],O=t?f:m,x=h||p,C=!!(null==t?void 0:t.length),_=(0,a.useCallback)((function(){return S((function(e){return!e}))}),[]);!function(e){var t=e.isSearchMode,n=e.setIsExternalVisible,r=(0,a.useRef)(!1);(0,a.useEffect)((function(){t&&n((function(e){return e||(r.current=!0),!0})),!t&&r.current&&(r.current=!1,n(!1))}),[t,n])}({isSearchMode:C,setIsExternalVisible:S});var w=fb((0,a.useState)(null),2),N=w[0],A=w[1],P=I?j.IconChevronDown16:j.IconChevronRight16;return(0,r.jsxs)("div",{onKeyDownCapture:ub,className:"scrollbar-on-hover overflow-auto",ref:A,children:[x&&(0,r.jsx)("div",{className:"text-center",children:u.GLOBAL.loading()}),!t||x?null:b||O.length?void 0:(0,r.jsx)("div",{className:"text-center",children:u.DIRECTORY.no_results_for_query(t)}),(0,r.jsx)("div",{className:M({hidden:h||t&&!b}),children:(0,r.jsx)("div",{"data-combined-directory":"internal",children:(0,r.jsx)(lb,{filter:s,query:t,onClick:o,isHighlighted:l,transferMode:n,transferControlsStyle:i})})}),(0,r.jsxs)("div",{"data-combined-directory":"external",children:[(0,r.jsxs)("button",{className:"flex w-full cursor-pointer items-center px-1 py-1.5 bg-primary-background","data-testid":"directory-folder","data-element":"directory-item","aria-expanded":I?"true":"false","aria-controls":y,onClick:_,children:[(0,r.jsx)(P,{className:"mr-2"}),(0,r.jsx)("span",{"data-testid":"category-title",className:"body text-primary-on-primary",children:u.DIRECTORY.external_contacts()})]}),(0,r.jsx)("div",{id:y,className:M("min-h-2 bg-primary-background",{hidden:p||t&&0===O.length}),children:I&&(0,r.jsx)(mh,{query:t,onClick:o,isHighlighted:l,scrollParent:N,withCreateContact:!1,transferMode:n,transferControlsStyle:i})})]})]})},vb=((0,$.invert)(["all","calls","messages"]),(0,$.invert)(["recent","favorites","directory"]),["internal","external"]),hb=(0,$.invert)(vb),bb=function(){var e=(0,at.useSessionState)().phoneDeviceCapabilities,t=(0,Gc.useDirectoryState)("users"),n=(0,st.useContactsState)(["contactList","contactListLoading"]).contactList,o=(0,c.useLocalizationState)().t,i=(0,I.useNotificationsState)("methods").hideNotificationsByTag,s=(0,nl.useDirectoryUIState)(),l=s.tabIndex,u=s.selected,d=s.searchValue,f=s.setSearchValue,m=s.setSelected,p=s.firstFoundItemId,v=s.setFirstFoundItemId,h=s.searchInputRef,b=(0,a.useCallback)((function(e){var t=e.target;if((0,se.isHTMLInputElement)(t)){var n=t.value;f(n),m(void 0),v(void 0)}}),[v,f,m]),y=(0,xn.useServiceState)().selectedService,g=(0,On.useDIDNumberState)().selectedDIDNumber,S=(0,te.useCallHandler)(),O=(0,te.useActivityHistoryOpener)(),x=vb[+l],C=(0,a.useMemo)((function(){return"internal"===x?t.find((function(e){return(0,Jt.getDirectoryItemUniqueId)(e)===(u||p)})):n.find((function(e){return(0,Jt.getDirectoryItemUniqueId)(e)===(u||p)}))}),[n,x,p,u,t]),_=(0,a.useCallback)((function(){if(C)S({phone:(0,Jt.getDirectoryItemPhoneBySearch)(C,d),firstName:C.firstName,lastName:C.lastName,serviceId:y,contactId:(0,Jt.getDirectoryItemContactId)(C),userId:(0,Jt.getDirectoryItemUserId)(C),accessNumberId:g,origination:"directory",navigateToInteractionsPage:!0});else{if(!d)return;S({serviceId:C,accessNumberId:g,phone:d,origination:"directory",navigateToInteractionsPage:!0})}}),[S,d,g,C,y]),w=(0,a.useCallback)((function(){if(!C){if(!d)return;return i("interaction-init"),O({phone:d,forceSearchForContact:!1})}i("interaction-init");var e=(0,Jt.getDirectoryItemUserId)(C),t=(0,Jt.getDirectoryItemContactId)(C);O({contactId:t,userId:e,phone:(0,Jt.getDirectoryItemPhone)(C),origination:"directory",firstName:C.firstName,lastName:C.lastName,emiPhotoUrl:(0,Jt.isMsTeamsUser)(C)?C.photoUrl:void 0,emiUserType:(0,Jt.isMsTeamsUser)(C)?C.userType:void 0})}),[i,O,d,C]);return(0,r.jsxs)("div",{className:"flex items-start gap-2.5",children:[(0,r.jsx)(j.SearchField,{value:d,onChange:b,ref:h,layoutClassName:"grow","data-testid":"search-input","aria-label":o.DIRECTORY.search_field_placeholder(),placeholder:o.DIRECTORY.search_field_placeholder()}),(0,r.jsx)(L.SearchForInteractionControls,{onCallClick:_,showCallButton:!!e.canDial,callButtonDisabled:!(0,Jt.getDirectoryItemPhoneBySearch)(C,d)&&!(0,rt.isPhone)(d),chatButtonDisabled:!C&&!(0,rt.isPhone)(d),onChatClick:w,searchQuery:d})]})};var yb=function(){var e=(0,c.useLocalizationState)().t,t=(0,nl.useDirectoryUIState)(),n=t.selected,o=t.setSelected,s=t.tabIndex,l=t.handleTabChange,u=t.searchValue,d=t.setSearchValue,f=t.searchInputRef,m=(0,i.useActiveInteractionId)(),p=(0,te.useCallHandler)(),v=(0,te.useActivityHistoryOpener)(),h=(0,a.useCallback)((function(e,t){e.nativeEvent.detail>1?clearTimeout(mb):mb=setTimeout((function(){var e=(0,Jt.getDirectoryItemUniqueId)(t);o(e);var n=(0,Jt.getDirectoryItemPhone)(t);n&&d(n)}),250)}),[o,d]),b=(0,a.useCallback)((function(e,t){if(clearTimeout(mb),null==t?void 0:t.onCall)return t.onCall();var n=(0,Jt.getDirectoryItemPhone)(e),r=(0,Jt.getDirectoryItemFirstName)(e),a=(0,Jt.getDirectoryItemLastName)(e),o=(0,Jt.getDirectoryItemUserId)(e),i=(0,Jt.getDirectoryItemContactId)(e);n?p({phone:n,firstName:r,lastName:a,userId:o,contactId:i,navigateToInteractionsPage:!0}):v({contactId:i,userId:o,phone:n,firstName:r,lastName:a,origination:"directory",emiPhotoUrl:(0,Jt.isMsTeamsUser)(e)?e.photoUrl:void 0,emiUserType:(0,Jt.isMsTeamsUser)(e)?e.userType:void 0})}),[p,v]),y=(0,a.useMemo)((function(){return[{id:"internal",content:e.ADDRESS_BOOK_AREA.tab_directory_internal()},{id:"external",content:e.ADDRESS_BOOK_AREA.tab_directory_external()}]}),[e]),g=(0,a.useCallback)((function(e){var t=y.findIndex((function(t){return t.id===e}));l(t)}),[l,y]),j=y[Number(s)].id;return(0,r.jsxs)(_e.TabsRoot,{value:j,className:"flex h-full flex-col gap-2.5 px-4 pt-2",children:[(0,r.jsx)(_e.TabsList,{"data-testid":"directory-tabs",children:y.map((function(e){return(0,r.jsx)(_e.TabsTrigger,{value:e.id,"data-testid":"tab-".concat(e.id),isSelected:e.id===j,onClick:function(){return g(e.id)},className:"w-full text-center",triggerClassName:M("py-2",(t={},n="text-primary-on-primary",a=e.id===j,n in t?Object.defineProperty(t,n,{value:a,enumerable:!0,configurable:!0,writable:!0}):t[n]=a,t)),children:e.content},e.id);var t,n,a}))}),(0,r.jsx)(iu,{itemId:m}),(0,r.jsx)(bb,{}),(0,r.jsxs)(_e.TabsContent,{value:j,className:"flex min-h-0 !flex-auto flex-col py-1 pr-0.5",children:["internal"===j&&(0,r.jsx)(lb,{query:u,onClick:h,onDoubleClick:b}),"external"===j&&(0,r.jsx)(mh,{query:u,onClick:h,selectedId:n,onDoubleClick:b,searchInputRef:f})]})]})},gb=function(e){var t=e.number,n=e.type,a=e.displayType,o=(0,gt.useFormatting)().formatPhoneType;return(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsxs)("div",{className:"mr-2 inline-block w-1/3",children:[(0,r.jsx)("span",{"data-key":"phone-type",children:a||o(n.toUpperCase())}),(0,r.jsx)("span",{children:":"})]}),(0,r.jsx)("span",{"data-key":"phone",children:(0,rt.formatPhone)(t)})]})};function jb(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ib(e){var t=e.phones,n=e.handleCall,o=e.handleSinglePhoneCall,i=(0,L.useDropdown)(),s=i.openerRef,l=i.setOptions,c=i.show,u=(0,a.useCallback)((function(e){c.setFalse(),n(e)}),[c,n]),d=(0,a.useCallback)((function(e){var t=e.type,n=e.number,a=e.displayType;return{onClick:function(){return u(n)},text:(0,r.jsx)(gb,{number:n,type:t,displayType:a}),value:"".concat(t,"_").concat(n)}}),[u]),f=(0,a.useCallback)((function(e){return e.persist(),e.preventDefault(),e.stopPropagation(),c&&e.target===s.current?c.setFalse():t.length>1?(l(t.map(d)),s.current=e.target,c.setTrue()):void o()}),[o,d,s,t,l,c]);return(0,a.useMemo)((function(){return function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){jb(e,t,n[t])}))}return e}({handleCallClick:f,dataKey:"phones-dropdown"},i)}),[i,f])}function Sb(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Ob(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Sb(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Sb(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var xb=function(e){var t=e.candidate,n=e.callNumber,o=e.initiateChatWith,i=(0,c.useLocalizationState)("t").CONTACT,s=(0,at.useSessionState)(),u=s.privileges,d=s.phoneDeviceCapabilities,f=(0,gt.useFormatting)().getNamesFromDisplayName,m=t.email,p=t.phones,v=t.displayName,h=t.associatedObjects,b=v.split(": "),y=Ob(f(b.length>1?b[1]:v),2),g=y[0],j=y[1],I=function(e){if(e.length){var t=e.find((function(e){return"business"===e.type}));return t?t.number:e[0].number}}(p),S=(0,rt.formatPhone)(gp(I)),O=(0,r.jsx)("b",{"data-key":"name",children:t.displayName}),x=(0,r.jsxs)(r.Fragment,{children:[S&&(0,r.jsx)("span",{"data-key":"phone",children:S}),m&&!S&&(0,r.jsx)("span",{"data-key":"email",children:m})]}),C=(0,a.useMemo)((function(){return{firstName:g,lastName:j}}),[g,j]),_=(0,a.useCallback)((function(e){n(e,"integration-api",{firstName:g,lastName:j,associatedRecords:h})}),[n,g,j,h]),w=(0,a.useCallback)((function(){(0,l.assertDefined)(S),_(S)}),[_,S]),N=(0,a.useCallback)((function(){(0,l.assertDefined)(S),o(S,"integration-api",{firstName:g,lastName:j})}),[o,S,g,j]),A=Ib({phones:p,handleCall:_,handleSinglePhoneCall:w}),P=(0,a.useMemo)((function(){return(0,r.jsxs)(r.Fragment,{children:[S&&d.canDial&&(0,r.jsx)(L.Dropdown,{open:A.show.value,onClose:A.show.setFalse,options:A.options,selectOnBlur:!1,tabIndex:-1,trigger:(0,r.jsx)(L.CircleButton,{className:"mx-1.5 h-4.5 w-4.5",onClick:A.handleCallClick,tooltip:i.button_start_call_text(),noActiveState:!0,ref:A.openerRef,transparent:!0,clickThrottle:500,"data-testid":"call-button",children:(0,r.jsx)(ve.IconPhone,{})})}),S&&(null==u?void 0:u.CAN_START_EXTERNAL_CHAT)&&(0,r.jsx)(L.CircleButton,{className:"mx-1.5 h-4.5 w-4.5",onClick:N,tooltip:i.button_initiate_chat_text(),noActiveState:!0,transparent:!0,clickThrottle:500,"data-testid":"chat-button",children:(0,r.jsx)(ve.IconChat,{})})]})}),[S,d.canDial,A.show,A.options,A.handleCallClick,A.openerRef,i,null==u?void 0:u.CAN_START_EXTERNAL_CHAT,N]);return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(yc.ContactListItem,{number:S,title:O,body:x,avatarProps:C,onClick:$.noop,controls:P,className:"relative"})})},Cb=function(e){var t=e.dialpadNumber,n=e.callNumber,a=e.initiateChatWith,o=(0,u.useIntegrationApiState)(),i=o.isAvailable,s=o.dialCandidates;return i&&!t&&s.length?(0,r.jsx)(r.Fragment,{children:s.map((function(e){return(0,r.jsx)(xb,{candidate:e,callNumber:n,initiateChatWith:a},e.id)}))}):null};function _b(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function wb(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function Nb(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return _b(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _b(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Ab(e,t){return Pb(t)}function Pb(e){return lp(e)?e.userId:e.id}var Eb=function(){var e=kp(),t=e.callNumber,n=e.initiateChatWith,o=e.onContactSelect,s=e.closeDialpad,l=(0,nl.useCommunicatorUIState)("dialpad").searchValue,c=_p(),u=c.contacts,d=c.isLoading,f=(0,Ta.useAtomValue)(np),m=(0,Ta.useAtomValue)(rp),p=(0,i.useDefaultTransferMode)(),v=(0,te.useContactDetailsOpener)(),h=(0,a.useRef)(null),b=(0,a.useMemo)((function(){return u.map((function(e,t){return Pb(e)}))}),[u]),y=Nb((0,a.useState)(void 0),2),g=y[0],j=y[1],I=(0,a.useCallback)((function(e){j(e)}),[]),S=(0,Ta.useSetAtom)(ap),O=(0,a.useMemo)((function(){return{scrollToFirst:function(){var e;null===(e=h.current)||void 0===e||e.scrollIntoView({index:0,done:function(){Db(g,b[0])}})},scrollToLast:function(){var e,t=(null==b?void 0:b.length)-1;null===(e=h.current)||void 0===e||e.scrollIntoView({index:t,done:function(){Db(g,b[t])}})}}}),[b,g]);(0,a.useEffect)((function(){S(O)}),[O,S]);var x=(0,a.useCallback)((function(e,t){if((0,Jt.isMsTeamsUser)(t)||(0,Jt.isMsTeamsChannel)(t)||(0,Jt.isUserWithDetails)(t))throw Error("We don't support this type of contact in dialpad search.");var n=function(e,t){var n=lp(e)?e.extension:cp(e)?e.number:e.phone;if(t&&n&&!n.includes(t)&&!lp(e)&&!cp(e)){var r=(e.phones||[]).find((function(e){return e.includes(t)}));if(r)return r}return n}(t,l)||"",r=Pb(t);o({id:r,phone:n})}),[l,o]),C=(0,a.useCallback)((function(e,a){var o=Pb(a),i=f===o;return(0,r.jsx)(L.ErrorBoundary,{fallback:null,children:(0,r.jsx)(nh,{showFavoriteButton:!1,className:"h-14 w-full",listNode:g,item:a,isSelected:i,transferMode:p,onCall:function(e){var n=e.phone,r=wb(e,["phone"]);t(n,"dialpad-search",r)},onChat:function(e){var t=e.phone,r=wb(e,["phone"]);n(t,"dialpad-search",r)},onClick:x,onDetails:v,as:L.SelectionItem,containerProps:{itemId:o,focusOnSelection:!0,tabIndex:0}})})}),[t,p,x,n,v,g,f]),_=(0,a.useMemo)((function(){return(0,$.throttle)((function(){return s()}),300,{leading:!0})}),[s]);return(0,r.jsx)("div",{className:"flex grow flex-col overflow-hidden pt-2",children:(0,r.jsxs)("div",{ref:I,className:M("scrollbar-on-hover relative !m-0 flex min-h-2.5 flex-auto grow flex-col overflow-y-auto overflow-x-hidden",{"relative overflow-y-hidden":d}),role:"list",onScroll:_,children:[l?d?(0,r.jsx)("div",{className:"absolute inset-x-0",children:(0,r.jsx)(yc.ContactListPlaceholder,{amount:15})}):(0,r.jsx)(L.SelectionContainer,{className:Rs,itemsListProvider:function(){return b},onItemSelect:function(e){var t,n=null==b?void 0:b.findIndex((function(t){return e===t}));null===(t=h.current)||void 0===t||t.scrollIntoView({index:n}),s()},circular:!0,onKeyDown:function(e){e.stopPropagation(),"Escape"===e.key&&(null==m||m.focus())},children:(0,r.jsx)(Ho.Virtuoso,{ref:h,tabIndex:void 0,data:u,itemContent:C,computeItemKey:Ab,customScrollParent:g})}):null,!l&&!u.length&&(0,r.jsx)(Cb,{callNumber:t,dialpadNumber:l,initiateChatWith:n})]})})};function Db(e,t){var n;null==e||null===(n=e.querySelector('[data-id="'.concat(t,'"]')))||void 0===n||n.focus()}var Tb=n(2096);function kb(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Mb(e){return function(e){if(Array.isArray(e))return kb(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return kb(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return kb(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Lb=function(){var e=(0,c.useLocalizationState)().t,t=(0,nl.useCommunicatorUIState)("dialpad").searchValue,n=(0,Ta.useAtomValue)(ap),o=kp(),i=o.onCallClick,s=o.updateCaretPosition,l=o.onInputValueChange,u=o.closeDialpad,d=(0,Ta.useSetAtom)(rp),f=!!_p().contacts.length,m=(0,L.useCountrySelectorState)(["countrySelectorValue","setCountrySelectorValue"]),p=m.countrySelectorValue,v=m.setCountrySelectorValue,h=(0,L.useCountrySelectorState)(["countrySelectorRecent","addCountryToRecent"]),b=h.countrySelectorRecent,y=h.addCountryToRecent,g=jp().isValidPhoneNumber,I=!(!(p!==L.ALL_COUNTRIES_ID)||!t||g||f),S=(0,at.useSessionState)().country,O=(0,Tb.useUserProfileState)().userProfile,x=(0,a.useCallback)((function(e){var t="ALL"===e?L.ALL_COUNTRIES_ID:e;t!==p&&(y(L.DEFAULT_COUNTRY_RECENT_ID,t),v(t))}),[v,p,y]),C=p===L.ALL_COUNTRIES_ID?"ALL":p,_=(0,a.useMemo)((function(){return{phone:t||"",countryCode:C}}),[t,C]),w=(0,a.useCallback)((function(e){var n=hp(e);n!==t&&l(n)}),[t,l]),N=(0,a.useCallback)((function(e){w(e.phone),x(e.countryCode)}),[w,x]),A=(0,a.useMemo)((function(){var e,t=function(e){var t=n.findIndex((function(t){return t.code.toUpperCase()===(null==e?void 0:e.toUpperCase())}));return-1===t?n:[n[t]].concat(Mb(n.slice(0,t)),Mb(n.slice(t+1)))},n=bp.phoneNumberFormatter.getSupportedRegions().map((function(e){return{code:e.toLowerCase(),name:e,prefix:bp.phoneNumberFormatter.getCountryCodeForRegion(e)}}));return t(null===(e=n.find((function(e){return e.name.toUpperCase()===(null==O?void 0:O.country.toUpperCase())})))||void 0===e?void 0:e.code),t(S),n}),[S,null==O?void 0:O.country]),P=(0,a.useMemo)((function(){return b[L.DEFAULT_COUNTRY_RECENT_ID]||[]}),[b]),E=(0,a.useCallback)((function(e){if(!e.altKey)if("Enter"===e.key)i(),e.preventDefault();else if("ArrowDown"===e.key||"ArrowUp"===e.key)"ArrowDown"===e.key?null==n||n.scrollToFirst():null==n||n.scrollToLast(),u(),e.preventDefault();else{var t=vp(e.key,e.code);s(t)}}),[u,i,s,n]),D=(0,a.useRef)(null);return(0,a.useEffect)((function(){return d(D.current),function(){return d(null)}}),[D,d]),(0,r.jsx)(j.CountryPhoneField,{value:_,onChange:N,countries:A,recentCountryCodes:P,inputRef:D,onKeyDown:E,error:I&&e.DIAL_PAD.invalid_number_error_text(),searchFieldPlaceholder:e.GLOBAL.country_selector_search_input_placeholder(),recentTitle:e.GLOBAL.country_selector_recent(),countriesTitle:e.GLOBAL.country_selector_countries(),allCountriesTitle:e.GLOBAL.country_selector_all_countries_title(),"data-testid":"dialpad-input"})},Rb=function(){var e=(0,nl.useCommunicatorUIState)("dialpad").searchValue,t=kp(),n=t.onCallClick,a=t.onChatClick,o=(0,at.useSessionState)().phoneDeviceCapabilities;return(0,r.jsxs)("div",{className:"flex items-start gap-2 pr-3.5",children:[(0,r.jsx)(Lb,{}),(0,r.jsx)(L.SearchForInteractionControls,{searchQuery:e,onCallClick:n,onChatClick:a,callButtonDisabled:!o.canDial})]})},Fb=n(2374);function Bb(e){var t=e.transferMode,n=e.favoritesList,r=e.filter,o=void 0===r?Boolean:r,i=Qh(),s=Zh();return(0,a.useMemo)((function(){return n.reduce((function(e,t){return t.channels.forEach((function(n){(0,Fb.isFavoritesMultiMediaChannel)(n)?n.media.forEach((function(r){var a;(null===(a=n.hiddenMedia)||void 0===a?void 0:a.includes(r))||e.push({item:t,channel:n,media:r})})):n.hidden||e.push({item:t,channel:n})})),e}),[]).filter((function(e){return o(e)&&("messages"!==t||(n=e.item,(0,Fb.isFavoritesUserItem)(n)||(0,Fb.isFavoritesDirectoryEntryItem)(n)))&&("calls"===t?s(e.item):"messages"!==t||i(e.item));var n})).sort((function(e,t){return n=e.item,r=t.item,n.displayName.localeCompare(r.displayName,void 0,{sensitivity:"base"});var n,r}))}),[n,o,t,s,i])}var Ub=function(e){var t=e.channel,n=e.media,a=(0,c.useLocalizationState)("t").CONTACT,o=(0,L.useGetMessengerName)();return(0,Fb.isFavoritesInternalChannel)(t)||(0,Fb.isFavoritesPhoneChannel)(t)?((0,l.assertDefined)(n),"voice"===n?(0,r.jsx)(Hb,{children:(0,rt.formatPhone)(t.number)}):t.number?(0,r.jsx)(Vb,{children:(0,rt.formatPhone)(t.number)}):(0,r.jsx)(Vb,{children:a.internal_messages_field_value()})):(0,Fb.isFavoritesEmailChannel)(t)?(0,r.jsx)(zb,{children:t.email}):(0,Fb.isFavoritesMessengerChannel)(t)?(0,r.jsx)(Vb,{type:t.messengerType,children:"".concat(o(t.messengerType),": ").concat(t.userId)}):null},zb=function(e){var t=e.children;return(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[(0,r.jsx)(j.IconEmail16,{className:"my-px mr-1 inline-block shrink-0 icon-neutral"}),(0,r.jsx)("span",{"data-testid":"email",className:"truncate caption-s text-neutral-on-secondary",children:t})]})},Hb=function(e){var t=e.children;return(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[(0,r.jsx)(j.IconPhone16Filled,{className:"my-px mr-1 inline-block shrink-0 icon-neutral"}),(0,r.jsx)("span",{"data-testid":"phone",className:"truncate caption-s text-neutral-on-secondary",children:t})]})},Vb=function(e){var t=e.children,n=e.type,a=(0,L.getChannelImageIcon)(n);return(0,r.jsxs)("span",{className:"flex items-center gap-1",children:[a&&(0,r.jsx)(a,{className:"my-px mr-1 inline-block shrink-0 icon-neutral"}),(0,r.jsx)("span",{"data-testid":"chat",className:"truncate caption-s text-neutral-on-secondary",children:t})]})},Gb=function(e){var t=e.item,n=e.onDetailsClick,a=(0,c.useLocalizationState)("t").CONTACT,o=(0,y.useEvent)((function(){null==n||n(t)}));return(0,r.jsx)(j.ButtonIcon,{tooltip:a.button_show_contact_details_text(),"data-testid":"user-info-button",onPressed:o,children:(0,r.jsx)(j.IconInformation,{})})},Wb=function(e){var t,n=e.item,a=(0,ev.useServiceDetailsState)(),o=a.huntGroupsDetails,i=a.serviceDetails,s=(0,Er.useUserDetailsById)(null!==(t=n.userId)&&void 0!==t?t:n.emiUserId);if(s)return(0,r.jsx)(Lv,{details:s});if((0,Fb.isFavoritesDirectoryEntryItem)(n)){var l=n.huntGroupId?o[n.huntGroupId]:void 0,c=n.serviceId?i[n.serviceId]:void 0;if(l)return(0,r.jsx)(iv,{metrics:l});if(c)return(0,r.jsx)(sv,{metrics:c})}return null};function qb(e){var t=e.item,n=e.channel,r=e.media;switch(n.channelType){case"internal":return[t.id,n.channelType,r].filter(l.isDefined).join("-");case"phone":return[t.id,n.channelType,r,n.numberType,n.numberId,n.number].filter(l.isDefined).join("-");case"email":return[t.id,n.channelType,n.emailId,n.email].filter(l.isDefined).join("-");case"messenger":return[t.id,n.channelType,n.messengerType,n.userId].filter(l.isDefined).join("-")}}function Yb(e){var t=e.userId,n=e.emiUserId,r=e.contactId,o=e.emiUserType,i=e.emiPhotoUrl,s=e.firstName,l=e.lastName,c=e.displayName,u=t||n,d=(0,Er.useUserDetailsById)(u),f=(0,yt.useGetAvatarUrl)(),m=tv(e.serviceId,e.huntGroupId),p=function(e){if((0,Fb.isFavoritesDirectoryEntryItem)(e))return e.huntGroupId?"hunt-group":void 0!==e.serviceId?"scenario-entry":"static-entry"}(e),v=(0,Fb.isFavoritesUserItem)(e)||(0,Fb.isFavoritesDirectoryEntryItem)(e)||(0,Fb.isFavoritesEmiItem)(e)&&"msteams"===e.emiUserType;return(0,a.useMemo)((function(){var e={firstName:s,lastName:l,fullName:c,isAgent:v,avatarType:p,url:f({userId:u,contactId:r,userType:o,photoUrl:i})};return(null==d?void 0:d.data)?(e.isOnline="available"===d.data.presenceState,e.onlineStatusIcon=(0,Er.getUserStatusIcon)(null==d?void 0:d.data)):m&&(e.onlineStatusIcon=m),e}),[p,s,l,c,m,v,f,u,r,o,i,d])}var Kb=function(e){var t,n=e.item,o=e.channel,i=e.media,s=e.transferMode,c=e.transferControlsStyle,u=e.onClick,d=e.onDetailsClick,f=e.useEmiItemStatus,m=e.isHighlighted,p=(0,Gc.useDirectoryState)("emiUsers"),v=f(n.emiUserType,n.emiOwnerId),h=v.active,b=v.disableReasonMessage,g=null===(t=p[Wc.MS_TEAMS_CHATS_CATEGORY_ID])||void 0===t?void 0:t.find((function(e){return e.userId===n.userId})),j=n.userId||n.emiUserId||n.entryId;!function(e,t){(0,Er.useSubscribeForUserDetails)(e.userId,t),(0,Er.useSubscribeForUserDetails)(e.emiUserId,t),(0,ev.useSubscribeForServiceDetails)(e.serviceId,t),(0,ev.useSubscribeForHuntGroupDetails)(e.huntGroupId,t)}(n);var I=Yb(n),S=(0,a.useMemo)((function(){return(0,r.jsxs)("span",{className:"flex gap-1",children:[(0,r.jsx)("b",{"data-testid":"name",className:"inline-block truncate font-semibold body text-primary-on-primary",children:n.displayName}),(0,r.jsx)(qc.FavoriteChannelButton,{item:n,channel:o,media:i,className:M("hidden group-[[data-pseudo-hover]]/contact-item:block","group-focus-within/contact-item:block group-hover/contact-item:block")})]})}),[n,o,i]),O=(0,r.jsx)(Ub,{channel:o,media:i}),x=(0,r.jsx)(Wb,{item:n}),C=(0,r.jsx)(Gb,{item:n,onDetailsClick:d}),_=(0,y.useEvent)((function(e){(0,l.assertDefined)(u),u({item:n,channel:o,media:i}),e.stopPropagation()}));return(0,r.jsx)(yc.ContactListItem,{as:L.SelectionItem,isSelected:m,transferMode:s,transferControlsStyle:c,userId:j,contactId:n.contactId,number:o.number,avatarProps:I,title:S,body:O,stats:x,controls:C,userType:n.emiUserType,disabled:!h,tooltip:h?void 0:b,hasChat:null==g?void 0:g.hasChat,onClick:_,containerProps:{itemId:qb({item:n,channel:o,media:i}),focusOnSelection:!0,tabIndex:0,"data-testid":"favorites-item"}})};function $b(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Xb(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){$b(e,t,n[t])}))}return e}function Qb(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}var Zb=function(e){var t,n=(0,i.useDefaultTransferMode)(),o=e.isHighlighted,s=e.transferMode,u=void 0===s?n:s,d=e.transferControlsStyle,f=e.onClick,m=(0,Wt.useFavoritesState)(),p=m.favoritesList,v=m.isLoading,h=(0,at.useSessionState)("emi"),b=(t=(0,te.useContactDetailsOpener)(),(0,y.useEvent)((function(e){t({contactId:e.contactId,userId:e.userId||e.emiUserId,entryId:e.entryId})}))),g=function(e){var t=(0,c.useLocalizationState)("t").CONTACT_POPUP,n=(0,hc.useCaseStateMethods)().createCaseEmail,r=(0,I.useNotificationsState)("methods").showNotification,a=(0,yo.useNavigationState)("setActivePage"),o=(0,te.useActivityHistoryOpener)(),i=(0,te.useCallHandler)();return(0,y.useEvent)((function(s){var c=s.item,u=s.channel,d=s.media;if(e)return e({item:c,channel:u,media:d});var f=c.contactId,m=c.userId,p=c.emiUserId,v=c.entryId,h=c.userDetails,b=c.firstName,y=c.lastName,g=c.emiUserType,j=c.emiPhotoUrl,S=m||v||p;if((0,Fb.isFavoritesPhoneChannel)(u)||(0,Fb.isFavoritesInternalChannel)(u))if((0,l.assertDefined)(d),"voice"===d){var O;i({userId:S,contactId:f,firstName:b,lastName:y,phone:null!==(O=u.number)&&void 0!==O?O:"",origination:"favorites",afterCallSideEffectCallback:function(){a({name:yo.AppRoutes.Interactions,params:{contactId:f}})}})}else{if("msteams"===g&&!(null==h?void 0:h.hasChat))return r({type:"error",id:I.Notifications.MSTeamsNoChatWithUserError,tags:["current-view"],message:t.contact_msteams_no_chat(),duration:7e3});o({contactId:f,phone:u.number,firstName:b,lastName:y,userId:S,origination:"favorites",emiUserType:g,emiPhotoUrl:j})}(0,Fb.isFavoritesEmailChannel)(u)&&n({contactId:f,emailAddress:u.email}),(0,Fb.isFavoritesMessengerChannel)(u)&&o({contactId:f,firstName:b,lastName:y,userId:S,origination:"favorites"})}))}(f),j=Bb(Qb(Xb({},e),{favoritesList:p})),S=(0,a.useMemo)((function(){return(0,$.partial)(Yv.useEmiItemStatus,h)}),[h]),O=(0,$l.useNativeScrollDataManager)(ec());return(0,r.jsx)(L.SelectionContainer,{ref:O,className:M("flex h-full min-h-0 flex-auto flex-col","scrollbar-on-hover overflow-auto",{"overflow-hidden":v}),children:(0,r.jsx)("div",{className:"bg-primary-background",children:v?(0,r.jsx)("div",{className:"mt-2",children:(0,r.jsx)(yc.ContactListPlaceholder,{amount:15})}):j.map((function(e){return(0,r.jsx)(L.ErrorBoundary,{fallback:null,children:(0,r.jsx)(Kb,Qb(Xb({},e),{isHighlighted:null==o?void 0:o(e),transferMode:u,transferControlsStyle:d,onClick:g,onDetailsClick:b,useEmiItemStatus:S}))},qb(e))}))})})};function Jb(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ey(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Jb(e,t,n[t])}))}return e}var ty=n(3741);const ny="communicator_InteractionBar_bar_fIRUf",ry="communicator_InteractionBar_desc_hgnsA",ay="communicator_InteractionBar_unread_XE4rf";var oy=function(){var e,t,n=(e=(0,Yt.useInteractionChatStateSelector)((function(e){return e.unreadPersonalMessagesAmountByContactId})),t=function(t,n){var r,a=n.contactId,o=void 0===a?"":a;return t+(o&&null!==(r=e[o])&&void 0!==r?r:0)},(0,i.useInteractionStateSelector)((function(e){return e.items.reduce(t,0)}))+(0,Yt.useChatUnread)()+(0,ty.useInternalChatTotalUnread)());return(0,r.jsx)(r.Fragment,{children:!!n&&(0,r.jsx)("div",{className:ay,"data-testid":"unread-counter",children:n})})};var iy=function(){var e,t=(0,c.useLocalizationState)().t,n=(e=(0,i.useInteractions)(),(0,a.useMemo)((function(){return e.reduce((function(e,t){return(0,X.isExternalChat)(t)||(0,X.isInternalChat)(t)?(e.chat++,e.history=0):(0,X.isCall)(t)?(e.call++,e.history=0):(0,X.isPotentialInteraction)(t)&&e.history++,e}),{call:0,chat:0,history:0})}),[e]));return(0,r.jsxs)(r.Fragment,{children:[!!n.call&&(0,r.jsxs)("span",{className:ry,children:[(0,r.jsx)("span",{children:t.GLOBAL.interaction_bar_calls_label()}),(0,r.jsx)("span",{children:": "}),(0,r.jsx)("span",{"data-testid":"calls-number",children:n.call})]}),!!n.chat&&(0,r.jsxs)("span",{className:ry,children:[(0,r.jsx)("span",{children:t.GLOBAL.interaction_bar_chats_label()}),(0,r.jsx)("span",{children:": "}),(0,r.jsx)("span",{"data-testid":"chats-number",children:n.chat})]}),!!n.history&&(0,r.jsxs)("span",{className:ry,children:[(0,r.jsx)("span",{children:t.GLOBAL.interaction_bar_contact_activities_label()}),(0,r.jsx)("span",{children:": "}),(0,r.jsx)("span",{"data-testid":"contact-histories-number",children:n.history})]})]})},sy=function(e){var t=e.action,n=function(){var e=(0,i.useInteractions)(),t=(0,s.useNonAssertedInteractionId)(),n=(0,i.useInteraction)(t),r=(0,qt.useAgentState)(),o=r.reservedForIncomingInteraction,l=r.reservedForIncomingInteractionTimeout;return(0,a.useMemo)((function(){return e&&e.length?n||(o||l?null!==(t=e.reverse().find((function(e){return(0,X.isInternalChat)(e)||(0,X.isPotentialInteraction)(e)})))&&void 0!==t?t:null:e[e.length-1]):null;var t}),[n,e,o,l])}(),o=(0,i.useInteractionStateMethods)().activateItem,l=function(e){var t=(0,gt.useFormatting)().formatFullName,n=(null!=e?e:{displayData:{}}).displayData,r=n.displayName,o=n.firstName,i=void 0===o?"":o,s=n.lastName,l=void 0===s?"":s;return(0,a.useMemo)((function(){return e?i&&l?t(i,l):r:null}),[e,r,i,t,l])}(n);if(!n)return null;var c=n.displayData.deliveredStartTime,u=(0,X.getMediaIcon)(n);return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("button",{onClick:function(){o(n.id),t()},className:ny,"data-testid":"interaction-bar",children:[(0,r.jsxs)("span",{className:ry,children:[(0,r.jsx)(L.InteractionMediaIcon,{showPotentialInteractionIcon:!0,icon:u,className:"mr-1.5"}),(0,r.jsx)("span",{"data-testid":"display-name",children:l}),!(0,X.isPotentialInteraction)(n)&&c&&(0,r.jsx)(L.InteractionTimer,{startTime:c,"data-testid":"duration-timer"})]},n.id),(0,r.jsx)(iy,{}),(0,r.jsx)(oy,{})]})})};function ly(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function cy(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return ly(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return ly(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function uy(e){var t=e.currentPage,n=e.getItemCoordsByIndex,r=e.goToPage;(0,a.useEffect)((function(){var e=function(e){if(e.altKey&&/^Digit[0-9]$/.test(e.code))return e.preventDefault(),dy(+e.code.replace("Digit","")-1,n,r);e.altKey&&/^ArrowLeft|ArrowRight$/.test(e.code)&&(e.preventDefault(),setTimeout((function(){return function(e,t,n,r){var a=Array.from(document.querySelectorAll('[data-testid="interaction-item"]'));if(null==a?void 0:a.length){var o=a.findIndex((function(e){return!!e.dataset.active}));return"ArrowLeft"===e.code?o--:o++,dy(o+4*t,n,r)}}(e,t,n,r)}),0))};return document.addEventListener("keydown",e),function(){document.removeEventListener("keydown",e)}}),[t,n,r])}function dy(e,t,n){var r=Array.from(document.querySelectorAll('[data-testid="interaction-item"]'));if(r&&r.length){var a=t(e),o=a.page,i=a.index;if(-1===o||-1===i)return;if(n(o),r[i])return r[i].click()}}var fy=n(8445);function my(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function py(e){return function(e){if(Array.isArray(e))return my(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return my(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return my(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var vy=function(e){var t=(0,fy.useNavigationState)("getLocationState"),n=(0,vn.useIsCommunicator)(),r=(0,s.useIsParallelInteractionContext)(),o=!n&&t()===fy.AppRoutes.interactionWorkspace,i=(0,Ta.useAtomValue)(x.parallelItemsHaveEnoughSpaceAtom),l=(0,Ta.useAtomValue)(x.parallelItemsAtom),c=(0,Ta.useSetAtom)(x.parallelItemsAtom),u=(0,Gr.useCommunicatorUIState)((function(e){return e.setParallelInteractionsWidth})),d=(0,y.useEvent)((function(t){var n;t.stopPropagation(),(null==e?void 0:e.id)&&c({type:"add",payload:{activeId:e.id,ids:[e.id].concat(py(null!==(n=null==e?void 0:e.associatedItemIds)&&void 0!==n?n:[]))}}),l.every((function(e){return e.activeItemId}))&&u((function(e){return e+e/(l.length+1)}))})),f=(0,y.useEvent)((function(t){var n;t.stopPropagation(),(null==e?void 0:e.id)&&c({type:"empty",payload:{ids:[e.id].concat(py(null!==(n=null==e?void 0:e.associatedItemIds)&&void 0!==n?n:[]))}})}));return(0,a.useMemo)((function(){return{showOpenParallelChatButton:o&&i&&!r,showCloseParallelChatButton:o&&r,openParallelChat:d,closeParallelChat:f}}),[o,i,r,d,f])},hy=function(e){var t=e.className,n=e.onClick,a=e.children,o=e.tooltip;return(0,r.jsx)(_e.Button,{variant:"primary",onClick:n,className:M("h-7 rounded-xs px-3 py-1.5 !font-semibold button-sm",t),"data-testid":"complete-button",tooltip:o,children:a})};function by(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function yy(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){by(e,t,n[t])}))}return e}function gy(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function jy(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var Iy=function(e){var t=e.withStateLayer,n=jy(e,["withStateLayer"]),a=(0,c.useLocalizationState)().t;return(0,r.jsx)("div",{className:M("rounded p-2.5","transition-colors hover:state-layer-opacity-4","state-layer-bg-[--c-main-bars-bg] state-layer-color-black state-layer-opacity-0",{"p-0":!t}),children:(0,r.jsx)(_e.Button,gy(yy({variant:"destructive",size:"sm",color:"danger",className:"px-3 py-0.5","data-testid":"complete-button"},n),{children:a.INTERACTIONS.end()}))})};function Sy(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Oy(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function xy(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var Cy=o().memo((function(e){var t=e.isDestructive,n=e.renderIcon,a=xy(e,["isDestructive","renderIcon"]),o=(0,c.useLocalizationState)().t;return(0,r.jsx)(_e.Button,Oy(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Sy(e,t,n[t])}))}return e}({variant:t?"destructive":"neutral",size:"sm",color:"danger",className:M({"h-7 w-12 px-3 py-0.5":t,"ml-2 h-6 px-2 py-1 text-on-error":!t}),tooltip:o.CALL_DETAILS_FORM.interaction_endCall(),"data-testid":"complete-button"},a),{children:(null==n?void 0:n())||(0,r.jsx)(j.IconEndCall,{className:"size-5 svg-color-current"})}))}));function _y(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function wy(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Ny(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var Ay=function(e){var t=e.className,n=Ny(e,["className"]),a=(0,c.useLocalizationState)().t;return(0,r.jsx)(_e.Button,wy(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){_y(e,t,n[t])}))}return e}({variant:"neutral",size:"xs",className:M("rounded-sm border-action","text-on-error","ml-2 px-2 py-1","h-6",t),"data-testid":"complete-button"},n),{children:a.INTERACTIONS.end()}))},Py=n(5906),Ey=function(e){var t=e.isActive,n=e.onClick,a=e.holdStartTime,o=e.disabled,i=e.iconClassName,s=(0,c.useLocalizationState)().t;return(0,r.jsx)(j.CircleButton,{isActive:t,onClick:n,className:"group/hold w-auto",disabled:o,tooltip:{content:t?s.CALL_DETAILS_FORM.interaction_retrieve():s.CALL_DETAILS_FORM.interaction_hold()},"data-testid":"hold-button","data-on-hold":t||void 0,children:(0,r.jsxs)(Py.motion.div,{animate:t?{paddingRight:9}:{paddingRight:5},className:"flex items-center py-[3px] pl-[5px]",children:[(0,r.jsxs)("div",{className:M("flex gap-0.5 "),children:[(0,r.jsx)(j.IconHold16,{className:M(i,"hidden size-4.5",{"group-hover/hold:block":t})}),(0,r.jsx)(j.IconPause16,{className:M(i,"visible size-4.5",{"group-hover/hold:hidden":t})})]}),(0,r.jsx)(Py.AnimatePresence,{children:t&&(0,r.jsx)(Py.motion.div,{initial:{width:0},animate:{width:"auto"},exit:{width:0},children:(0,r.jsx)(L.InteractionTimer,{startTime:a})})})]})})},Dy=new y.MicrophoneVolume,Ty=function(e){var t=e.muted,n=e.className,o=(0,a.useRef)(null);return(0,a.useEffect)((function(){return t||Dy.startAnalysis((function(e){var t,n;o.current&&(t=o.current,(n=t.querySelector("linearGradient stop"))&&n.setAttribute("offset","".concat(e,"%")))})),function(){Dy.stopAnalysis()}}),[t]),t?(0,r.jsx)(j.IconMute16,{className:M("size-4.5",n)}):(0,r.jsx)(j.IconVoiceVolume,{className:M("size-4.5 icon-default",n),ref:o})},ky=function(e){var t=e.isActive,n=e.disabled,a=e.onClick,o=(0,c.useLocalizationState)().t;return(0,r.jsx)(j.CircleButton,{onClick:a,disabled:n,tooltip:{content:t?o.CALL_DETAILS_FORM.unmute_tooltip():o.CALL_DETAILS_FORM.mute_tooltip()},"data-testid":"mute-button","data-muted":t||void 0,children:(0,r.jsx)(Ty,{className:"icon-fade",muted:!!t})})},My=function(e){var t=e.isActive,n=e.onClick,a=e.className,o=e.disabled,i=(0,c.useLocalizationState)().t;return(0,r.jsx)(j.CircleButton,{onClick:n,isActive:t,disabled:o,className:M(o?"icon-disabled":"icon-error",a),tooltip:{content:t?i.CALL_DETAILS_FORM.interaction_recordStop_tooltip():i.CALL_DETAILS_FORM.interaction_recordStart_tooltip()},"data-testid":"call-recording-button","data-recording-active":t||void 0,children:t?(0,r.jsx)(j.IconRecordingActive16,{className:"size-4.5"}):(0,r.jsx)(j.IconRecording16,{className:"size-4.5"})})},Ly=function(e){var t=e.isActive,n=e.onClick,a=e.disabled,o=e.iconClassName,i=e.tooltip,s=(0,c.useLocalizationState)().t;return(0,r.jsx)(j.CircleButton,{isActive:t,onClick:n,disabled:a,tooltip:{content:i||s.CALL_DETAILS_FORM.interaction_initiate_transfer()},"data-testid":"transfer-button","data-on-hold":t||void 0,children:(0,r.jsx)(j.IconForward16,{className:o})})};var Ry=function(e){var t=e.handleCloseClick,n=e.item,o=e.small,i=e.className,s=e.isChat,l=e.isDestructive,u=e.renderIcon,d=function(e){var t=(0,c.useLocalizationState)().t;return(0,a.useMemo)((function(){return e?(0,X.isPotentialInteraction)(e)?{text:t.ACTIVITY_HISTORY.button_close_tooltip()}:(0,X.isAfterCallWork)(e)||(0,X.isWorkItem)(e)?{text:t.CALL_DETAILS_FORM.interaction_completeACW(),tooltip:t.GLOBAL.complete_interaction()}:(0,X.isChatConference)(e)?{text:t.CALL_DETAILS_FORM.interaction_leaveConference()}:(0,X.isCallConference)(e)?{text:e.isConferenceHost?t.CALL_DETAILS_FORM.interaction_endConference():t.CALL_DETAILS_FORM.interaction_leaveConference()}:(0,X.isCall)(e)?{text:t.CALL_DETAILS_FORM.interaction_endCall()}:{text:t.CALL_DETAILS_FORM.interaction_endChat()}:{text:""}}),[e,t])}(n),f=d.tooltip,m=d.text;return(0,X.isAfterCallWork)(n)||(0,X.isWorkItem)(n)?o?(0,r.jsx)(_e.Button,{variant:"neutral",size:"xs",className:M("ml-2 px-2 py-1 text-on-error",i),"data-testid":"complete-button",onClick:t,children:(0,r.jsx)("span",{className:"flex size-3.5 items-center justify-center rounded-full bg-primary-default",children:(0,r.jsx)(j.IconCheck16,{className:"size-2.5 [&_path]:stroke-neutral-0"})})}):(0,r.jsx)(hy,{onClick:t,tooltip:f,children:m}):(0,X.isChatConference)(n)||s?(0,r.jsx)(Iy,{className:"h-7 w-12",onClick:t,tooltip:f}):o?(0,r.jsx)(Ay,{onClick:t,tooltip:f,className:i}):(0,r.jsx)(Cy,{renderIcon:u,isDestructive:l,onClick:t,tooltip:f})};function Fy(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function By(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Fy(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Fy(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Uy=function(e){var t,n,o=e.className,l=(0,c.useLocalizationState)().t,u=(0,s.useNonAssertedInteractionId)(),d=(0,i.useInteractionStateMethods)().flagItem,f=(0,i.useInteractionProp)(u,(function(e){var t;return!!(null==e||null===(t=e.displayData)||void 0===t?void 0:t.isFlagged)})),m=(0,i.useInteractionProp)(u,X.getInteractionStepId),p=By((t=f,n=(0,y.useBoolean)(t),(0,a.useEffect)((function(){var e;if(t!==n.value)return e=setTimeout((function(){n.toggle(t)}),1e3),function(){return clearTimeout(e)}}),[t,n]),[n.value,n.toggle]),2),v=p[0],h=p[1];return(0,r.jsx)(j.ButtonIcon,{active:v,onClick:function(){h(),d(m,f?ar.FlagMode.unflag:ar.FlagMode.flag)},className:o,tooltip:f?l.SHORTCUTS_DIALOG_BOX.shortcuts_alt_shift_m():l.SHORTCUTS_DIALOG_BOX.shortcuts_alt_m(),"data-testid":"flag-button","data-flagged":f||void 0,children:(0,r.jsx)(j.IconFlag16,{})})};function zy(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Hy(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){zy(e,t,n[t])}))}return e}function Vy(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Gy(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var Wy=function(e){var t=e.itemId,n=Gy(e,["itemId"]),o=(0,c.useLocalizationState)("t").ACTIVITY_HISTORY,i=(0,x.useInteractionUIItemStateSetter)(),s=(0,x.useInteractionPopupItemIdSelector)(),l=(0,a.useCallback)((function(){i(t,(function(e){return Vy(Hy({},e),{chatView:"popup"})})),s&&i(s,(function(e){return Vy(Hy({},e),{chatView:"embedded"})}))}),[s,t,i]);return(0,r.jsx)(j.ButtonIcon,Vy(Hy({tooltip:o.button_open_popup_tooltip(),onClick:l},n),{children:(0,r.jsx)(j.IconChatDock,{className:"size-4"})}))};function qy(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Yy(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return qy(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return qy(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Ky=function(e){var t=e.unreadAmount,n=e.customerWaitTimer,a=e.showTimerProgressBar,o={"bg-primary-700":Boolean(n)},i=t>99?"99+":t,s="".concat(n?n+10:100,"%");return t<1?null:(0,r.jsxs)("div",{className:"relative ml-1.5 size-4",children:[(0,r.jsx)("div",{"data-testid":"unread-counter",className:M("flex size-full items-center justify-center rounded-full text-icon bg-warning",o),children:(0,r.jsx)("span",{className:"select-none caption-xs text-inverse-primary",children:i})}),a&&(0,r.jsx)("div",{className:"absolute -bottom-1.5 -left-0.5 m-auto h-[3px] w-5 rounded-full bg-primary-container-variant2",children:(0,r.jsx)("div",{className:M("h-[3px] rounded-full bg-warning",o),style:{width:s}})})]})},$y="flex items-center",Xy=M($y,"w-0 group-focus-within:w-auto group-hover:w-auto","opacity-0 group-focus-within:opacity-100 group-hover:opacity-100"),Qy=M($y,"w-auto group-focus-within:w-0 group-hover:w-0","opacity-100 group-focus-within:opacity-0 group-hover:opacity-0"),Zy=function(e){var t=e.item,n=(0,c.useLocalizationState)().t,o=(0,Yt.useInteractionChatDataSelector)((0,X.getInteractionStepId)(t),(function(e){return null==e?void 0:e.sentiment})),s=(0,x.useInteractionUIStateItemSelector)(t.id,(function(e){return"embedded"===(null==e?void 0:e.chatView)})),l=(0,Jt.useDisconnectButtonClickHandler)(),u=(0,a.useCallback)((function(e){return l(t,{event:e})}),[l,t]),d=(0,i.useInteractionProp)(t.id,(function(e){return!(0,X.isPotentialInteraction)(e)&&!(0,X.isInternalChat)(e)})),f=(0,X.isExternalChat)(t)||(0,X.isExternalCall)(t),m=((0,X.isInternalChat)(t)||(0,X.isPotentialInternalInteraction)(t))&&s,p=(0,X.isAfterCallWork)(t),v=function(e,t){var n=Yy((0,a.useState)(void 0),2),r=n[0],o=n[1],i=(0,y.useTimer)(r,{format:y.cutMilliseconds}),s=(0,Jt.useUnread)(e);return(0,a.useEffect)((function(){t&&o(s>0?(new Date).getTime():void 0)}),[s,t]),(0,a.useEffect)((function(){i&&i>=90&&o(void 0)}),[i]),(0,a.useMemo)((function(){return{unreadAmount:s,customerWaitTimer:i}}),[s,i])}(t,f),h=v.unreadAmount,b=v.customerWaitTimer,g=vy(t),I=g.showOpenParallelChatButton,S=g.openParallelChat;return p?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:Qy,children:(0,r.jsx)("span",{className:"button-sm text-neutral-on-secondary",children:n.INTERACTIONS.acl_after_call_work_label()})}),(0,r.jsx)("div",{className:Xy,children:(0,r.jsx)(Ry,{item:t,handleCloseClick:u,small:!0})})]}):(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:Xy,children:[f&&I&&(0,r.jsx)(j.ButtonIcon,{tooltip:n.KNOWLEDGE_BASE.new_tab_button_tooltip(),onClick:S,children:(0,r.jsx)(j.IconChatPanelOpen,{className:"size-4"})}),m&&(0,r.jsx)(Wy,{itemId:t.id}),(0,r.jsx)(Ry,{item:t,handleCloseClick:u,small:!0})]}),(0,r.jsxs)("div",{className:Qy,children:[d&&(0,r.jsx)(Uy,{}),(0,r.jsx)(Ky,{unreadAmount:h,customerWaitTimer:b,showTimerProgressBar:f}),o&&(0,r.jsx)(L.Sentiment,{className:"ml-2",sentiment:o})]})]})};const Jy="communicator_InteractionsPage_interactionVideo_lxYHD",eg="communicator_InteractionsPage_interactionVideoExternal_elzNi",tg="communicator_InteractionsPage_interactionVideoInternal_Sarl8",ng="communicator_InteractionsPage_rescue_s4hA4",rg="communicator_InteractionsPage_pagination_KgiGN",ag="communicator_InteractionsPage_paginationButton_HNoWM",og="communicator_InteractionsPage_prolongedConnectionItemLabel_y5oSA",ig="communicator_InteractionsPage_failedItemLabel_2wH7a",sg="communicator_InteractionsPage_chatInWindowPlaceholder_2JLHf",lg="communicator_InteractionsPage_chatInWindowPlaceholderText_x9y0Y",cg="communicator_InteractionsPage_scenarioMessages_Hz3qR";var ug=function(){var e=(0,c.useLocalizationState)().t;return(0,r.jsx)("span",{"data-testid":"connecting",className:og,children:e.GLOBAL.dial_request_status_long_connection()})};var dg=function(e){var t=function(e){var t=(0,gt.useFormatting)().formatFullName,n=null!=e?e:{},r=n.displayData,o=n.contactId,i=null!=r?r:{},s=i.displayName,l=i.firstName,u=i.lastName,d=(0,c.useLocalizationState)().t,f=(0,yt.useContactDisplayName)(o),m=d.HOME_SCREEN.interaction_call_conference_label(),p=d.HOME_SCREEN.interaction_chat_conference_label();return(0,a.useMemo)((function(){var n,a,o,i=null!==(o=null==e?void 0:e.externalChatData)&&void 0!==o?o:{},c=i.firstName,v=i.lastName,h=f||s||t(c,v)||t(l,u),b=(0,rt.formatPhone)(null==r?void 0:r.number),y=(0,X.isWorkItem)(e)?(null==e||null===(n=e.workitemData)||void 0===n?void 0:n.serviceName)||"":(null==e||null===(a=e.scenarioData)||void 0===a?void 0:a.serviceName)||"";if((0,X.isCallConference)(e))return y?{name:m,service:y}:{name:m};if((0,X.isChatConference)(e))return y?{name:p,service:y}:{name:p};var g=(0,X.isExternalChat)()?h||b||d.EXTERNAL_CHAT.display_name_placeholder():h||b||d.GLOBAL.anonymous();return y?g?{name:g,service:y}:{service:y}:{name:g}}),[m,p,f,null==r?void 0:r.number,s,l,t,e,u,d])}(e.item),n=t.name,o=t.service;return(0,r.jsxs)(r.Fragment,{children:[n&&(0,r.jsx)("div",{className:M("shrink-0 truncate font-semibold caption-s text-primary-on-primary",{"max-w-[62%]":Boolean(o)}),"data-testid":"display-name",children:n}),o&&(0,r.jsx)("div",{className:"ml-1 flex-auto truncate caption-s text-neutral-fade","data-testid":"service-name",children:o})]})},fg=function(){var e=(0,c.useLocalizationState)().t;return(0,r.jsx)("span",{"data-testid":"failed",className:ig,children:e.GLOBAL.dial_request_status_failed()})};var mg=function(e){var t=e.item,n=function(e){return(0,a.useMemo)((function(){return(0,X.isWorkItem)(e)?j.IconOutboundPreview16:(0,X.isPotentialInteraction)(e)?(0,X.isContact)(e)?j.IconRoundChat16Filled:j.IconInternalChat16:(0,X.isOnHold)(e)&&(0,X.isCall)(e)?j.IconPause16:(0,X.isChatConference)(e)?j.IconConferenceChat16:(0,X.isAfterCallWork)(e)?j.IconAfterCallWorkAD:(0,X.isInternalMessage)(e)?j.IconChat:(0,X.isExternalChat)(e)?j.IconRoundChat16Filled:(0,X.isInternalChat)(e)?j.IconInternalChat16:(0,X.isEmail)(e)?j.IconEmail16:(0,X.isCallConference)(e)?j.IconConferenceCall16:(0,X.isOutboundInteraction)(e)&&(0,X.isCall)(e)?j.IconOutboundCall16:j.IconPhone16Filled}),[e])}(t);return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(n,{className:"size-4 icon-neutral"}),(0,r.jsx)("div",{className:"sr-only","data-testid":"media-type",children:t.mediaType})]})},pg=function(e){var t=e.item,n=(0,c.useLocalizationState)("t").DISPOSITION,o=function(e){var t=(null!=e?e:{}).displayData,n=null!=t?t:{},r=n.stateStartTime,o=n.failed;return(0,a.useMemo)((function(){return void 0!==r&&!o&&!(0,X.isPotentialInteraction)(e)}),[o,e,r])}(t),i=o&&t.displayData.deliveredStartTime,s=Boolean((0,X.isCall)(t)&&(0,X.isOnHold)(t)&&t.displayData.holdStartTime),l=(0,X.isAfterCallWork)(t),u=function(){if(i)return(0,r.jsx)(L.InteractionTimer,{startTime:t.displayData.deliveredStartTime,className:"ml-1 py-0 caption-xs","data-testid":"duration-timer"})};return(0,r.jsxs)(r.Fragment,{children:[s&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex h-6 items-center justify-center rounded-full pl-1 pr-2 bg-container-disabled",children:[(0,r.jsx)(mg,{item:t}),(0,r.jsx)(L.InteractionTimer,{startTime:t.displayData.holdStartTime,className:"m-0 text-primary-fade","data-testid":"hold-timer"})]}),u()]}),l&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(mg,{item:t}),(0,r.jsx)("span",{className:"mx-1 font-semibold caption-xs text-neutral-fade",children:n.ended()})]}),!s&&!l&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(mg,{item:t}),u()]})]})},vg="ml-1 size-4 icon-neutral",hg=function(e){var t=e.item;return(0,X.isQualityManagementItemInMonitorMode)(t)?(0,r.jsx)(j.IconMonitor,{className:vg}):(0,X.isQualityManagementItemInWhisperMode)(t)?(0,r.jsx)(j.IconCoaching,{className:vg}):null},bg=o().memo((function(e){var t=e.itemId,n=e.onClick,o=e.isActive,s=e.isSelected,c=(0,i.useInteraction)(t);(0,l.assertDefined)(c);var u,d=c.displayData,f=d.failed,m=d.prolongedConnection,p=(u=n,(0,a.useCallback)((function(e){"Enter"!==e.key&&" "!==e.key||(e.preventDefault(),u())}),[u]));return(0,r.jsxs)("div",{className:M("flex items-center","h-9.5 cursor-pointer border-none px-2 py-1.5","transition ease-in-out","group state-layer-bg-neutral-0",{"state-layer-mix-teal-on-white-2":s}),"data-testid":"interaction-item","data-active":o||void 0,onClick:n,onKeyPress:p,role:"button",tabIndex:0,children:[(0,r.jsxs)("div",{className:"flex flex-none items-center overflow-hidden",children:[(0,r.jsx)(pg,{item:c}),(0,r.jsx)(hg,{item:c})]}),(0,r.jsxs)("div",{className:"ml-2 flex flex-auto items-center overflow-hidden",children:[(0,r.jsx)(dg,{item:c}),f&&(0,r.jsx)(fg,{}),!f&&m&&(0,r.jsx)(ug,{})]}),(0,r.jsx)("div",{className:"ml-4 flex flex-none shrink-0 items-center",children:(0,r.jsx)(Zy,{item:c})})]})}));function yg(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function gg(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return yg(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return yg(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var jg=function(e){var t=e.children,n=(0,s.useInteractionId)(),o=(0,it.useSlidingModalState)((function(e){return Object.values(e.getInteractionModalData(n)).every((function(e){return!e.show}))})),i=gg((0,a.useState)(null),2),l=i[0],c=i[1],u=(0,y.useResizeObserver)(l),d=gg((0,a.useState)(void 0),2),f=d[0],m=d[1];(0,a.useEffect)((function(){return m(null==u?void 0:u.contentRect.height)}),[u]);var p=(0,a.useMemo)((function(){var e=o?f:0;return{height:e,minHeight:e,maxHeight:e}}),[f,o]);return(0,r.jsx)("div",{className:"overflow-hidden transition-all",style:p,children:(0,r.jsx)("div",{ref:c,children:t})})};function Ig(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Sg(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Ig(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Ig(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Og(){var e,t,n=(e=["-mx-1 my-2 h-2 cursor-row-resize"],t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}})));return Og=function(){return n},n}var xg=o().memo((function(e){var t=e.height,n=e.min,o=void 0===n?0:n,i=e.onResize,s=e.onReset,l=(0,a.useId)(),c=(0,a.useRef)(t),u=(0,y.useAsRef)(o),d=Sg((0,a.useState)(!1),2),f=d[0],m=d[1],p=(0,a.useCallback)((function(){c.current=t,m(!0)}),[m,t]),v=(0,a.useCallback)((function(e){var t=e.offset,n=e.initialOffset;if(c.current){var r,a,o=(null!==(r=null==t?void 0:t.y)&&void 0!==r?r:0)-(null!==(a=null==n?void 0:n.y)&&void 0!==a?a:0),s=Math.max(u.current,c.current+o);i(s)}}),[u,i]),h=(0,a.useCallback)((function(e){var t=e.offset,n=e.initialOffset;if(c.current){var r,a,o=(null!==(r=null==t?void 0:t.y)&&void 0!==r?r:0)-(null!==(a=null==n?void 0:n.y)&&void 0!==a?a:0),s=Math.max(u.current,c.current+o);i(s),c.current=s}m(!1)}),[u,i]);return(0,r.jsx)(L.Draggable,{className:M((0,_e.tw)(Og()),"bg-neutral-200 hover:bg-neutral-300",{"bg-neutral-300":f}),previewClassName:"absolute w-0 h-0 invisible opacity-0 p-1",type:L.DragItemTypes.RESIZE_TABLE_HEIGHT,onDragStart:p,onDrag:v,onDrop:h,onDoubleClick:s,id:l})})),Cg=function(e){var t=(0,c.useLocalizationState)().t,n=e.goNextPage,a=e.goPreviousPage,o=e.showNext,i=e.showPrev,s=e.prevAmount,l=e.nextAmount;return(0,r.jsxs)(d.SmMenu.Item,{className:rg,children:[(0,r.jsx)("div",{className:ag,children:i&&(0,r.jsxs)("p",{onClick:a,className:"aria-paginate-prev-interaction-items",tabIndex:0,role:"button","data-testid":"pagination-prev-button",children:[(0,r.jsx)(d.SmIcon,{name:"chevron left"})," ",t.UNDEFINED.bulk_button_previous()," ",s]})}),(0,r.jsx)("div",{className:ag,children:o&&(0,r.jsxs)("p",{onClick:n,className:"aria-paginate-next-interaction-items",tabIndex:0,role:"button","data-testid":"pagination-next-button",children:[t.UNDEFINED.bulk_button_next()," ",l," ",(0,r.jsx)(d.SmIcon,{name:"chevron right"})]})})]})};function _g(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function wg(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Ng(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){wg(e,t,n[t])}))}return e}function Ag(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function Pg(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return _g(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return _g(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Eg=o().memo((function(e){var t=e.itemIds,n=e.selectedItemId,o=e.setSelectedItemId,s=(0,c.useLocalizationState)().t,l=Pg((0,a.useState)(100),2),u=l[0],d=l[1],f=Pg((0,a.useState)(!1),2),m=f[0],p=f[1],v=Pg((0,a.useState)(null),2),h=v[0],b=v[1],g=(0,y.useResizeObserver)(h),j=null==g?void 0:g.contentRect.height,I=m?{height:u}:void 0,S=37*t.length;(0,a.useEffect)((function(){j&&!m&&d(j)}),[j,m,d]);var O=(0,y.useEvent)((function(){S>u&&d(S)}));(0,a.useEffect)(O,[S,O]);var x=(0,a.useCallback)((function(e){e<=S?p(!1):(p(!0),d(e))}),[d,p,S]),C=(0,a.useCallback)((function(){p(!1)}),[p]),_=function(e){var t=e.itemIds,n=cy((0,a.useState)(0),2),r=n[0],o=n[1],i=(0,a.useRef)(t.length);i.current=t.length;var s=(0,a.useRef)(!1);s.current=i.current>5;var l=Math.ceil(i.current/4),c=function(e){return e+1>=l},u=function(e){return e+1<=1},d=t.filter((function(e,t){if(!s.current)return!0;var n=4*r-1;return t>n&&t<=n+4}));return{currentPage:r,goNextPage:function(){c(r)||o(r+1)},goPreviousPage:function(){u(r)||o(u(r)?1:r-1)},showPrev:s.current&&!u(r),showNext:s.current&&!c(r),prevAmount:4,nextAmount:c(r+1)&&i.current%4||4,pagedItems:d,paginationIsEnabled:s.current,getItemCoordsByIndex:function(e){return e+1>i.current?{page:-1,index:-1}:s.current?{page:Math.floor(e/4),index:e%4}:{page:0,index:e}},goToPage:function(e){o(e)}}}({itemIds:t}),w=_.currentPage,N=_.goToPage,A=_.getItemCoordsByIndex,P=_.pagedItems,E=_.paginationIsEnabled,D=Ag(_,["currentPage","goToPage","getItemCoordsByIndex","pagedItems","paginationIsEnabled"]);uy({getItemCoordsByIndex:A,goToPage:N,currentPage:w});var T=(0,i.useActiveInteractionId)(),k=(0,a.useCallback)((function(e){return function(){o(e)}}),[o]);return 0===P.length?null:(0,r.jsx)(jg,{children:(0,r.jsxs)("div",{className:"max-w-full shrink-0 overflow-hidden px-1 pb-2","data-testid":"interactions-list",children:[(0,r.jsxs)("div",{className:"z-10 flex shrink-0 items-center p-4 uppercase tracking-[0.8px] caption-xs text-neutral-disabled",children:[s.COMMUNICATION_PANEL.active_interactions()," ","(",t.length,")"]}),(0,r.jsxs)("div",{className:"min-h-9.5",style:I,ref:b,children:[P.map((function(e,t){return(0,r.jsx)(bg,{itemId:e,onClick:k(e),isSelected:n===e,isActive:T===e},t)})),E&&(0,r.jsx)(Cg,Ng({},D))]}),(0,r.jsx)(xg,{height:u,onResize:x,onReset:C,min:S})]})})}));function Dg(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Tg(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Dg(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Dg(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function kg(e){var t=Tg((0,a.useState)(0),2),n=t[0],r=t[1];return(0,a.useLayoutEffect)((function(){if(e){var t=document.querySelector('[data-testid="communicator_content"]'),n=new ResizeObserver((function(e){var t=Tg(e,1)[0];r(t.contentRect.height)}));return t&&n.observe(t),function(){n.disconnect()}}}),[e]),n}function Mg(){var e,t,n=(0,a.useRef)(document.querySelector('[data-testid="bottom-nav"]')),r=(0,y.useResizeObserver)(n);return null!==(t=null==r||null===(e=r.contentRect)||void 0===e?void 0:e.height)&&void 0!==t?t:0}var Lg=(0,L.createComponentLoader)("calendar",(function(){return n.e(662).then(n.t.bind(n,5662,23))}),"CalendarEventForm").CalendarEventFormLoader,Rg=function(e){var t=e.closeModal,n=e.closing,o=e.style,i=e.show,s=(0,c.useLocalizationState)().t,l=(0,ot.useCalendarState)("selectedEvent"),u=(0,ot.useCalendarStateMethods)().closeEventForm,d=(0,Bu.useForm)(),f=(0,a.useCallback)((function(){u()}),[u]);return(0,a.useEffect)((function(){l||t()}),[t,l]),(0,r.jsx)(L.SlidingModal,{name:"calendarEvent",header:s.CALENDAR_EVENT_MODAL.title(),closeModal:f,show:i,closing:n,style:o,children:l&&(0,r.jsx)(Lg,{event:l,form:d,onClose:f})})};function Fg(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Bg(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Fg(e,t,n[t])}))}return e}function Ug(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var zg=function(e){var t=e.show,n=e.closing,a=e.closeModal,o=e.style,i=Ug(e,["show","closing","closeModal","style"]),s=(0,c.useLocalizationState)().t;return(0,r.jsx)(L.SlidingModal,{show:t,closing:n,style:o,closeModal:a,name:"mergeContacts",header:s.CONTACT.merge_contacts(),"data-testid":"merge-contacts-modal",children:(0,r.jsx)(ep,Bg({},i))})},Hg=n(710);var Vg=(0,Hg.w0)({selected:null,searchValue:""},(function(e,t){switch(t.type){case"selectParty":var n;return{selected:t.payload.party,searchValue:null!==(n=t.payload.party.phone)&&void 0!==n?n:""};case"setSearchValue":return{selected:null,searchValue:t.payload.value};case"clearState":return{selected:null,searchValue:""}}})),Gg=function(e){var t=e.recentItem,n=e.onCall,a=e.onChat,o=(0,c.useLocalizationState)("t").RECENT,i=(0,at.useSessionState)("phoneDeviceCapabilities"),s=(0,xn.useServiceState)().selectedService,l=(0,Ta.useAtomValue)(Vg),u=l.selected,d=l.searchValue,f=(0,Ta.useSetAtom)(Vg),m=(0,y.useEvent)((function(e){var t=e.target.value.replace(/\D/g,"");f({type:"setSearchValue",payload:{value:t}})})),p=(0,y.useEvent)((function(){n({phone:d,firstName:null==u?void 0:u.firstName,lastName:null==u?void 0:u.lastName,serviceId:null!=s?s:t.serviceId,contactId:null==u?void 0:u.contactId,userId:null==u?void 0:u.userId,origination:"recent"})})),v=(0,y.useEvent)((function(){a({phone:d,firstName:null==u?void 0:u.firstName,lastName:null==u?void 0:u.lastName,serviceId:null!=s?s:t.serviceId,contactId:null==u?void 0:u.contactId,userId:null==u?void 0:u.userId,origination:"recent"})}));return(0,r.jsxs)("div",{className:"flex grow items-start gap-2.5",children:[(0,r.jsx)(j.SearchField,{value:d,onChange:m,layoutClassName:"grow","data-testid":"search-input","aria-label":o.conference_details_input_placeholder(),placeholder:o.conference_details_input_placeholder()}),(0,r.jsx)(L.SearchForInteractionControls,{searchQuery:d,showCallButton:!!i.canDial,callButtonDisabled:!u&&!(0,rt.isPhone)(d),chatButtonDisabled:!u&&!(0,rt.isPhone)(d),onCallClick:p,onChatClick:v})]})};function Wg(){var e=(0,c.useLocalizationState)("t"),t=(0,gt.useFormatting)().formatFullName;return(0,a.useCallback)((function(n){return n.map((function(n){return n.lastName?t(n.firstName,n.lastName):n.phone?(0,rt.formatPhone)(n.phone):e.GLOBAL.anonymous()})).join(", ")}),[t,e.GLOBAL])}var qg=function(e){var t=e.item.parties,n=Wg();return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(j.Avatar,{size:"32",type:"conference"}),(0,r.jsx)("span",{className:"truncate",children:"(".concat(t.length+1,") ").concat(n(t))})]})};function Yg(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var Kg=function(e){var t=e.party,n=e.transferMode,a=e.onClick,o=e.onCall,i=e.onChat,s=e.onDetails,l=(0,Er.useUserDetailsById)(t.userId),c=(0,y.useEvent)((function(){a(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Yg(e,t,n[t])}))}return e}({phone:null==l?void 0:l.data.extension},t))}));if(t.userId){var u,d,f,m,p={userId:t.userId,firstName:null!==(u=t.firstName)&&void 0!==u?u:"",lastName:null!==(d=t.lastName)&&void 0!==d?d:"",extension:null!==(f=null==l?void 0:l.data.extension)&&void 0!==f?f:"",presenceState:null!==(m=null==l?void 0:l.data.presenceState)&&void 0!==m?m:"offline",isAgent:null==l?void 0:l.data.isAgent,photoId:null==l?void 0:l.data.photoId,teamId:null==l?void 0:l.data.teamId};return(0,r.jsx)(Hv,{user:p,transferMode:n,onClick:c,onCall:o,onChat:i,onDetails:s})}if(t.contactId){var v,h,b,g={id:t.contactId,firstName:null!==(v=t.firstName)&&void 0!==v?v:"",lastName:null!==(h=t.lastName)&&void 0!==h?h:"",phone:null!==(b=t.phone)&&void 0!==b?b:"",email:""};return(0,r.jsx)(Cv,{contact:g,transferMode:n,onClick:c,onCall:o,onChat:i,onDetails:s})}return null};function $g(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Xg(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var Qg=function(e){var t=e.recentItem,n=Xg(e,["recentItem"]);(0,l.assertDefined)(t);var o=(0,c.useLocalizationState)("t").RECENT,s=(0,i.useActiveInteractionId)(),u=(0,te.useContactDetailsOpener)(),d=(0,Ta.useSetAtom)(Vg),f=(0,y.formatDate)(t.time,"LLL"),m=(0,X.isRecentCallConference)(t)?o.conference_call_details_description_text(f):o.conference_chat_details_description_text(f);(0,a.useEffect)((function(){return function(){return d({type:"clearState"})}}));var p=(0,y.useEvent)((function(e){d({type:"selectParty",payload:{party:e}})}));return(0,r.jsxs)("div",{className:"flex flex-col gap-4",children:[(0,r.jsx)("div",{children:m}),(0,r.jsx)(iu,{itemId:s}),(0,r.jsx)(L.SelectionContainer,{children:t.parties.map((function(e){return(0,r.jsx)(Kg,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){$g(e,t,n[t])}))}return e}({party:e,onClick:p,onDetails:u},n),e.phone)}))})]})};function Zg(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Jg(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Zg(e,t,n[t])}))}return e}function ej(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}var tj=function(e){var t=e.show,n=e.closeModal,a=e.closing,o=e.style,i=e.handleCallClick,s=e.handleChatClick,c=e.recentItem,u=e.transferMode;(0,l.assertDefined)(c);var d=(0,y.useEvent)((function(e){i(ej(Jg({},e),{origination:"recent",navigateToInteractionsPage:!0,afterCallSideEffectCallback:n}))})),f=(0,y.useEvent)((function(e){s(ej(Jg({},e),{origination:"recent",previousActivity:c.globalInteractionId?{globalInteractionId:c.globalInteractionId,mediaType:c.media}:void 0})),n()}));return(0,r.jsx)(L.SlidingModal,{show:t,closing:a,style:o,closeModal:n,name:"recentConference","data-testid":"recent-conference-parties-modal",header:(0,r.jsx)(qg,{item:c}),footer:(0,r.jsx)(Gg,{recentItem:c,onCall:d,onChat:f}),children:(0,r.jsx)(Qg,{recentItem:c,transferMode:u,onCall:d,onChat:f})})};function nj(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function rj(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function aj(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var oj=o().memo((function(e){var t=e.contentVoiceTranscript,n=aj(e,["contentVoiceTranscript"]),a=(0,c.useLocalizationState)().t;return(0,r.jsx)(L.SlidingModal,rj(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){nj(e,t,n[t])}))}return e}({name:"call-transcript",headerClassName:M("flex min-h-[72px] justify-center heading-xs text-primary-on-primary"),showIconClose:!1,header:a.VOICE_TRANSCRIPT.title()},n),{children:t}))}));function ij(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function sj(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){ij(e,t,n[t])}))}return e}var lj=function(e){var t=e.name,n=(0,it.useCloseGlobalSlidingModal)(),o=(0,it.useSlidingModalState)("globalModalsData"),i=o[t],s=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:5,n=kg(e),r=Mg();return(0,a.useMemo)((function(){return{height:"".concat(n+r-t,"px")}}),[n,r,t])}(i.show,i.topOffset),l=(0,a.useCallback)((function(){n(t)}),[t,n]);switch(t){case"recentConference":return(0,r.jsx)(tj,sj({closeModal:l,style:s},o[t]));case"mergeContacts":return(0,r.jsx)(zg,sj({closeModal:l,style:s},o[t]));case"calendarEvent":return(0,r.jsx)(Rg,sj({closeModal:l,style:s},o[t]));case"voiceTranscript":return(0,r.jsx)(oj,sj({closeModal:l,style:s},o[t]));default:return null}},cj=o().memo((function(){var e=(0,it.useSlidingModalState)((function(e){return(0,l.typedKeys)(e.globalModalsData).filter((function(t){return e.globalModalsData[t].show||e.globalModalsData[t].closing}))}));return(0,r.jsx)("div",{className:"pointer-events-none absolute inset-y-0 z-[15] h-full w-full overflow-hidden",children:e.map((function(e){return(0,r.jsx)(lj,{name:e},e)}))})}));function uj(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function dj(e){if(Array.isArray(e))return e}function fj(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}function mj(e,t){return dj(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||vj(e,t)||fj()}function pj(e){return dj(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||vj(e)||fj()}function vj(e,t){if(e){if("string"==typeof e)return uj(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?uj(e,t):void 0}}function hj(e){var t,n=null==e?void 0:e.state;return(0,X.isCall)(e)&&("delivered"===(t=n)||"delivery_pending"===t)}var bj=function(){var e=(0,a.useRef)(null),t=function(e){var t=mj((0,a.useState)(""),2),n=t[0],r=t[1],o=mj((0,a.useState)(0),2),l=o[0],c=o[1],u=(0,s.useInteractionId)(),d=(0,i.useInteractionStateMethods)().sendDtmf,f=(0,i.useInteractionProp)(u,(function(e){var t;return null==e||null===(t=e.callData)||void 0===t?void 0:t.callId})),m=(0,i.useInteractionProp)(u,hj),p=(0,a.useCallback)((function(e,t){f&&setTimeout((function(){e.forEach((function(e){d({dtmf:e,callId:f})}))}),t)}),[f,d]),v=(0,a.useCallback)((function(e){if(f){var t=(0,X.digitizePhone)(e.target.value.toLowerCase());if(!function(e){return!/^[0-9*#,]*$/g.test(e)}(t)&&m){r(t);var a=function(e,t){var n=i(e,t),r=pj(t.replace(n,"").split(",")),a=r[0],o=r.slice(1);return{DTMFsToSend:a.split(""),DTMFSToQueue:o.map((function(e){return e.split("")}))};function i(e,t){for(var n="",r=0;r<t.length;r++){if(e[r]!==t[r])return n;n+=e[r]}return n}}(n,t),o=a.DTMFsToSend,i=a.DTMFSToQueue;!function(e,t){var n=a(e),r=a(t);function a(e){return e.split(",").length-1}function o(){var e=1e3*i();c((function(t){return t-e}))}function i(){return n-r}r<n&&o()}(n,t),p(o,l),function(e){if(e.length){var t=l;e.forEach((function(e){p(e,t+=1e3)})),c(t)}}(i)}}}),[f,m,l,n,p]),h=(0,a.useCallback)((function(e){e.preventDefault();var t=e.target;(0,se.isHTMLInputElement)(t)&&(t.focus(),t.selectionStart=t.selectionEnd=t.value.length+1)}),[]),b=(0,a.useCallback)((function(t){return function(){t=t.trim(),m&&f&&(d({dtmf:t,callId:f}),r(n+t)),e.current&&e.current.focus()}}),[f,m,e,n,d]),y=(0,a.useCallback)((function(e){"ArrowLeft"===e.key&&e.preventDefault()}),[]),g=(0,a.useCallback)((function(e){e.preventDefault()}),[]);return(0,a.useMemo)((function(){return{inputValue:n,preventDefault:g,handleInputChange:v,moveCaretToTheEnd:h,handleButtonClick:b,preventToMoveLeft:y}}),[n,g,v,h,b,y])}(e),n=t.inputValue,o=t.handleButtonClick,l=t.moveCaretToTheEnd,c=t.preventToMoveLeft,u=t.handleInputChange;return(0,r.jsxs)("div",{className:"flex flex-auto flex-col",children:[(0,r.jsx)(j.InputField,{ref:e,autoFocus:!0,onMouseDown:l,onFocus:l,onKeyDown:c,onSelect:l,value:n,onChange:u}),(0,r.jsx)("div",{className:"mt-12 flex flex-auto items-center justify-center",children:(0,r.jsx)(Vp,{handleButtonClick:o,allowLetterBasedDialing:!1})})]})};function yj(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function gj(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}var jj=o().memo((function(e){var t=(0,c.useLocalizationState)("t");return(0,r.jsx)(L.SlidingModal,gj(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){yj(e,t,n[t])}))}return e}({name:"keypad",header:t.DIAL_PAD.keypad()},e),{children:(0,r.jsx)(bj,{})}))})),Ij=(0,L.createComponentLoader)("knowledgeBase",n.e(330).then(n.t.bind(n,2330,23)),"KBPage").KBPageLoader,Sj={openInNewTab:!0},Oj=(0,a.memo)((function(){var e=(0,Wr.useKbBridgeConnector)();return(0,Wr.assertKBBridgeInterface)(e),(0,r.jsx)(Ij,{features:Sj,kbBridge:e})})),xj=n(7650);function Cj(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function _j(){var e=Cj(["bg-primary-background"]);return _j=function(){return e},e}function wj(){var e=Cj(["flex flex-col"]);return wj=function(){return e},e}function Nj(){var e=Cj(["rounded-t-md"]);return Nj=function(){return e},e}function Aj(){var e=Cj(["absolute z-10 w-[calc(100%_-_8px)]"]);return Aj=function(){return e},e}function Pj(){var e=Cj(["bottom-0 left-1 top-auto"]);return Pj=function(){return e},e}function Ej(){var e=Cj(["overflow-hidden"]);return Ej=function(){return e},e}function Dj(){var e=Cj(["data-[state=open]:animate-slide-panel-up"]);return Dj=function(){return e},e}function Tj(){var e=Cj(["data-[state=closed]:animate-fade-out-100"]);return Tj=function(){return e},e}function kj(){var e=Cj(["shadow-5"]);return kj=function(){return e},e}function Mj(){var e=Cj(["absolute inset-0 z-10 bg-inverse-overlay"]);return Mj=function(){return e},e}function Lj(){var e=Cj(["data-[state=open]:animate-fade-in-100"]);return Lj=function(){return e},e}function Rj(){var e=Cj(["data-[state=closed]:animate-fade-out-100"]);return Rj=function(){return e},e}function Fj(){var e=Cj(["relative truncate px-6 py-4"]);return Fj=function(){return e},e}function Bj(){var e=Cj(["flex items-center justify-between gap-4"]);return Bj=function(){return e},e}function Uj(){var e=Cj(["heading-s"]);return Uj=function(){return e},e}function zj(){var e=Cj(["border-b border-default"]);return zj=function(){return e},e}function Hj(){var e=Cj(["flex items-center gap-4 truncate"]);return Hj=function(){return e},e}function Vj(){var e=Cj(["size-10 shrink-0"]);return Vj=function(){return e},e}function Gj(){var e=Cj(["relative overflow-y-auto p-6"]);return Gj=function(){return e},e}function Wj(){var e=Cj(["flex flex-auto flex-col"]);return Wj=function(){return e},e}function qj(){var e=Cj(["shrink-0"]);return qj=function(){return e},e}function Yj(){var e=Cj(["relative truncate px-6 py-4"]);return Yj=function(){return e},e}function Kj(){var e=Cj(["flex items-center justify-between gap-4"]);return Kj=function(){return e},e}function $j(){var e=Cj(["border-t border-default"]);return $j=function(){return e},e}var Xj;(0,xj.tv)({base:[(0,_e.tw)(_j()),(0,_e.tw)(wj()),(0,_e.tw)(Nj()),(0,_e.tw)(Aj()),(0,_e.tw)(Pj()),(0,_e.tw)(Ej()),(0,_e.tw)(Dj()),(0,_e.tw)(Tj())],variants:{modal:{false:(0,_e.tw)(kj())}},slots:{overlay:[(0,_e.tw)(Mj()),(0,_e.tw)(Lj()),(0,_e.tw)(Rj())]}}),(0,xj.tv)({base:[(0,_e.tw)(Fj()),(0,_e.tw)(Bj()),(0,_e.tw)(Uj()),(0,_e.tw)(zj())],slots:{innerContainer:(0,_e.tw)(Hj()),close:(0,_e.tw)(Vj())}}),(0,xj.tv)({base:[(0,_e.tw)(Gj()),(0,_e.tw)(Wj())]}),(0,xj.tv)({base:[(0,_e.tw)(qj()),(0,_e.tw)(Yj()),(0,_e.tw)(Kj()),(0,_e.tw)($j())]});var Qj=(0,L.createComponentLoader)("knowledgeBase",n.e(330).then(n.t.bind(n,2330,23)),"KBPage").KBPageLoader,Zj={setupInteractionKB:!0,openInNewTab:!0},Jj=function(){var e=(0,Wr.useKbBridgeConnector)();(0,Wr.assertKBBridgeInterface)(e);var t=(0,a.useContext)(Xj).onClose,n=(0,r.jsx)(_e.Button,{className:"ml-2",flat:!0,icon:(0,r.jsx)(j.IconClose24,{}),onPressed:t,tooltipPlacement:"bottom-end",variant:"ghost"});return(0,r.jsx)(Qj,{closeButton:n,features:Zj,kbBridge:e})};function eI(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function tI(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}var nI=o().memo((function(e){return(0,r.jsx)(L.SlidingModal,tI(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){eI(e,t,n[t])}))}return e}({className:"text-left",contentClassName:"p-0",name:"knowledgeBase",focusTrap:!1},e),{children:(0,r.jsx)(Jj,{})}))}));function rI(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function aI(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}var oI=(0,r.jsx)(L.FocusTrap,{className:"flex flex-col items-start text-left",children:(0,r.jsx)(Ft,{})}),iI=function(e){var t=(0,c.useLocalizationState)().t;return(0,r.jsx)(L.SlidingModal,aI(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){rI(e,t,n[t])}))}return e}({name:"reschedule",focusTrap:!1,header:t.CALL_DETAILS_FORM.button_schedule_followup_label()},e),{children:oI}))},sI=(0,Ta.atom)("consult-call"),lI=(0,Ta.atom)(""),cI=(0,Ta.atom)("");function uI(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function dI(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return uI(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return uI(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var fI=function(){var e=(0,y.useBoolean)(),t=(0,c.useLocalizationState)("t"),n=dI((0,Ta.useAtom)(sI),2),a=n[0],o=n[1],i=(0,Ta.useAtomValue)(cI),l=(0,s.useInteractionId)(),u=(0,it.useCloseInteractionSlidingModal)(),d=[{value:"consult-call",text:t.VOICE_CALL.dial_consult_button_tooltip(),selectedIcon:(0,r.jsx)(j.IconPhone24Filled,{className:"svg-color-current"}),optionIcon:(0,r.jsx)(j.IconPhone,{className:"size-4"})},{value:"transfer",text:t.VOICE_CALL.blind_transfer_button_tooltip(),selectedIcon:(0,r.jsx)(j.IconCompleteTransferFilled,{className:"svg-color-current"}),optionIcon:(0,r.jsx)(j.IconCompleteTransfer,{className:"size-4"})},{value:"conference",text:t.VOICE_CALL.dial_conference_button_tooltip(),selectedIcon:(0,r.jsx)(j.IconConferenceCall24,{className:"svg-color-current"}),optionIcon:(0,r.jsx)(j.IconConference,{className:"size-4"})}],f=d.find((function(e){return e.value===a})),m=(0,te.useTransferHandlers)();return(0,r.jsx)(j.SplitButtonDropdown,{actionButton:{onClick:function(){switch(a){case"consult-call":m.consultCallHandler(i);break;case"transfer":m.blindTransferHandler(i);break;case"conference":m.singleStepConferenceHandler(i)}u(l,"transfer")}},open:e.value,onOpenChange:e.toggle,className:"h-10",options:d.map((function(e){return(0,r.jsxs)("button",{className:"flex gap-2",onClick:function(){return o(e.value)},children:[e.optionIcon,(0,r.jsx)("span",{children:e.text})]},e.value)})),children:(0,r.jsxs)("span",{className:"flex items-center gap-2",children:[null==f?void 0:f.selectedIcon,(0,r.jsx)("span",{children:null==f?void 0:f.text})]})})};function mI(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function pI(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return mI(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return mI(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var vI=function(){var e=pI((0,Ta.useAtom)(cI),2),t=e[0],n=e[1],a=(0,c.useLocalizationState)("t");return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(j.InputField,{layoutClassName:"flex-auto",value:t,onChange:function(e){n(e.target.value)},fieldClassName:"h-10",label:a.CONTACT.channel_favorites_phone_icon_tooltip()}),(0,r.jsx)(fI,{})]})};var hI=n(8704),bI=n(5163);function yI(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function gI(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}var jI=function(){return!0};function II(e){var t=e.type,n=e.transferMode,r=e.renderContext,o=e.recentList,i=e.filter,s=void 0===i?jI:i,l=(0,at.useSessionState)().userId,c=(0,nl.useRecentUIState)((function(e){return e.searchValue})),u=(0,a.useDeferredValue)(c),d=(0,a.useCallback)((function(e){var t,n,a,o;return"transfer"===r||!u||(null===(t=e.number)||void 0===t?void 0:t.includes(u))||(null===(n=e.name)||void 0===n?void 0:n.toLowerCase().includes(u.toLowerCase()))||(null===(a=e.firstName)||void 0===a?void 0:a.toLowerCase().includes(u.toLowerCase()))||(null===(o=e.lastName)||void 0===o?void 0:o.toLowerCase().includes(u.toLowerCase()))}),[r,u]),f=Zh(),m=Qh(),p=(0,a.useCallback)((function(e){var r=!!e.userId,a="msteams"===(null==e?void 0:e.userType),o=!("messages"===n)||r||a,i=(0,X.isRecentCall)(e)&&e.userId===l,c="calls"===n?f(e):"messages"!==n||m(e);return d(e)&&s(e)&&o&&SI(e,t)&&!i&&c}),[n,l,f,m,d,s,t]);return(0,a.useMemo)((function(){return(e=o,t=void 0,n=[],r={contactIds:{},emails:{},numbers:{},names:{}},e.filter((function(e){return function(e,t){var n=!0;if((0,X.isRecentChat)(e))if(e.contactId)t.contactIds[e.contactId]?n=!1:t.contactIds[e.contactId]=!0;else if(e.email)t.emails[e.email]?n=!1:t.emails[e.email]=!0;else if(e.number)t.numbers[e.number]?n=!1:t.numbers[e.number]=!0;else{var r=e.name||[e.firstName,e.lastName].join(" ");r.trim()&&(t.names[r]?n=!1:t.names[r]=!0)}return n}(e,r)})).forEach((function(e){var r,a,o=OI(e);n.length>0&&(a=t,(r=o)&&a&&"chat"!==r.mediaType&&("voice"===r.mediaType?"voice"===a.mediaType&&!r.isConference&&!a.isConference&&r.phone===a.phone&&r.type===a.type:"email"===r.mediaType&&"email"===a.mediaType&&r.caseId===a.caseId))?function(e){var t=e[e.length-1];"number"==typeof t.repeatCount?t.repeatCount+=1:e[e.length-1]=gI(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){yI(e,t,n[t])}))}return e}({},t),{repeatCount:2})}(n):n.push(e),t=o})),n).filter(p);var e,t,n,r}),[p,o])}var SI=function(e,t){return"all"===t||(0,rt.itemTypeToTabType)(e.type,e.media)===t};var OI=function(e){if("VOICE"!==e.media)return"EMAIL"===e.media&&e.caseId?{mediaType:"email",caseId:e.caseId}:void 0;if(e.number){var t=e.answered?e.direction:"missed";return{mediaType:"voice",phone:e.number,type:t,isConference:(0,X.isRecentCallConference)(e)}}};var xI=function(e){var t=e.crmObject,n=(0,u.useIntegrationApiStateMethods)().openRecord,a=t.displayName,o=(0,y.useEvent)((function(){n(t,void 0,{inNewTab:!1,source:"user"})}));return(0,r.jsx)("button",{"data-testid":"crm-object-item-button",onClick:o,className:M("cursor-pointer whitespace-nowrap caption-s","text-primary-on-primary hover:text-primary-link"),children:a})},CI=function(e){var t=e.crmObjects;return(0,r.jsx)("div",{"data-testid":"crm-objects",className:"ml-11 flex flex-col",children:t.map((function(e){return(0,r.jsx)(xI,{crmObject:e},e.id)}))})};var _I=n(8631);function wI(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function NI(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){wI(e,t,n[t])}))}return e}function AI(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function PI(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var EI=function(e){var t,n=e.contactId,a=e.icon,o=e.tooltip,i=e.OptionComponent,s=e.optionsExtractor,c=e.onPressed,u=e.className,d=e.children,f=PI(e,["contactId","icon","tooltip","OptionComponent","optionsExtractor","onPressed","className","children"]),m=(0,y.useBoolean)(),p=(0,st.useContactsStateMethods)().getContact,v=null!==(t=(0,st.useContact)(n))&&void 0!==t?t:{},h=v.data,b=v.isLoading,g=(0,y.useEvent)((function(){p({id:n}).then((function(e){if(e){var t=s(e);t.length>1?m.setTrue():1===t.length&&c(t[0].value)}}))})),I=(0,y.useEvent)((function(e){"Escape"===e.key&&(e.stopPropagation(),m.setFalse())}));if(!h)return(0,r.jsx)(_e.Button,AI(NI({size:"sm",variant:"neutral",state:b?"loading":"default",className:u,tooltip:o,iconLeft:a,onClick:g},f),{children:d}));var S=s(h);return S.length>1?(0,r.jsx)(j.TriggerDropdown,{modal:!1,inPortal:!1,align:"start",open:m.value,onOpenChange:m.toggle,onKeyDown:I,onClick:y.stopPropagation,onFocus:y.stopPropagation,className:"[&>*:not(:last-child)]:border-b [&>*:not(:last-child)]:border-default",options:S.map((function(e){var t=e.key,n=PI(e,["key"]);return(0,r.jsx)("button",{onClick:function(){return c(n.value)},children:(0,r.jsx)(i,NI({},n))},t)})),children:function(e){return(0,r.jsx)(_e.Button,{size:"sm",variant:"neutral",className:u,tooltip:o,iconLeft:a,iconRight:e?(0,r.jsx)(j.IconArrowUp16,{}):(0,r.jsx)(j.IconArrowDown16,{}),"data-focused":e,children:d})}}):(0,r.jsx)(_e.Button,AI(NI({size:"sm",variant:"neutral",state:S.length?"default":"disabled",className:u,tooltip:o,iconLeft:a,onPressed:function(){(0,l.assertDefined)(S[0]),c(S[0].value)}},f),{children:d}))},DI=function(e){var t,n,a=e.contactId,o=e.onCallClick,i=e.onChatClick,s=e.onEmailClick,l=(0,c.useLocalizationState)("t"),u=(null!==(t=(0,st.useContact)(a))&&void 0!==t?t:{}).data,d=null!==(n=(0,yt.useContactDisplayName)(a))&&void 0!==n?n:l.GLOBAL.anonymous(),f=u?(0,Pr.contactToShortContact)(u):void 0,m=(0,y.useEvent)((function(e){o({phone:e,contactId:a,firstName:null==u?void 0:u.firstName,lastName:null==u?void 0:u.lastName})})),p=(0,y.useEvent)((function(e){i({phone:e,contactId:a,firstName:null==u?void 0:u.firstName,lastName:null==u?void 0:u.lastName})})),v=(0,y.useEvent)((function(e){s({contactId:a,emailAddress:e})}));return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:"flex items-start gap-1 px-2 py-1.5",children:[(0,r.jsx)("div",{className:"truncate font-semibold body text-primary-action",children:d}),!!f&&(0,r.jsx)(qc.ExternalContactFavoriteButton,{item:f,className:"ml-auto size-6 p-1"})]}),(0,r.jsxs)("div",{className:"flex flex-auto gap-2 px-2 pb-2",children:[(0,r.jsx)(EI,{contactId:a,className:"h-7 flex-auto",icon:(0,r.jsx)(j.IconPhone16,{className:"svg-color-current"}),tooltip:l.CONTACT.button_start_call_text(),OptionComponent:L.PhoneOption,optionsExtractor:lt.externalContact.callOptions,onPressed:m}),(0,r.jsx)(EI,{contactId:a,className:"h-7 flex-auto",icon:(0,r.jsx)(j.IconRoundChat16,{className:"svg-color-current"}),tooltip:l.CONTACT.button_initiate_chat_text(),OptionComponent:L.PhoneOption,optionsExtractor:lt.externalContact.chatOptions,onPressed:p}),(0,r.jsx)(EI,{contactId:a,className:"h-7 flex-auto",icon:(0,r.jsx)(j.IconEmailEnvelope16,{className:"svg-color-current"}),tooltip:l.CONTACT.button_send_email_text(),OptionComponent:L.EmailOption,optionsExtractor:lt.externalContact.emailOptions,onPressed:v})]})]})},TI=n(1079);n(7422);n(4225);n(9969);var kI=(0,Na.createSelector)((function(e){return e.parties}),(function(e){var t=new Set;return null==e||e.forEach((function(e){"CONTACT"!==e.partyType&&e.disposition&&t.add(e.disposition)})),Array.from(t)})),MI=((0,Na.createSelector)((function(e){return e.parties}),(function(e){var t=new Set;return null==e||e.forEach((function(e){"CONTACT"!==e.partyType&&e.notes&&t.add(e.notes)})),Array.from(t)})),(0,Na.createSelector)((function(e){return e.services}),(function(e){var t;return null==e||null===(t=e.map((function(e){return e.serviceName})))||void 0===t?void 0:t.join(", ")}))),LI=(0,Na.createSelector)(kI,(function(e){return null==e?void 0:e.join(", ")}));(0,Na.createSelector)(MI,LI,(function(e,t){return[e,t].filter(Boolean).join(": ")}));var RI,FI,BI;n(6426);function UI(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}RI=function(){function e(){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e)}var t,n,r;return t=e,r=[{key:"validate",value:function(e){return null!=e&&this.emailPattern.test(e)}}],(n=null)&&UI(t.prototype,n),r&&UI(t,r),e}(),FI="emailPattern",BI=new RegExp(sp.EMAIL_REGEX),FI in RI?Object.defineProperty(RI,FI,{value:BI,enumerable:!0,configurable:!0,writable:!0}):RI[FI]=BI;n(161);const zI=n.p+"768a4584de75be31d108c80afaed59bb.svg";L.Svg;var HI="updateTime",VI=(0,Ta.atom)([{id:"TEAM",type:"queue",queueType:"TEAM",closeable:!1},{id:"PERSONAL",type:"queue",queueType:"PERSONAL",closeable:!1},{id:"FOLLOWUP",queueType:"FOLLOWUP",type:"queue",closeable:!1}]),GI=(0,Ta.atom)("TEAM");(0,Ta.atom)((function(e){return e(VI).find((function(t){return t.id===e(GI)}))})),(0,Ta.atom)(400),(0,Ta.atom)(),(0,Ta.atom)({skip:0,size:100}),(0,Ta.atom)(void 0),(0,Ta.atom)({field:HI,direction:"desc"}),(0,Ta.atom)(void 0),(0,Ta.atom)("all"),(0,Ta.atom)(void 0),(0,Ta.atom)({field:HI,direction:"desc"}),(0,Ta.atom)({skip:0,size:100}),(0,Ta.atom)(void 0),(0,Ta.atom)({field:HI,direction:"desc"});var WI=n(3705);(0,WI.Cl)();(0,WI.Cl)();var qI=n(6658);(0,WI.Cl)();(0,Ta.createStore)();n(574);n.p;n(7704);var YI={id:"search",type:"search",title:"",closeable:!1},KI=((0,Ta.atom)(""),(0,Ta.atom)([YI])),$I=(0,Ta.atom)(YI.id),XI=((0,Ta.atom)(void 0),(0,Ta.atom)(void 0),(0,Ta.atom)(600),(0,Ta.atom)([]),(0,Ta.atom)({sortBy:"score",asc:!1}),(0,Ta.atom)(void 0),(0,Ta.atom)(void 0),(0,Ta.atom)([]));function QI(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function ZI(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||eS(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function JI(e){return function(e){if(Array.isArray(e))return QI(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||eS(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function eS(e,t){if(e){if("string"==typeof e)return QI(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?QI(e,t):void 0}}function tS(){var e=ZI((0,Ta.useAtom)(KI),2),t=e[0],n=e[1],r=ZI((0,Ta.useAtom)($I),2),o=r[0],i=r[1];return{handleTabOpen:(0,a.useCallback)((function(e){t.find((function(t){return t.id===e.id}))||n(JI(t).concat([e])),i(e.id)}),[i,n,t]),handleTabClose:(0,a.useCallback)((function(e){e===o&&i(t[0].id),n(t.filter((function(t){return t.id!==e})))}),[o,i,n,t]),handleTabUpdate:(0,a.useCallback)((function(e){n((function(t){return t.map((function(t){return t.id===e.id?e:t}))}))}),[n])}}function nS(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function rS(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||oS(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function aS(e){return function(e){if(Array.isArray(e))return nS(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||oS(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function oS(e,t){if(e){if("string"==typeof e)return nS(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?nS(e,t):void 0}}(0,WI.Cl)();function iS(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function sS(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){iS(e,t,n[t])}))}return e}function lS(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function cS(){var e=(0,c.useLocalizationState)().t,t=tS(),n=t.handleTabOpen,r=t.handleTabClose,o=t.handleTabUpdate,i=(0,gt.useFormatting)().formatFullName,s=function(){var e=(0,c.useLocalizationState)().t,t=(0,at.useSessionState)("privileges"),n=rS((0,Ta.useAtom)(XI),2),r=n[0],o=n[1],i=tS(),s=i.handleTabOpen,l=i.handleTabClose,u=3>r.length&&t.EDIT_CONTACTS&&t.DELETE_CONTACTS,d=(0,a.useCallback)((function(t){o((function(e){return Array.from(new Set(aS(e).concat([t])))})),s({id:"merge",type:"merge_contacts",title:e.GLOBAL.merge(),closeable:!1})}),[s,o,e.GLOBAL]);return{addContactForMerge:u?d:void 0,removeContactFromMerge:(0,a.useCallback)((function(e){var t=r.filter((function(t){return t!==e}));o(t),t.length||l("merge")}),[l,r,o]),canAddContactForMerge:u,closeContactsMerge:(0,a.useCallback)((function(){o([]),l("merge")}),[l,r,o])}}().addContactForMerge,l=(0,a.useCallback)((function(e,t){var r={id:e.id,type:"contact",title:i(e.firstName,e.lastName),props:{editMode:t,onMerge:s?function(){return s(e.id)}:void 0,onEditMode:function(e){return o(lS(sS({},r),{props:lS(sS({},r.props),{editMode:e})}))}},closeable:!0};n(r)}),[s,i,n,o]),u=(0,a.useCallback)((function(t,r,a){var o={id:"create",type:"create_contact",title:t||e.GLOBAL.anonymous(),closeable:!0,props:{initialData:r,onContactCreated:a}};n(o)}),[e,n]);return{handleContactCreate:u,handleContactOpen:l,handleContactCreateCancel:(0,a.useCallback)((function(){r("create")}),[r])}}(0,WI.Cl)();function uS(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function dS(e,t,n,r,a,o,i){try{var s=e[o](i),l=s.value}catch(c){return void n(c)}s.done?t(l):Promise.resolve(l).then(r,a)}function fS(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(s){o=[6,s],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function mS(){var e,t,n=ju(),r=wu(),a=(0,st.useContactsStateMethods)().getContact;return(0,y.useEvent)((e=function(e,t){var o,i,s,l;return fS(this,(function(c){switch(c.label){case 0:return[4,a({id:e})];case 1:return(i=c.sent())?(s=t.number,l=t.email,i.emails.find((function(e){return e.emailAddress===l}))?(null===(o=i.phones)||void 0===o?void 0:o.find((function(e){return e.phone===s})))?[2]:[2,new Promise((function(t){r({phone:s,contactId:e,firstName:i.firstName,lastName:i.lastName,onConfirm:t})}))]:[2,new Promise((function(t){n({email:l,contactId:e,firstName:i.firstName,lastName:i.lastName,onConfirm:t})}))]):[2,Promise.reject()]}}))},t=function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){dS(o,r,a,i,s,"next",e)}function s(e){dS(o,r,a,i,s,"throw",e)}i(void 0)}))},function(e,n){return t.apply(this,arguments)}))}function pS(e,t,n,r,a,o,i){try{var s=e[o](i),l=s.value}catch(c){return void n(c)}s.done?t(l):Promise.resolve(l).then(r,a)}function vS(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){pS(o,r,a,i,s,"next",e)}function s(e){pS(o,r,a,i,s,"throw",e)}i(void 0)}))}}function hS(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function bS(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(s){o=[6,s],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function yS(){var e=hS(["min-w-40"]);return yS=function(){return e},e}function gS(){var e=hS(["min-w-40"]);return gS=function(){return e},e}function jS(){var e=hS(["min-w-40"]);return jS=function(){return e},e}var IS=function(e){var t=e.item,n=e.closeHovercard,a=function(e){return I.apply(this,arguments)},o=function(){return g(),n(),Promise.resolve()},i=(0,c.useLocalizationState)("t"),s=(0,gt.useFormatting)().formatFullName,l=(0,fy.useNavigationState)("goTo"),u=(0,hI.useRecentStateMethods)().linkWithContact,d=(0,st.useContactsStateMethods)().createContact,f=cS(),m=f.handleContactCreate,p=f.handleContactOpen,v=mS(),h=(0,ie.useModalComponentOpener)(TI.QuickAddModal),b=(0,ie.useModalComponentOpener)(TI.AddToExistingModal),g=(0,y.useEvent)((function(){m(s(t.firstName,t.lastName),function(e){var t;return uS(t={},"Contact.first_name",e.firstName),uS(t,"Contact.last_name",e.lastName),uS(t,"Contact.phones",e.number?[{phone:e.number,type:lt.PhoneTypes.BUSINESS}]:[]),uS(t,"Contact.emails",e.email?[{email_address:e.email,type:lt.EmailTypes.PRIMARY}]:[]),t}(t),(function(e){u(t.itemId,e)}))}));function I(){return(I=vS((function(e){return bS(this,(function(r){switch(r.label){case 0:return[4,v(e.id,t)];case 1:return r.sent(),[2,n()]}}))}))).apply(this,arguments)}var S=[{key:"quick-add",content:i.INTERACTIONS.quick_add(),onSelect:function(){h({defaultValues:{firstName:t.firstName,lastName:t.lastName,email:t.email,phone:t.number},onSubmit:function(e){d({contact:{first_name:e.firstName,last_name:e.lastName,emails:e.email?[{email_address:e.email,type:lt.EmailTypes.PRIMARY}]:[],phones:e.phone?[{phone:e.phone,type:lt.PhoneTypes.BUSINESS}]:[]}},{onSuccess:function(n){u(t.itemId,n),l(fy.AppRoutes.search),p({id:n,firstName:e.firstName,lastName:e.lastName})}})}}),n()},className:(0,_e.tw)(yS())},{key:"new-contact",content:i.INTERACTIONS.new_contact(),onSelect:o,className:(0,_e.tw)(gS())},{key:"add-to-existing",content:i.INTERACTIONS.add_to_existing(),onSelect:function(){b({handleAddNewContact:o,handleAddToExisting:a}),n()},className:(0,_e.tw)(jS())}];return(0,r.jsx)(j.MoreOptions,{size:"xs",className:"size-7",buttonProps:{variant:"neutral"},options:S})},SS=function(e){var t=e.item,n=e.closeHovercard,a=e.onCallClick,o=e.onChatClick,i=e.onEmailClick,s=(0,c.useLocalizationState)("t"),u=(0,at.useSessionState)("phoneDeviceCapabilities"),d=(0,gt.useFormatting)().formatFullName,f=(0,vn.useIsCommunicator)(),m=t.number&&(0,rt.formatPhone)(t.number),p=d(t.firstName,t.lastName)||t.name||m||s.GLOBAL.anonymous(),v=!!t.number&&"-"!==t.number&&u.canDial,h=!!t.number,b=!f&&!!t.email,g=(0,y.useEvent)((function(){(0,l.assertDefined)(t.number),a({phone:t.number,firstName:t.firstName,lastName:t.lastName})})),I=(0,y.useEvent)((function(){(0,l.assertDefined)(t.number),o({phone:t.number,firstName:t.firstName,lastName:t.lastName})})),S=(0,y.useEvent)((function(){(0,l.assertDefined)(t.email),i({emailAddress:t.email})}));return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"flex items-start gap-1 px-2 py-1.5",children:(0,r.jsx)("div",{className:"truncate font-semibold body text-primary-action",children:p})}),(0,r.jsxs)("div",{className:"flex flex-auto gap-2 px-2 pb-2",children:[v&&(0,r.jsx)(_e.Button,{size:"sm",variant:"neutral",className:"h-7 flex-auto",tooltip:s.CONTACT.button_start_call_text(),iconLeft:(0,r.jsx)(j.IconPhone16,{className:"svg-color-current"}),onPressed:g}),h&&(0,r.jsx)(_e.Button,{size:"sm",variant:"neutral",className:"h-7 flex-auto",tooltip:s.CONTACT.button_initiate_chat_text(),iconLeft:(0,r.jsx)(j.IconRoundChat16,{className:"svg-color-current"}),onPressed:I}),b&&(0,r.jsx)(_e.Button,{size:"sm",variant:"neutral",className:"h-7 flex-auto",tooltip:s.CONTACT.button_send_email_text(),iconLeft:(0,r.jsx)(j.IconEmailEnvelope16,{className:"svg-color-current"}),onPressed:S}),(0,r.jsx)(IS,{item:t,closeHovercard:n})]})]})};function OS(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function xS(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){OS(e,t,n[t])}))}return e}function CS(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var _S=function(e){var t=e.item,n=e.children,o=CS(e,["item","children"]),i=(0,Gr.useCommunicatorUIState)().floatingState,s=(0,y.useBoolean)(),l=(0,y.useBoolean)();(0,a.useEffect)((function(){"closed"===i&&(s.setFalse(),l.setFalse())}),[i,s,l]);var c=(0,y.useEvent)((function(e){"Escape"===e.key&&(e.stopPropagation(),s.setFalse())})),u=(0,y.useEvent)((function(e){e?s.setTrue():l.setTrue()}));return(0,r.jsxs)(_I.Root,{open:s.value,onOpenChange:u,children:[(0,r.jsx)(_I.Trigger,{asChild:!0,children:n}),(0,r.jsx)(_I.Portal,{children:(0,r.jsx)(Py.AnimatePresence,{onExitComplete:function(){s.setFalse(),l.setFalse()},children:!l.value&&(0,r.jsx)(_I.Content,{asChild:!0,onKeyDown:c,onClick:y.stopPropagation,onDoubleClick:y.stopPropagation,avoidCollisions:!0,align:"start",style:{transform:"translate(10px, 10px)"},tabIndex:0,className:"flex w-60 flex-col border shadow-4 bg-primary-background border-default",children:(0,r.jsx)(Py.motion.div,{initial:{opacity:0},animate:{opacity:1},exit:{opacity:0},transition:{duration:.15,ease:"easeOut"},children:t.contactId?(0,r.jsx)(DI,xS({contactId:t.contactId},o)):(0,r.jsx)(SS,xS({item:t,closeHovercard:s.setFalse},o))})})})})]})};function wS(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function NS(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function AS(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var PS=function(e){var t,n=e.item,o=AS(e,["item"]),i=null===(t=(0,Gc.useDirectoryState)("emiUsers")[Wc.MS_TEAMS_CHATS_CATEGORY_ID])||void 0===t?void 0:t.find((function(e){return e.userId===n.userId})),s=function(e,t){var n,r=(0,at.useSessionStateRef)(),o=(0,yt.useGetAvatarUrl)(),i=function(){if("msteams"===e.userType||"msteams_channel"===e.userType)return null==t?void 0:t.userId;if(e.groupChatData&&e.groupChatData.members.length<=2){var n,a=r.current.userId;return null===(n=e.groupChatData.members.find((function(e){return e.id!==a})))||void 0===n?void 0:n.id}return e.userId}()||"";(0,Gc.useDirectoryUser)(i);var s=null===(n=(0,Er.useUserDetailsById)(i))||void 0===n?void 0:n.data;return(0,a.useMemo)((function(){var t;return t=(0,X.isRecentCallConference)(e)||(0,X.isRecentExtChatConference)(e)?{avatarType:"conference",isAgent:(0,X.isRecentGroupChat)(e)}:(0,X.isRecentEmail)(e)?{avatarType:"case"}:e.groupChatData?Dr({chatData:e.groupChatData,p2pUser:s,session:r.current}):{avatarType:(0,jt.getAvatarType)(e.userId,e.contactId,e.userType),firstName:e.firstName||e.name,lastName:e.lastName,isAgent:!!e.userType||!!e.userId,url:o({userId:e.userId,contactId:e.contactId,userType:e.userType,photoUrl:e.photoUrl})},s&&(t.isOnline="available"===s.presenceState,t.onlineStatusIcon=(0,Er.getUserStatusIcon)(s)),t}),[o,e,s,r])}(n,i),l=(0,r.jsx)(jt.Avatar,{firstName:s.firstName,lastName:s.lastName,fullName:s.fullName,url:s.url,icon:s.icon,online:s.isOnline,onlineStatus:s.onlineStatusIcon,headPhones:s.isAgent,type:s.avatarType});return!n.contactId&&n.userId||(0,X.isRecentCallConference)(n)||(0,X.isRecentExtChatConference)(n)||(0,X.isRecentGroupChat)(n)?l:(0,r.jsx)(_S,NS(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){wS(e,t,n[t])}))}return e}({item:n},o),{children:l}))};function ES(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function DS(){var e=ES(["shrink-0"]);return DS=function(){return e},e}function TS(){var e=ES(["icon-error"]);return TS=function(){return e},e}function kS(){var e=ES(["icon-neutral"]);return kS=function(){return e},e}function MS(){var e=ES(["ml-1 truncate caption-s"]);return MS=function(){return e},e}function LS(){var e=ES(["text-on-error"]);return LS=function(){return e},e}function RS(){var e=ES(["text-neutral-on-secondary"]);return RS=function(){return e},e}var FS="flex items-center overflow-hidden",BS=(0,xj.tv)({base:(0,_e.tw)(DS()),variants:{isMissed:{true:(0,_e.tw)(TS()),false:(0,_e.tw)(kS())}},defaultVariants:{isMissed:!1}}),US=(0,xj.tv)({base:(0,_e.tw)(MS()),variants:{isMissed:{true:(0,_e.tw)(LS()),false:(0,_e.tw)(RS())}},defaultVariants:{isMissed:!1}}),zS=function(e){var t,n=e.item,o=(0,c.useLocalizationState)("t"),i=Wg(),s=(t=(0,gt.useFormatting)().formatFullName,(0,a.useCallback)((function(e){return e.map((function(e){return t(e.firstName,e.lastName)})).join(", ")}),[t])),u=!!Number(n.duration)&&(0,r.jsx)("span",{"data-testid":"duration",children:"(".concat((0,y.formatDurationShort)((0,y.cutMilliseconds)(n.duration)),")")});if((0,X.isRecentCallConference)(n))return(0,r.jsxs)("div",{className:FS,children:[(0,r.jsx)(j.IconConferenceCall16,{className:BS()}),(0,r.jsxs)("div",{className:US(),children:[u," ",(0,r.jsx)("span",{"data-testid":"parties",children:i(n.parties)})]})]});if((0,X.isRecentExtChatConference)(n))return(0,r.jsxs)("div",{className:FS,children:[(0,r.jsx)(j.IconConferenceChat16,{className:BS()}),(0,r.jsxs)("div",{className:US(),children:[u," ",(0,r.jsx)("span",{"data-testid":"parties",children:i(n.parties)})]})]});if((0,X.isRecentGroupChat)(n))return(0,l.assertDefined)(n.groupChatData),(0,r.jsxs)("div",{className:FS,children:[(0,r.jsx)(j.IconConferenceChat16,{className:BS()}),(0,r.jsxs)("div",{className:US(),children:[u," ",(0,r.jsx)("span",{"data-testid":"parties",children:s(n.groupChatData.members)})]})]});if((0,X.isRecentInternalChat)(n))return(0,r.jsxs)("div",{className:FS,children:[(0,r.jsx)(j.IconInternalChat16,{className:BS()}),(0,r.jsxs)("div",{className:US(),children:[u," ",(0,r.jsx)("span",{"data-testid":"last-message-author",children:n.lastMessageAuthor}),(0,r.jsx)("span",{children:": "}),(0,r.jsx)("span",{"data-testid":"last-message",children:n.lastMessage})]})]});if((0,X.isRecentExternalChat)(n)){var d=!n.userId&&"INBOUND"===n.direction&&"0"===n.duration,f=(0,L.getChannelImageIcon)(n.channel),m=d?o.ACTIVITY_HISTORY.call_message_missed():"INBOUND"===n.direction?o.ACTIVITY_HISTORY.call_message_incoming_text():o.ACTIVITY_HISTORY.call_message_outgoing_text(),p="external_chat_party_joined_new"===n.lastMessage?o.EXTERNAL_CHAT.external_chat_party_joined_new():"external_chat_party_left_new"===n.lastMessage?o.EXTERNAL_CHAT.external_chat_party_left_new():(0,se.formatHTMLAsOneLineString)(n.lastMessage);return(0,r.jsxs)("div",{className:FS,children:[f&&(0,r.jsx)(f,{className:BS({isMissed:d})}),(0,r.jsxs)("div",{className:US({isMissed:d}),children:[(0,r.jsx)("span",{children:m})," ",u,!d&&p&&(0,r.jsxs)(r.Fragment,{children:[": ",(0,r.jsx)("span",{"data-testid":"last-message",children:p})]})]})]})}if((0,X.isRecentCall)(n)){var v="INBOUND"===n.direction&&"0"===n.duration,h="INBOUND"===n.direction?j.IconPhone16Filled:j.IconOutboundCall16,b=v?o.ACTIVITY_HISTORY.call_message_missed():"INBOUND"===n.direction?o.ACTIVITY_HISTORY.call_message_incoming_text():o.ACTIVITY_HISTORY.call_message_outgoing_text();return(0,r.jsxs)("div",{className:FS,children:[(0,r.jsx)(h,{className:BS({isMissed:v})}),(0,r.jsxs)("div",{className:US({isMissed:v}),children:[(0,r.jsx)("span",{children:b})," ",u]})]})}if((0,X.isRecentEmail)(n)){if(n.caseTitle)return(0,r.jsxs)("div",{className:FS,children:[(0,r.jsx)(j.IconEmail16,{className:BS()}),(0,r.jsx)("div",{className:US(),children:(0,r.jsx)("span",{"data-testid":"case-title",children:n.caseTitle})})]})}else if((0,X.isRecentWorkitem)(n)){var g=n.number&&(0,rt.formatPhone)(n.number);return(0,r.jsxs)("div",{className:FS,children:[(0,r.jsx)(j.IconOutboundPreview16,{className:BS()}),(0,r.jsx)("div",{className:US(),children:(0,r.jsx)("span",{"data-testid":"phone",children:g})})]})}return null},HS=function(e){var t,n,a=e.item,o=e.transferMode,i=e.crmObjectsListOpened,s=e.onCall,u=e.onChat,d=e.onEmail,f=e.onDetails,m=e.toggleShowCrmObjectsList,p=(0,c.useLocalizationState)("t"),v=(0,at.useSessionState)(["userId","phoneDeviceCapabilities"]),h=v.userId,b=v.phoneDeviceCapabilities,g=(0,vn.useIsCommunicator)(),I=a.userId===h,S=(null===(t=a.number)||void 0===t?void 0:t.startsWith("+"))?a.number.substring(1):a.number,O=!("calls"===o||!b.canDial||(0,X.isRecentCallConference)(a)||(0,X.isRecentExtChatConference)(a)||!S||I),x=!("messages"===o||(0,X.isRecentCallConference)(a)||(0,X.isRecentExtChatConference)(a)||!a.contactId&&(!a.userId||(0,X.isRecentEmail)(a))&&!S&&!a.groupChatData),C=!g&&(0,X.isRecentEmail)(a)&&!!a.email,_=!!a.userId||!!a.contactId,w=(0,y.useEvent)((function(){(0,l.assertDefined)(s),(0,l.assertDefined)(S),s({phone:S,contactId:a.contactId,userId:a.userId,firstName:a.firstName,lastName:a.lastName,serviceId:a.serviceId})})),N=(0,y.useEvent)((function(){var e;(0,l.assertDefined)(u),u({phone:S,contactId:a.contactId,userId:a.userId,firstName:a.firstName,lastName:a.lastName,serviceId:a.serviceId,groupChatId:null===(e=a.groupChatData)||void 0===e?void 0:e.chatId})})),A=(0,y.useEvent)((function(){(0,l.assertDefined)(d),(0,l.assertDefined)(a.email),d({contactId:a.contactId,emailAddress:a.email})})),P=(0,y.useEvent)((function(){return f(a)})),E=(0,y.useEvent)((function(e){e.stopPropagation(),m()}));return(0,r.jsxs)(r.Fragment,{children:[!!(null===(n=a.associatedCRMObjects)||void 0===n?void 0:n.length)&&(0,r.jsx)(_e.Button,{"data-testid":"crm-objects-button",size:"xs",variant:i?"secondary":"neutral",tooltip:p.RECENT.button_show_crm_objects_text(),className:"h-6 items-center pt-1",onClick:E,children:p.RECENT.button_show_crm_objects_text_short()}),O&&(0,r.jsx)(j.ButtonIcon,{"data-testid":"call-button",tooltip:p.CONTACT.button_start_call_text(),onClick:w,children:(0,r.jsx)(j.IconPhone16Filled,{})}),x&&(0,r.jsx)(j.ButtonIcon,{"data-testid":"chat-button",tooltip:p.CONTACT.button_initiate_chat_text(),onClick:N,children:(0,r.jsx)(j.IconRoundChat16Filled,{})}),C&&(0,r.jsx)(j.ButtonIcon,{"data-testid":"email-button",tooltip:p.CONTACT.button_send_email_text(),onClick:A,children:(0,r.jsx)(j.IconEmail16,{})}),_&&(0,r.jsx)(j.ButtonIcon,{"data-testid":"user-info-button",tooltip:p.CONTACT.button_show_contact_details_text(),onPressed:P,children:(0,r.jsx)(j.IconInformation,{})})]})},VS=function(e){var t,n,a,o,i=e.item,s=e.repeatCount,l=(0,c.useLocalizationState)("t"),u=(0,gt.useFormatting)().formatFullName,d=M("caption-s text-neutral-on-secondary"),f=M("font-semibold body text-primary-on-primary"),m=(null!==(t=(0,st.useContact)(i.contactId))&&void 0!==t?t:{}).data,p=i.number&&(0,rt.formatPhone)(i.number),v=u(null==m?void 0:m.firstName,null==m?void 0:m.lastName)||u(i.firstName,i.lastName)||i.name||p||l.GLOBAL.anonymous();if((0,X.isRecentCallConference)(i)||(0,X.isRecentExtChatConference)(i))n=(0,r.jsx)("span",{className:f,children:"".concat(l.RECENT.conference_title_text()," (").concat(i.parties.length,")")});else if((0,X.isRecentChat)(i)){var h=i.groupChatData?i.groupChatData.title:v;n=(0,r.jsx)("span",{className:f,"data-testid":"name",children:h})}else if((0,X.isRecentCall)(i))n=(0,r.jsx)("span",{className:f,"data-testid":"name",children:(a=v,o=s,a&&s?"".concat(a," (").concat(o,")"):a)});else if((0,X.isRecentEmail)(i)){var b=u(i.firstName,i.lastName)||i.email||l.GLOBAL.unidentified();n=(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:d,"data-testid":"case-number",children:"#".concat(i.caseNumber)}),(0,r.jsx)("span",{children:" "}),(0,r.jsx)("span",{className:f,"data-testid":"name",children:b})]})}else n=(0,X.isRecentWorkitem)(i)?(0,r.jsx)("span",{className:f,"data-testid":"name",children:v}):(0,r.jsx)("span",{className:f,"data-testid":"unknown-media",children:"[Unknown media: ".concat(i.media,"]")});return(0,r.jsxs)("span",{className:"flex gap-1",children:[(0,r.jsxs)("span",{className:"truncate",children:[n,i.serviceName&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:"mx-1 inline-block h-[9px] border-l border-inverse"}),(0,r.jsx)("span",{"data-testid":"service-name",className:d,children:i.serviceName})]})]}),!(0,X.isRecentCallConference)(i)&&!(0,X.isRecentExtChatConference)(i)&&!(0,X.isRecentGroupChat)(i)&&(0,r.jsx)(qc.RecentFavoriteButton,{forContactListItem:!0,item:i})]})},GS=n(4554);function WS(e,t){return t||(t=e.slice(0)),Object.freeze(Object.defineProperties(e,{raw:{value:Object.freeze(t)}}))}function qS(){var e=WS(["flex items-center justify-center rounded-full bg-primary-700 caption-xs text-inverse-primary"]);return qS=function(){return e},e}function YS(){var e=WS(["size-3.5"]);return YS=function(){return e},e}function KS(){var e=WS(["size-4"]);return KS=function(){return e},e}function $S(){var e=WS(["size-5"]);return $S=function(){return e},e}var XS=function(e){var t,n,o=e.item,s=(0,i.useInteractionStateSelector)((function(e){var t=e.items.find((function(e){return(0,X.isInternalChat)(e)&&e.userId===o.userId}));return(0,X.getInteractionId)(t)})),l=(0,i.useInteractionStateSelector)((function(e){var t=e.items.find((function(e){return((0,X.isExternalChat)(e)||(0,X.isChatConference)(e))&&e.contactId===o.contactId}));return(0,X.getInteractionStepId)(t)})),c=(0,Yt.useChatUnread)(l),u=(0,ty.useInternalChatUnread)(s),d=null===(t=o.groupChatData)||void 0===t?void 0:t.chatId,f=(0,GS.useGroupChatTotalUnread)((function(e){return e.chatId===d})),m=(0,Yt.usePersonalMessagesUnreadAmount)(null!==(n=o.contactId)&&void 0!==n?n:""),p=(0,a.useMemo)((function(){return u||(f||(o.contactId&&((0,X.isRecentExtChatConference)(o)||(0,X.isRecentChat)(o))?m+c:0))}),[c,u,o,m,f]);if(!p)return null;var v=String(p).length,h=(0,xj.tv)({base:(0,_e.tw)(qS()),variants:{digitsNumber:{1:(0,_e.tw)(YS()),2:(0,_e.tw)(KS()),3:(0,_e.tw)($S())}}});return(0,r.jsx)("div",{className:h({digitsNumber:v}),children:p})};function QS(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function ZS(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){QS(e,t,n[t])}))}return e}function JS(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}var eO,tO=o().memo((function(e){var t,n=e.isHighlighted,o=e.transferMode,i=e.transferControlsStyle,s=e.onClick,l=e.onDoubleClick,c=e.onCallClick,u=e.onChatClick,d=e.onEmailClick,f=e.onDetailsClick,m=e.useEmiItemStatus,p=e.repeatCount,v=e.isSelected,h=e.recentItem,b=(0,st.useContactsState)("contacts"),g=(0,at.useAuthorizedSession)().userId,j=(0,a.useMemo)((function(){if((0,X.isRecentEmail)(h)){var e,t,n,r=h.contactId,a=r&&(null===(n=b[r])||void 0===n||null===(t=n.data)||void 0===t||null===(e=t.primaryPhone)||void 0===e?void 0:e.phone);if(a)return JS(ZS({},h),{number:a})}if((0,X.isRecentInternalChat)(h)){var o,i=null===(o=h.groupChatData)||void 0===o?void 0:o.members;if(2===(null==i?void 0:i.length)){var s=i.find((function(e){return e.id!==g}));if(s)return JS(ZS({},h),{firstName:s.firstName,lastName:s.lastName,userId:s.id})}}return h}),[b,h,g]),I="INBOUND"===j.direction&&"0"===j.duration,S="INBOUND"===j.direction,O="OUTBOUND"===j.direction,x=function(e){return"extChat"!==e.type||"web"!==e.channel}(j);(0,Er.useSubscribeForUserDetails)(j.userId);var C=(0,y.useBoolean)(),_=C.value,w=C.toggle,N=(0,r.jsx)(PS,{item:j,onCallClick:c,onChatClick:u,onEmailClick:d}),A=(0,r.jsx)(VS,{item:j,repeatCount:p}),P=(0,r.jsx)(zS,{item:j}),E=(0,r.jsx)("span",{"data-testid":"date",className:"caption-s text-neutral-on-secondary",children:(0,rt.formatDate)(j.time)}),D=(0,r.jsx)(XS,{item:j}),T=(0,r.jsx)(HS,{item:j,transferMode:o,crmObjectsListOpened:_,onCall:c,onChat:u,onEmail:d,onDetails:f,toggleShowCrmObjectsList:w}),k=_&&(null===(t=j.associatedCRMObjects)||void 0===t?void 0:t.length)?(0,r.jsx)(CI,{crmObjects:j.associatedCRMObjects}):null,M=m(j.userType,j.ownerId),R=M.active,F=M.disableReasonMessage,B=(0,y.useEvent)((function(e){s(j,e)})),U=(0,y.useEvent)((function(){l(j)}));return(0,r.jsx)(r.Fragment,{children:(0,r.jsx)(yc.ContactListItem,{as:L.SelectionItem,containerProps:{focusOnSelection:!0,touchedOnly:!0,itemId:j.itemId,title:F,"data-testid":"recent-item","data-conference":(0,X.isRecentCallConference)(j)||(0,X.isRecentExtChatConference)(j)||void 0,"data-chat":(0,X.isRecentChat)(j)||void 0,"data-call":(0,X.isRecentCall)(j)||void 0,"data-missed":I||void 0,"data-incoming":S||void 0,"data-outgoing":O||void 0,"data-email":(0,X.isRecentEmail)(j)||void 0,"data-disabled":!R||void 0,"data-selected":v},isSelected:n||v,showControls:v,isConference:(0,X.isRecentCallConference)(j)||(0,X.isRecentExtChatConference)(j),transferMode:o,transferControlsStyle:i,userId:j.userId,contactId:j.contactId,number:j.number,avatar:N,title:A,titleRight:E,body:P,bodyRight:D,controls:T,bottomContent:k,onClick:x?B:void 0,onDoubleClick:U,userType:j.userType,disabled:!R})})}));function nO(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function rO(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){nO(e,t,n[t])}))}return e}function aO(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}var oO=function(e){var t=(0,c.useLocalizationState)("t"),n=(0,i.useDefaultTransferMode)(),o=(0,nl.useRecentUIState)(),u=o.selected,d=o.setSelected,f=o.setSearchValue,m=o.searchValue,p=e.filter,v=e.isHighlighted,h=e.transferMode,b=void 0===h?n:h,g=e.transferControlsStyle,j=e.type,S=e.renderContext,O=e.onClick,x=(0,te.useActivityHistoryOpener)(),C=(0,te.useContactDetailsOpener)(),_=(0,te.useCallHandler)(),w=(0,xn.useServiceState)().selectedService,N=(0,$l.useNativeScrollDataManager)(Zl(j)),A=(0,hI.useRecentState)(),P=A.recentList,E=A.isLoading,D=(0,Gc.useDirectoryState)("teams"),T=(0,Gc.useDirectoryStateMethods)(),k=(0,at.useSessionState)(),R=k.privileges,F=k.emi,B=(0,hc.useCaseStateMethods)().createCaseEmail,U=(0,I.useNotificationsState)("methods").hideNotificationsByTag,z=(0,a.useRef)(!1),H=!!Object.keys(R).length;(0,a.useEffect)((function(){H&&R.CAN_VIEW_DIRECTORY&&T.getAgentTeams()}),[T,R.CAN_VIEW_DIRECTORY,H]),(0,a.useEffect)((function(){D.length&&!z.current&&(T.getLoggedUsers(D.map((function(e){return e.id}))),z.current=!0)}),[T,D,z]);var V=(0,a.useMemo)((function(){return(0,$.partial)(Yv.useEmiItemStatus,F)}),[F]),G=(0,y.useEvent)((function(e){_(aO(rO({},e),{navigateToInteractionsPage:!0,serviceId:null!=w?w:e.serviceId}))})),W=(0,y.useEvent)((function(e){G(aO(rO({},e),{origination:"recent"}))})),q=(0,y.useEvent)((function(e){(e.contactId||e.userId||e.phone||e.groupChatId)&&x(aO(rO({},e),{origination:"recent"}))})),Y=(0,y.useEvent)((function(e){B(e)})),K=(0,it.useOpenInteractionSlidingModal)(),Q=(0,it.useOpenGlobalSlidingModal)(),Z=(0,yo.useNavigationState)("setActivePage"),J=(0,s.useNonAssertedInteractionId)(),ee=(0,it.useShowSlidingModalChecker)(J,"recentConference"),ne=(0,y.useEvent)((function(e){var t={recentItem:e,handleChatClick:q,handleCallClick:W,onClick:O,transferMode:b};b?((0,l.assertDefined)(J),K(J,"recentConference",t)):Q("recentConference",t)}));!function(e){var t=(0,s.useNonAssertedInteractionId)(),n=(0,it.useShowSlidingModalChecker)(t,"recentConference"),r=(0,a.useRef)(0);(0,a.useLayoutEffect)((function(){var t,a,o;n?(r.current=null!==(o=null===(t=e.current)||void 0===t?void 0:t.scrollTop)&&void 0!==o?o:0,null===(a=e.current)||void 0===a||a.scrollTo({top:0})):requestAnimationFrame((function(){var t;null===(t=e.current)||void 0===t||t.scrollTo({top:r.current}),r.current=0}))}),[e,n])}(N);var re,ae,oe,ie=(0,y.useEvent)((function(e,t){t.preventDefault(),t.nativeEvent.detail>1?clearTimeout(eO):eO=setTimeout((function(){if(O)O(e,t);else if((0,X.isRecentCallConference)(e)||(0,X.isRecentExtChatConference)(e))ne(e);else{if((0,X.isRecentCall)(e))return d(e.itemId),void(e.number&&f(e.number));if((0,X.isRecentChat)(e))return U("interaction-init"),void x({contactId:e.contactId,userId:e.userId,phone:e.number,firstName:e.firstName,lastName:e.lastName,origination:"recent",emiPhotoUrl:e.photoUrl,emiUserType:e.userType,previousActivity:e.globalInteractionId?{globalInteractionId:e.globalInteractionId,mediaType:e.media}:void 0});if((0,X.isRecentEmail)(e)){if(!e.caseId)return;Z({name:yo.AppRoutes.Cases,params:{id:e.caseId}})}}}),250)})),se=(0,y.useEvent)((function(e){if(clearTimeout(eO),e.number&&(0,X.isRecentCall)(e))return f(""),W({phone:e.number,firstName:e.firstName,lastName:e.lastName,userId:e.userId,contactId:e.contactId,serviceId:e.serviceId})})),le=(0,y.useEvent)((function(e){(0,X.isRecentCallConference)(e)||(0,X.isRecentExtChatConference)(e)?ne(e):C({userId:(0,bI.isRecentDirectoryEntryItem)(e)?void 0:e.userId,contactId:e.contactId,entryId:(0,bI.isRecentDirectoryEntryItem)(e)?e.userId:void 0})})),ce=II({type:j,transferMode:b,filter:p,recentList:P,renderContext:S});!function(e){var t=(0,nl.useRecentUIState)(),n=t.tabIndex,r=t.searchValue,o=t.setSelected,i=(0,y.usePrevious)(n);(0,a.useEffect)((function(){r&&e.length&&o((function(t){var r=n!==i,a=e[0];if(r)return a.itemId;var o=t&&e.find((function(e){return e.itemId===t}));return o?o.itemId:a.itemId})),r&&e.length||o(void 0)}),[r,e,o,n,i])}(ce),re=ce,ae=(0,st.useContactsState)("contacts"),oe=(0,st.useContactsStateMethods)().getContacts,(0,a.useEffect)((function(){var e=[],t=void 0;if(re.forEach((function(t){var n=t.contactId;!n||ae[n]||e.includes(n)||e.push(n)})),e.length)return t=setTimeout((function(){return oe(e)}),500),function(){return clearTimeout(t)}}),[re]);var ue=(0,a.useDeferredValue)(m);return ce.length?E?(0,r.jsx)("div",{className:"relative mt-2",children:(0,r.jsx)("div",{className:"absolute inset-x-0",children:(0,r.jsx)(yc.ContactListPlaceholder,{amount:15})})}):(0,r.jsx)(L.SelectionContainer,{ref:N,className:M("scrollbar-on-hover flex-auto overflow-auto",{"overflow-hidden":ee}),children:(0,r.jsx)("div",{className:"bg-primary-background",children:(0,r.jsx)(L.ErrorBoundary,{fallback:null,children:ce.map((function(e,t){return(0,r.jsx)(tO,{onClick:ie,onDoubleClick:se,onCallClick:W,onChatClick:q,onEmailClick:Y,onDetailsClick:le,isHighlighted:null==v?void 0:v(e),isSelected:!!u&&u===e.itemId,transferMode:b,transferControlsStyle:g,useEmiItemStatus:V,recentItem:e,repeatCount:e.repeatCount},e.itemId||t)}))})})}):ue.length?(0,r.jsx)("p",{className:"mt-[32.5px] text-center",children:t.RECENT.no_recent_interactions_found_for(ue)}):(0,r.jsx)("p",{className:"mt-[32.5px] text-center",children:t.RECENT.no_recent_interactions_found()})};function iO(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function sO(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}var lO=function(){var e=(0,c.useLocalizationState)("t").RECENT,t=(0,at.useSessionState)("phoneDeviceCapabilities"),n=(0,nl.useRecentUIState)(),a=n.selected,o=n.searchValue,i=n.setSearchValue,s=(0,hI.useRecentState)().recentList,l=(0,xn.useServiceState)().selectedService,u=(0,On.useDIDNumberState)().selectedDIDNumber,d=(0,I.useNotificationsState)("methods").hideNotificationsByTag,f=(0,te.useCallHandler)(),m=(0,te.useActivityHistoryOpener)(),p=(0,y.useEvent)((function(e){i(e.target.value)})),v=(0,y.useEvent)((function(e){f(sO(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){iO(e,t,n[t])}))}return e}({},e),{navigateToInteractionsPage:!0}))})),h=(0,y.useEvent)((function(){i("");var e,t=a&&s.find((function(e){return a===e.itemId}));if(!t){if(!o)return;return v({phone:o,serviceId:l,accessNumberId:u,origination:"recent"})}v({phone:null!==(e=t.number)&&void 0!==e?e:"",firstName:t.firstName,lastName:t.lastName,serviceId:null!=l?l:t.serviceId,contactId:t.contactId,userId:t.userId,accessNumberId:u,origination:"recent"})})),b=(0,y.useEvent)((function(){i("");var e=s.find((function(e){return a===e.itemId}));if(!e){if(!o)return;return d("interaction-init"),m({phone:o})}d("interaction-init"),(e.userId||e.contactId||e.number)&&m({contactId:e.contactId,userId:e.userId,phone:e.number,firstName:e.firstName,lastName:e.lastName,origination:"recent",emiPhotoUrl:e.photoUrl,emiUserType:e.userType,previousActivity:e.globalInteractionId?{globalInteractionId:e.globalInteractionId,mediaType:e.media}:void 0})}));return(0,r.jsxs)("div",{className:"flex items-start gap-2.5",children:[(0,r.jsx)(j.SearchField,{value:o,onChange:p,layoutClassName:"grow","data-testid":"search-input","aria-label":e.search_field_placeholder(),placeholder:e.search_field_placeholder()}),(0,r.jsx)(L.SearchForInteractionControls,{searchQuery:o,showCallButton:!!t.canDial,callButtonDisabled:!a&&!(0,rt.isPhone)(o),chatButtonDisabled:!a&&!(0,rt.isPhone)(o),onCallClick:h,onChatClick:b})]})};function cO(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var uO=[{id:"all",testId:"tab-all",content:"All"},{id:"calls",testId:"tab-calls",content:"Calls"},{id:"messages",testId:"tab-messages",content:"Messages"}];function dO(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function fO(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return dO(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return dO(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function mO(e){var t=e.transferMode,n=e.selectedTab,o=fO((0,Ta.useAtom)(lI),2),u=o[0],d=o[1],f=fO((0,Ta.useAtom)(cI),2),m=f[0],p=f[1],v=(0,c.useLocalizationState)("t"),h=(0,s.useInteractionId)(),b=(0,i.useInteractionProp)(h,X.isExternalChat),y=b?"all":"calls",g=(0,a.useCallback)((function(e){return[e.firstName,e.lastName,e.number,e.name].join(" ").toLowerCase().includes(u.trim().toLowerCase())}),[u]),I=(0,a.useCallback)((function(e){var n=e.item,r=e.channel,a=e.media;return[n.displayName,r.number].join(" ").toLowerCase().includes(u.trim().toLowerCase())&&("calls"===t?"voice"===a:"chat"===a)}),[u,t]),S=(0,a.useCallback)((function(e){return Boolean((0,Jt.getDirectoryItemPhone)(e))}),[]),O=M("flex min-h-0 flex-auto flex-col overflow-auto"),x=(0,a.useMemo)((function(){return(0,r.jsx)(j.SearchField,{autoFocus:!0,value:u,"data-testid":"dialpad-input",fieldClassName:"mb-4",onChange:function(e){return d(e.target.value)},placeholder:v.VOICE_CALL.transfer_search_placeholder()})}),[u,d,v.VOICE_CALL]),C=(0,it.useOpenInteractionSlidingModal)();function _(e){if((0,X.isRecentCallConference)(e)||(0,X.isRecentExtChatConference)(e))return n={recentItem:e,onClick:_,handleCallClick:$.noop,handleChatClick:$.noop,transferMode:t},(0,l.assertDefined)(h),void C(h,"recentConference",n);var n;e.number&&p(e.number)}return(0,r.jsxs)("div",{className:M("flex min-h-0 flex-auto flex-col overflow-auto"),children:["favorites"===n&&(0,r.jsxs)("div",{className:O,children:[x,(0,r.jsx)(Zb,{onClick:function(e){var t=e.channel;return t.number&&p(t.number)},transferMode:t,transferControlsStyle:"replace",isHighlighted:function(e){return e.channel.number===m},filter:I})]}),"recent"===n&&(0,r.jsxs)("div",{className:O,children:[x,(0,r.jsx)(oO,{onClick:_,isHighlighted:function(e){return e.number===m},renderContext:"transfer",filter:g,type:y,transferMode:t,transferControlsStyle:"replace"})]}),"directory"===n&&(0,r.jsxs)("div",{className:O,children:[x,b?(0,r.jsx)(lb,{onClick:function(e,t){var n=(0,Jt.getDirectoryItemPhone)(t);n&&p(n)},query:u,filter:S,transferMode:t,isHighlighted:function(e){return(0,Jt.getDirectoryItemPhone)(e)===m},transferControlsStyle:"replace"}):(0,r.jsx)(pb,{onClick:function(e,t){var n=(0,Jt.getDirectoryItemPhone)(t);n&&p(n)},query:u,filter:S,transferMode:t,isHighlighted:function(e){return(0,Jt.getDirectoryItemPhone)(e)===m},transferControlsStyle:"replace"})]})]})}var pO=function(){var e,t,n,o,l,u,d=(0,c.useLocalizationState)().t,f=(0,s.useInteractionId)(),m=(0,i.useInteractionProp)(f,X.isExternalChat)?"messages":"calls";e=(0,Ta.useAtomValue)(lI),t=(0,te.useTransferHandlers)(),n=(0,a.useCallback)((function(){return t.consultCallHandler(e)}),[e,t]),o=(0,a.useCallback)((function(){return t.blindTransferHandler(e)}),[e,t]),l=(0,a.useCallback)((function(){return t.singleStepConferenceHandler(e)}),[e,t]),u=(0,a.useCallback)((function(e){if(e.shiftKey&&e.altKey)switch(e.code){case"KeyB":return o();case"KeyC":return l();case"KeyD":return n()}}),[o,n,l]),(0,y.useEventListener)("keydown",u);var p=(0,nl.useCommunicatorUIState)(["transferTabIndex","handleTransferTabChange"]),v=p.transferTabIndex,h=p.handleTransferTabChange,b=(0,a.useMemo)((function(){return[{id:"recent",key:"tab-recent",content:d.ADDRESS_BOOK_AREA.addressBook_recents(),className:"w-full"},{id:"favorites",key:"tab-favorites",content:d.ADDRESS_BOOK_AREA.addressBook_favorites(),className:"w-full"},{id:"directory",key:"tab-directory",content:d.ADDRESS_BOOK_AREA.addressBook_directory(),className:"w-full"}]}),[d]),g=b[Number(v)].id;return(0,r.jsxs)("div",{className:"flex flex-auto flex-col overflow-auto px-4 pt-4",children:["calls"===m&&(0,r.jsx)(iu,{itemId:f,labeled:!0}),(0,r.jsxs)(_e.TabsRoot,{value:g,className:"mt-4 flex flex-col overflow-auto rounded-xs border px-4 pb-4 bg-primary-background border-default",children:[(0,r.jsx)(_e.TabsList,{children:b.map((function(e){return(0,r.jsx)(_e.TabsTrigger,{triggerClassName:M("p-2 text-center",{"text-primary-on-primary":g===e.id}),value:e.id,className:e.className,onClick:function(){return t=e.id,n=b.findIndex((function(e){return e.id===t})),void h(n);var t,n},isSelected:g===e.id,children:e.content},e.key)}))}),(0,r.jsx)(_e.TabsContent,{value:g,className:"flex flex-auto flex-col overflow-auto pt-4",children:(0,r.jsx)(mO,{transferMode:m,selectedTab:g})})]})]})};function vO(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function hO(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return vO(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return vO(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function bO(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function yO(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}var gO=o().memo((function(e){var t,n,o,l,u=function(){var e=(0,c.useLocalizationState)().t,t=hO((0,a.useState)(""),2),n=t[0],r=t[1],o=(0,s.useInteractionId)(),l=(0,i.useInteractionProp)(o,X.isExternalChat);return(0,a.useEffect)((function(){r(l?e.EXTERNAL_CHAT.invite_dialog_label():e.VOICE_CALL.consult_conference_blind_transfer())}),[e,l]),n}(),d=(0,s.useInteractionId)(),f=(0,i.useInteractionProp)(d,X.isExternalChat);return t=(0,s.useInteractionId)(),n=(0,i.useInteractionProp)(t,X.isAfterCallWork),o=(0,it.useCloseInteractionSlidingModal)(),l=(0,it.useShowSlidingModalChecker)(t,"transfer"),(0,a.useEffect)((function(){l&&n&&o(t,"transfer")}),[n,l,o,t]),(0,r.jsx)(L.SlidingModal,yO(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){bO(e,t,n[t])}))}return e}({name:"transfer",header:u,footer:!f&&(0,r.jsx)(vI,{}),contentClassName:"bg-secondary-background p-0",footerClassName:"items-end"},e),{children:(0,r.jsx)(pO,{})}))}));function jO(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function IO(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){jO(e,t,n[t])}))}return e}var SO=function(e){var t=e.name,n=(0,it.useCloseInteractionSlidingModal)(),o=(0,s.useInteractionId)(),i=(0,it.useSlidingModalState)((function(e){return e.getInteractionModalData(o)})),l=(0,a.useCallback)((function(){n(o,t)}),[n,o,t]);switch(t){case"knowledgeBase":return(0,r.jsx)(nI,IO({closeModal:l},i[t]));case"keypad":return(0,r.jsx)(jj,IO({closeModal:l},i[t]));case"transfer":return(0,r.jsx)(gO,IO({closeModal:l},i[t]));case"reschedule":return(0,r.jsx)(iI,IO({closeModal:l},i[t]));case"recentConference":return(0,r.jsx)(tj,IO({closeModal:l},i[t]));default:return null}},OO=o().memo((function(){var e=(0,s.useInteractionId)(),t=(0,it.useSlidingModalState)((function(t){var n=t.getInteractionModalData(e);return(0,l.typedKeys)(n).filter((function(e){return n[e].show||n[e].closing}))}));return function(){var e=(0,s.useInteractionId)(),t=(0,Gr.useCommunicatorUIState)(),n=t.isOpenTransferModal,r=t.handleToggleTransferModal,o=(0,it.useOpenInteractionSlidingModal)();(0,a.useEffect)((function(){n&&(o(e,"transfer"),null==r||r(!1))}),[e,o,n,r])}(),(0,r.jsx)(r.Fragment,{children:t.map((function(e){return(0,r.jsx)(SO,{name:e},e)}))})}));var xO=function(){var e=(0,c.useLocalizationState)().t,t=(0,s.useInteractionId)(),n=(0,i.useInteraction)(t),a=(0,X.getServiceNameFromItem)(n),o=vy(n),l=o.closeParallelChat,u=o.showCloseParallelChatButton;return(0,r.jsxs)("div",{className:"flex items-center justify-between px-4 py-2",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)("div",{className:"uppercase caption-xs text-neutral-disabled",children:e.INTERACTIONS.interaction_details()}),a&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(j.IconDivider,{}),(0,r.jsx)("div",{className:"capitalize caption-s text-neutral-disabled",children:a})]})]}),u&&(0,r.jsx)(j.ButtonIcon,{tooltip:e.KNOWLEDGE_BASE.close_tab_text(),onClick:l,className:"p-0",children:(0,r.jsx)(j.IconChatPanelClose,{className:"!size-6"})})]})};function CO(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function _O(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return CO(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return CO(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var wO=function(){var e=(0,c.useLocalizationState)().t,t=(0,s.useInteractionId)(),n=(0,i.useInteraction)(t),a=(0,te.useCallHandler)(),o=_O((0,(0,gt.useFormatting)().getNamesFromDisplayName)((null==n?void 0:n.displayData.displayName)||""),2),l=o[0],u=void 0===l?null==n?void 0:n.displayData.firstName:l,d=o[1],f=void 0===d?null==n?void 0:n.displayData.lastName:d,m=(null==n?void 0:n.displayData.number)||"";return(0,r.jsx)("div",{className:"relative flex w-full justify-end",children:(0,r.jsx)(L.InteractionDropdown,{searchMode:"single_contact",callParams:{phone:m,contactId:null==n?void 0:n.contactId,userId:null==n?void 0:n.userId,firstName:u,lastName:f,origination:"interaction"},onCall:a,trigger:function(t){var n=t.handleCallClick,a=t.isLoading,o=t.openerRef;return(0,r.jsx)(L.CircleButton,{ref:o,noActiveState:!0,isLoading:a,onClick:n,tooltip:e.CALL_DETAILS_FORM.button_initiate_call_tooltip(),"data-testid":"call-button",children:(0,r.jsx)(ve.IconPhone,{})})}})})},NO=function(){var e=(0,c.useLocalizationState)().t,t=(0,s.useInteractionId)(),n=(0,i.useInteraction)(t),o=(0,Wn.useRemoteAssistStateMethods)().openRemoteAssist,l=(0,Wn.useRemoteAssistState)("items"),u=(0,X.getGlobalInteractionId)(n),d=(0,X.isInternalChat)(n)?null==n?void 0:n.id:u,f=!!d&&!!l[d],m=(0,y.useAsRef)(d),p=(0,y.useAsRef)(n),v=(0,a.useCallback)((function(){var e,t,n,r,a,i,s;m.current&&o({globalInteractionId:m.current,popup:!0},{action:"create",giid:m.current,mediaType:(null===(e=p.current)||void 0===e?void 0:e.mediaType)||"unknown",caseId:null===(n=p.current)||void 0===n||null===(t=n.emailData)||void 0===t?void 0:t.caseId,contactId:null===(r=p.current)||void 0===r?void 0:r.contactId,clientFirstName:null===(a=p.current)||void 0===a?void 0:a.displayData.firstName,clientLastName:null===(i=p.current)||void 0===i?void 0:i.displayData.lastName,clientDisplayName:null===(s=p.current)||void 0===s?void 0:s.displayData.displayName})}),[m,p,o]);return(0,r.jsx)(L.CircleButton,{className:"px-1",active:f,disabled:f,onClick:v,tooltip:e.INTERNAL_CHAT.chat_remote_assist(),"data-testid":"remote-assist-button",clickThrottle:500,children:(0,r.jsx)(ve.IconRemoteAssist,{})})},AO=function(e){var t=e.className,n=(0,ie.useModalsState)((function(e){return e.modals.some((function(e){return"call_problem"===e.id}))})),o=(0,ie.useModalComponentOpener)(me),i=(0,c.useLocalizationState)().t,s=(0,ln.useAppConfigState)("renderReportProblemButton"),l=(0,a.useCallback)((function(){return o(void 0,{id:"call_problem"})}),[o]);return(0,r.jsx)(r.Fragment,{children:s&&(0,r.jsx)(j.ButtonIcon,{active:n,className:t,onClick:l,tooltip:i.CALL_DETAILS_FORM.report_a_call_problem(),"data-testid":"report-problem-button",children:(0,r.jsx)(j.IconWarning16,{})})})},PO=(0,L.createComponentLoader)("chatCenter",n.e(975).then(n.t.bind(n,9975,23)),"ChatMembersButtonProvider").ChatMembersButtonProviderLoader,EO=function(e){var t,n=e.className,o=(0,at.useSessionState)(),l=o.tenantFeatures,c=o.privileges,u=(0,s.useInteractionId)(),d=(0,i.useInteraction)(u),f=(0,i.useInteractionProp)(u,(function(e){return!(0,X.isPotentialInteraction)(e)&&!(0,X.isInternalChat)(e)})),m=(0,X.isWorkItem)(d)||(0,X.isCall)(d),p=(t=(0,at.useSessionState)().userId,(0,a.useCallback)((function(e){var n=(0,$.get)(e,"displayData.number"),r=((0,$.get)(e,"userId")||(0,$.get)(e,"internalChatData.userId"))===t;return((0,X.isPotentialInteraction)(e)||(0,X.isInternalChat)(e))&&Boolean(n)&&!r}),[t]))(d),v=!!(null==l?void 0:l.nativeRemoteAssistEnabled)&&!!c.SYS_USE_REMOTE_ASSIST,h=(0,X.isInternalChat)(d)&&v,b=(0,X.isGroupChat)(d)||(0,X.isPotentialGroupChat)(d)||(0,X.isInternalInteraction)(d);return(0,r.jsxs)("div",{className:M("flex items-center gap-2",n),children:[f&&(0,r.jsx)(Uy,{}),m&&(0,r.jsx)(AO,{}),h&&(0,r.jsx)(NO,{}),p&&(0,r.jsx)(wO,{}),b&&(0,r.jsx)(PO,{scope:"communicator",size:"16"})]})};function DO(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function TO(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return DO(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return DO(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var kO=function(){var e,t,n=(0,s.useInteractionId)(),a=(0,i.useInteraction)(n),o=(0,te.useContactDetailsOpener)(),l=(0,c.useLocalizationState)("t").CALL_DETAILS_FORM,u=null==a?void 0:a.contactId,d=null==a?void 0:a.userId,f=null==a||null===(e=a.displayData)||void 0===e?void 0:e.emiUserType,m=!!u||!!d,p=(0,yt.useGetAvatarUrl)(),v=TO(function(e){var t=(0,gt.useFormatting)(),n=t.getNamesFromDisplayName,r=t.formatFullName;if(!e)return["",""];var a=e.displayData,o=a.displayName,i=a.firstName,s=a.lastName,l=e.externalChatData,c=null==l?void 0:l.firstName,u=null==l?void 0:l.lastName;return n(o||r(c||i,u||s))}(a),2),h=v[0],b=v[1],g=p({userId:d,contactId:u,userType:f,photoUrl:null==a||null===(t=a.displayData)||void 0===t?void 0:t.emiPhotoUrl}),j=(0,X.isPotentialInteraction)(a)?void 0:(0,X.isExternalChat)(a)||(0,X.isInternalChat)(a)?"chat":(0,X.isEmail)(a)?"email":"phone",I=(0,jt.getAvatarType)(d,u,f),S=(0,y.useEvent)((function(){o({contactId:u,userId:d})})),O=M({"cursor-pointer":m});return(0,r.jsx)(jt.Avatar,{interactionIcon:j,className:O,firstName:h,lastName:b,url:g,type:I,onClick:S,title:m?l.contact_details_link_tooltip():void 0})},MO=function(e){var t=e.displayName;return(0,r.jsx)("div",{className:"truncate font-semibold body text-primary-on-primary","data-testid":"display-name",children:t})},LO=function(e){var t=e.number,n=e.numberType,a=e.isContact,o=(0,(0,gt.useFormatting)().formatPhoneType)(n);return(0,r.jsxs)("div",{className:"truncate caption-s text-neutral-fade",children:[a&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{"data-testid":"phone-type",children:o}),(0,r.jsx)("span",{children:": "})]}),(0,r.jsx)("span",{"data-testid":"phone",children:(0,rt.formatPhone)(t)})]})},RO=function(){var e=(0,s.useInteractionId)(),t=(0,i.useInteraction)(e),n=(0,c.useLocalizationState)().t,a=null==t?void 0:t.contactId,o=(0,yt.useContactDisplayName)(a),l=(0,GS.useIsMultiuserGroupChat)(null==t?void 0:t.groupChatId);if(!t)return null;var u=t.displayData,d=u.displayName,f=u.number,m=u.numberType,p=t.externalChatData,v=o||d||((0,X.isExternalChat)(t)?n.EXTERNAL_CHAT.display_name_placeholder():n.GLOBAL.anonymous()),h=t&&!l&&!(0,X.isCallConference)(t)&&!(0,X.isChatConference)(t);return(0,r.jsxs)("div",{className:"flex flex-auto items-center gap-2 px-4 py-2","data-testid":"party",children:[(0,r.jsx)(kO,{}),(0,r.jsxs)("div",{className:"flex flex-auto flex-col",children:[(0,r.jsxs)("div",{className:"relative flex flex-auto items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(MO,{displayName:v}),h&&(0,r.jsx)(qc.InteractionFavoriteButton,{interaction:t})]}),(0,r.jsx)(EO,{})]}),!p&&f&&(0,r.jsx)(LO,{number:f,numberType:m,isContact:!!a})]})]})};function FO(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function BO(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return FO(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return FO(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var UO=function(e){var t=e.isChat,n=(0,c.useLocalizationState)().t,r=(0,gt.useFormatting)(),o=r.formatFullName,u=r.getNamesFromDisplayName,d=(0,s.useInteractionId)(),f=(0,i.useInteraction)(d);return(0,l.assertDefined)(f),(0,a.useCallback)((function(e,r){var a=e.name,i=e.phone,s=e.email,l=e.userId,c=t?o(e.firstName,e.lastName):a,d=r||c,m=BO(d?u(d):[e.firstName,e.lastName],2),p=m[0],v=m[1];return t?{displayName:d||(i?(0,rt.formatPhone)(i):s||((0,X.isExternalChat)(f)?n.EXTERNAL_CHAT.display_name_placeholder():n.GLOBAL.anonymous())),showPhone:!(!d||!i),showEmail:!(!d||i||!s),firstName:p,lastName:v}:{displayName:d||(i?l?i:(0,rt.formatPhone)(i):n.GLOBAL.anonymous()),showPhone:!(!d||!i),firstName:p,lastName:v}}),[u,o,f,n,t])};function zO(e){var t=e.callParties,n=e.chatParties;return(null==t?void 0:t.length)?null==t?void 0:t.map((function(e){return{id:e.id,name:e.name,phone:e.phone,firstName:e.firstName,lastName:e.lastName,userId:e.userId,contactId:e.contactId,party:e}})):null==n?void 0:n.map((function(e){return{id:e.party_id,phone:e.phone,itemId:e.item_id,firstName:e.first_name,lastName:e.last_name,userId:e.user_id,contactId:e.contact_id,email:e.email,party:e}}))}var HO=function(e,t){var n=null==e?void 0:e.slice(0,3),r=function(e){var t=(0,gt.useFormatting)().formatFullName,n=(0,st.useContactsState)().contacts;return null==e?void 0:e.map((function(e){var r,a,o,i;return t(null===(a=n[e])||void 0===a||null===(r=a.data)||void 0===r?void 0:r.firstName,null===(i=n[e])||void 0===i||null===(o=i.data)||void 0===o?void 0:o.lastName)}))}(null==n?void 0:n.map((function(e){return e.contactId})).filter((function(e){return void 0!==e}))),a=UO({isChat:t});return null==n?void 0:n.map((function(e,t){return a(e,null==r?void 0:r[t]).displayName})).join(", ")},VO=n(2163),GO=function(e){var t=e.onClick,n=e.className,a=(0,c.useLocalizationState)().t;return(0,r.jsx)("button",{className:M("underline button-sm text-primary-action",n),onClick:t,"data-testid":"remove-party-button",children:a.INTERACTIONS.disconnect()})},WO=function(e){var t=e.item,n=e.onRemoveItem,o=e.isChat,c=e.canRemove,u=t.phone,d=t.id,f=t.userId,m=t.contactId,p=t.email,v=t.is_qm,h=(0,yt.useContactDisplayName)(m),b=UO({isChat:o})(t,h),y=b.firstName,g=b.lastName,j=b.displayName,I=b.showPhone,S=b.showEmail,O=(0,yt.useGetAvatarUrl)(),x=(0,s.useInteractionId)(),C=(0,i.useInteraction)(x);(0,l.assertDefined)(C);var _=O({userId:f,contactId:m}),w="1"===v,N=o?!(0,X.isAfterCallWork)(C)&&f&&!w:c,A=f?"user":m?"contact":"unknown",P=(0,a.useCallback)((function(){n(d)}),[n,d]);return(0,r.jsxs)("div",{tabIndex:0,className:M("group flex cursor-pointer items-center justify-between gap-2 rounded-xs","px-2 py-1 transition-colors hover:state-layer-bg-dark-on-white-1 focus:state-layer-bg-dark-on-white-1","active:state-layer-bg-dark-on-white-1"),children:[(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(jt.Avatar,{size:"16",headPhones:!!f,url:_,firstName:y,lastName:g,type:A}),(0,r.jsxs)("div",{className:"ml-1 flex gap-x-1 overflow-hidden",children:[(0,r.jsx)("div",{className:"flex items-center overflow-hidden",children:(0,r.jsx)("div",{className:"truncate font-semibold caption-s text-primary-on-primary","data-testid":"display-name",children:j})}),I&&(0,r.jsx)("div",{className:"truncate caption-s text-primary-on-primary","data-testid":"phone",children:f?u:(0,rt.formatPhone)(u)}),S&&(0,r.jsx)("div",{className:"truncate caption-s text-primary-on-primary","data-testid":"email",children:p})]})]}),N&&(0,r.jsx)(GO,{onClick:P,className:"opacity-0 hover:opacity-100 focus:opacity-100 active:opacity-100 group-hover:opacity-100 group-focus:opacity-100"})]})};function qO(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function YO(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}var KO=function(e){var t,n,a,o,i,s,l,c=e.avatarsItems,u="+".concat((null==c?void 0:c.length)-1),d=(t=c,n=(0,at.useSessionState)(),a=n.userId,o=n.firstName,i=n.lastName,s=(0,yt.useGetAvatarUrl)(),l=t.map((function(e){return{firstName:e.firstName,lastName:e.lastName,type:e.userId?"user":e.contactId?"contact":"unknown",url:s({userId:e.userId,contactId:e.contactId})}})),a&&l.push({firstName:o,lastName:i,url:s({userId:a}),type:"user"}),l.slice(0,3));return(null==d?void 0:d.length)?(0,r.jsxs)("div",{className:"flex items-center -space-x-1",children:[d.map((function(e,t){var n=d.length-t;return(0,r.jsx)(jt.Avatar,YO(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){qO(e,t,n[t])}))}return e}({},e),{className:M("z-[".concat(n,"] border border-white"))}),t)})),(null==c?void 0:c.length)>3&&(0,r.jsx)(j.Avatar,{fallback:u,className:"z-0"})]}):null},$O=function(){var e=(0,yt.useGetAvatarUrl)(),t=(0,c.useLocalizationState)().t,n=(0,gt.useFormatting)().formatFullName,a=(0,at.useSessionState)(),o=a.userId,i=a.isAgent,s=a.firstName,l=a.lastName,u=e({userId:o});return(0,r.jsx)("div",{tabIndex:0,className:M("group flex shrink-0 cursor-pointer items-center justify-between gap-2 rounded-xs","px-2 py-1 transition-colors hover:state-layer-bg-dark-on-white-1"),children:(0,r.jsxs)("div",{className:"flex items-center",children:[(0,r.jsx)(jt.Avatar,{size:"16",headPhones:i,url:u,firstName:s,lastName:l,type:i?"user":"contact"}),(0,r.jsxs)("div",{className:"ml-1 flex gap-x-1 overflow-hidden",children:[(0,r.jsx)("div",{className:"flex items-center overflow-hidden",children:(0,r.jsx)("div",{className:"truncate font-semibold caption-s text-primary-on-primary","data-testid":"display-name",children:n(s,l)})}),(0,r.jsx)("div",{className:"truncate caption-s text-primary-on-primary",children:t.INTERACTIONS.self_item_name()})]})]})})},XO=function(e){var t=e.participantsItems,n=e.onRemoveItem,a=e.canRemove,o=e.isChat,i=(0,y.useBoolean)(),s=i.value,l=i.toggle,u=(0,c.useLocalizationState)().t.INTERACTIONS,d=HO(t,o),f=null==t?void 0:t.length;if(!f)return null;return(0,r.jsxs)(VO.Root,{open:s,onOpenChange:l,children:[(0,r.jsxs)("div",{"data-testid":"parties",className:"flex w-full items-center justify-between px-4 py-2",children:[(0,r.jsx)(VO.Trigger,{children:(0,r.jsxs)("div",{className:"flex items-center gap-x-2",children:[(0,r.jsx)(KO,{avatarsItems:t}),(0,r.jsxs)("div",{className:"flex flex-col",children:[(0,r.jsx)("span",{className:"truncate font-semibold body",children:d}),(0,r.jsxs)("div",{className:"flex gap-0.5",children:[(0,r.jsx)("div",{className:"caption-s text-neutral-fade",children:u.count_members(f+1)}),(0,r.jsx)(j.IconChevronDown16,{className:M("transition-transform duration-300",{"-rotate-180":s})})]})]})]})}),(0,r.jsx)(EO,{className:"mt-2.5"})]}),(0,r.jsx)(VO.Content,{className:"pr-1",children:(0,r.jsxs)("div",{className:"scrollbar-general flex max-h-[136px] flex-col overflow-y-auto pl-4 pr-2",children:[t.map((function(e,t){return(0,r.jsx)(WO,{item:e,onRemoveItem:n,isChat:o,canRemove:a},t)})),f<3&&(0,r.jsx)($O,{})]})})]})},QO=function(e){var t=e.isHost,n=e.callParties,o=void 0===n?[]:n,s=zO({callParties:o}),l=(0,i.useInteractionStateMethods)().removeCallParty,c=(0,a.useCallback)((function(e){var t=o.find((function(t){return t.id===e}));t&&l(t)}),[l,o]);return(0,r.jsx)(XO,{onRemoveItem:c,canRemove:!!t,participantsItems:s})},ZO=function(){var e=(0,s.useInteractionId)(),t=(0,i.useAssociatedChatInteractionProp)(e,X.getChatParties),n=zO({chatParties:t}),o=(0,Yt.useInteractionChatStateMethods)().removePartyFromChat,l=(0,a.useCallback)((function(e){var n=null==t?void 0:t.find((function(t){return t.party_id===e}));n&&n.party_id&&n.item_id&&o({partyId:n.party_id,itemId:n.item_id})}),[t,o]);return(0,r.jsx)(XO,{isChat:!0,onRemoveItem:l,participantsItems:n})},JO=function(){var e=(0,c.useLocalizationState)("t"),t=(0,gt.useFormatting)().formatFullName,n=(0,s.useInteractionId)(),a=(0,i.useInteraction)(n),o=(0,yt.useGetAvatarUrl)(),u=(0,te.useContactDetailsOpener)();(0,l.assertDefined)(a),(0,l.assertDefined)(a.workitemData);var d,f=a.workitemData.contactInfo,m=t(f.firstName,f.lastName)||e.GLOBAL.anonymous(),p=a.contactId,v=null!==(d=(0,st.useContact)(p))&&void 0!==d?d:{},h=v.data,b=v.isLoading,g=null!=h?h:{},I=g.firstName,S=g.lastName,O=g.primaryPhone,x=g.primaryEmail,C=t(I,S),_=(0,rt.formatPhone)(null==O?void 0:O.phone),w=null==x?void 0:x.emailAddress,N=C||_||w||e.GLOBAL.anonymous(),A=o({contactId:p}),P=(0,rt.getInitials)(I,S),E=(0,y.useEvent)((function(){u({contactId:p})}));return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("div",{className:"my-2 ml-4 mr-6 truncate body text-primary-on-primary",children:(0,r.jsx)("span",{"data-testid":"list-record-name",children:m})}),p&&!b&&(0,r.jsxs)("div",{className:"mx-4 my-2 flex items-center gap-2",children:[(0,r.jsx)(j.Avatar,{type:"contact",src:A,fallback:P,tooltip:e.CALL_DETAILS_FORM.contact_details_link_tooltip(),onClick:E}),(0,r.jsx)("div",{className:"truncate font-semibold body text-primary-on-primary",children:(0,r.jsx)("span",{"data-testid":"name",children:N})})]})]})},ex=o().memo((function(){var e=(0,s.useInteractionId)(),t=(0,i.useInteractionProp)(e,X.isCallConference),n=(0,i.useInteractionProp)(e,X.isChatConference),a=(0,i.useInteractionProp)(e,(function(e){return null==e?void 0:e.parties})),o=(0,i.useInteractionProp)(e,(function(e){return null==e?void 0:e.isConferenceHost}));return(0,i.useInteractionProp)(e,X.isNeedToShowWorkitemUI)?(0,r.jsx)(JO,{}):(0,r.jsxs)(r.Fragment,{children:[!n&&!t&&(0,r.jsx)(RO,{}),t&&(0,r.jsx)(QO,{isHost:o,callParties:a}),n&&(0,r.jsx)(ZO,{})]})})),tx=function(e){var t,n,o=e.onClose,l=(0,it.useOpenInteractionSlidingModal)(),u=(0,s.useInteractionId)(),d=(0,it.useShowSlidingModalChecker)(u,"transfer"),f=(0,c.useLocalizationState)().t,m=(0,i.useInteraction)(u),p=(0,te.useCallHandler)(),v=(0,Yt.useInteractionChatStateMethods)(),h=v.createRtcCall,b=v.stopRtcCall,y=v.toggleRtcCallDevice,g=v.requestCobrowsing,I=(0,Yt.useWebRtcConfig)(),S=(0,X.getInteractionStepId)(m),O=(0,Yt.useInteractionChatData)(S),x=(0,at.useSessionState)(),C=x.tenantFeatures,_=x.privileges,w=(0,Yt.useInteractionChatStateConnector)(),N=null==m?void 0:m.displayData.number,A=null==O?void 0:O.cobrowsingWidgetKey,P=null==O?void 0:O.cobrowsingActive,E=null==O?void 0:O.call,D=(0,Yt.useInteractionChatStateSelector)((function(e){return Object.keys(e.chatData).some((function(t){var n;return t!==S&&(null===(n=e.chatData[t].call)||void 0===n?void 0:n.isConfirmed)}))})),T=!!(null==E?void 0:E.isConfirmed),k=!!(null==C?void 0:C.nativeRemoteAssistEnabled)&&!!_.SYS_USE_REMOTE_ASSIST,R="delivered"===(null==m?void 0:m.state)||"hold"===(null==m?void 0:m.state);(0,a.useEffect)((function(){var e=w.dispenser.subscribe({onCobrowsingStarted:function(e){e.cobrowsingLink&&window.open(e.cobrowsingLink,"_blank","")}});return function(){return e.unsubscribe()}}),[w]);var F=(0,a.useCallback)((function(){var e,t;p({phone:N,contactId:null==m?void 0:m.contactId,userId:null==m?void 0:m.userId,firstName:null==m||null===(e=m.displayData)||void 0===e?void 0:e.firstName,lastName:null==m||null===(t=m.displayData)||void 0===t?void 0:t.lastName,origination:"interaction"})}),[null==m?void 0:m.contactId,null==m||null===(t=m.displayData)||void 0===t?void 0:t.firstName,null==m||null===(n=m.displayData)||void 0===n?void 0:n.lastName,null==m?void 0:m.userId,p,N]),B=(0,a.useCallback)((function(){h({chatId:S,isConfirmed:!0})}),[S,h]),U=(0,a.useCallback)((function(){b({chatId:S})}),[S,b]),z=(0,a.useCallback)((function(){E&&y({chatId:S,device:"audio",enabled:!E.withAudio})}),[S,y,E]),H=(0,a.useCallback)((function(){E&&y({chatId:S,device:"video",enabled:!E.withVideo})}),[S,y,E]),V=(0,a.useCallback)((function(){S&&!P&&"delivered"===(null==m?void 0:m.state)&&g(S)}),[S,P,m,g]),G=(0,a.useCallback)((function(){l(u,"transfer")}),[l,u]),W=Ce(),q=(0,pe.useRescueState)().isEnabled,Y=(0,a.useCallback)((function(){W({type:"chat"})}),[W]);return(0,r.jsxs)("div",{className:"flex size-full items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex h-7 items-center gap-2.5",children:[R&&(0,r.jsx)(Ly,{iconClassName:"icon-fade",isActive:d,onClick:G,tooltip:f.EXTERNAL_CHAT.invite_dialog_label()}),R&&T&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ky,{isActive:!(null==E?void 0:E.withAudio),onClick:z,"data-testid":"webrtc-mute-button","data-muted":!(null==E?void 0:E.withAudio)||void 0}),(0,r.jsx)(j.CircleButton,{isActive:!(null==E?void 0:E.withVideo),onClick:H,tooltip:{content:(null==E?void 0:E.withVideo)?f.CALL_DETAILS_FORM.voip_video_on_tooltip():f.CALL_DETAILS_FORM.voip_video_off_tooltip()},"data-testid":"webrtc-video-button","data-video-active":(null==E?void 0:E.withVideo)||void 0,children:(null==E?void 0:E.withVideo)?(0,r.jsx)(j.IconCamera,{className:"size-4.5 icon-fade"}):(0,r.jsx)(j.IconCameraOff,{className:"size-4.5 icon-fade"})})]}),R&&(0,r.jsxs)(r.Fragment,{children:[A&&(0,r.jsx)(L.CircleButton,{active:P&&"delivered"===(null==m?void 0:m.state),onClick:V,tooltip:f.INTERNAL_CHAT.chat_cobrowsing_button_tooltip(),"data-testid":"request-cobrowsing-button",clickThrottle:500,children:(0,r.jsx)(ve.IconCobrowsing,{})}),q&&!k&&(0,r.jsx)(j.CircleButton,{onClick:Y,tooltip:{content:f.CALL_DETAILS_FORM.button_remote_access_tooltip()},"data-testid":"remote-assist-button",children:(0,r.jsx)(j.IconRemoteAssist,{})}),k&&(0,r.jsx)(NO,{})]})]}),(0,r.jsxs)("div",{className:"flex h-7 items-center",children:[R&&(I||T)&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(j.CircleButton,{className:"mr-2",onClick:T?U:B,tooltip:{content:T?f.CALL_DETAILS_FORM.interaction_endCall():f.EXTERNAL_CHAT.button_start_web_call_tooltip()},disabled:!T&&D,"data-testid":T?"webrtc-end-call-button":"webrtc-call-button",children:T?(0,r.jsx)(j.IconEndWebCall,{className:"size-5"}):(0,r.jsx)(j.IconStartWebCall,{className:"size-5"})}),(0,r.jsx)(j.CircleButton,{disabled:!N,className:"mr-2 h-7 w-12 rounded-xs",onClick:F,tooltip:{content:f.CALL_DETAILS_FORM.voip_start_tooltip()},"data-testid":"call-button",children:(0,r.jsx)(j.IconVoiceInbound,{className:M("size-5",{"icon-disabled":!N})})})]}),(0,r.jsx)(Ry,{isChat:!0,handleCloseClick:o,item:m})]})]})};function nx(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function rx(e){return function(e){if(Array.isArray(e))return nx(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return nx(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return nx(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var ax=(0,L.createComponentLoader)("supervision",(function(){return n.e(205).then(n.t.bind(n,3205,23))}),"AgentSupervisorControls").AgentSupervisorControlsLoader,ox=function(e){var t,n=e.item,o=(0,at.useSessionState)("userId"),i=(0,a.useMemo)((function(){var e=(n.allChatParties||[]).filter((function(e){return e.user_id&&"1"!==e.is_qm&&e.user_id!==o})).map((function(e){return e.user_id||""})),t=(n.allParties||[]).filter((function(e){return e.userId&&"supervisor"!==e.role&&e.userId!==o})).map((function(e){return e.userId||""}));return rx(e).concat(rx(t))}),[n.allChatParties,n.allParties,o]);(0,Er.useSubscribeForUserDetails)(i);var s=null===(t=n.scenarioData)||void 0===t?void 0:t.qmMonitoredItemId;(0,l.assertDefined)(s);var c=(0,Er.useUserDetailsState)((function(e){return i.reduce((function(t,n){var r,a=(null===(r=e.userDetails[n])||void 0===r?void 0:r.data)||{},o=a.userId,i=a.items;return o&&(null==i?void 0:i.length)?(i.forEach((function(e){t[e.id]=o})),t):t}),{})[s]}));return c?(0,r.jsx)(ax,{userId:c,itemId:s}):null},ix=n(3498),sx=function(){var e,t=(0,c.useLocalizationState)("t").GLOBAL,n=(0,ne.useTimezonesState)().localTimezone,r=(0,ot.useCalendarStateMethods)().selectEvent,a=(0,at.useAuthorizedSession)(),o=a.userId,u=a.firstName,d=a.lastName,f=(0,s.useInteractionId)(),m=(0,i.useInteraction)(f),p=(0,fy.useNavigationState)("goTo"),v=(0,gt.useFormatting)().formatFullName,h=(0,X.getContactId)(m),b=(0,st.useContact)(h),g=(0,X.getPhoneFromItem)(m),I=(null==b?void 0:b.data)?null===(e=b.data.nonEmptyPhones)||void 0===e?void 0:e.find((function(e){return e.phone===g})):void 0,S=(null==b?void 0:b.data)?{id:h,first_name:b.data.firstName,last_name:b.data.lastName,create:!1,calendar_phone:I}:void 0,O=v(u,d),x=n.length?n:(0,y.getUserTimezone)();return{onClick:(0,y.useEvent)((function(){var e,t;(0,l.assertDefined)(m);var n,a=(0,l.withoutUndefinedKeys)({_temporaryId:(0,En.uuid)(),startTime:Date.now(),endTime:(n=Date.now(),n+36e5),userId:o,userName:O,number:g,email:m.displayData.email,name:m.displayData.displayName,serviceId:(0,X.getServiceId)(m),serviceName:(0,X.getServiceNameFromItem)(m),globalInteractionId:(0,X.getGlobalInteractionId)(m),screenpopSize:0,listLinkId:null===(e=m.workitemData)||void 0===e?void 0:e.listLinkId,listRecordId:null===(t=m.workitemData)||void 0===t?void 0:t.listRecordId,assignees:[{userId:o,displayText:O,type:"user"}],contacts:S?[S]:[],allDay:!1,completed:!1,remindIn:10,remindInUnit:"MINUTES",timezone:x,title:""});p(fy.AppRoutes.calendar),r(a)})),tooltip:t.button_followUpActivity_tooltip(),"data-testid":"schedule-interaction-event-button",Icon:j.IconAddEvent}};function lx(e,t,n,r,a,o,i){try{var s=e[o](i),l=s.value}catch(c){return void n(c)}s.done?t(l):Promise.resolve(l).then(r,a)}function cx(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){lx(o,r,a,i,s,"next",e)}function s(e){lx(o,r,a,i,s,"throw",e)}i(void 0)}))}}function ux(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(s){o=[6,s],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}function dx(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function fx(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function mx(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function px(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}function vx(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return dx(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return dx(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var hx=function(){var e=(0,c.useLocalizationState)().t,t=(0,a.useRef)(null),n=(0,y.useBoolean)(!1),o=n.value,l=n.toggle;(0,y.useOutsideClick)({ref:t,handler:function(){l(!1)}});var f=(0,a.useCallback)((function(e){o||(e.nativeEvent.stopImmediatePropagation(),l(!0))}),[o,l]),m=function(e){var t,n,r=(0,c.useLocalizationState)().t,o=(0,u.useIntegrationApiStateRef)(),l=(0,u.useIntegrationApiStateMethods)().requestTransferData,d=(0,i.useInteractionStateMethods)().sendScreenPopData,f=(0,ix.usePrerecordedMessagesList)(),m=(0,s.useInteractionId)(),p=(0,i.useInteractions)(),v=(0,i.useInteraction)(m),h=(0,pe.useRescueState)().isEnabled,b=(0,at.useSessionState)(),g=b.tenantFeatures,I=b.privileges,S=(0,Wn.useRemoteAssistStateMethods)().openRemoteAssist,O=(0,Wn.useRemoteAssistState)().items,x=Ce(),C=(0,vn.useIsCommunicator)(),_=(0,X.getServiceId)(v),w=(0,X.getGlobalInteractionId)(v),N=!!(null==g?void 0:g.nativeRemoteAssistEnabled)&&!!I.SYS_USE_REMOTE_ASSIST,A=w?O[w]:void 0,P=!!(null==A?void 0:A.sessionId),E=null==A?void 0:A.pin,D=null==A?void 0:A.sessionId,T=(0,y.useAsRef)(w),k=(0,y.useAsRef)(v),M=(0,y.useAsRef)(E),L=(0,y.useAsRef)(D),R="delivered"===(null==v?void 0:v.state)||"hold"===(null==v?void 0:v.state),F="wrap_up"===(null==v?void 0:v.state)||"wrap_up_hold"===(null==v?void 0:v.state),B=(R||F)&&I.CAN_USE_CALENDAR&&!C,U=sx(),z=(0,a.useCallback)((function(){x({type:"voice"}),e(!1)}),[x,e]),H=(0,a.useCallback)((function(){var e,t,n,r,a,o,i;T.current&&S({globalInteractionId:T.current,popup:!0},{action:"create",giid:T.current,mediaType:(null===(e=k.current)||void 0===e?void 0:e.mediaType)||"unknown",caseId:null===(n=k.current)||void 0===n||null===(t=n.emailData)||void 0===t?void 0:t.caseId,contactId:null===(r=k.current)||void 0===r?void 0:r.contactId,clientFirstName:null===(a=k.current)||void 0===a?void 0:a.displayData.firstName,clientLastName:null===(o=k.current)||void 0===o?void 0:o.displayData.lastName,clientDisplayName:null===(i=k.current)||void 0===i?void 0:i.displayData.displayName})}),[T,k,S]),V=null===(t=(0,X.getMainItem)(p,v))||void 0===t?void 0:t.id,G=(0,X.hasConsultCalls)(v),W=(0,X.isConsultCall)(v),q=null==v?void 0:v.parties,Y=(0,X.isCallConference)(v),K=(0,X.isChatConference)(v),$=!!(null==q?void 0:q.some((function(e){return!!e.userId}))),Q=(0,a.useMemo)((function(){return G||W||Y||K||$}),[G,W,Y,K,$]),Z=(0,a.useCallback)((n=cx((function(e){var t;return ux(this,(function(n){switch(n.label){case 0:if(!V||!e.length)return[3,5];if(t={},!o.current.isAvailable)return[3,4];n.label=1;case 1:return n.trys.push([1,3,,4]),[4,l(V)];case 2:return t=n.sent(),[3,4];case 3:return n.sent(),[3,4];case 4:e.forEach((function(e){var n=e.userItemId,r=e.userId;return d({targetItemId:V,userId:r,userItemId:n,customData:t,raSessionPin:M.current,raSessionId:L.current})})),n.label=5;case 5:return[2]}}))})),function(e){return n.apply(this,arguments)}),[V,o,d,l,M,L]),J=(0,a.useCallback)(cx((function(){var t;return ux(this,(function(n){switch(n.label){case 0:return e(!1),v?(t=null,Y||K||W||$?v.parties&&(t=v.parties.filter((function(e){var t=e.theirItemId,n=e.userId;return t&&n})).map((function(e){return{userItemId:e.theirItemId,userId:e.userId}})).filter((function(e){return!!e.userId}))):G&&(t=v.displayData.hasConsultCalls.flatMap((function(e){var t;return null===(t=p.find((function(t){return t.id===e})))||void 0===t?void 0:t.parties})).filter((function(e){return(null==e?void 0:e.theirItemId)&&(null==e?void 0:e.userId)})).map((function(e){return{userItemId:e.theirItemId,userId:e.userId}}))),t?[4,Z(t)]:[3,2]):[3,2];case 1:n.sent(),n.label=2;case 2:return[2]}}))})),[e,v,Y,K,W,$,G,p,Z]);return(0,a.useMemo)((function(){var e=[];return N?e.push({className:ng,onClick:H,tooltip:r.INTERNAL_CHAT.chat_remote_assist(),active:!1,Icon:j.IconRemoteAssist,"data-testid":"remote-assist-button",disabled:P}):h&&e.push({className:ng,onClick:z,tooltip:r.CALL_DETAILS_FORM.button_remote_access_tooltip(),active:!1,Icon:j.IconRemoteAssist,"data-testid":"remote-assist-button"}),Q&&e.push({tooltip:r.CALL_DETAILS_FORM.interaction_sendScreen_tooltip(),active:!1,onClick:J,Icon:j.IconScreenshare,"data-testid":"send-screen-button"}),B&&e.push(U),e}),[U,B,_,N,h,f.length,Q,H,r.INTERNAL_CHAT,r.CALL_DETAILS_FORM,r.PLAY_CANNED_PROMPTS_DIALOG_BOX,P,z,J])}(l);if(!m.length)return null;if(1===m.length){var p=vx(m,1)[0],v=p.Icon,h=p.tooltip,b=px(m[0],["Icon","tooltip"]);return(0,r.jsx)(j.CircleButton,mx(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){fx(e,t,n[t])}))}return e}({},b),{tooltip:{content:h},children:v&&(0,r.jsx)(v,{className:"flex size-4 items-center justify-center"})}))}return(0,r.jsxs)("div",{ref:t,children:[(0,r.jsx)(j.CircleButton,{isActive:o,tooltip:{content:e.GLOBAL.show_more()},onMouseDown:f,"data-testid":"show-more-button",children:(0,r.jsx)(j.IconMore,{className:"icon-fade"})}),(0,r.jsx)("div",{children:o&&(0,r.jsx)(d.SmList,{className:"absolute z-[200] min-w-[168px] rounded border border-main-border bg-white",verticalAlign:"middle","data-testid":"more-buttons-list",children:m.map((function(e){var t=e.Icon;return(0,r.jsxs)(d.SmList.Item,{as:"button","data-testid":e["data-testid"],"aria-label":e.tooltip,className:M("relative flex h-[37px] cursor-pointer items-center bg-transparent","w-full gap-x-2 border-none px-3 py-2.5 text-primary-on-primary hover:bg-menu-bg-hover"),onClick:e.onClick,disabled:e.disabled,children:[t&&(0,r.jsx)(t,{className:"size-4"}),(0,r.jsx)(d.SmList.Content,{className:"caption-s",children:e.tooltip})]},e["data-testid"])}))})})]})},bx=function(e){var t,n=e.onClose,o=(0,c.useLocalizationState)().t,l=(0,s.useInteractionId)(),u=(0,it.useOpenInteractionSlidingModal)(),d=(0,it.useShowSlidingModalChecker)(l,"transfer"),f=(0,it.useShowSlidingModalChecker)(l,"keypad"),m=(0,at.useSessionState)().phoneDeviceCapabilities,p=(0,i.useInteraction)(l),v=null==p?void 0:p.isConferenceHost,h=(0,te.useCallButtonsHandlers)(),b=h.showRecordButton,y=h.isCallEstablished,g=h.isMuted,I=h.isRecording,S=h.isOnHold,O=h.isRecordingMuted,x=h.isCallConference,C=h.isLoading,_=h.handleHoldClick,w=h.handleMuteClick,N=h.handleMergeClick,A=h.handleTransferClick,P=h.handleLeaveConference,E=h.handleRecordClick,D=(0,a.useCallback)((function(){u(l,"transfer")}),[l,u]),T=(0,a.useCallback)((function(){u(l,"keypad")}),[l,u]),k=x&&v||(0,X.showMergeButton)(p)||(0,X.showTransferButton)(p),M=!y||(S?!m.canRetrieve:!m.canHold),L="delivered"===(null==p?void 0:p.state)||"hold"===(null==p?void 0:p.state);return(0,r.jsxs)("div",{className:"flex flex-auto items-center justify-between",children:[(0,r.jsxs)("div",{className:"flex items-center gap-2.5",children:[L&&(0,r.jsx)(Ey,{iconClassName:"icon-fade",isActive:S,isLoading:C.onHold,onClick:_,holdStartTime:null==p||null===(t=p.displayData)||void 0===t?void 0:t.holdStartTime,disabled:M}),L&&b&&(0,r.jsx)(My,{isLoading:C.recording,isActive:I,onClick:E,disabled:!y||S||O,"data-testid":"call-recording-button","data-recording-active":I||void 0}),L&&(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(ky,{isActive:g,isLoading:C.muted,onClick:w,disabled:!y}),(0,r.jsx)(Ly,{isActive:d,onClick:D,iconClassName:"icon-fade"})]}),L&&k&&(0,r.jsxs)(r.Fragment,{children:[(0,X.showMergeButton)(p)&&(0,r.jsx)(j.CircleButton,{onClick:N,tooltip:{content:o.CALL_DETAILS_FORM.interaction_merge()},"data-testid":"merge-button",children:(0,r.jsx)(j.IconMerge,{className:"size-4.5 icon-fade"})}),(0,X.showTransferButton)(p)&&(0,r.jsx)(j.CircleButton,{onClick:A,tooltip:{content:o.CALL_DETAILS_FORM.interaction_complete()},"data-testid":"complete-transfer-button",children:(0,r.jsx)(j.IconCompleteTransferFilled,{className:"size-4.5 icon-fade"})})]}),L&&(0,r.jsx)(hx,{})]}),(0,r.jsxs)("div",{className:"flex h-7 items-center gap-2",children:[(0,r.jsx)(j.CircleButton,{tooltip:{content:o.ADDRESS_BOOK_AREA.addressBook_dial()},isActive:f,onClick:T,"data-testid":"show-dialpad-button",className:"h-7 w-12 rounded-xs",children:(0,r.jsx)(j.IconDialpad,{className:"icon-fade"})}),x&&v&&(0,r.jsx)(j.CircleButton,{onClick:P,tooltip:{content:o.CALL_DETAILS_FORM.interaction_leaveConference()},"data-testid":"leave-conference-button",className:"h-7 w-12 rounded-xs",children:(0,r.jsx)(j.IconLeave,{className:"size-5 icon-error"})}),(0,r.jsx)(Ry,{isDestructive:!0,item:p,handleCloseClick:n,renderIcon:!v&&x?function(){return(0,r.jsx)(j.IconLeave,{className:"size-5 [&_path]:stroke-neutral-0"})}:void 0})]})]})};var yx=function(e){var t=e.onClose,n=(0,c.useLocalizationState)("t"),a=(0,s.useInteractionId)(),o=(0,i.useInteraction)(a),u=(0,i.useInteractionStateMethods)().setDisposition,d=(0,te.useSystemDisposition)("skipped"),f=sx(),m=(0,y.useEvent)((function(e){d&&a&&u({itemId:a,disposition:d}),t(e,d||void 0)}));return(0,l.assertDefined)(o),(0,r.jsxs)("div",{className:"flex flex-auto items-center justify-between",children:[(0,r.jsx)("div",{className:"flex items-center gap-2.5",children:(0,r.jsx)(j.CircleButton,{"data-testid":f["data-testid"],tooltip:{content:f.tooltip},onClick:f.onClick,children:(0,r.jsx)(f.Icon,{className:"size-4.5 icon-fade"})})}),(0,r.jsxs)("div",{className:"flex items-center gap-2",children:[(0,r.jsx)(_e.Button,{variant:"secondary",size:"sm",onClick:t,className:"h-7","data-testid":"complete-button",children:n.CALL_DETAILS_FORM.interaction_completeACW()}),!!d&&(0,r.jsx)(_e.Button,{variant:"secondary",size:"sm",onClick:m,className:"h-7 text-on-error","data-testid":"skip-workitem-button",children:n.CALL_DETAILS_FORM.interaction_endWorkItem()})]})]})};function gx(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function jx(e){return function(e){if(Array.isArray(e))return gx(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return gx(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return gx(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Ix=(0,Hg.w0)({selectedMessage:void 0,messagesOrder:[]},(function(e,t){switch(t.type){case"selectMessage":return t.payload.selectedMessage===e.selectedMessage?e:{selectedMessage:t.payload.selectedMessage,messagesOrder:[t.payload.selectedMessage.id].concat(jx(e.messagesOrder.filter((function(e){return e!==t.payload.selectedMessage.id}))))};case"revalidateMessages":var n=t.payload.existingMessages.reduce((function(e,t){return e[t.id]=t,e}),{}),r=t.payload.existingMessages.filter((function(t){return!e.messagesOrder.includes(t.id)})).map((function(e){return e.id})),a=jx(e.messagesOrder.filter((function(e){return n[e]}))).concat(jx(r));return{selectedMessage:e.selectedMessage&&n[e.selectedMessage.id]?e.selectedMessage:t.payload.existingMessages[0],messagesOrder:a}}})),Sx=((0,Hg.kv)(Ix,(function(e){return e.selectedMessage})),(0,Hg.kv)(Ix,(function(e){return e.messagesOrder})),(0,Ta.atom)(void 0)),Ox=function(e){var t=e.prompt,n=e.selected,a=e.onClick;return(0,r.jsx)("li",{"data-selected":n,className:M("group","text-primary-on-primary","truncate","hover:state-layer-mix-dark-on-white-1","focus:state-layer-mix-dark-on-white-1","transition-colors","state-layer-bg-main-bg","data-[selected=true]:state-layer-mix-teal-on-white-1","data-[selected=true]:hover:state-layer-mix-teal-on-white-2","data-[selected=true]:focus:state-layer-mix-teal-on-white-2"),children:(0,r.jsxs)("button",{className:"flex w-full items-center justify-between gap-2 px-4 py-3 leading-[24px]",onClick:function(){return a(t)},children:[t.name,(0,r.jsx)(j.IconCheck24,{className:"hidden group-data-[selected=true]:block"})]})})};function xx(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Cx(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return xx(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return xx(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var _x=function(){var e=(0,c.useLocalizationState)().t,t=(0,s.useInteractionId)(),n=(0,i.useInteractionProp)(t,X.getServiceId),o=(0,ix.usePrerecordedMessagesState)(),l=o.list,u=o.serviceMessages,d=(0,ix.usePrerecordedMessagesStateMethods)().getServiceMessages;(0,a.useEffect)((function(){n&&d(n)}),[d,n]);var f=n?u[n]:void 0,m=Cx((0,Ta.useAtom)(Sx),2),p=m[0],v=m[1],h=M("p-4 uppercase caption-s text-neutral-disabled");return(0,a.useEffect)((function(){p||v((null==f?void 0:f[0])||l[0])}),[f,l,p,n,u,v]),(null==f?void 0:f.length)&&l.length?(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("h2",{className:h,children:e.PLAY_CANNED_PROMPTS_DIALOG_BOX.canned_prompts()}),(0,r.jsx)("ul",{children:f.map((function(e){return(0,r.jsx)(Ox,{selected:(null==p?void 0:p.id)===e.id,onClick:v,prompt:e},e.id)}))}),(0,r.jsx)("h2",{className:h,children:e.PLAY_CANNED_PROMPTS_DIALOG_BOX.custom_prompts()}),(0,r.jsx)("ul",{children:l.map((function(e){return(0,r.jsx)(Ox,{selected:(null==p?void 0:p.id)===e.id,onClick:v,prompt:e},e.id)}))})]}):(null==f?void 0:f.length)?(0,r.jsx)("ul",{children:f.map((function(e){return(0,r.jsx)(Ox,{selected:(null==p?void 0:p.id)===e.id,onClick:v,prompt:e},e.id)}))}):(0,r.jsx)("ul",{children:l.map((function(e){return(0,r.jsx)(Ox,{selected:(null==p?void 0:p.id)===e.id,onClick:v,prompt:e},e.id)}))})};function wx(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Nx(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Ax(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var Px=function(e){var t,n=function(){return d&&d.id===v},a=function(){if((0,l.assertDefined)(d),!n())return I({type:"selectMessage",payload:{selectedMessage:d}}),v?g({itemId:m,interactionStepId:p,promptId:d.id}):b({itemId:m,interactionStepId:p,promptId:d.id});y(p)},o=e.onClose,u=Ax(e,["onClose"]),d=(0,Ta.useAtomValue)(Sx),f=(0,c.useLocalizationState)("t"),m=(0,s.useInteractionId)(),p=(0,i.useInteractionProp)(m,X.getInteractionStepId),v=null===(t=(0,ix.usePrerecordedMessagesState)("playingPrompts")[p])||void 0===t?void 0:t.promptId,h=(0,ix.usePrerecordedMessagesStateMethods)(),b=h.playPrompt,y=h.stopPlayingPrompt,g=h.stopAndPlayPrompt,I=(0,Ta.useSetAtom)(Ix);return(0,r.jsxs)(j.Modal,Nx(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){wx(e,t,n[t])}))}return e}({},u),{onClose:o,children:[(0,r.jsx)(j.Modal.Header,{children:f.VOICE_CALL.prerecorded_messages()}),(0,r.jsx)(j.Modal.Content,{className:"px-3 pt-0 [&_ul]:m-0 [&_ul]:p-0",children:(0,r.jsx)(_x,{})}),(0,r.jsxs)(j.Modal.Actions,{children:[(0,r.jsx)(_e.Button,{variant:"ghost",onClick:function(){return o()},children:f.GLOBAL.cancel()}),!v&&(0,r.jsx)(_e.Button,{variant:"secondary",onClick:(0,$.flow)(a,o),children:f.VOICE_CALL.prerecorded_messages_play_and_leave()}),(0,r.jsx)(_e.Button,{onClick:a,variant:"primary",children:n()?f.GLOBAL.stop():f.GLOBAL.play()})]})]}))};function Ex(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Dx(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||kx(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function Tx(e){return function(e){if(Array.isArray(e))return Ex(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||kx(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function kx(e,t){if(e){if("string"==typeof e)return Ex(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);return"Object"===n&&e.constructor&&(n=e.constructor.name),"Map"===n||"Set"===n?Array.from(n):"Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n)?Ex(e,t):void 0}}var Mx=function(){var e=(0,c.useLocalizationState)().t,t=(0,s.useInteractionId)(),n=(0,i.useInteractionProp)(t,X.getInteractionStepId),o=(0,i.useInteractionProp)(t,X.getServiceId),u=(0,ix.usePrerecordedMessagesState)(),d=u.list,f=u.serviceMessages,m=u.isLoading,p=u.playingPrompts,v=(0,ix.usePrerecordedMessagesStateMethods)(),h=v.playPrompt,b=v.stopPlayingPrompt,g=v.getServiceMessages,I=Dx((0,Ta.useAtom)(Ix),2),S=I[0],O=S.selectedMessage,x=S.messagesOrder,C=I[1],_=(0,a.useCallback)((function(e){var t;return e.id===(null===(t=p[n])||void 0===t?void 0:t.promptId)}),[n,p]),w=(0,a.useCallback)((function(){(0,l.assertDefined)(null==O?void 0:O.id),(0,l.assertDefined)(t),_(O)?b(n):h({itemId:t,interactionStepId:n,promptId:null==O?void 0:O.id})}),[t,n,_,h,O,b]),N=(0,a.useMemo)((function(){return Tx(d).concat(Tx(o&&f[o]||[]))}),[d,o,f]);(0,a.useEffect)((function(){m||!N.length||O||C({type:"revalidateMessages",payload:{existingMessages:N}})}),[C,N,m,O]),(0,a.useEffect)((function(){o&&g(o)}),[g,o]);var A=(0,y.useBoolean)();(0,y.useEscapeManager)(A.setFalse,{enabled:A.value});var P=(0,ie.useModalComponentOpener)(Px);if(!O)return null;var E,D,T,k=(E=N,D=x,T=new Map(D.map((function(e,t){return[e,t]}))),(0,$.sortBy)(E,(function(e){return T.get(e.id)}))).slice(0,4);return(0,r.jsxs)("div",{className:"flex items-center gap-2 pb-1 pt-2",children:[(0,r.jsx)(j.CircleButton,{disabled:!O.id,onClick:w,children:_(O)?(0,r.jsx)(j.IconStop16,{className:"size-4.5"}):(0,r.jsx)(j.IconPlay16,{className:"size-4.5"})}),(0,r.jsx)(j.ButtonDropdown,{open:A.value,onOpenChange:A.toggle,align:"start",contentClassName:"min-w-[232px]",options:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(j.ButtonDropdown.Label,{className:"font-semibold caption-s text-neutral-on-secondary",children:e.VOICE_CALL.prerecorded_messages_recents()}),k.map((function(e){var t=O.id===e.id;return(0,r.jsx)(j.ButtonDropdown.Item,{"data-selected":t,"aria-selected":t,onClick:function(){return C({type:"selectMessage",payload:{selectedMessage:e}})},children:e.name},e.id)})),N.length>k.length&&(0,r.jsx)(j.ButtonDropdown.Item,{className:"border-t py-4 border-default",onClick:function(){return P()},children:e.VOICE_CALL.prerecorded_messages_more_messages()})]}),button:{className:"h-7 px-2.5",tooltip:e.VOICE_CALL.prerecorded_messages(),variant:"ghost"},chevronClassName:"-ml-1",children:O.name})]})},Lx=o().memo((function(){var e=(0,s.useInteractionId)(),t=(0,i.useInteraction)(e),n=(0,Jt.useDisconnectButtonClickHandler)(),o=(0,a.useCallback)((function(e){return n(t,{event:e})}),[n,t]);return(0,X.isNeedToShowWorkitemUI)(t)?(0,r.jsx)("div",{className:"flex items-center px-4 py-2",children:(0,r.jsx)(yx,{onClose:o})}):(0,r.jsxs)("div",{className:"flex flex-col px-4",children:[(0,X.isCall)(t)&&(0,r.jsx)(Mx,{}),(0,r.jsxs)("div",{className:"flex flex-auto items-center py-2",children:[(0,X.isExternalChat)(t)&&(0,r.jsx)(tx,{onClose:o}),(0,X.isCall)(t)&&(0,r.jsx)(bx,{onClose:o})]}),(0,X.isQualityManagementItem)(t)&&(0,r.jsx)(ox,{item:t})]})})),Rx=n(6552);function Fx(e,t,n,r,a,o,i){try{var s=e[o](i),l=s.value}catch(c){return void n(c)}s.done?t(l):Promise.resolve(l).then(r,a)}function Bx(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){Fx(o,r,a,i,s,"next",e)}function s(e){Fx(o,r,a,i,s,"throw",e)}i(void 0)}))}}function Ux(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(s){o=[6,s],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}const zx="communicator_InteractionVideoWarning_interactionVideoWarning_oOaDY",Hx="communicator_InteractionVideoWarning_interactionVideoWarningItem_0ZfCp";function Vx(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Gx(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return Vx(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Vx(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Wx=function(e){var t,n=e.localStream,o=(0,c.useLocalizationState)().t,i=Gx((0,a.useState)(!1),2),s=i[0],l=i[1],u=Gx((0,a.useState)(!1),2),d=u[0],f=u[1],m=(0,a.useRef)((0,$.debounce)((function(){l(!1)}),2e3)).current,p=(0,a.useRef)((0,$.debounce)((function(){f(!1)}),2e3)).current,v=(0,a.useCallback)((function(e){"mic"===e&&(l(!0),m()),"performance"===e&&(f(!0),p())}),[m,p]),h=(t=(0,a.useRef)(0),(0,a.useEffect)((function(){var e=!1;function n(){return(n=Bx((function(){var n;return Ux(this,(function(r){return n=function(){return new Promise((function(r){setTimeout((function(){t.current++,r(t.current),e||n()}))}))},t.current=0,n(),[2]}))}))).apply(this,arguments)}return function(){n.apply(this,arguments)}(),function(){e=!0}}),[]),(0,a.useCallback)((function(){var e=t.current;return t.current=0,e}),[]));return(0,a.useEffect)((function(){var e=null==n?void 0:n.getAudioTracks()[0],t=setInterval((function(){!(null==e?void 0:e.muted)&&(null==e?void 0:e.enabled)&&"ended"!==e.readyState||v("mic"),h()<100&&v("performance")}),1e3);return function(){clearInterval(t)}}),[h,n,v]),(0,r.jsxs)("div",{className:zx,children:[s&&(0,r.jsx)("div",{className:Hx,children:o.ERROR_MESSAGES.microphone_muted()}),d&&(0,r.jsx)("div",{className:Hx,children:o.ERROR_MESSAGES.low_cpu()})]})},qx=function(e,t){var n=e.current;return n&&t&&(n.srcObject=t),function(){return n&&n.removeAttribute("srcObject")}},Yx=o().memo((function(){var e=(0,Rx.useWebRtcState)().streams,t=(0,s.useInteractionId)(),n=(0,i.useAssociatedChatInteractionProp)(t,X.getInteractionStepId),o=(0,Yt.useInteractionChatDataSelector)(n,(function(e){return null==e?void 0:e.call}))||{},l=o.localStreamId,c=o.remoteStreamId,u=(0,a.useRef)(null),d=(0,a.useRef)(null),f=l?e[l]:void 0,m=c?e[c]:void 0;return(0,a.useEffect)((function(){return qx(d,f)}),[f]),(0,a.useEffect)((function(){return qx(u,m)}),[m]),(0,r.jsxs)("div",{className:M(Jy,"px-4"),children:[(0,r.jsx)("div",{className:eg,children:(0,r.jsx)("video",{ref:u,controls:!1,playsInline:!0,autoPlay:!0})}),(0,r.jsx)("div",{className:tg,children:(0,r.jsx)("video",{ref:d,controls:!1,playsInline:!0,autoPlay:!0,muted:!0})}),(0,r.jsx)(Wx,{localStream:f})]})})),Kx=o().memo((function(){var e=(0,s.useInteractionId)(),t=(0,i.useAssociatedChatInteractionProp)(e,X.getInteractionStepId),n=(0,Yt.useInteractionChatDataSelector)(t,(function(e){var t,n;return!!(null==e||null===(t=e.call)||void 0===t?void 0:t.localStreamId)||!!(null==e||null===(n=e.call)||void 0===n?void 0:n.remoteStreamId)}));return function(){var e=(0,te.useContactActivityHistory)().getMessages,t=(0,i.useInteractionStateMethods)().clearRemovedAssociatedItem,n=(0,s.useInteractionId)(),r=(0,x.useInteractionUIChatType)(n),o=(0,i.useInteractionProp)(n,X.getContactId),l=(0,y.useAsRef)((0,st.useActivityHistoryByContactId)(o)),c=(0,i.useInteractionProp)(n,(function(e){return!!(null==e?void 0:e.removedAssociatedItemId)})),u=(0,y.useAsRef)(r),d=(0,y.useAsRef)(o),f=(0,y.useAsRef)(c),m=(0,a.useCallback)((function(){e({contactId:d.current,type:u.current,checkForLatestMessages:!0}).catch((function(e){un.bpLogger.error(e||"Error while trying to load new messages")}))}),[d,e,u]);(0,a.useEffect)((function(){var e=l.current||{},r=e.isLoading,a=e.messages;!r&&o&&(null==a?void 0:a.length)&&n&&(f.current?setTimeout((function(){t(n),m()}),3e3):m())}),[o,n,m,t,f,l])}(),(0,r.jsxs)("div",{className:"flex flex-col","data-testid":"interaction-header",children:[(0,r.jsx)(xO,{}),(0,r.jsx)(ex,{}),(0,r.jsx)(Lx,{}),n&&(0,r.jsx)(Yx,{})]})}));function $x(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Xx(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}var Qx=function(){var e=(0,c.useLocalizationState)().t,t=(0,s.useInteractionId)(),n=(0,x.useInteractionUIItemStateSetter)(),o=(0,a.useCallback)((function(){n(t,(function(e){return Xx(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){$x(e,t,n[t])}))}return e}({},e),{chatView:"embedded"})}))}),[t,n]);return(0,r.jsx)(r.Fragment,{children:(0,r.jsxs)("div",{className:sg,children:[(0,r.jsx)("p",{className:lg,children:e.INTERNAL_CHAT.chat_in_popup_message()}),(0,r.jsx)(L.Button,{linkLike:!0,onClick:o,children:e.INTERNAL_CHAT.unpin()})]})})};function Zx(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Jx(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Zx(e,t,n[t])}))}return e}function eC(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function tC(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function nC(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function rC(e){var t=(0,s.useInteractionId)(),n=(0,i.useInteractionProp)(t,(function(e){return!!(null==e?void 0:e.voiceTranscript)||!!(null==e?void 0:e.botSuggestions)})),r=(0,y.usePrevious)(n),o=(0,x.useInteractionUIItemStateSetter)();(0,a.useEffect)((function(){!r&&n&&o(e,(function(e){return nC(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){tC(e,t,n[t])}))}return e}({},e),{activeTab:"transcript"})}))}),[e,n,o,r])}function aC(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function oC(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function iC(e){var t,n=(0,yo.useNavigationState)(),r=n.activePage,o=n.removePageParam,i=(0,x.useInteractionUIItemStateSetter)();(0,a.useEffect)((function(){var t,n=null==r||null===(t=r.params)||void 0===t?void 0:t.currentTab;n&&e&&(i(e,(function(e){return oC(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){aC(e,t,n[t])}))}return e}({},e),{activeTab:n})})),o("currentTab"))}),[e,null==r||null===(t=r.params)||void 0===t?void 0:t.currentTab,i,o])}var sC=M("min-w-0 flex-auto grow-0 px-2.5"),lC=["transcript","all","calls","messages","workitemContacts","workitemDetails","workitemHistory","crm","resolution"];function cC(){var e=(0,s.useInteractionId)();(0,x.useAvailableInteractionTabsController)(e);var t=(0,c.useLocalizationState)().t,n=(0,x.useInteractionUIAvailableTabs)(e),o=function(e){var t=(0,at.useSessionState)().serverOrigin,n=(0,s.useInteractionId)(),o=(0,i.useInteractionProp)(n,X.getInteractionStepId),l=e.HOME_SCREEN.interaction_tab_label_transcript(),c=(0,a.useCallback)((function(e){e.stopPropagation();var n=new URLSearchParams({interactionStepId:o});window.open("".concat(t,"/agent/voice-transcript-app?").concat(n.toString()))}),[t,o]);return(0,a.useMemo)((function(){return{content:(0,r.jsxs)("div",{className:"flex min-w-0 flex-auto items-center",children:[(0,r.jsx)("span",{className:"flex-auto truncate",children:l}),(0,r.jsx)(L.Button,{transparent:!0,className:"group ml-4",onClick:c,children:(0,r.jsx)(ve.IconOpenDetached,{className:"transition-all duration-300 group-hover:[&_g]:stroke-primary-legacy group-hover:[&_path]:fill-primary-legacy"})})]}),title:l,id:"transcript"}}),[l,c])}(t),l=function(e){var t=e.HOME_SCREEN.interaction_tab_label_all_interactions();return(0,a.useMemo)((function(){return{content:(0,r.jsx)("span",{className:"truncate",children:t}),id:"all",title:t}}),[t])}(t),u=function(e){var t=e.HOME_SCREEN.interaction_tab_label_calls();return(0,a.useMemo)((function(){return{content:(0,r.jsx)("span",{className:"truncate",children:t}),id:"calls",title:t}}),[t])}(t),d=function(e){var t=e.HOME_SCREEN.interaction_tab_label_messages();return(0,a.useMemo)((function(){return{content:(0,r.jsx)("span",{className:"truncate",children:t}),id:"messages",title:t}}),[t])}(t),f=function(e){var t=e.HOME_SCREEN.interaction_tab_label_crm();return(0,a.useMemo)((function(){return{content:(0,r.jsx)("span",{className:"truncate",children:t}),id:"crm",title:t,className:M(sC,"ml-auto")}}),[t])}(t),m=function(e){var t=e.HOME_SCREEN.interaction_tab_workitem_contacts();return(0,a.useMemo)((function(){return{content:(0,r.jsx)("span",{className:"truncate",children:t}),id:"workitemContacts",title:t}}),[t])}(t),p=function(e){var t=e.HOME_SCREEN.interaction_tab_workitem_details();return(0,a.useMemo)((function(){return{content:(0,r.jsx)("span",{className:"truncate",children:t}),id:"workitemDetails",title:t}}),[t])}(t),v=function(e){var t=e.HOME_SCREEN.interaction_tab_workitem_history();return(0,a.useMemo)((function(){return{content:(0,r.jsx)("span",{className:"truncate",children:t}),id:"workitemHistory",title:t}}),[t])}(t),h=function(e){var t=e.HOME_SCREEN.interaction_tab_label_resolution();return(0,a.useMemo)((function(){return{content:(0,r.jsx)("span",{className:"truncate",children:t}),id:"resolution",title:t,className:M(sC,"ml-auto")}}),[t])}(t),b=(0,a.useMemo)((function(){return{transcript:o,all:l,calls:u,messages:d,crm:f,workitemContacts:m,workitemDetails:p,workitemHistory:v,resolution:h}}),[o,l,u,d,f,m,p,v,h]);return(0,a.useMemo)((function(){return lC.reduce((function(e,t){return n[t]&&e.push(b[t]),e}),[])}),[n,b])}var uC=n(8421),dC=function(e){var t=e.number,n=e.label,a=e.suggested,o=e.disabled,u=(0,c.useLocalizationState)("t").CALL_DETAILS_FORM,d=(0,s.useInteractionId)();(0,l.assertDefined)(d);var f=(0,i.useInteractionStateMethods)().dialWorkitem,m=(0,rt.formatPhone)(t),p=(0,uC.useTimerById)("workitemAutoDial/".concat(d)),v=(0,y.useTimer)(null==p?void 0:p.endTime,{countdown:!0,format:y.cutMilliseconds}),h=(0,r.jsxs)("div",{children:[a&&(0,r.jsx)("span",{className:"absolute left-[5px] top-4.5 size-1.5 rounded-full bg-warning"}),(0,r.jsx)("span",{className:"font-semibold body text-primary-on-primary",children:n})]}),b=(0,r.jsx)("span",{"data-testid":"phone",className:"body text-neutral-on-secondary",children:m}),g=a&&v?(0,r.jsx)("div",{className:"h-5 rounded bg-teal-on-white-1 px-2",children:(0,r.jsx)("span",{className:"font-semibold caption-s text-primary-on-primary",children:u.workitem_auto_dial_message_text(String(null!=v?v:0))})}):null,j=(0,y.useEvent)((function(){f({workitemItemId:d,phoneNumber:t})}));return(0,r.jsx)(yc.ContactListItem,{as:L.SelectionItem,title:h,titleRight:g,body:b,onClick:j,disabled:o,tooltip:o?void 0:u.workitem_phone_number_call_tooltip(),containerProps:{focusOnSelection:!0,touchedOnly:!0,"data-testid":"phone-number-item","data-disabled":o||void 0,"data-suggested":a||void 0}})};function fC(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var mC=function(){var e,t,n=(e=(0,s.useInteractionId)(),t=(0,i.useInteractionProp)(e,(function(e){return null==e?void 0:e.workitemData})),(0,l.assertDefined)(t),(0,a.useMemo)((function(){return t.contactInfo.addresses.filter((function(e){return"phone"===e.type})).map((function(e){return{number:e.value,label:e.label,suggested:e.value===t.suggestedPhone,disabled:"yes"!==e.allowed}}))}),[t.contactInfo.addresses,t.suggestedPhone]));return(0,r.jsx)(L.SelectionContainer,{className:"scrollbar-on-hover mx-4 mt-2 overflow-auto",children:(0,r.jsx)("div",{className:"bg-primary-background",children:n.map((function(e){return(0,r.jsx)(dC,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){fC(e,t,n[t])}))}return e}({},e),e.number)}))})})},pC=function(){var e=(0,s.useInteractionId)(),t=(0,i.useInteractionProp)(e,(function(e){return null==e?void 0:e.workitemData}));(0,l.assertDefined)(t);var n=t.contactInfo.fullInfo;return(0,r.jsx)("div",{className:"scrollbar-on-hover m-4 mt-2 overflow-auto",children:n.map((function(e){var t=e.name,n=e.value;return(0,r.jsxs)("div",{className:"flex gap-6 border-b px-1 py-4 bg-primary-background border-disabled",children:[(0,r.jsx)("div",{className:"line-clamp-[13] w-[120px] shrink-0 font-semibold body text-primary-on-primary",children:t}),(0,r.jsx)("div",{className:"line-clamp-[13] grow body text-primary-on-primary",children:n})]},t)}))})},vC=function(){var e=(0,c.useLocalizationState)("t").ACTIVITY_HISTORY;return(0,r.jsxs)("div",{className:"flex h-full flex-col items-center justify-center gap-2.5",children:[(0,r.jsx)("div",{className:"heading-m text-neutral-on-secondary",children:e.empty_activity_message_title()}),(0,r.jsx)("div",{className:"body-m text-neutral-fade",children:e.empty_activity_message_description()})]})};var hC=function(){var e,t=(0,c.useLocalizationState)("t").CALL_DETAILS_FORM,n=(0,s.useInteractionId)(),a=(0,i.useInteractionProp)(n,X.getContactId),o=(0,x.useInteractionUIChatType)(n),u=(0,x.useInteractionUIItemStateSetter)(),d=!(null===(e=(0,st.useContactsState)("activityHistory")[a])||void 0===e?void 0:e.messages.length),f={all:t.workitem_history_filter_all(),calls:t.workitem_history_filter_calls(),messages:t.workitem_history_filter_messages()},m=(0,y.useEvent)((function(e){var t=e.currentTarget.dataset.value;t&&(!function(e){if(!(0,l.array)(x.activityFilters).includes(e))throw Error('"assertFilterType" failed: '.concat(e," is not filter type"))}(t),u(n,E()((function(e){e.activityFilter=t}))))}));return d?(0,r.jsx)(vC,{}):(0,r.jsxs)("div",{className:"flex h-full flex-col overflow-hidden",children:[(0,r.jsx)("div",{className:"flex gap-2 px-4 py-2 shadow-2 bg-primary-background",children:x.activityFilters.map((function(e){return(0,r.jsx)(j.Chip,{variant:"interactive","data-value":e,active:e===o,onClick:m,children:f[e]},e)}))}),(0,r.jsx)(Hl,{itemId:n})]})},bC=o().memo(o().forwardRef((function(e,t){var n=e.activeTab,a=e.activeChatId,o=function(){switch(n){case"transcript":case"all":case"calls":case"messages":return(0,r.jsx)(Gl,{itemId:a,scope:"communicator"});case"crm":return(0,r.jsx)(h,{});case"resolution":return(0,r.jsx)(zt,{className:"px-4"});case"workitemContacts":return(0,r.jsx)(mC,{});case"workitemDetails":return(0,r.jsx)(pC,{});case"workitemHistory":return(0,r.jsx)(hC,{})}}();return(0,r.jsx)("div",{ref:t,className:"flex h-0 flex-auto flex-col overflow-auto p-0","data-testid":"interaction-body",children:o})})));function yC(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function gC(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){yC(e,t,n[t])}))}return e}function jC(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}var IC=o().memo((function(){var e=cC(),t=(0,x.useInteractionUIItemStateSetter)(),n=(0,s.useInteractionId)(),o=(0,i.useAssociatedChatInteractionId)(n);(0,l.assertDefined)(o);var c=(0,x.useInteractionUIActiveTab)(o);iC(o),rC(o),function(e){var t=(0,s.useInteractionId)(),n=(0,I.useNotificationsState)().notifications,r=(0,i.useInteractionProp)(t,X.isAfterCallWork),o=(0,i.useInteractionStateMethods)().activateItem;(0,a.useEffect)((function(){r&&e(t,(function(e){return eC(Jx({},e),{activeTab:"resolution"})}))}),[t,r,e]);var l=n[I.Notifications.DispositionNotSelectedError],c=(0,vn.useIsCommunicator)(),u=(0,y.useAsRef)(t),d=(0,Gr.useCommunicatorUIState)((function(e){return e.setFloatingState}));(0,a.useEffect)((function(){l&&(c||d((function(e){return"closed"===e?"floating":e})),l.interactionId&&u.current!==l.interactionId&&o(l.interactionId),e(u.current,(function(e){return eC(Jx({},e),{activeTab:"resolution"})})))}),[c,d,o,l,u,e])}(t);var u=(0,a.useCallback)((function(e){t(o,(function(t){return jC(gC({},t),{activeTab:e})}))}),[o,t]);return(0,a.useEffect)((function(){if(!e.some((function(e){return e.id===c}))){var n,r=null===(n=e[0])||void 0===n?void 0:n.id;t(o,(function(e){return jC(gC({},e),{activeTab:r})}))}}),[o,c,e,t]),(0,r.jsxs)(_e.TabsRoot,{value:c,"data-test-id":"interaction-tabs",className:"flex h-full grow flex-col overflow-hidden",children:[(0,r.jsx)(_e.TabsList,{className:"w-full shrink-0 px-4",children:e.map((function(e){return(0,r.jsx)(_e.TabsTrigger,{value:e.id,className:e.className,triggerClassName:"py-2",onClick:function(){return u(e.id)},isSelected:e.id===c,"data-test-id":"tab-".concat(e.id),children:e.content},e.id)}))}),(0,r.jsx)(_e.TabsContent,{value:c,className:"flex grow flex-col overflow-auto",asChild:!0,children:(0,r.jsx)(bC,{activeChatId:o,activeTab:c})})]})})),SC=function(){var e,t=(0,s.useInteractionId)(),n=(0,i.useInteractionProp)(t,(function(e){var t;return null==e||null===(t=e.internalMessageData)||void 0===t?void 0:t.messages}));return(0,r.jsx)("div",{className:cg,"data-testid":"interaction-body",children:null==n||null===(e=n.filter((function(e){return e.text})))||void 0===e?void 0:e.map((function(e,t){return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("p",{className:"pb-1 pl-4 pt-2 text-xs text-chat-name",children:(0,rt.formatChatDate)(e.timestamp)}),(0,r.jsx)(Kl,{className:"pt-0",children:e.text},t)]})}))})},OC=function(){var e=(0,s.useInteractionId)(),t=(0,i.useAssociatedChatInteractionId)(e);(0,l.assertDefined)(t);var n=(0,i.useInteractionProp)(e,X.isInternalMessage),a=(0,x.useInteractionUIStateItemSelector)(t,(function(e){return null==e?void 0:e.chatView}));return n?(0,r.jsx)(SC,{}):"embedded"===a?(0,r.jsx)(IC,{}):(0,r.jsx)(Qx,{})},xC=o().memo((function(){var e=(0,s.useNonAssertedInteractionId)();return(0,i.useAssociatedChatInteractionId)(e)?(0,r.jsxs)("div",{className:"relative flex grow flex-col","data-interaction-page":!0,children:[(0,r.jsxs)("div",{className:"flex h-full w-full shrink-0 flex-col bg-primary-background",children:[(0,r.jsx)(Kx,{}),(0,r.jsx)(OC,{})]}),(0,r.jsx)(OO,{})]}):null}));function CC(){var e=(0,Yt.useChatUnread)();return(0,Yt.usePersonalMessagesUnreadAmount)()+e+(0,ty.useInternalChatTotalUnread)()}var _C=M("absolute right-0 top-0 !h-4 !w-4 translate-x-1/2"),wC=o().memo((function(){var e=(0,c.useLocalizationState)().t,t=(0,at.useSessionState)("privileges"),n=(0,vn.useBrowserTabMetaInfo)(),o=(0,yo.useNavigationState)(),s=o.setActivePage,l=o.noVisibleInteractionsOnMainPannel,u=(0,yo.useNavigationState)("activePage"),d=CC(),f=(0,i.useInteractionStateSelector)((function(e){return e.missedCallsAmount})),m=(0,a.useMemo)((function(){var a,o=function(e){return e===u.name?"svg-color-primary":"svg-color-neutral-600"},i=[{id:yo.AppRoutes.Interactions,testId:"nav-active-interaction",title:e.ADDRESS_BOOK_AREA.active_interaction(),className:M("flex w-12 justify-center"),disabled:l,content:(0,r.jsx)(j.IconInteractionDetails,{className:(a=yo.AppRoutes.Interactions===u.name,M({"svg-color-primary":a,"svg-color-neutral-600":!a&&!l,"svg-color-neutral-400":l}))})},{id:yo.AppRoutes.Directory,testId:"nav-directory",title:e.ADDRESS_BOOK_AREA.addressBook_directory(),className:M("flex w-12 justify-center"),content:(0,r.jsx)(j.IconDirectory,{className:o(yo.AppRoutes.Directory)})}];return i.push({id:yo.AppRoutes.Dial,testId:"nav-dial",title:e.ADDRESS_BOOK_AREA.addressBook_dial(),className:M("flex w-12 justify-center"),content:(0,r.jsx)(j.IconDialpad,{className:o(yo.AppRoutes.Dial)})}),t.SYS_USE_FAVORITES_TAB&&i.push({id:yo.AppRoutes.Favorites,testId:"nav-favorites",title:e.ADDRESS_BOOK_AREA.addressBook_favorites(),className:M("flex w-12 justify-center"),content:(0,r.jsx)(j.IconStar24,{className:o(yo.AppRoutes.Favorites)})}),t.SYS_USE_RECENT_TAB&&i.push({id:yo.AppRoutes.Recents,testId:"nav-recents",title:e.ADDRESS_BOOK_AREA.addressBook_recents(),className:M("flex w-12 justify-center"),content:(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(j.IconRecent,{className:o(yo.AppRoutes.Recents)}),(0,r.jsx)(L.UnreadBadge,{className:_C,unreadAmount:d}),!d&&(0,r.jsx)(L.MissedCallsBadge,{className:_C,amount:f})]})}),"adc"===(null==n?void 0:n.app)&&t.CAN_USE_CALENDAR&&i.push({id:yo.AppRoutes.Calendar,testId:"nav-calendar",title:e.ADDRESS_BOOK_AREA.addressBook_calendar(),className:M("flex w-12 justify-center"),content:(0,r.jsx)(j.IconCalendar,{className:o(yo.AppRoutes.Calendar)})}),i}),[e.ADDRESS_BOOK_AREA,t.SYS_USE_FAVORITES_TAB,t.SYS_USE_RECENT_TAB,t.CAN_USE_CALENDAR,null==n?void 0:n.app,f,d,u.name,l]),p=(0,a.useCallback)((function(e){s({name:e})}),[s]);return(0,r.jsx)(_e.TabsRoot,{children:(0,r.jsx)(_e.TabsList,{className:"justify-center gap-6","data-testid":"bottom-nav",topBorder:!0,children:m.map((function(e){return(0,r.jsx)(_e.TabsTrigger,{value:e.id,onClick:function(){return p(e.id)},isSelected:e.id===u.name,className:e.className,"data-testid":e.testId,topBorder:!0,disabled:e.disabled,triggerClassName:"flex items-center justify-center p-3",children:e.content},e.id)}))})})}));function NC(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var AC=function(){var e,t,n=(0,yo.useNavigationState)().activePage,a=(0,vn.useIsCommunicator)(),o=(0,c.useLocalizationState)("t").ADDRESS_BOOK_AREA,i=(NC(t={},yo.AppRoutes.Calendar,o.addressBook_calendar()),NC(t,yo.AppRoutes.ContactDetails,o.addressBook_contact_details()),NC(t,yo.AppRoutes.Cases,o.addressBook_cases()),NC(t,yo.AppRoutes.Dial,o.addressBook_dial_pad()),NC(t,yo.AppRoutes.Directory,o.addressBook_directory()),NC(t,yo.AppRoutes.Favorites,o.addressBook_favorites()),NC(t,yo.AppRoutes.KnowledgeBase,o.addressBook_knowledge_base()),NC(t,yo.AppRoutes.Recents,o.addressBook_recents()),NC(t,yo.AppRoutes.Help,o.addressBook_help()),t);return a||n.name===yo.AppRoutes.Interactions||n.name===yo.AppRoutes.ContactDetails?null:(0,r.jsx)("div",{className:"flex shrink-0 items-center p-4",children:(0,r.jsx)("span",{"data-testid":"page-title",className:"uppercase tracking-[0.8px] caption-xs text-neutral-disabled",children:null===(e=i[n.name])||void 0===e?void 0:e.toUpperCase()})})};const PC={outerWrapper:"communicator_MainPage_outerWrapper_F6z1g",wrapper:"communicator_MainPage_wrapper_krWum",invisible:"communicator_MainPage_invisible_FSqHH",sidebar:"communicator_MainPage_sidebar_hJQGa",item:"communicator_MainPage_item_MWSjp",itemLink:"communicator_MainPage_itemLink_WjiTq",itemActive_recent:"communicator_MainPage_itemActive_recent_esr5r",itemActive_favorites:"communicator_MainPage_itemActive_favorites_6aHjZ",itemActive_directory:"communicator_MainPage_itemActive_directory_nNRPC",itemActive_dialpad:"communicator_MainPage_itemActive_dialpad_bXLh5",itemActive_calendar:"communicator_MainPage_itemActive_calendar_TYzDh",itemActive_help:"communicator_MainPage_itemActive_help_l1tNv","itemActive_knowledge-base":"communicator_MainPage_itemActive_knowledge-base_3uT73",icon:"communicator_MainPage_icon_EJpVq",header:"communicator_MainPage_header_p07Ex",pageTitle:"communicator_MainPage_pageTitle_qDD83",headerTop:"communicator_MainPage_headerTop_ooG9j",agentState:"communicator_MainPage_agentState_RoOuK",agentStateText:"communicator_MainPage_agentStateText_mW5t2",rightButtons:"communicator_MainPage_rightButtons_pq4RG",popout:"communicator_MainPage_popout_jC9Xu",directChat:"communicator_MainPage_directChat_QBPZh",hamburger:"communicator_MainPage_hamburger_icTEV",pusher:"communicator_MainPage_pusher_PK6bH",content:"communicator_MainPage_content_1YjJW",offlineBar:"communicator_MainPage_offlineBar_umrUd",offlineErrorMessage:"communicator_MainPage_offlineErrorMessage_52imi",knowledgeBase:"communicator_MainPage_knowledgeBase_QPE4T",notifications:"communicator_MainPage_notifications_uzeh4",mainMenuIconWrapper:"communicator_MainPage_mainMenuIconWrapper_veOLm",errorFallback:"communicator_MainPage_errorFallback_vSke3",copiedLabel:"communicator_MainPage_copiedLabel_1VjWY","fade-out":"communicator_MainPage_fade-out_d4CAy",inNotification:"communicator_MainPage_inNotification_OS8Q6",directChatLinkCopyNotification:"communicator_MainPage_directChatLinkCopyNotification_Ge1YS"};function EC(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var DC,TC=function(e){e.errorMessage;var t=(0,c.useLocalizationState)().t;return(0,r.jsx)(d.SmMessage,{className:PC.errorFallback,error:!0,header:t.ERROR_MESSAGES.unhandled_router_error(),content:!1})};function kC(e){return(0,r.jsx)(L.ErrorBoundary,{fallback:TC,children:(0,r.jsx)(e,{})})}var MC=(EC(DC={},yo.AppRoutes.Recents,kC((function(){var e=(0,i.useInteractionStateMethods)().resetMissedCalls,t=(0,i.useInteractionStateSelector)((function(e){return e.missedCallsAmount})),n=(0,nl.useRecentUIState)(),o=n.handleTabChange,s=n.tabIndex,l=(0,y.usePageVisibility)(),c=(0,i.useActiveInteractionId)(),u=uO[Number(s)].id,d=(0,y.useEvent)((function(e){var t=uO.findIndex((function(t){return t.id===e}));o(t)}));return(0,a.useEffect)((function(){l&&e()}),[t,e,l]),(0,r.jsxs)(_e.TabsRoot,{"data-testid":"recent",value:u,className:"flex h-full flex-col gap-2.5 px-4 pt-2",children:[(0,r.jsx)(_e.TabsList,{"data-testid":"recent-tabs",children:uO.map((function(e){return(0,r.jsx)(_e.TabsTrigger,{value:e.id,"data-testid":e.testId,isSelected:u===e.id,onClick:function(){return d(e.id)},className:"w-full text-center",triggerClassName:M("py-2",cO({},"text-primary-on-primary",e.id===u)),children:e.content},e.id)}))}),(0,r.jsx)(iu,{itemId:c}),(0,r.jsx)(lO,{}),(0,r.jsx)(_e.TabsContent,{value:u,className:"flex min-h-0 !flex-auto flex-col py-1 pr-0.5",children:(0,r.jsx)(oO,{type:u})})]})}))),EC(DC,yo.AppRoutes.Dial,kC((function(){var e,t,n,o,s,l,c,u=(0,i.useActiveInteractionId)(),d=(0,Ta.useAtomValue)(tp);return e=(0,nl.useCommunicatorUIState)("dialpad"),t=e.searchValue,n=e.setSearchValue,o=(0,yo.useNavigationState)(),s=o.activePage.params,l=o.cleanPageParams,c=null==s?void 0:s.searchQuery,(0,a.useLayoutEffect)((function(){!t&&c&&n(c),l()}),[t,c,n,l]),function(){var e=kp().onChatClick,t=(0,Wt.useFavoritesState)("favoritesList"),n=(0,nl.useCommunicatorUIState)((function(e){return e.dialpad.setSearchValue})),r=Bb({favoritesList:t}),o=(0,a.useCallback)((function(t){var a,o,i=Number(null===(o=t.code)||void 0===o||null===(a=o.match(/^(Numpad|Digit)([1-9])$/))||void 0===a?void 0:a[2]);if(i&&t.altKey&&t.shiftKey&&function(){var e=r[i-1].item.channels.find((function(e){return"phone"===e.channelType}));if(null==e?void 0:e.number){var t=document.querySelector('[data-testid="dialpad-input"] input');t&&(n(e.number),t.focus())}}(),"KeyS"===t.code&&t.altKey&&t.shiftKey)return e()}),[e,n,r]);(0,y.useEventListener)("keydown",o)}(),(0,r.jsxs)("div",{className:"relative flex flex-1 flex-col overflow-hidden","data-testid":"dialpad",children:[(0,r.jsx)("div",{className:"px-4 pt-2",children:(0,r.jsx)(iu,{itemId:u})}),(0,r.jsxs)("div",{className:M("flex flex-1 flex-col overflow-y-hidden pb-[50px] pl-4 pr-0.5 pt-[7px]",{"pb-[350px]":d}),children:[(0,r.jsx)(Rb,{}),(0,r.jsx)(Eb,{})]}),(0,r.jsx)(Gp,{})]})}))),EC(DC,yo.AppRoutes.Favorites,kC((function(e){var t=(0,i.useActiveInteractionId)();return(0,r.jsxs)("div",{className:"flex h-full min-h-0 flex-auto flex-col gap-2.5 px-4 pt-2","data-testid":"favorites",children:[(0,r.jsx)(iu,{itemId:t}),(0,r.jsx)(Zb,ey({},e))]})}))),EC(DC,yo.AppRoutes.Directory,kC((function(){return(0,r.jsx)("div",{className:"flex h-full min-h-0 flex-auto flex-col","data-testid":"directory",children:(0,r.jsx)(yb,{})})}))),EC(DC,yo.AppRoutes.Interactions,kC(xC)),EC(DC,yo.AppRoutes.Cases,kC((function(){var e=(0,yo.useNavigationState)().activePage,t=(0,$.get)(e.params,"id"),n=(0,$.get)(e.params,"emailId");return n?(0,r.jsx)(Vc,{id:n}):t?(0,r.jsx)(Hc,{id:t}):(un.bpLogger.error("You are trying to open a case page without providing the case ID."),null)}))),EC(DC,yo.AppRoutes.ContactDetails,kC((function(){var e,t=null!==(e=(0,yo.useNavigationState)().activePage.params)&&void 0!==e?e:{},n=t.contactId,a=t.userId,o=t.entryId;return n?(0,r.jsx)(wm,{contactId:n}):o?(0,r.jsx)(sd,{entryId:o}):a?(0,r.jsx)(ud,{userId:a}):(un.bpLogger.error("You are trying to open a contact details page without providing a proper ID."),null)}))),EC(DC,yo.AppRoutes.KnowledgeBase,kC(Oj)),EC(DC,yo.AppRoutes.Help,kC((function(){var e=(0,yo.useNavigationState)("addPageParams");return(0,r.jsx)(qI.Help,{addPageParams:e})}))),EC(DC,yo.AppRoutes.Calendar,kC((function(){return(0,r.jsxs)("div",{"data-testid":"calendar-page",className:"flex h-full flex-col",children:[(0,r.jsx)(pc,{}),(0,r.jsx)(vc,{})]})}))),DC),LC=(0,a.memo)((function(){var e=(0,yo.useNavigationState)().activePage;return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)(AC,{}),(0,r.jsx)("div",{className:"relative z-0 flex w-full shrink grow flex-col overflow-hidden","data-testid":"communicator_content",children:MC[e.name]}),(0,r.jsx)(wC,{}),(0,r.jsx)(cj,{})]})})),RC=n(7500),FC=n(2469);const BC="communicator_Notifications_listWrapper_NVyLi",UC="communicator_Notifications_listItem_5BLxr";var zC={hide:0,show:300},HC=function(e){var t=e.omit,n=e.show,o=e.className,i=(0,I.useNotificationsState)(),s=i.notifications,c=i.methods.hideNotificationById,u=(0,a.useMemo)((function(){var e=(0,l.truthy)(Object.values(s)).filter((function(e){return!e.delayed}));return n&&(e=e.filter((function(e){return n.includes(e.id)}))),t&&(e=e.filter((function(e){return!t.includes(e.id)}))),e.slice(0,3)}),[s,t,n]);return(0,r.jsx)("div",{className:M(o,BC),children:(0,r.jsx)(d.SmTransition.Group,{animation:"fade down",duration:zC,children:u.map((function(e){var t;return t=e.content?(0,a.isValidElement)(e.content)?(0,a.cloneElement)(e.content,{onHide:function(){return c(e.id)}}):e.content:e.message,(0,r.jsxs)("div",{className:UC,children:[(0,r.jsx)("div",{children:(0,r.jsx)(d.SmMessage,{onDismiss:e.closable?function(){return c(e.id)}:void 0,content:t,error:"error"===e.type,info:"info"===e.type,warning:"warning"===e.type,success:"success"===e.type})}),(0,r.jsx)(L.AriaStatus,{children:t})]},e.id)}))})})},VC=n(7043);function GC(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function WC(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){GC(e,t,n[t])}))}return e}function qC(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}var YC=function(e){var t=e.activePageName,n=e.onMenuItemClick,o=e.onSettingsClick,s=e.onAgentStateClick,l=e.onInteractionClick,u=(0,at.useSessionState)().isLoggedIn,f=(0,on.useIsOffline)(),m=(0,c.useLocalizationState)().t,p=(0,i.useInteractions)(),v=(0,yt.useGetAvatarUrl)(),h=(0,Yt.useInteractionChatData)(),b=(0,ty.useInternalChats)(),y=(0,i.useActiveInteractionProp)((function(e){return null==e?void 0:e.mediaType})),g=(0,qt.useAgentStateSelectedOption)(),j=(0,a.useCallback)((function(e){if("Enter"===e.key||" "===e.key){var t=e.target;if(!(0,se.isHTMLButtonElement)(t))return;e.preventDefault(),t.click()}}),[]),I=(0,a.useMemo)((function(){return[{route:yo.AppRoutes.Recents,name:m.ADDRESS_BOOK_AREA.addressBook_recents(),Icon:ve.IconNavRecents},{route:yo.AppRoutes.Favorites,name:m.ADDRESS_BOOK_AREA.addressBook_favorites(),Icon:ve.IconNavFavorites},{route:yo.AppRoutes.Directory,name:m.ADDRESS_BOOK_AREA.addressBook_directory(),Icon:ve.IconNavDirectory},{route:yo.AppRoutes.Dial,name:m.ADDRESS_BOOK_AREA.addressBook_dial(),Icon:ve.IconNavDial}].map((function(e){return qC(WC({},e),{onClick:function(){return n(e.route)}})}))}),[n,m.ADDRESS_BOOK_AREA]),S=(0,a.useMemo)((function(){return p.map((function(e){return{onClick:function(){return l(e)}}}))}),[p,l]),O=M("h-9 w-9 justify-center p-0 [&:not(:last-child)]:mb-2");return(0,r.jsx)("div",{className:"h-full w-11 p-1 outline outline-1 outline-main-border",children:u?(0,r.jsxs)(d.SmMenu,{vertical:!0,secondary:!0,children:[(0,r.jsx)(d.SmMenu.Item,{as:"button",className:M(O,"[&_img]:h-7 [&_img]:w-7"),name:"AgentState",onClick:s,children:(0,r.jsx)(VC.AgentStatusIcon,{busyMediaType:y,agentStatusOption:g,isOffline:f})}),I.map((function(e){var n=e.Icon,a=e.name,o=e.onClick,i=e.route;return(0,r.jsx)(d.SmMenu.Item,{as:"button",className:O,name:a,onClick:o,active:t===i,onKeyPress:j,children:(0,r.jsx)(n,{})},a)})),(0,r.jsx)(d.SmMenu.Item,{as:"button",className:O,name:"Settings",onClick:o,onKeyPress:j,children:(0,r.jsx)(ve.IconNavSettings,{})}),p.map((function(e,t){var n,a,o,i,s=e.displayData,l=e.internalChatData,c=e.externalChatData,u=e.userId,f=e.contactId,m=null===(n=e.displayData)||void 0===n?void 0:n.emiUserType,p="chat"===e.mediaType||!!l||!!c,y=function(e,t,n){var r=e.internalChatData&&e.internalChatData.userId,a=(0,X.getInteractionStepId)(e),o=a&&t[a]&&t[a].unread,i=r&&n[r]&&n[r].unreadAmount;return o||i||0}(e,h,b);if(c||l){var g=c||l;o=g.firstName,i=g.lastName}else o=s.firstName,i=s.lastName;var I={firstName:o,lastName:i,url:v({userId:u,contactId:f,userType:m,photoUrl:null===(a=e.displayData)||void 0===a?void 0:a.emiPhotoUrl}),headPhones:!!u,interactionIcon:p?y||"chat":"phone",size:28,type:(0,jt.getAvatarType)(u,f,m)};return(0,r.jsx)(d.SmMenu.Item,{as:"button",className:O,name:String(Math.random()),onClick:S[t].onClick,onKeyPress:j,children:(0,r.jsx)(jt.AvatarLegacy,WC({},I))},e.id)}))]}):null})},KC={__ts__:Date.now(),notification:{compact:!1,hideWhileActiveInteraction:!0},calendar_event_notification:{},quality_management_monitor:{position:void 0}};function $C(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function XC(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function QC(){var e=(0,Wn.useRemoteAssistStateConnector)(),t=(0,i.useInteractions)(),n=(0,y.useAsRef)(t),r=(0,x.useInteractionUIItemStateSetter)();(0,a.useEffect)((function(){var t=e.dispenser.subscribe({onSessionStarted:function(e){var t=e.globalInteractionId,a=e.clientUrl,o=n.current.find((function(e){return(0,X.getGlobalInteractionId)(e)===t})),i=n.current.find((function(e){return e.id===t})),s=null!=o?o:i;s&&r(s.id,(function(e){return XC(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){$C(e,t,n[t])}))}return e}({},e),{chatMessage:e.chatMessage+" "+a})}))}});return function(){return t.unsubscribe()}}),[e,r,n])}function ZC(e){var t,n,r,o,s,l,c,d=e.toggleRightPanel,f=e.toggleSettings,m=e.isMinimized,p=e.setIsMinimized;t=(0,yo.useNavigationStateRef)(),n=(0,i.useInteractionStateConnector)(),r=(0,a.useCallback)((function(){var e=t.current,n=e.activePage,r=e.setActivePage;n.name!==yo.AppRoutes.Interactions&&r({name:yo.AppRoutes.Interactions})}),[t]),(0,a.useEffect)((function(){var e=null==n?void 0:n.dispenser.subscribe({onItemAccepted:r,onActiveItemChanged:r});return function(){return null==e?void 0:e.unsubscribe()}}),[null==n?void 0:n.dispenser,t,r]),o=(0,Yt.useInteractionChatStateConnector)(),s=(0,i.useInteractions)(),l=(0,y.useAsRef)(s),c=(0,Jt.useOpenChannel)(),(0,a.useEffect)((function(){var e=o.dispenser.subscribe({onSwitchItemChannel:function(e){var t=e.interactionStepId,n=e.channel,r=l.current.find((function(e){return(0,X.getInteractionStepId)(e)===t}));r&&c(n,r.id)},onCobrowsingStarted:function(e){e.cobrowsingLink&&window.open(e.cobrowsingLink,"_blank","")}});return function(){e.unsubscribe()}}),[o.dispenser,l,c]),function(){var e=(0,Kt.useBpClientStateConnector)(),t=(0,yo.useNavigationStateRef)();(0,a.useEffect)((function(){var n=t.current.setActivePage,r=null==e?void 0:e.dispenser.subscribe({onNavigateToInteraction:function(){n({name:yo.AppRoutes.Interactions})}});return function(){return null==r?void 0:r.unsubscribe()}}),[e,t])}(),QC(),function(e){var t=e.toggleRightPanel,n=e.toggleSettings,r=e.setIsMinimized,o=(0,u.useIntegrationApiStateConnector)();(0,a.useEffect)((function(){var e=o.dispenser.subscribe({onSetWidgetMinimized:function(e){return e&&(n(!1),t(!1)),r(e),Promise.resolve()}});return function(){e.unsubscribe()}}),[o.dispenser,r,t,n])}({toggleRightPanel:d,toggleSettings:f,setIsMinimized:p});var v=(0,u.useIntegrationApiStateMethods)().widgetMinimizedChange;(0,a.useEffect)((function(){v(m)}),[v,m])}function JC(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function e_(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return JC(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return JC(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function t_(){var e=(0,nl.useCommunicatorUIState)(["toggleRightPanel","toggleSettings"]),t=e.toggleRightPanel,n=e.toggleSettings,r=(0,a.useCallback)((function(){n(!1),t(!1)}),[t,n]),o=(0,a.useCallback)((function(){n(!0),t(!0)}),[n,t]),i=(0,a.useCallback)((function(e){["Escape"].includes(e.key)&&(e.preventDefault(),r())}),[r]);return(0,a.useMemo)((function(){return{toggleSettings:n,closeMenu:r,openSettingsMenu:o,handleMenuKeyPress:i}}),[n,r,o,i])}function n_(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function r_(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}var a_=function(e){var t,n=e.allowRender,o=void 0===n||n,i=e.id,s=e.onClick,l=e.enabledOffline,c=e.children,u=e.isLink,f=e.page,m=e.activePage,p=e.disabled,v=e.disabledTitle,h=(0,a.useCallback)((function(e){if(["Enter"," "].includes(e.key)){var t=e.target;if(!(0,se.isHTMLButtonElement)(t))return;e.preventDefault(),t.click()}}),[]),b=f===m,y=(0,L.useEnabledInOffline)(l,{className:M(PC.item,(t={},n_(t,PC.itemLink,u),n_(t,PC["itemActive_".concat(i)],b),t)),onClick:s});return o?(0,r.jsx)(d.SmMenu.Item,r_(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){n_(e,t,n[t])}))}return e}({onKeyPress:h,as:"button",role:"menuitem",disabled:p,title:p?v:void 0,"data-testid":"menu-item-button","data-item":i,"data-element":"menu-item","data-active":b||void 0},y),{children:c})):null};function o_(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function i_(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){o_(e,t,n[t])}))}return e}function s_(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function l_(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var c_=function(e){var t=e.menuProps,n=e.toggleSettings,o=e.onMenuItemClick,s=e.activePageName,l=function(e){var t=e.onMenuItemClick,n=e.toggleSettings,o=(0,c.useLocalizationState)().t,s=(0,at.useSessionState)().privileges,l=(0,i.useInteractionStateSelector)((function(e){return e.missedCallsAmount})),u=CC(),d=(0,a.useCallback)((function(e,t,n,a){return(0,r.jsxs)(r.Fragment,{children:[(0,r.jsxs)("div",{className:PC.mainMenuIconWrapper,children:[(0,r.jsx)(e,{className:PC.icon}),(0,r.jsx)(L.UnreadBadge,{className:PC.unread,unreadAmount:a})]}),(0,r.jsx)("span",{"data-testid":"menu-item-text",children:t}),(0,r.jsx)(L.MissedCallsBadge,{className:"ml-4",amount:n})]})}),[]),f=(0,a.useCallback)((function(e){return function(){t(e)}}),[t]);return(0,a.useMemo)((function(){var e=[];return s.SYS_USE_RECENT_TAB&&e.push({key:"recent",page:yo.AppRoutes.Recents,onClick:f(yo.AppRoutes.Recents),children:d(ve.IconNavRecents,o.ADDRESS_BOOK_AREA.addressBook_recents(),l,u),enabledOffline:!0}),s.SYS_USE_FAVORITES_TAB&&e.push({key:"favorites",page:yo.AppRoutes.Favorites,onClick:f(yo.AppRoutes.Favorites),children:d(ve.IconNavFavorites,o.ADDRESS_BOOK_AREA.addressBook_favorites()),enabledOffline:!0}),e.push({key:"directory",page:yo.AppRoutes.Directory,onClick:f(yo.AppRoutes.Directory),children:d(ve.IconNavDirectory,o.ADDRESS_BOOK_AREA.addressBook_directory()),enabledOffline:!0},{key:"dialpad",page:yo.AppRoutes.Dial,onClick:f(yo.AppRoutes.Dial),children:d(ve.IconNavDial,o.ADDRESS_BOOK_AREA.addressBook_dial()),enabledOffline:!0}),s.CAN_USE_CALENDAR&&e.push({key:"calendar",page:yo.AppRoutes.Calendar,onClick:f(yo.AppRoutes.Calendar),children:d(ve.IconNavCalendar,o.ADDRESS_BOOK_AREA.addressBook_calendar()),enabledOffline:!0}),e.push({key:"knowledge-base",page:yo.AppRoutes.KnowledgeBase,onClick:f(yo.AppRoutes.KnowledgeBase),children:d(ve.IconKnowledgeBase,o.KNOWLEDGE_BASE.kb_heading())},{key:"settings",onClick:n,children:d(ve.IconNavSettings,o.GLOBAL.settings()),enabledOffline:!0},{key:"help",page:yo.AppRoutes.Help,onClick:f(yo.AppRoutes.Help),children:d(ve.IconHelp,o.GLOBAL.help()),enabledOffline:!0}),e}),[s.SYS_USE_RECENT_TAB,s.SYS_USE_FAVORITES_TAB,s.CAN_USE_CALENDAR,f,d,o.ADDRESS_BOOK_AREA,o.KNOWLEDGE_BASE,o.GLOBAL,n,l,u])}({onMenuItemClick:o,toggleSettings:n}),u=(0,L.useMenuKeysHandler)("menu-item","menu-container",!0);return(0,r.jsx)(d.SmMenu,s_(i_({"data-element":"menu-container"},t),{"data-testid":"menu",onKeyDown:u,children:l.map((function(e){var t=e.children,n=l_(e,["children"]);return(0,a.createElement)(a_,s_(i_({},n),{key:n.key,id:n.key,activePage:s}),t)}))}))};const u_="communicator_UserProfilePreview_name_TgrHj",d_="communicator_UserProfilePreview_phone_Zy4sD",f_="communicator_UserProfilePreview_link_GVBLo";var m_=function(){var e=(0,gt.useFormatting)().formatFullName,t=(0,Tb.useUserProfileState)().persistentAvatar,n=(0,at.useSessionState)(),o=n.firstName,i=n.lastName,s=n.userId,l=n.phoneNumber,u=void 0===l?"_":l,d=(0,c.useLocalizationState)().t,f=(0,a.useMemo)((function(){return{firstName:o,lastName:i,url:null==t?void 0:t.src}}),[o,i,null==t?void 0:t.src]),m=(0,r.jsxs)(r.Fragment,{children:[(0,r.jsx)("span",{className:u_,"data-testid":"name",children:e(o,i)}),(0,r.jsx)("span",{className:d_,"data-testid":"extension",children:d.USER_PROFILE.sidebar_ext(u)})]}),p=(0,r.jsx)("span",{className:f_,"data-testid":"menu-item-text",children:d.USER_PROFILE.sidebar_profile_link()});return(0,r.jsx)(yc.ContactListItem,{as:"div",avatarProps:f,title:m,body:p,userId:s,isFitted:!0,isLowRise:!0})};var p_=["IVR","delivery_pending","delivered","hold"];function v_(e){var t=e.toggleSettings,n=e.closeMenu,o=e.openSettingsMenu,s=(0,at.useSessionState)(),l=s.isSsoEnabled,u=s.phoneType,d=s.tenantFeatures,f=(0,i.useInteractionState)().items,m=(0,c.useLocalizationState)().t,p=f.some((function(e){return"voice"===e.mediaType&&e.state&&p_.includes(e.state)})),v=!!u&&["phone_type_browser","phone_type_soft_secure","phone_type_soft_unsecure"].includes(u),h=!!(null==d?void 0:d.msTeamsIntegrationEnabled),b=function(e){var t=e.hasActiveCalls,n=e.closeMenu,r=e.openSettingsMenu,o=(0,at.useSessionStateMethods)().startPhoneTypeSelection,i=(0,cc.useOpenChangePasswordModal)(),s=(0,cc.useOpenLogoutModal)(),l=(0,cc.useOpenEMIAccountsModal)(),c=(0,cc.useOpenUserProfileModal)(),u=(0,cc.useOpenKeyboardShortcutsModal)(),d=(0,cc.useOpenPredefinedMessagesModal)(),f=(0,cc.useOpenVolumeModal)(),m=(0,cc.useOpenPreferencesModal)(),p=(0,cc.useOpenAboutModal)(),v=(0,cc.useOpenAudioDevicesModal)(),h=(0,cc.useOpenPrerecordedMessagesModal)(),b=(0,a.useCallback)((function(){n(),d(void 0,{afterClose:r})}),[n,d,r]),y=(0,a.useCallback)((function(){t||(n(),o())}),[t,n,o]),g=(0,a.useCallback)((function(){n(),v(void 0,{afterClose:r})}),[n,v,r]),j=(0,a.useCallback)((function(){n(),i({},{afterClose:r})}),[n,i,r]),I=(0,a.useCallback)((function(){n(),s(void 0,{afterClose:r})}),[n,s,r]),S=(0,a.useCallback)((function(){n(),c(void 0,{afterClose:r})}),[n,r,c]),O=(0,a.useCallback)((function(){n(),p(void 0,{afterClose:r})}),[n,p,r]),x=(0,a.useCallback)((function(){n(),u(void 0,{afterClose:r})}),[n,u,r]),C=(0,a.useCallback)((function(){n(),h(void 0,{afterClose:r})}),[n,h,r]),_=(0,a.useCallback)((function(){n(),m(void 0,{afterClose:r})}),[n,m,r]),w=(0,a.useCallback)((function(){n(),l(void 0,{afterClose:r})}),[n,l,r]),N=(0,a.useCallback)((function(){n(),f(void 0,{afterClose:r})}),[n,r,f]);return(0,a.useMemo)((function(){return{closeMenu:n,handlePrerecordedMessagesClick:C,handlePreferencesClick:_,handleUserProfileClick:S,handleAboutClick:O,handleKeyboardShortcutsClick:x,handleLogoutClick:I,handleChangePasswordClick:j,handlePhoneSelectionClick:y,handleAudioDevicesClick:g,handlePredefinedMessagesClick:b,handleRingtonesAndAlertsVolumeClick:N,handleEMIAccountsClick:w}}),[n,j,I,y,g,b,C,_,S,O,x,N,w])}({closeMenu:n,openSettingsMenu:o,hasActiveCalls:p}),y=b.handlePrerecordedMessagesClick,g=b.handlePreferencesClick,j=b.handleUserProfileClick,I=b.handleAboutClick,S=b.handleKeyboardShortcutsClick,O=b.handleLogoutClick,x=b.handleChangePasswordClick,C=b.handlePhoneSelectionClick,_=b.handleAudioDevicesClick,w=b.handlePredefinedMessagesClick,N=b.handleRingtonesAndAlertsVolumeClick,A=b.handleEMIAccountsClick;return(0,a.useMemo)((function(){return[{key:"user-profile",onClick:j,children:(0,r.jsx)(m_,{}),enabledOffline:!0},{key:"back",onClick:t,children:(0,r.jsx)("span",{"data-testid":"menu-item-text",children:m.SETTINGS.settings_menu_go_back()}),isLink:!0,enabledOffline:!0},{key:"phone-device",onClick:C,children:(0,r.jsx)("span",{"data-testid":"menu-item-text",children:m.SETTINGS.settings_menu_phoneDevice()}),disabled:p,disabledTitle:m.SETTINGS.menu_phone_devices_disabled_tooltip()},{key:"audio-devices",onClick:_,allowRender:v,children:(0,r.jsx)("span",{"data-testid":"menu-item-text",children:m.SETTINGS.settings_menu_audioDevices()})},{key:"change-password",onClick:x,children:(0,r.jsx)("span",{"data-testid":"menu-item-text",children:m.CHANGE_PASSWORD_DIALOG_BOX.changePassword_heading()})},{key:"predefined-chat-messages",onClick:w,children:(0,r.jsx)("span",{"data-testid":"menu-item-text",children:m.SETTINGS.settings_menu_chatCannedResponses()})},{key:"preferences",onClick:g,children:(0,r.jsx)("span",{"data-testid":"menu-item-text",children:m.SETTINGS.settings_menu_preferences()}),enabledOffline:!0},{key:"emi-accounts",onClick:A,allowRender:h,children:(0,r.jsx)("span",{"data-testid":"menu-item-text",children:m.UNDEFINED.tab_enterprise_messaging_accounts_heading()})},{key:"prerecorded-messages",onClick:y,children:(0,r.jsx)("span",{"data-testid":"menu-item-text",children:m.VOICE_PROMPTS_DIALOG_BOX.edit_voice_prompts_heading()})},{key:"keyboard_shortcuts",onClick:S,children:(0,r.jsx)("span",{"data-testid":"menu-item-text",children:m.SETTINGS.settings_menu_shortcuts()}),enabledOffline:!0},{key:"ringtones",onClick:N,children:(0,r.jsx)("span",{"data-testid":"menu-item-text",children:m.SETTINGS.settings_menu_ringtone_volume()})},{key:"about",onClick:I,children:(0,r.jsx)("span",{"data-testid":"menu-item-text",children:m.SETTINGS.settings_menu_about()}),enabledOffline:!0},{key:"logout",onClick:O,allowRender:!l,children:(0,r.jsx)("span",{"data-testid":"menu-item-text",children:m.GLOBAL.logout()})}]}),[I,_,x,A,S,O,C,w,g,y,N,j,p,v,h,l,t,m])}function h_(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function b_(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){h_(e,t,n[t])}))}return e}function y_(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function g_(e,t){if(null==e)return{};var n,r,a=function(e,t){if(null==e)return{};var n,r,a={},o=Object.keys(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||(a[n]=e[n]);return a}(e,t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(e);for(r=0;r<o.length;r++)n=o[r],t.indexOf(n)>=0||Object.prototype.propertyIsEnumerable.call(e,n)&&(a[n]=e[n])}return a}var j_=function(e){var t=e.menuProps,n=e.toggleSettings,o=e.closeMenu,i=e.openSettingsMenu,s=e.activePageName,l=v_({toggleSettings:n,closeMenu:o,openSettingsMenu:i}),c=(0,L.useMenuKeysHandler)("menu-item","menu-container",!0);return(0,r.jsx)(d.SmMenu,y_(b_({"data-element":"menu-container"},t),{onKeyDown:c,children:l.map((function(e){var t=e.children,n=g_(e,["children"]);return(0,a.createElement)(a_,y_(b_({},n),{key:n.key,id:n.key,activePage:s}),t)}))}))};var I_=o().memo((function(e){var t=(0,nl.useCommunicatorUIState)("rightPanelOpened"),n=t_().closeMenu,o=function(e){var t=(0,nl.useCommunicatorUIState)(["settingsOpened","toggleSettings"]),n=t.settingsOpened,o=t.toggleSettings,i=e.activePageName,s=e.onMenuItemClick,l=t_(),c=l.closeMenu,u=l.openSettingsMenu,d=l.handleMenuKeyPress,f=(0,a.useMemo)((function(){return{vertical:!0,secondary:!0,onKeyDown:d}}),[d]);return n?(0,r.jsx)(j_,{menuProps:f,toggleSettings:o,closeMenu:c,openSettingsMenu:u,activePageName:i}):(0,r.jsx)(c_,{menuProps:f,toggleSettings:o,onMenuItemClick:s,activePageName:i})}(e);return(0,r.jsx)(d.SmSidebar,{className:PC.sidebar,animation:"overlay",direction:"right",visible:t,onHide:n,"data-page-section":"sidebar sidebar_right","data-testid":"right-sidebar",children:(0,r.jsx)(L.FocusTrap,{enabled:t,delayFocus:500,children:o})})}));function S_(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function O_(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return S_(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return S_(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var x_=function(e){var t=e.displayName,n=e.serviceName,a=e.type;return(0,r.jsx)(r.Fragment,{children:t&&(0,r.jsxs)("div",{"aria-live":"assertive",role:"alert",className:"aria-description",children:["chat"===a?"Chat from ":n," ",t]})})};const C_="communicator_CompactNotificationModal_overlayContainer_aP5A4",__="communicator_CompactNotificationModal_notificationList_HFXNj",w_="communicator_CompactNotificationModal_notificationItem_QCXHz",N_="communicator_CompactNotificationModal_notificationItemContent_0tp8z",A_="communicator_CompactNotificationModal_background_ixU4Q",P_="communicator_CompactNotificationModal_content_eI0tj",E_="communicator_CompactNotificationModal_displayRow_VeD2C",D_="communicator_CompactNotificationModal_chatIcon_lZXmL",T_="communicator_CompactNotificationModal_displayName_xG1sv",k_="communicator_CompactNotificationModal_phoneNumber_61rE1",M_="communicator_CompactNotificationModal_controlsRow_h2CjZ",L_="communicator_CompactNotificationModal_control_GfyHn",R_="communicator_CompactNotificationModal_serviceRow_25nnh",F_="communicator_CompactNotificationModal_invertedButton_uaLGd";var B_=function(e){var t,n,o,s,l,u,f=e.id,m=(t=e,s=(0,gt.useFormatting)(),l=s.formatFullName,u=s.getNamesFromDisplayName,(0,a.useMemo)((function(){var e,n,r=t.displayData||{},a=r.firstName,o=r.lastName,i=r.number,s=void 0===i?"":i,c=r.displayName,d=void 0===c?"":c,f=r.email||(0,rt.formatPhone)(s),m=null==t||null===(e=t.externalChatData)||void 0===e?void 0:e.firstName,p=null==t||null===(n=t.externalChatData)||void 0===n?void 0:n.lastName,v=O_(u(d),2),h=v[0],b=v[1];return d||l(h||a||m,b||o||p)||f}),[l,u,t.displayData,null==t||null===(n=t.externalChatData)||void 0===n?void 0:n.firstName,null==t||null===(o=t.externalChatData)||void 0===o?void 0:o.lastName])),p=(0,X.getServiceNameFromItem)(e),v=(0,i.useInteractionStateMethods)(),h=v.rejectItem,b=v.acceptItem,y=v.activateItem,g=v.dialWorkitem,j=(0,c.useLocalizationState)().t,I=(0,yo.useNavigationState)(),S=I.activePage,O=I.setActivePage,x=(0,a.useCallback)((function(){h(f)}),[h,f]),C=(0,a.useCallback)((function(){b(f)}),[b,f]),_=(0,a.useCallback)((function(){b(f),y(f),S.name!==yo.AppRoutes.Interactions&&O({name:yo.AppRoutes.Interactions})}),[b,y,f,S,O]),w=(0,a.useCallback)((function(){_(),g({workitemItemId:f})}),[g,f,_]);return(0,r.jsx)(d.SmListItem,{className:w_,children:(0,r.jsxs)(d.SmList.Content,{className:N_,children:[(0,r.jsx)("div",{className:A_}),(0,r.jsxs)("div",{className:P_,children:[(0,X.isWorkItem)(e)&&p&&(0,r.jsx)("div",{className:R_,children:p}),(0,r.jsxs)("div",{className:E_,children:[(0,r.jsx)(d.SmList.Icon,{className:D_,children:(0,X.isWorkItem)(e)?(0,r.jsx)(ve.IconCampaignNotification,{}):(0,r.jsx)(ve.IconChatNotification,{})}),(0,r.jsx)("div",{className:T_,children:m}),(0,X.isWorkItem)(e)&&(0,r.jsx)("div",{className:k_,children:e.displayData.number})]}),(0,r.jsxs)("div",{className:M_,children:[(0,r.jsx)("div",{children:(0,r.jsx)(d.SmButton,{"data-testid":"reject-button",negative:!0,size:"small",className:L_,onClick:x,children:j.INCOMING_CALL_DIALOG_BOX.incomingInteraction_reject()})}),(0,r.jsxs)("div",{children:[(0,r.jsx)(d.SmButton,{positive:!0,size:"small","data-testid":"accept-button",className:L_,onClick:C,children:j.INCOMING_CALL_DIALOG_BOX.incomingInteraction_accept()}),(0,X.isWorkItem)(e)?(0,r.jsx)(d.SmButton,{size:"small",className:M(L_,F_),onClick:w,children:j.INCOMING_CALL_DIALOG_BOX.dial_number()}):(0,r.jsx)(d.SmButton,{positive:!0,size:"small",className:L_,onClick:_,children:j.INCOMING_CALL_DIALOG_BOX.button_accept_and_open_label()})]})]})]}),(0,r.jsx)(x_,{type:(0,X.isWorkItem)(e)?"workitem":"chat",serviceName:p,displayName:m})]})})};function U_(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var z_=function(){var e=(0,i.useInteractions)(),t=(0,i.useModalInteractionIds)(),n=(0,a.useMemo)((function(){return t.reduce((function(t,n){var r=e.find((function(e){return e.id===n}));return e.length>1&&r&&(0,X.isDeliveryPending)(r)&&((0,X.isExternalChat)(r)||(0,X.isInternalChat)(r)||(0,X.isWorkItem)(r))&&t.push(r),t}),[])}),[t,e]),o=(0,a.useMemo)((function(){return n.map((function(e){return(0,r.jsx)(B_,function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){U_(e,t,n[t])}))}return e}({},e),e.id)}))}),[n]);return(0,r.jsx)("div",{className:C_,children:(0,r.jsx)(d.SmList,{className:__,children:o})})},H_=function(){var e=(0,a.useRef)(null);return(0,g.useInteractionModalsAutoOpener)(e),(0,r.jsx)("div",{ref:e})},V_=n(1549);function G_(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var W_=(0,L.createComponentLoader)("calendar",(function(){return n.e(662).then(n.t.bind(n,5662,23))}),"CalendarUserSelect").CalendarUserSelectLoader;function q_(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Y_(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return q_(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return q_(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var K_=function(e){var t=e.url,n=(0,c.useLocalizationState)().t,o=Y_((0,a.useState)(0),2),i=o[0],s=o[1],l=(0,a.useCallback)((function(){y.clipboard.copy(t),s((function(e){return++e}))}),[t]);return(0,r.jsxs)("div",{className:PC.directChatLinkCopyNotification,onClick:l,children:[(0,r.jsx)("span",{children:n.HOME_SCREEN.direct_chat_copy_link_safari_notification()}),!!i&&(0,r.jsx)(d.SmLabel,{pointing:"left",className:M(PC.copiedLabel,PC.inNotification),children:n.HOME_SCREEN.direct_chat_invitation_link_copied_label()},i)]})};function $_(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function X_(e,t,n,r,a,o,i){try{var s=e[o](i),l=s.value}catch(c){return void n(c)}s.done?t(l):Promise.resolve(l).then(r,a)}function Q_(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var o=e.apply(t,n);function i(e){X_(o,r,a,i,s,"next",e)}function s(e){X_(o,r,a,i,s,"throw",e)}i(void 0)}))}}function Z_(e,t){return function(e){if(Array.isArray(e))return e}(e)||function(e,t){var n=null==e?null:"undefined"!=typeof Symbol&&e[Symbol.iterator]||e["@@iterator"];if(null!=n){var r,a,o=[],i=!0,s=!1;try{for(n=n.call(e);!(i=(r=n.next()).done)&&(o.push(r.value),!t||o.length!==t);i=!0);}catch(Iw){s=!0,a=Iw}finally{try{i||null==n.return||n.return()}finally{if(s)throw a}}return o}}(e,t)||function(e,t){if(!e)return;if("string"==typeof e)return $_(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return $_(e,t)}(e,t)||function(){throw new TypeError("Invalid attempt to destructure non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}function J_(e,t){var n,r,a,o,i={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;i;)try{if(n=1,r&&(a=2&o[0]?r.return:o[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,o[1])).done)return a;switch(r=0,a&&(o=[2&o[0],a.value]),o[0]){case 0:case 1:a=o;break;case 4:return i.label++,{value:o[1],done:!1};case 5:i.label++,r=o[1],o=[0];continue;case 7:o=i.ops.pop(),i.trys.pop();continue;default:if(!(a=i.trys,(a=a.length>0&&a[a.length-1])||6!==o[0]&&2!==o[0])){i=0;continue}if(3===o[0]&&(!a||o[1]>a[0]&&o[1]<a[3])){i.label=o[1];break}if(6===o[0]&&i.label<a[1]){i.label=a[1],a=o;break}if(a&&i.label<a[2]){i.label=a[2],i.ops.push(o);break}a[2]&&i.ops.pop(),i.trys.pop();continue}o=t.call(e,i)}catch(s){o=[6,s],r=0}finally{n=a=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}var ew=function(){var e=(0,nl.useCommunicatorUIState)(["toggleLeftPanel","toggleRightPanel"]),t=e.toggleRightPanel,n=e.toggleLeftPanel,o=(0,c.useLocalizationState)().t,s=(0,i.useInteractionStateSelector)((function(e){return e.missedCallsAmount})),l=(0,yo.useNavigationState)(),f=l.activePage,m=l.setActivePage,p=function(){var e=(0,c.useLocalizationState)().t,t=(0,nl.useDirectoryUIState)((function(e){return e.createContactMode&&e.tabIndex===hb.external})),n=(0,yo.useNavigationState)().activePage,o=(0,a.useMemo)((function(){var n;return G_(n={},yo.AppRoutes.Recents,e.ADDRESS_BOOK_AREA.addressBook_recents()),G_(n,yo.AppRoutes.Dial,e.ADDRESS_BOOK_AREA.addressBook_dial()),G_(n,yo.AppRoutes.Favorites,e.ADDRESS_BOOK_AREA.addressBook_favorites()),G_(n,yo.AppRoutes.Directory,t?e.CONTACT.create_contact():e.ADDRESS_BOOK_AREA.addressBook_directory()),G_(n,yo.AppRoutes.Cases,e.CRM.crm_case_tab()),G_(n,yo.AppRoutes.Interactions,""),G_(n,yo.AppRoutes.Calendar,(0,r.jsx)(W_,{className:"left-[-140px]"})),G_(n,yo.AppRoutes.ContactDetails,e.ADDRESS_BOOK_AREA.contact()),n}),[t,e]);return o[n.name]}(),v=(0,at.useSessionState)(),h=v.serverOrigin,b=v.userId,g=v.privileges,j=(0,I.useNotificationsState)("methods").showNotification,S=(0,u.useIntegrationApiState)().integrationKey,O=(0,u.useIntegrationApiStateMethods)().requestRecordOnScreen,x=Z_((0,a.useState)(!1),2),C=x[0],_=x[1],w=Z_((0,a.useState)(0),2),N=w[0],A=w[1],P=(0,a.useCallback)((function(){m({name:yo.AppRoutes.Interactions})}),[m]),E=(0,a.useCallback)(Q_((function(){var e,t;return J_(this,(function(n){switch(n.label){case 0:return b?(_(!0),e={userId:b},S?[4,O()]:[3,2]):[2];case 1:t=n.sent(),e.params={crmType:S,crmObjectType:null==t?void 0:t.type,crmObjectId:null==t?void 0:t.id},n.label=2;case 2:return(0,Fi.apiRequests)(h).requestDirectChatInvitationLink({requestBody:e}).then((function(e){var t=e.URL,n=e.expiresIn;"safari"!==Zt.platformInfo.browser?(y.clipboard.copy(t),A((function(e){return++e}))):j({type:"success",id:I.Notifications.DirectChatSafariConfirmation,duration:1e3*n,closable:!0,content:(0,r.jsx)(K_,{url:t})})})).catch((function(e){console.error("Unable to get direct chat invitation link:",e)})).finally((function(){return _(!1)})),[2]}}))})),[b,h,S,O,j]);return(0,r.jsxs)(r.Fragment,{children:[f.name!==yo.AppRoutes.Interactions&&(0,r.jsx)(sy,{action:P}),(0,r.jsxs)("header",{className:PC.header,role:"none",children:[(0,r.jsxs)("div",{className:PC.headerTop,children:[(0,r.jsx)("div",{className:PC.agentState,children:(0,r.jsx)(VC.ActiveStatusControlCommunicator,{toggleLeftPanel:n})}),(0,r.jsx)(d.SmHeader,{as:"h3",className:PC.pageTitle,role:"heading","aria-level":"1",children:p}),(0,r.jsxs)("div",{className:PC.rightButtons,children:[g.DIRECT_CHAT_INVITATION&&(0,r.jsxs)(r.Fragment,{children:[!!N&&(0,r.jsx)(d.SmLabel,{pointing:"right",className:PC.copiedLabel,children:o.HOME_SCREEN.direct_chat_invitation_link_copied_label()},N),(0,r.jsx)(L.SemanticButton,{className:PC.directChat,onClick:E,tooltip:o.HOME_SCREEN.request_direct_chat_invitation_link_button_tooltip(),"data-key":"direct-chat-invitation-button",enabledInOffline:!1,disabled:C,basic:!0,icon:!0,compact:!0,children:(0,r.jsx)(ve.IconDirectChatInvitation,{})})]}),(0,r.jsxs)(L.SemanticButton,{className:PC.hamburger,onClick:t,tooltip:o.HOME_SCREEN.menu_icon_tooltip(),"data-testid":"menu-button",basic:!0,enabledInOffline:!0,icon:!0,compact:!0,children:[(0,r.jsx)(d.SmIcon,{name:"bars"}),(0,r.jsx)(L.MissedCallsBadge,{className:"absolute bottom-0 right-0 translate-x-1/3 translate-y-1/3",amount:s})]})]})]}),(0,r.jsx)(V_.OfflineBar,{className:PC.offlineBar})]})]})},tw=function(){var e=(0,g.useNonParalleledDeliveredItems)(),t=(0,g.useSelectedItems)(e),n=t.selectedItemId,a=t.setSelectedItemId;return(0,yo.useNavigationState)().activePage.name!==yo.AppRoutes.Interactions?null:(0,r.jsx)(s.InteractionContextProvider,{interactionId:n,children:(0,r.jsx)(Eg,{itemIds:e,selectedItemId:n,setSelectedItemId:a})})},nw=o().memo((function(){var e=(0,nl.useCommunicatorUIState)(["leftPanelOpened","toggleLeftPanel"]),t=e.leftPanelOpened,n=e.toggleLeftPanel,o=(0,a.useCallback)((function(){return n(!1)}),[n]);return(0,y.useEscapeManager)(o,{enabled:t}),(0,r.jsx)(d.SmSidebar,{animation:"overlay",direction:"left",onHide:o,visible:t,className:T()("overflow-hidden",PC.sidebar),"data-page-section":"sidebar sidebar_left","data-testid":"left-sidebar",children:(0,r.jsx)(L.FocusTrap,{enabled:t,delayFocus:500,className:"flex h-full flex-col",children:(0,r.jsx)(VC.AgentStatuses,{closePanel:o})})})})),rw=(0,L.createComponentLoader)("calendar",(function(){return n.e(662).then(n.t.bind(n,5662,23))}),"CalendarModalsAutoOpener").CalendarModalsAutoOpenerLoader,aw=o().memo((function(){var e,t,o,s,l,c=(0,nl.useCommunicatorUIState)(["leftPanelOpened","rightPanelOpened","toggleLeftPanel","toggleRightPanel","toggleSettings"]),u=c.leftPanelOpened,f=c.rightPanelOpened,m=c.toggleLeftPanel,p=c.toggleRightPanel,v=c.toggleSettings,h=(0,yo.useNavigationState)(),b=h.activePage,y=h.setActivePage;e=(0,ln.useAppConfigStateMethods)().checkWhetherToRenderReportProblemButton,t=(0,at.useSessionState)(),o=t.isLoggedIn,s=t.tenantId,(0,a.useEffect)((function(){o&&s&&e(s)}),[e,o,s]),function(){var e=(0,nl.useCommunicatorUIState)(["toggleLeftPanel","toggleRightPanel"]),t=e.toggleRightPanel,n=e.toggleLeftPanel,r=(0,ie.useModalsState)((function(e){return e.modals.some((function(e){return"notification"===e.id}))}));(0,a.useEffect)((function(){r&&(t(!1),n(!1))}),[r,t,n])}(),(0,op.useAppDefaultSettings)({modals:KC}),function(){var e=(0,at.useSessionState)().offerPhoneSelection,t=(0,a.useRef)(),n=(0,nl.useCommunicatorUIState)(["toggleRightPanel","toggleSettings"]),r=n.toggleRightPanel,o=n.toggleSettings;(0,a.useEffect)((function(){t.current&&!e&&(r(!0),o(!0)),t.current=e}),[e])}(),fn(),(0,Jt.useIncomingChatMessageAudioNotifications)(!0),l=(0,at.useSessionState)("privileges"),(0,a.useMemo)((function(){l.CAN_START_INTERNAL_CHAT&&n.e(975).then(n.t.bind(n,9975,23)),l.CAN_USE_CALENDAR&&n.e(662).then(n.t.bind(n,5662,23))}),[l.CAN_START_INTERNAL_CHAT,l.CAN_USE_CALENDAR]);var g=(0,a.useCallback)((function(e,t){var n={name:e};t&&(n.params=t),y(n),p(!1)}),[p,y]),j=function(e){var t=e.toggleSettings,n=e.toggleLeftPanel,r=e.onMenuItemClick,o=e.toggleRightPanel,s=e_((0,a.useState)(!1),2),l=s[0],c=s[1],u=(0,i.useInteractionStateMethods)().activateItem,d=(0,yo.useNavigationState)("setActivePage"),f=(0,a.useCallback)((function(e,t){c(!1),r(e,t)}),[r]),m=(0,a.useCallback)((function(){c(!1),o(!0),t(!0)}),[o,t]),p=(0,a.useCallback)((function(){c(!1),n(!0)}),[n]),v=(0,a.useCallback)((function(e){c(!1),u(e.id);var t={name:yo.AppRoutes.Interactions};e.userId&&(t.params={userId:e.userId}),e.contactId&&(t.params={contactId:e.contactId}),d(t)}),[u,d]);return{isMinimized:l,setIsMinimized:c,onMinimizedMenuItemClick:f,onMinimizedSettingsClick:m,onMinimizedAgentStateClick:p,onMinimizedInteractionClick:v,onMenuItemClick:r}}({toggleLeftPanel:m,toggleRightPanel:p,toggleSettings:v,onMenuItemClick:g}),I=j.isMinimized,S=j.setIsMinimized,O=j.onMinimizedAgentStateClick,x=j.onMinimizedInteractionClick,C=j.onMinimizedMenuItemClick,_=j.onMinimizedSettingsClick;return ZC({isMinimized:I,toggleRightPanel:p,toggleSettings:v,setIsMinimized:S}),(0,r.jsxs)(RC.DndProvider,{backend:FC.HTML5Backend,children:[I&&(0,r.jsx)(YC,{activePageName:b.name,onMenuItemClick:C,onSettingsClick:_,onAgentStateClick:O,onInteractionClick:x}),(0,r.jsxs)(d.SmSegment.Group,{className:M(PC.outerWrapper,I&&PC.invisible),"data-page-section":"main-page",id:"mainContainer",children:[(0,r.jsx)(HC,{className:PC.notifications}),(0,r.jsxs)(d.SmSidebar.Pushable,{as:d.SmSegment.Group,className:PC.wrapper,children:[(0,r.jsx)(nw,{}),(0,r.jsx)(I_,{activePageName:b.name,onMenuItemClick:g}),(0,r.jsxs)(d.SmSidebar.Pusher,{"data-page-section":"main-content",dimmed:u||f,className:PC.pusher,children:[(0,r.jsx)(ew,{}),(0,r.jsx)(tw,{}),(0,r.jsx)(LC,{})]}),(0,r.jsx)(z_,{})]})]}),(0,r.jsx)(H_,{}),(0,r.jsx)(rw,{})]})})),ow=function(){var e=(0,Cn.useUIState)().isTabNavHighlighted;return(0,r.jsx)(d.SmContainer,{className:M("relative bg-main-bg text-main",{"[&_*:focus-within]:!outline-none [&_*:focus]:!outline-none":!e,"[&_*:focus-within]:!outline-0 [&_*:focus]:!outline-0":!e}),children:(0,r.jsxs)(j.ToastProvider,{children:[(0,r.jsx)(aw,{}),(0,r.jsx)(cc.Modals,{}),(0,r.jsx)(L.AriaStatuses,{})]})})},iw=n(898),sw=n(4344),lw=n(3381),cw=n(9084),uw=n(313),dw=n(847),fw=n(1503),mw=n(5165),pw=n(7347),vw=function(e,t,n){var r,a,o,i,s,c,u,d,f,m,p,v,h,b,y,g={interactionId:t.id,globalInteractionId:null===(r=t.scenarioData)||void 0===r?void 0:r.globalInteractionId,state:t.state,type:t.mediaType,phoneNumber:t.displayData.number,email:t.displayData.email,callDirection:t.direction,callMuted:null!==(v=null===(a=t.callData)||void 0===a?void 0:a.muted)&&void 0!==v&&v,callRecording:null!==(h=t.displayData.isRecording)&&void 0!==h&&h,startTime:t.displayData.deliveredStartTime,endTime:t.displayData.acwStartTime,duration:t.displayData.deliveredStartTime&&t.displayData.acwStartTime&&Math.floor((t.displayData.acwStartTime-t.displayData.deliveredStartTime)/1e3)||void 0,description:(0,X.getItemNotes)(t).join("\n"),disposition:null===(i=t.dispositionData)||void 0===i||null===(o=i.disposition)||void 0===o?void 0:o.name,service:null===(s=t.scenarioData)||void 0===s?void 0:s.serviceName,playbackUrl:t.playbackUrl?(0,Fi.getPlaybackUrl)(e,t.playbackUrl):void 0,recordingUrl:(null===(c=t.scenarioData)||void 0===c?void 0:c.interactionStepId)?(0,Fi.getRecordingUrl)(e,t.scenarioData.interactionStepId):void 0,DNIS:null===(u=t.callData)||void 0===u?void 0:u.destination,ANI:null===(d=t.callData)||void 0===d?void 0:d.fromNumber,callParties:((0,X.getPhoneParties)(t)||[]).map((function(e){return{id:e.id,name:e.name,phone:e.phone,userId:e.userId}})),chatParties:(t.chatParties||[]).filter((function(e){return(0,l.array)(pw.chatPartyTypes).includes(e.type)})).map((function(e){return{id:e.party_id,type:e.type,name:n(e.first_name||"",e.last_name||""),userId:e.user_id,contactId:e.contact_id,email:e.email,phone:e.phone}})),attachedData:(null===(f=t.scenarioData)||void 0===f?void 0:f.attachedData)||{},origination:t.origination,subject:"",associatedObjects:{list:null!==(b=null===(m=t.associatedObjects)||void 0===m?void 0:m.list)&&void 0!==b?b:[],selected:null!==(y=null===(p=t.associatedObjects)||void 0===p?void 0:p.selected)&&void 0!==y?y:[]}};return(0,l.withoutUndefinedKeys)(g)};function hw(e){return{id:e.id,displayName:e.name,isSupervised:!!e.supervised,usersCount:e.usersCount}}function bw(e){return{id:e.id,name:e.name,useDispositions:e.useDispositions,requireDisposition:e.requireDispositions}}function yw(e){return{id:e.id,number:e.externalNumber.toString(),isSMS:e.isSMS,isVoice:e.isVoice}}function gw(e){return{id:e.id,code:e.code,name:e.name,type:e.type}}function jw(e){return{allowed:e.vncInit,active:e.started,muted:e.muted}}function Iw(e,t){return{code:pw.serverErrorCodes[e],name:e,timestamp:Date.now(),message:t||"Message undefined"}}function Sw(e,t,n){switch(e){case"auth":switch(t){case 1:return Iw("invalid_credentials",n);case 2:return Iw("other_user_logged_with_phone",n);case 3:return Iw("invalid_token",n);case 4:return Iw("user_already_logged_in",n);case 5:return Iw("logged_users_limit_reached",n);case 6:return Iw("tenant_disabled",n);case 12:return Iw("already_logged_in_with_the_same_session",n)}break;case"agentServer":switch(t){case 1:return Iw("forced_logout_by_other_client",n);case 2:case 6:return Iw("not_enough_privileges",n);case 3:return Iw("invalid_request",n);case 4:case 9:return Iw("phone_not_registered",n);case 5:return Iw("phone_not_in_dial_plan",n);case 7:return Iw("forced_logout_by_supervisor",n);case 8:return Iw("tenant_disabled",n);case 10:return Iw("destination_user_not_logged",n);case 11:return Iw("user_disabled_or_deleted",n)}break;case"3pcc":return Iw("sip_server_error",n)}return Iw("unknown_error",n)}function Ow(e){return{canAnswer:!!e.canAnswer,canDial:!!e.canDial,canHold:!!e.canHold,canRetrieve:!!e.canRetrieve}}function xw(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function Cw(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var _w=function(){function e(t){!function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}(this,e),Cw(this,"timeout",void 0),Cw(this,"pendingRequests",void 0),this.timeout=t,this.pendingRequests={}}var t,n,r;return t=e,(n=[{key:"newPendingRequest",value:function(e,t){var n=this;return new Promise((function(r,a){n.pendingRequests[e]||(n.pendingRequests[e]=[]);var o={id:(0,En.uuid)(),resolve:r,reject:a,payload:t},i=n.pendingRequests[e];(0,l.assertDefined)(i),i.push(o),setTimeout((function(){-1!==i.indexOf(o)&&a("Agent Desktop is unable to complete your "+"request in the specified timeout ".concat(n.timeout," ms"))}),n.timeout)}))}},{key:"resolvePendingRequest",value:function(e,t,n){var r=(this.pendingRequests[e]||[]).find((function(e){return e.id===n}));if(r){var a=this.pendingRequests[e].indexOf(r);-1!==a&&(r.resolve(t),this.pendingRequests[e].splice(a,1))}}},{key:"rejectPendingRequest",value:function(e,t,n){var r=this.pendingRequests[e],a=null==r?void 0:r.find((function(e){return e.id===n}));if(r&&a){var o=r.indexOf(a);-1!==o&&(a.reject(t),r.splice(o,1))}}},{key:"resolveAllPendingRequests",value:function(e,t){var n,r=this;null===(n=this.pendingRequests[e])||void 0===n||n.forEach((function(n){r.resolvePendingRequest(e,t,n.id)}))}},{key:"rejectAllPendingRequests",value:function(e,t){var n,r=this;null===(n=this.pendingRequests[e])||void 0===n||n.forEach((function(n){r.rejectPendingRequest(e,t,n.id)}))}}])&&xw(t.prototype,n),r&&xw(t,r),e}();function ww(e){return new _w(e)}function Nw(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function Aw(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Pw(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Aw(e,t,n[t])}))}return e}function Ew(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}function Dw(e){return function(e){if(Array.isArray(e))return Nw(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return Nw(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return Nw(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var Tw={noChatInService:(0,iw.resultError)("no_chat_in_service","Selected service has not associated chat entry"),noChannelInService:(0,iw.resultError)("no_channel_in_service","No service selected or service is not suitable for this action"),noNumber:(0,iw.resultError)("empty_number","Number is empty"),noService:(0,iw.resultError)("no_service","Service is required, but not selected"),selfCall:(0,iw.resultError)("self_call","Recursive call to yourself"),noDIDPermissionsSMS:(0,iw.resultError)("no_permissions_did_sms","No permissions to start SMS chat with a selected DID number"),noDIDPermissionsCall:(0,iw.resultError)("no_permissions_did_call","No permissions to start SMS chat with a selected DID number"),messageTooBig:(0,iw.resultError)("invalid_args","A single message size exceeded its limit")},kw=un.bpLogger.withPrefix("@API_con"),Mw=function(e,t,n){var r=e.currentTabDataProvider,a=e.integrationApiConnector,o=e.sessionConnector,i=t.sharedConnectors,s=i.interactionStateConnector.dispatch,c=i.agentStateConnector.dispatch,u=i.directoryStateConnector.dispatch,d=i.servicesDispositionsStateConnector.dispatch,f=i.didStateConnector.dispatch,m=i.bpClientStateConnector.dispatch,p=i.interactionChatStateConnector.dispatch,v=ww(5e3),h={},b={},g={},j={},I=(0,ar.getInitialInteractionState)(),S=(0,fw.getInitialSessionState)(),O=(0,dw.getInitialServicesDispositionsState)(),x=(0,lw.getInitialDidState)(),C=(0,mw.getInitialTimezonesState)(),_=(0,Wc.getInitialDirectoryState)(),w=(0,sw.getInitialBPClientState)(),N=(0,uw.getInitialRASharedState)(),A=(0,iw.getInitialIntegrationApiState)(),P=function(e,t){return(0,rt.formatFullName)(S.displayNameFormat,e,t)},E=function(e,t){var r="call"===e?{skip:["noChatInService"]}:{},a="call"===e?"call":"sms",o=n.current.getService(),i=n.current.getDIDNumber();return Dw(i?(0,cw.getDIDNumberErrorRaw)({options:Ew(Pw({},r),{interactionType:a}),selectedDIDNumber:i,didNumbers:x.didNumbers}):(0,cw.getServiceErrorsRaw)({options:r,selectedService:o,services:O.services,serviceRequiredForOutboundCall:O.serviceRequiredForOutboundCall})).concat(Dw((0,cw.getNumberErrorsRaw)({options:{number:t},selfPhoneNumber:S.phoneNumber}))).map((function(e){return Tw[e]}))},D=function(e){var t=I.items.find((function(e){return e.id===I.activeItemId})),n=e?I.items.find((function(t){return t.id===e})):t;if(!n)throw new iw.ApiError("no_interaction",e?'No interaction with id "'.concat(e,'"'):"No active interaction");return n},T=function(e){var t,n=(0,X.getGlobalInteractionId)(e);return n?null===(t=N.items[n])||void 0===t?void 0:t.pin:void 0},k=function(e){var t,n=(0,X.getGlobalInteractionId)(e);return n?null===(t=N.items[n])||void 0===t?void 0:t.sessionId:void 0},M=function(){if(!S.isLoggedIn)throw new iw.ApiError("not_logged_in","You are not logged in")},L=function(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(t.some((function(e){return!S.privileges[e]})))throw new iw.ApiError("not_enough_privileges","Not allowed")},R=function(e){j.state===e.state&&j.notReadyReason===e.notReadyReason&&!!j.reservedForIncomingInteraction==!!e.reservedForIncomingInteraction||a.dispatch.agentStateChange({state:e.state?e.state:"supervising",reservedForIncomingInteraction:!!e.reservedForIncomingInteraction,notReadyReason:e.notReadyReason})},F=i.agentStateConnector.dispenser.subscribe({onInitialState:function(e){R(e),j=Pw({},e)},onChange:function(e){var t=Pw({},j,e);R(t),j=t}}),B=function(e){I.activeItemId&&!e.activeItemId&&a.dispatch.activeInteractionSwitched(null)},U=function(e){try{if("queued"===e.state)return;if(b[e.id]){var t=I.items.find((function(t){return t.id===e.id})),n=t&&vw(S.serverOrigin,t,P),r=vw(S.serverOrigin,e,P);(0,$.isEqual)(n,r)||a.dispatch.interactionStateChange(r)}else b[e.id]=!0,h[e.id]=!0,a.dispatch.newInteraction(vw(S.serverOrigin,e,P));if(e.mediaType&&"unknown"!==e.mediaType&&h[e.id]){var o,i=null===(o=A.pendingAssociatedObjects[e.mediaType])||void 0===o?void 0:o.objects;i&&(a.dispatch.removePendingAssociatedObjects(e.mediaType),i.forEach((function(t){s.addAssociatedObject(e.id,t,{force:!0,primary:!1})}))),delete h[e.id]}}catch(Iw){kw.error("onInteractionItemChange error:",(0,y.getErrorMessage)(Iw))}},z=i.interactionStateConnector.dispenser.subscribe({onInitialState:function(e){h={},b={},g={},e.items.forEach((function(e){return U(e)})),B(e),I=Pw({},e)},onChange:function(e){B(e),I=Pw({},I,e)},onNewItem:function(e){U(e)},onItemChanged:function(e){U(e)},onItemRemoved:function(e){try{delete h[e.id],delete b[e.id],delete g[e.id];var t,n=vw(S.serverOrigin,e,P);a.dispatch.interactionRemoved(n);var r=function(e,t){var n,r,a,o,i,s,c,u,d,f,m,p,v,h={interactionId:t.id,globalInteractionId:null===(n=t.scenarioData)||void 0===n?void 0:n.globalInteractionId,state:t.state,type:t.mediaType,associatedObjects:{list:null!==(m=null===(r=t.associatedObjects)||void 0===r?void 0:r.list)&&void 0!==m?m:[],selected:null!==(p=null===(a=t.associatedObjects)||void 0===a?void 0:a.selected)&&void 0!==p?p:[]},phoneNumber:t.displayData.number,email:t.displayData.email,callDirection:t.direction,startTime:t.displayData.deliveredStartTime,endTime:t.displayData.acwStartTime,duration:t.displayData.deliveredStartTime&&t.displayData.acwStartTime&&Math.floor((t.displayData.acwStartTime-t.displayData.deliveredStartTime)/1e3)||void 0,description:(null!==(v=(0,X.getItemNotes)(t))&&void 0!==v?v:[]).join("\n"),disposition:null===(i=t.dispositionData)||void 0===i||null===(o=i.disposition)||void 0===o?void 0:o.name,service:null===(s=t.scenarioData)||void 0===s?void 0:s.serviceName,playbackUrl:t.playbackUrl?(0,Fi.getPlaybackUrl)(e,t.playbackUrl):void 0,recordingUrl:(null===(c=t.scenarioData)||void 0===c?void 0:c.interactionStepId)?(0,Fi.getRecordingUrl)(e,t.scenarioData.interactionStepId):void 0,DNIS:null===(u=t.callData)||void 0===u?void 0:u.destination,ANI:null===(d=t.callData)||void 0===d?void 0:d.fromNumber,attachedData:(null===(f=t.scenarioData)||void 0===f?void 0:f.attachedData)||{},origination:t.origination,subject:"",callParties:[],chatParties:[],callMuted:!1,callRecording:!1};return(0,l.withoutUndefinedKeys)(h)}(null!==(t=A.integrationKey)&&void 0!==t?t:"",e);a.dispatch.saveActivityRecord(r)}catch(Iw){kw.error("onItemRemoved error:",(0,y.getErrorMessage)(Iw))}},onActivateItemAttempt:function(e){var t=A.integrationKey;if(t){var n=(0,X.getMainItem)(I.items,e),r=(0,X.getMainItem)(I.items,I.items.find((function(e){return e.id===I.activeItemId})));n&&n.activeCrmScreen&&n.activeCrmScreen[t]&&n.id!==(null==r?void 0:r.id)&&a.dispatch.showScreen(n.activeCrmScreen[t],e.id)}},onActiveItemChanged:function(e){a.dispatch.activeInteractionSwitched(e.id)}}),H=i.servicesDispositionsStateConnector.dispenser.subscribe({onInitialState:function(e){O=Pw({},e)},onChange:function(e){O=Pw({},O,e)}}),V=i.didStateConnector.dispenser.subscribe({onInitialState:function(e){x=Pw({},e)},onChange:function(e){x=Pw({},x,e)}}),G=function(e,t){if(t.phoneDeviceCapabilities){var n=Ow(e.phoneDeviceCapabilities),r=Ow(t.phoneDeviceCapabilities);n.canRetrieve===r.canRetrieve&&n.canHold===r.canHold&&n.canDial===r.canDial&&n.canAnswer===r.canAnswer||a.dispatch.phoneCapabilitiesChange(r)}!e.loginError&&t.loginError&&v.rejectAllPendingRequests("onLogin",t.loginError)},W=o.dispenser.subscribe({onInitialState:function(e){e.isLoggedIn&&(v.resolveAllPendingRequests("onLogin",void 0),a.dispatch.login({isLoggedIn:!0,agentId:e.userId,username:e.loginId,sessionId:e.sessionId})),G(S,e),S=Pw({},e)},onChange:function(e){var t=S;S=Pw({},S,e),G(t,S)},onLogin:function(e){v.resolveAllPendingRequests("onLogin",void 0),a.dispatch.login({isLoggedIn:!0,agentId:e.userId,username:e.loginId,sessionId:e.sessionId})},onLogout:function(){a.dispatch.logout()},onServerError:function(e,t,n){a.dispatch.serverError(Sw(e,t,n))},onBadCallQualityAlert:function(e,t){a.dispatch.callAudioQualityAlert(e,t)}}),q=i.timezonesStateConnector.dispenser.subscribe({onInitialState:function(e){C=Pw({},e)},onChange:function(e){C=Pw({},C,e)}}),Y=i.directoryStateConnector.dispenser.subscribe({onInitialState:function(e){_=Pw({},e)},onChange:function(e){_=Pw({},_,e)}}),K=function(e){var t=jw(w.screenRecording),n=jw(e.screenRecording);t.allowed===n.allowed&&t.active===n.active&&t.muted===n.muted||a.dispatch.screenRecordingStateChange(n),w.softphone.ready===e.softphone.ready&&w.softphone.error===e.softphone.error||a.dispatch.softphoneStatusChange(e.softphone.ready,e.softphone.error),w.audioDevice.input===e.audioDevice.input&&w.audioDevice.output===e.audioDevice.output||a.dispatch.audioDeviceChange(e.audioDevice.input,e.audioDevice.output)},Q=i.bpClientStateConnector.dispenser.subscribe({onInitialState:function(e){K(e),w=Pw({},e)},onChange:function(e){var t=Pw({},w,e);K(t),w=t}}),Z=i.remoteAssistStateConnector.dispenser.subscribe({onInitialState:function(e){N=Pw({},e)},onChange:function(e){N=Pw({},N,e)}}),J=function(e){A.isAvailable!==e.isAvailable&&r.setIntegrationApiActive(e.isAvailable)},ee=a.dispenser.subscribe({onInitialState:function(e){J(e),A=Pw({},e)},onChange:function(e){var t=Pw({},A,e);J(t),A=t}}),te=a.dispenser.subscribe({onGetConfig:function(){return"salesforce"===A.integrationKey?Promise.resolve({clickAction:"call"}):Promise.resolve({})},onStartCall:function(e,t){M();var r=A.adapterUrlParams,o=r&&r.deferredDial,i=t.map((function(e){return Ew(Pw({},e),{source:A.integrationKey||""})}));if(o&&"0"!==o&&n.current.deferredDial&&i.length)return a.dispatch.setDeferredDialData({number:e,objects:i}),n.current.deferredDial(e),Promise.resolve({id:null});var l=E("call",e);if(l.length)throw new iw.ApiError(l[0].name,l[0].message);return n.current.showInteractionPage(),s.initiateCall({phone:e,accessNumberId:n.current.getDIDNumber(),serviceId:n.current.getService(),associatedRecords:i,origination:"integration-api"}).then((function(e){var t;return{id:e.id,error:null===(t=e.error)||void 0===t?void 0:t.message}}))},onStartChat:function(e,t,r){M();var o=A.adapterUrlParams,i=o&&o.deferredDial,l=r.map((function(e){return Ew(Pw({},e),{source:A.integrationKey||""})}));if(i&&"0"!==i&&n.current.deferredDial&&l.length)return a.dispatch.setDeferredDialData({number:t,objects:l}),n.current.deferredDial(t),Promise.resolve({id:null});if("sms"===e){var c=E("smsChat",t);if(c.length)throw new iw.ApiError(c[0].name,c[0].message)}var u=s.initiateChat({address:t,channel:e,serviceId:n.current.getService(),accessNumberId:n.current.getDIDNumber(),origination:"integration-api"});return l&&a.dispatch.addPendingAssociatedObjects("chat",l),n.current.showInteractionPage(),u.then((function(e){var t;return{id:e.id,error:null===(t=e.error)||void 0===t?void 0:t.message}}))},onStartEmail:function(e,t){throw M(),new iw.ApiError("api_method_not_implemented","Email interactions is not implemented")},onGetAgentState:function(){return M(),Promise.resolve({state:j.state?j.state:"supervising",reservedForIncomingInteraction:!!j.reservedForIncomingInteraction,notReadyReason:j.notReadyReason})},onSetAgentState:function(e,t){var n;if(M(),L("SYS_RECEIVE_AUTOMATICALLY_DISTRIBUTED_CALLS"),"not_ready"===e&&!t)throw new iw.ApiError("invalid_args","not_ready state requires notReadyReason to be present");if("not_ready"===e&&t&&!(null===(n=j.notReadyReasons)||void 0===n?void 0:n.includes(t)))throw new iw.ApiError("invalid_args",'Unknown not ready reason: "'.concat(t,'"'));return c.setState({state:"supervising"===e?"":e,reason:t}),Promise.resolve()},onSwitchActiveInteraction:function(e){return M(),D(e),s.activateItem(e),Promise.resolve()},onSetVariable:function(e,t,n){M();var r=D(n);return s.setScenarioVariables(Aw({},e,t),(0,X.getInteractionStepId)(r)),Promise.resolve()},onGetVariables:function(e,t){M();var n=D(t);return s.getScenarioVariables({itemId:n.id,variableNames:e})},onLeaveInteraction:function(e){M();var t=D(e),n=t?t.state:"";if("delivered"!==n&&"hold"!==n&&"delivery_pending"!==n&&"IVR"!==n)throw new iw.ApiError("not_suitable_state","The interaction is in the '".concat(n,"' state and cannot be terminated."));return s.disconnectItem(t.id),Promise.resolve()},onCompleteInteraction:function(e){var t,n,r,a,o;M();var i=D(e),l=(null==i?void 0:i.state)||"",c=(null==i?void 0:i.internalChatData)||"",u=(null===(t=i.scenarioData)||void 0===t?void 0:t.serviceId)||(null===(n=i.workitemData)||void 0===n?void 0:n.serviceId),d=u?null==O?void 0:O.services[u]:void 0,f=null==d?void 0:d.requireDispositions,m=null===(r=i.dispositionData)||void 0===r?void 0:r.disposition,p=null===(o=i.dispositionData)||void 0===o||null===(a=o.disposition)||void 0===a?void 0:a.rescheduleFrom;if(f&&!m)throw new iw.ApiError("no_disposition","Cannot complete interaction without a set disposition. It is required.");if(p&&(0,y.isBefore)(p))throw new iw.ApiError("invalid_request","Reschedule date is in the past.");if(c&&s.agentChatClose(i.id),!("wrap_up"===l||"wrap_up_hold"===l||i.callData&&"failed"===i.callData.callState||"workitem"===i.mediaType&&"delivered"===l))throw new iw.ApiError("not_suitable_state",'The interaction is in the "'.concat(l,'" state and cannot be completed.'));return s.completeItem(i.id),Promise.resolve()},onLeaveAndCompleteInteraction:function(e,t,n){var r,a;M();var o=D(n);if(!["delivered","hold","delivery_pending","IVR"].includes(o.state))throw new iw.ApiError("not_suitable_state","The interaction is in the '".concat(o.state,"' state and cannot be terminated."));var i=(null===(r=o.scenarioData)||void 0===r?void 0:r.serviceId)||(null===(a=o.workitemData)||void 0===a?void 0:a.serviceId),l=Object.values(O.services).find((function(e){return e.id===i}));if(!l)throw new iw.ApiError("object_not_found",'Unable to get service (id: "'.concat(i,'") info for requested interaction (id: "').concat(o.id,'")'));if(l.requireDispositions&&!e)throw new iw.ApiError("no_disposition",'Interaction with service "'.concat(l.name,'" requires disposition'));if(e){var c,u=Object.values(null!==(c=null==O?void 0:O.dispositions[l.id])&&void 0!==c?c:{}).find((function(t){return[t.id,t.code,t.name].includes(e)}));if(!u)throw new iw.ApiError("object_not_found",'There is no disposition with id/code/name "'.concat(e,'" for service "').concat(l.name,'"'));s.setDisposition({itemId:o.id,disposition:{id:u.id,name:u.name}})}return t&&s.addNote({itemId:o.id,note:t}),setTimeout((function(){s.disconnectItem(o.id),setTimeout((function(){s.completeItem(o.id)}))})),Promise.resolve()},onGetServicesList:function(){M();var e=Object.values(O.services);return e.length?(d.requestServices(),Promise.resolve(e.map((function(e){return bw(e)})))):d.requestServices().then((function(e){var t;return null!==(t=null==e?void 0:e.map((function(e){return bw(e)})))&&void 0!==t?t:[]}))},onGetService:function(){M();var e=n.current.getService();if(!e)return Promise.resolve(null);var t=O.services[e];if(!t)throw new iw.ApiError("object_not_found","Unable to resolve selected service. Try to refresh services list data.");return Promise.resolve(bw(t))},onSetService:function(e){if(M(),null===e)return n.current.setService(),Promise.resolve();var t=Object.values(O.services),r=t.find((function(t){return t.id===e}));if(r)n.current.setService(r.id);else{var a=t.find((function(t){return t.name===e}));if(!a)throw new iw.ApiError("object_not_found",'There is no service with id/name "'.concat(e,'"'));n.current.setService(a.id)}return Promise.resolve()},onGetDIDNumbersList:function(){M();var e=Object.values(x.didNumbers);return e.length?(f.requestDIDNumbers(void 0),Promise.resolve(e.map((function(e){return yw(e)})))):f.requestDIDNumbers(S.phoneNumber).then((function(e){var t;return null!==(t=null==e?void 0:e.map((function(e){return yw(e)})))&&void 0!==t?t:[]}))},onGetDIDNumber:function(){M();var e=n.current.getDIDNumber();if(!e)return Promise.resolve(null);var t=x.didNumbers[e];if(!t)throw new iw.ApiError("object_not_found","Unable to resolve selected did number. Try to refresh did numbers list data.");return Promise.resolve(yw(t))},onSetDIDNumber:function(e){if(M(),null===e)return n.current.setDIDNumber(),Promise.resolve();var t=Object.values(x.didNumbers),r=t.find((function(t){return t.id===e}));if(r)n.current.setDIDNumber(r.id);else{var a=t.find((function(t){return t.externalNumber.toString()===e}));if(!a)throw new iw.ApiError("object_not_found",'There is no DID number with id/number "'.concat(e,'"'));n.current.setDIDNumber(a.id)}return Promise.resolve()},onGetDispositionsList:function(e){var t=e.service,n=e.interactionId;M();var r=t;if(!t){var a,o,i=D(n);r=(null===(a=i.scenarioData)||void 0===a?void 0:a.serviceId)||(null===(o=i.workitemData)||void 0===o?void 0:o.serviceId)}if(!r)throw new iw.ApiError("object_not_found","Service associated with active interaction not found");var s=Object.values(O.services);if(s.length){var l=s.find((function(e){return e.id===r||e.name===r}));if(!l)throw new iw.ApiError("object_not_found",'There is no service with id/name "'.concat(t,'"'));r=l.id}else d.requestServices();var c=Object.values(O.dispositions[r]||{});return c.length?(d.requestServiceDispositions(r),Promise.resolve(c.map((function(e){return gw(e)})))):d.requestServiceDispositions(r).then((function(e){var t;return null!==(t=null==e?void 0:e.map((function(e){return gw(e)})))&&void 0!==t?t:[]}))},onSetDisposition:function(e,t){var n,r;M();var a,o,i=D(t),l=(null===(n=i.scenarioData)||void 0===n?void 0:n.serviceId)||(null===(r=i.workitemData)||void 0===r?void 0:r.serviceId),c=Object.values(null!==(a=null==O?void 0:O.services)&&void 0!==a?a:{}).find((function(e){return e.id===l}));if(!c)throw new iw.ApiError("object_not_found",'Unable to get service (id: "'.concat(l,'") info for requested interaction (id: "').concat(i.id,'")'));var u=Object.values(null!==(o=null==O?void 0:O.dispositions[c.id])&&void 0!==o?o:{}).find((function(t){return[t.id,t.code,t.name].includes(e)}));if(!u)throw new iw.ApiError("object_not_found",'There is no disposition with id/code/name "'.concat(e,'" for service "').concat(c.name,'"'));return s.setDisposition({itemId:i.id,disposition:{id:u.id,name:u.name}}),Promise.resolve()},onAddInteractionAssociatedObject:function(e,t){M();var n=D(t),r=Ew(Pw({},e),{source:A.integrationKey||""});return s.addAssociatedObject(n.id,r),Promise.resolve()},onSetInteractionActiveScreen:function(e,t){M();var n=A.integrationKey;if(null===n)return Promise.resolve();var r=D(t);return s.setActiveCrmScreen(r.id,n,e),Promise.resolve()},onConsultCall:function(e){M();var t=A.adapterUrlParams,r=t&&t.deferredDial;if(r&&"0"!==r&&n.current.deferredDial)n.current.deferredDial(e);else{var a=E("call",e);if(a.length)throw new iw.ApiError(a[0].name,a[0].message);s.initiateCall({phone:e,serviceId:n.current.getService(),accessNumberId:n.current.getDIDNumber(),origination:"integration-api"})}return Promise.resolve()},onBlindTransfer:function(e,t,n){M(),L("CAN_TRANSFER");var r=D(n),a=T(r),o=k(r);return g[r.id]=!0,s.updateScreenPopData({itemId:r.id,customData:t,raSessionPin:a,raSessionId:o}),s.blindTransfer({item:r,phone:e}),Promise.resolve()},onTransfer:function(e){M(),L("CAN_TRANSFER");var t=I.activeItemId,n=D(t),r=n.displayData.isConsultCall,a=r?D(r):n,o=T(a),i=k(a);return g[a.id]=!0,s.updateScreenPopData({itemId:a.id,customData:e,raSessionPin:o,raSessionId:i}),s.completeTransfer(),Promise.resolve()},onAddNote:function(e,t){M();var n=D(t);return s.addNote({itemId:n.id,note:e}),Promise.resolve()},onUpdateNote:function(e,t){M();var n=D(t);return s.updateNote({itemId:n.id,note:e}),Promise.resolve()},onReplaceNote:function(e,t){M();var n=D(t);return s.replaceNote({itemId:n.id,note:e}),Promise.resolve()},onLogin:function(e){var t=e.username,n=e.password,r=e.tenant,a=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(S.isLoggedIn)throw new iw.ApiError("not_suitable_state","You are already in logged in state");if(S.isAuthorizing)throw new iw.ApiError("not_suitable_state","Login procedure in process now");return a?o.dispatch.forceLogin():o.dispatch.login({loginId:t,password:n,domain:r||location.host}),v.newPendingRequest("onLogin",[{username:t,password:n,tenant:r},a])},onLogout:function(){return M(),o.dispatch.logout(),Promise.resolve()},onSetRescheduleWindow:function(e,t){M();var n=D(t),r=e.timezoneCode;if(r&&!C.allTimezones.find((function(e){return e.id===r})))throw new iw.ApiError("object_not_found",'Unknown timezone with code "'.concat(r,'"'));return s.setDispositionReschedule(n.id,{rescheduleTimezone:r,reschedulePhone:e.numberToDial,rescheduleFrom:e.fromTime,rescheduleTo:e.untilTime}),Promise.resolve()},onGetPhoneDevicesList:function(){return M(),Promise.resolve((0,l.typedKeys)(S.availablePhoneTypes))},onGetPhoneDevice:function(){M();var e=S.phoneType;if(!e)throw new iw.ApiError("logged_without_phone","Selected phone is undefined");return Promise.resolve({type:e,phone:["phone_type_external","phone_type_hard_custom"].includes(e)?S.phoneNumber:void 0})},onSetPhoneDevice:function(e){var t=e.type,n=e.phone;if(M(),!Object.keys(S.availablePhoneTypes).includes(t))throw new iw.ApiError("banned",'Phone device "'.concat(t,'" is not available'));return o.dispatch.submitPhoneTypeSelection({phoneType:t,phoneNumber:n}),Promise.resolve()},onGetLoginState:function(){return Promise.resolve({isLoggedIn:S.isLoggedIn||!1,agentId:S.userId,username:S.loginId,sessionId:S.sessionId})},onSendDtmf:function(e,t){var n;M();var r=D(t);if("voice"!==r.mediaType||!(null===(n=r.callData)||void 0===n?void 0:n.callId))throw new iw.ApiError("not_suitable_state","Dtmf is applicable only for voice calls, "+'but the interaction "'.concat(r.id,'" is of a type "').concat(r.mediaType,'"'));if("delivered"!==r.state)throw new iw.ApiError("not_suitable_state","Dtmf is applicable only for active calls, "+'but the interaction "'.concat(r.id,'" is in the state "').concat(r.state,'"'));return s.sendDtmf({dtmf:e,callId:r.callData.callId}),Promise.resolve()},onAcceptInteraction:function(e){M();var t=D(e);if("delivery_pending"!==t.state)throw new iw.ApiError("not_suitable_state",'To be accepted interaction must be in a "delivery_pending" state, '+'but the interaction "'.concat(t.id,'" is in the "').concat(t.state,'" state'));return s.acceptItem(t.id),Promise.resolve()},onRejectInteraction:function(e){M();var t=D(e);if("delivery_pending"!==t.state)throw new iw.ApiError("not_suitable_state",'To be rejected interaction must be in a "delivery_pending" state, '+'but the interaction "'.concat(t.id,'" is in the "').concat(t.state,'" state'));return s.rejectItem(t.id),Promise.resolve()},onInviteToCallConference:function(e,t,r){M(),L("CAN_TRANSFER");var a=D(r),o=T(a);return g[a.id]=!0,s.updateScreenPopData({itemId:a.id,customData:t,raSessionPin:o}),s.singleStepConference({phone:e,serviceId:n.current.getService(),accessNumberId:n.current.getDIDNumber()}),Promise.resolve()},onRemoveFromCallConference:function(e,t){M();var n=D(t),r=(n.parties||[]).find((function(t){return t.id===e}));if(!r)throw new iw.ApiError("object_not_found",'Could not find party "'.concat(e,'" for the interaction "').concat(n.id,'"'));return s.removeCallParty(r),Promise.resolve()},onDestroyCallConference:function(e){M();var t=D(e);return s.destroyCallConference(t.id),Promise.resolve()},onInviteToChatConference:function(e,t){var n;M();var r=D(t);if(!(null===(n=r.scenarioData)||void 0===n?void 0:n.interactionStepId))throw new iw.ApiError("object_not_found",'Could not find interaction step id in the interaction "'.concat(r.id,'"'));p.inviteToChat({itemId:r.scenarioData.interactionStepId,partyId:e})},onRemoveFromChatConference:function(e,t){var n;M();var r=D(t);if(!(null===(n=r.scenarioData)||void 0===n?void 0:n.interactionStepId))throw new iw.ApiError("object_not_found",'Could not find interaction step id in the interaction "'.concat(r.id,'"'));var a=(r.chatParties||[]).find((function(t){return t.party_id===e}));if(!a)throw new iw.ApiError("object_not_found",'Could not find chat party "'.concat(e,'" for the interaction "').concat(r.id,'"'));p.removePartyFromChat({itemId:r.scenarioData.interactionStepId,partyId:a.party_id})},onMergeAllCallsIntoConference:function(e){M(),D();var t=I.items.find((function(e){var t;return!!(null===(t=e.displayData.hasConsultCalls)||void 0===t?void 0:t.length)}));if(t){var n=T(t);g[t.id]=!0,s.updateScreenPopData({itemId:t.id,customData:e,raSessionPin:n})}return s.mergeAllCallsIntoConference(),Promise.resolve()},onGetTeams:function(){return M(),_.teams.length?(u.getAgentTeams(),Promise.resolve(_.teams.map((function(e){return hw(e)})))):u.getAgentTeams().then((function(e){return e.map((function(e){return hw(e)}))}))},onGetTeamMembers:function(e){if(M(),_.teams.length){if(!_.teams.find((function(t){return t.id===e})))throw new iw.ApiError("object_not_found",'Team with id "'.concat(e,'" is not found'))}else u.getAgentTeams();return u.requestTeamUsers(e).then((function(e){return e.map((function(e){return function(e){return{id:e.userId,teamId:e.teamId,phone:e.extension,firstName:e.firstName,lastName:e.lastName,state:e.isLogged?""===e.agentState?"supervising":e.agentState:"offline"}}(e)}))}))},onSetCallHold:function(e,t){M();var n=D(t);return e?s.holdItem(n.id):s.resumeItem(n.id),Promise.resolve()},onSetCallRecording:function(e,t){M();var n=D(t);return e?(L("CAN_START_RECORDING"),s.recordCall(n.id)):(L("CAN_STOP_RECORDING"),s.stopRecordingCall(n.id)),Promise.resolve()},onSetCallMute:function(e,t){M();var n=D(t);return e?s.muteItem(n.id):s.unmuteItem(n.id),Promise.resolve()},onSetScreenRecordingMute:function(e){if(M(),!w.screenRecording.vncInit)throw new iw.ApiError("banned","Screen Recording is not allowed for the current user");return m.setScreenRecordingMute(e),Promise.resolve()},onGetScreenRecordingState:function(){return M(),Promise.resolve(jw(w.screenRecording))},onSendChatMessage:function(e,t){M();var n=D(t);if("scenario"===n.itemKind&&"chat"===n.mediaType){var r,a,o=(null===(r=n.externalChatData)||void 0===r?void 0:r.channel)||"sms",i=(0,cw.getMessageErrorsRaw)({options:{message:e,channel:o}}).map((function(e){return Tw[e]}));if(i.length)throw new iw.ApiError(i[0].name,i[0].message);var s,l=null===(a=n.scenarioData)||void 0===a?void 0:a.interactionStepId;if(l)p.sendMessage({text:e,type:"message",itemId:l,channel:null===(s=n.externalChatData)||void 0===s?void 0:s.channel});return Promise.resolve()}throw new iw.ApiError("invalid_args","Invalid interaction type  for sending chat service. id=".concat(t," kind=").concat(n.itemKind," mediaType=").concat(n.mediaType))},onSuggestChatMessage:function(e,t,r){M();var a=D(r);if("chat"!==a.mediaType)throw new iw.ApiError("invalid_args","Interaction isn't a chat. id=".concat(r," mediaType=").concat(a.mediaType));return n.current.setChatMessageSuggestion(e,!!t,a.id),Promise.resolve()},onGetAgentNotReadyReasons:function(){var e;return M(),Promise.resolve(null!==(e=j.notReadyReasons)&&void 0!==e?e:[])},onActivatePage:function(){r.activateTab()},onGetInteractionsState:function(){var e;return M(),{activeInteractionId:null!==(e=I.activeItemId)&&void 0!==e?e:null,interactions:I.items.map((function(e){return vw(S.serverOrigin,e,P)}))}},onSetCallRecordingMute:function(e,t){var n=function(t){t.displayData.isRecording&&(e&&!t.displayData.isRecordingMuted&&s.muteCallRecording((0,X.getInteractionStepId)(t)),!e&&t.displayData.isRecordingMuted&&s.unmuteCallRecording((0,X.getInteractionStepId)(t)))};(M(),"all"===t)?I.items.forEach(n):n(D(t))},onSetDialCandidates:function(){}});return[F,z,H,V,W,q,Y,Q,Z,ee,te]};function Lw(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Rw(e,t){return t=null!=t?t:{},Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(t)):function(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}(Object(t)).forEach((function(n){Object.defineProperty(e,n,Object.getOwnPropertyDescriptor(t,n))})),e}var Fw=function(e){var t=e.baseConnectors,n=e.authorizedConnectors,o=e.children,s=(0,xn.useServiceState)(),l=s.selectedService,c=s.setService,u=(0,On.useDIDNumberState)(),d=u.selectedDIDNumber,f=u.setDIDNumber,m=(0,x.useInteractionUIState)(),p=m.items,v=m.setItemState,h=(0,i.useInteractionStateRef)(),b=(0,a.useCallback)((function(e,t,n){var r=p[n];if(!r)throw new iw.ApiError("no_interaction",'No interaction with id "'.concat(n,'"'));if(r.chatMessage&&!t)throw new iw.ApiError("banned","Not allowed to overwrite the existing message");v(n,(function(t){return Rw(function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Lw(e,t,n[t])}))}return e}({},t),{chatMessage:e})}))}),[p,v]),y=(0,nl.useCommunicatorUIState)((function(e){return e.dialpad.setSearchValue})),g=(0,yo.useNavigationState)("setActivePage"),j=(0,a.useCallback)((function(e){y(e),g({name:yo.AppRoutes.Dial})}),[y,g]),I=(0,a.useCallback)((function(){g({name:yo.AppRoutes.Interactions})}),[g]),S=(0,a.useRef)({getService:function(){return l},setService:function(e){return c(e)},getDIDNumber:function(){return d},setDIDNumber:function(e){return f(e)},setChatMessageSuggestion:b,deferredDial:j,showInteractionPage:I});return(0,a.useEffect)((function(){S.current={getDIDNumber:function(){return d},setDIDNumber:function(e){return f(e)},getService:function(){return l},setService:function(e){var t,n;return c(e,null===(n=h.current)||void 0===n||null===(t=n.activeItem)||void 0===t?void 0:t.id)},setChatMessageSuggestion:b,deferredDial:j,showInteractionPage:I}}),[h,l,c,j,d,f,b,I]),(0,a.useEffect)((function(){var e=Mw(t,n,S);return function(){e.forEach((function(e){return e.unsubscribe()}))}}),[t,n]),(0,r.jsx)(r.Fragment,{children:o})};function Bw(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function Uw(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){Bw(e,t,n[t])}))}return e}var zw=function(e){var t=e.baseConnectors,n=e.children;return(0,a.useEffect)((function(){var e=function(e){var t=e.integrationApiConnector,n=e.sessionConnector,r=ww(5e3),a=(0,fw.getInitialSessionState)(),o=n.dispenser.subscribe({onInitialState:function(e){e.isLoggedIn&&(r.resolveAllPendingRequests("onLogin",void 0),t.dispatch.login({isLoggedIn:!0,agentId:e.userId,username:e.loginId,sessionId:e.sessionId})),!a.loginError&&e.loginError&&r.rejectAllPendingRequests("onLogin",e.loginError),a=Uw({},e)},onChange:function(e){var t=a;a=Uw({},a,e),!t.loginError&&a.loginError&&r.rejectAllPendingRequests("onLogin",a.loginError)},onLogin:function(e){r.resolveAllPendingRequests("onLogin",void 0),t.dispatch.login({isLoggedIn:!0,agentId:e.userId,username:e.loginId,sessionId:e.sessionId})},onServerError:function(e,n,r){t.dispatch.serverError(Sw(e,n,r))}}),i=function(){throw new iw.ApiError("not_logged_in","You are not logged in")},s=t.dispenser.subscribe({onLogin:function(e){var t=e.username,o=e.password,i=e.tenant,s=arguments.length>1&&void 0!==arguments[1]&&arguments[1];if(a.isLoggedIn)throw new iw.ApiError("not_suitable_state","You are already in logged in state");if(a.isAuthorizing)throw new iw.ApiError("not_suitable_state","Login procedure in process now");return s?n.dispatch.forceLogin():n.dispatch.login({loginId:t,password:o,domain:i||location.host}),r.newPendingRequest("onLogin",[{username:t,password:o,tenant:i},s])},onGetLoginState:function(){return Promise.resolve({isLoggedIn:a.isLoggedIn||!1,agentId:a.userId,username:a.loginId,sessionId:a.sessionId})},onLogout:i,onAcceptInteraction:i,onAddInteractionAssociatedObject:i,onAddNote:i,onBlindTransfer:i,onCompleteInteraction:i,onConsultCall:i,onDestroyCallConference:i,onGetAgentNotReadyReasons:i,onGetAgentState:i,onGetConfig:i,onGetDIDNumber:i,onGetDIDNumbersList:i,onGetDispositionsList:i,onGetPhoneDevice:i,onGetPhoneDevicesList:i,onGetScreenRecordingState:i,onGetService:i,onGetServicesList:i,onGetTeamMembers:i,onGetTeams:i,onGetVariables:i,onInviteToCallConference:i,onLeaveAndCompleteInteraction:i,onLeaveInteraction:i,onMergeAllCallsIntoConference:i,onRejectInteraction:i,onRemoveFromCallConference:i,onReplaceNote:i,onSendChatMessage:i,onSendDtmf:i,onSetAgentState:i,onSetCallHold:i,onSetCallMute:i,onSetCallRecording:i,onSetDIDNumber:i,onSetDisposition:i,onSetInteractionActiveScreen:i,onSetPhoneDevice:i,onSetRescheduleWindow:i,onSetScreenRecordingMute:i,onSetService:i,onSetVariable:i,onSetWidgetMinimized:i,onStartCall:i,onStartChat:i,onStartEmail:i,onSuggestChatMessage:i,onSwitchActiveInteraction:i,onTransfer:i,onUpdateNote:i});return[o,s]}(t);return function(){e.forEach((function(e){return e.unsubscribe()}))}}),[t]),(0,r.jsx)(r.Fragment,{children:n})},Hw=(0,y.createProviderWrapper)(lc),Vw=function(){return(0,r.jsx)(Sn,{platformSpecific:(0,Ht.createPlatformSpecific)("adc"),app:"adc",BaseConnectorsConsumer:zw,appRemoteName:"communicator",children:function(e,t){return(0,r.jsx)(Hw,{children:(0,r.jsx)(Fw,{baseConnectors:e,authorizedConnectors:t,children:(0,r.jsx)(ow,{})})})}})},Gw=(0,y.createProviderWrapper)(sc),Ww=function(){var e=(0,g.useNonParalleledDeliveredItems)(),t=(0,g.useSelectedItems)(e),n=t.selectedItemId,a=t.setSelectedItemId;return(0,r.jsx)(Gw,{children:(0,r.jsxs)(s.InteractionContextProvider,{interactionId:n,children:[(0,r.jsx)(Eg,{itemIds:e,selectedItemId:n,setSelectedItemId:a}),(0,r.jsx)(LC,{})]})})},qw=(0,y.createProviderWrapper)(ic),Yw=function(e){var t=e.parallelItem,n=(0,c.useLocalizationState)("t"),o=n.INTERACTIONS,l=n.KNOWLEDGE_BASE,u=(0,i.useInteraction)(t.activeItemId),d=(0,Ta.useSetAtom)(x.parallelItemsAtom),f=(0,Ta.useAtomValue)(x.parallelItemsCountAtom),m=(0,Gr.useCommunicatorUIState)((function(e){return e.setParallelInteractionsWidth})),p=(0,a.useRef)(null);return(0,a.useEffect)((function(){var e=p.current;if(e)return e.style.opacity="1",function(){var e;null===(e=p.current)||void 0===e||e.style.setProperty("opacity","0")}}),[]),u&&t.activeItemId?(0,r.jsx)("div",{className:M("flex flex-col","ml-2 flex-auto shrink-0 overflow-hidden","border-2 border-t-[6px] transition-all duration-300 border-on-primary","has-[:focus-within]:border-2 has-[:focus-within]:border-t-[6px] has-[:focus-within]:border-primary"),children:(0,r.jsx)(s.InteractionContextProvider,{interactionId:t.activeItemId,isParallelInteractionContext:!0,children:(0,r.jsx)(qw,{children:(0,r.jsx)(xC,{})})})}):(0,r.jsxs)("div",{ref:p,className:"ml-2 transition-all bg-secondary-container-variant1",children:[(0,r.jsxs)("div",{className:M("flex w-full items-center justify-between px-4 py-2","border-b border-neutral-100 bg-primary-background"),children:[(0,r.jsx)("div",{className:"uppercase caption-xs text-neutral-disabled",children:o.interaction_details()}),(0,r.jsx)(j.ButtonIcon,{tooltip:l.close_tab_text(),onClick:function(){d({type:"remove",payload:{index:t.index}});var e=f+1;m((function(t){return t-t/e}))},className:"p-0",children:(0,r.jsx)(j.IconClose24,{className:"!size-6"})})]}),(0,r.jsxs)("div",{className:"flex h-full flex-col items-center justify-center",children:[(0,r.jsx)("h1",{className:"heading-s text-neutral-on-secondary",children:o.no_new_interactions()}),(0,r.jsx)("p",{className:"text-neutral-fade",children:o.next_message_interaction_show()})]})]})}}}]);
//# sourceMappingURL=114.a60e0d51.chunk.js.map