{"version":3,"file":"lightning-8806419f9a1df83cbd6f.js","mappings":"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","sources":["webpack://@bpinc/adapters/../../node_modules/lodash-es/fromPairs.js","webpack://@bpinc/adapters/./src/adc-client-api.ts","webpack://@bpinc/adapters/./src/utils/index.ts","webpack://@bpinc/adapters/../../packages/adapters-public-api-types/src/types.ts","webpack://@bpinc/adapters/../../node_modules/uuid/index.js","webpack://@bpinc/adapters/../../node_modules/uuid/lib/bytesToUuid.js","webpack://@bpinc/adapters/../../node_modules/uuid/lib/rng-browser.js","webpack://@bpinc/adapters/../../node_modules/uuid/v1.js","webpack://@bpinc/adapters/../../node_modules/uuid/v4.js","webpack://@bpinc/adapters/webpack/bootstrap","webpack://@bpinc/adapters/webpack/runtime/define property getters","webpack://@bpinc/adapters/webpack/runtime/hasOwnProperty shorthand","webpack://@bpinc/adapters/./src/integrations/lightning/loadExternalApi.ts","webpack://@bpinc/adapters/./src/integrations/lightning/LightningAPIWrapper.ts","webpack://@bpinc/adapters/./src/integrations/lightning/integration.ts","webpack://@bpinc/adapters/./src/integrations/lightning/guards.ts"],"sourcesContent":["/**\n * The inverse of `_.toPairs`; this method returns an object composed\n * from key-value `pairs`.\n *\n * @static\n * @memberOf _\n * @since 4.0.0\n * @category Array\n * @param {Array} pairs The key-value pairs.\n * @returns {Object} Returns the new object.\n * @example\n *\n * _.fromPairs([['a', 1], ['b', 2]]);\n * // => { 'a': 1, 'b': 2 }\n */\nfunction fromPairs(pairs) {\n  var index = -1,\n      length = pairs == null ? 0 : pairs.length,\n      result = {};\n\n  while (++index < length) {\n    var pair = pairs[index];\n    result[pair[0]] = pair[1];\n  }\n  return result;\n}\n\nexport default fromPairs;\n","import fromPairs from 'lodash-es/fromPairs'\r\n\r\nimport type {\r\n    AgentDesktopClientAPI,\r\n    AgentState,\r\n    AgentStateData,\r\n    CallbackMessage,\r\n    ChatChannelType,\r\n    CustomTransferData,\r\n    DialCandidate,\r\n    DIDNumber,\r\n    DispositionData,\r\n    DispositionTarget,\r\n    InitialObjects,\r\n    InitiateResult,\r\n    InitOptions,\r\n    IntegrationConfig,\r\n    InteractionAssociatedObjectData,\r\n    InteractionScreen,\r\n    InteractionsState,\r\n    LoginData,\r\n    LoginStateData,\r\n    MessageLogger,\r\n    OnActiveInteractionSwitchHandler,\r\n    OnAgentStateChangeHandler,\r\n    OnAudioDeviceChangeHandler,\r\n    OnCallAudioQualityAlertHandler,\r\n    OnGetKnowledgeBaseArticleHandler,\r\n    OnGetKnowledgeBaseFolderHandler,\r\n    OnInteractionRemovedHandler,\r\n    OnInteractionStateChangeHandler,\r\n    OnLoadTransferDataHandler,\r\n    OnLoginHandler,\r\n    OnLogoutHandler,\r\n    OnNewInteractionHandler,\r\n    OnOpenRecordHandler,\r\n    OnPhoneCapabilitiesChangeHandler,\r\n    OnRequestRecordInfoHandler,\r\n    OnRequestRecordOnScreenHandler,\r\n    OnRequestTransferDataHandler,\r\n    OnSaveActivityRecordHandler,\r\n    OnScreenRecordingStateChangeHandler,\r\n    OnSearchKnowledgeBaseHandler,\r\n    OnSearchRecordsHandler,\r\n    OnServerErrorHandler,\r\n    OnShowScreenHandler,\r\n    OnSoftphoneStatusChangeHandler,\r\n    OnValidateAssociatedRecordsHandler,\r\n    OnWebScreenPopCustomHandler,\r\n    OnWidgetMinimizedChangeHandler,\r\n    OperationResult,\r\n    PhoneDevice,\r\n    PhoneDeviceData,\r\n    RequestMessage,\r\n    RescheduleData,\r\n    ScreenRecordingState,\r\n    ServiceData,\r\n    Team,\r\n    User,\r\n} from '@bpinc/adapters-public-api-types'\r\nimport {\r\n    callbackMessages,\r\n    requestMessages,\r\n    requestResponseMessages,\r\n    RESPONSE_SUFFIX,\r\n} from '@bpinc/adapters-public-api-types'\r\nimport {uuid} from '@bpinc/lib-uuid'\r\n\r\nimport type {\r\n    AnyEventHandler,\r\n    MessagePackage,\r\n    MessagesHandlers,\r\n    MessageUID,\r\n    ResponseCallbacks,\r\n} from './types'\r\nimport {utils} from './utils'\r\n\r\n\r\n// In milliseconds (ms)\r\nconst RESPONSE_TIMEOUT = 20_000\r\nconst MINIMIZED_WIDGET_WIDTH = '44px'\r\nconst MAXIMIZED_WIDGET_WIDTH_DEFAULT = '500px'\r\n\r\nconst selfScriptUrl = (function() {\r\n    if (window.document.currentScript) {\r\n        return (window.document.currentScript as HTMLScriptElement).src\r\n    } else {\r\n        const scripts = document.getElementsByTagName('script')\r\n        const myScript = scripts[scripts.length - 1]\r\n        return myScript.src\r\n    }\r\n})()\r\n\r\nconst adcOriginOverride = utils.extractURLParams(window.location.href)['adcUrl']\r\n\r\nconst adcOrigin = adcOriginOverride || new URL(selfScriptUrl).origin // 'https://adcommunicator.web.app'\r\n\r\nexport class AgentDesktopClientAPIImpl implements AgentDesktopClientAPI {\r\n\r\n    public adcFrame: HTMLIFrameElement | null\r\n    private adcFrameOrigin: string\r\n    private pendingMessages: any[]\r\n    private connectionEstablished: boolean\r\n    private adcIsReady: boolean\r\n    private maximizedIframeWidth = MAXIMIZED_WIDGET_WIDTH_DEFAULT\r\n    private readonly messageHandlers: MessagesHandlers\r\n    private readonly responseCallbacks: ResponseCallbacks\r\n    private readonly integrationKey: string\r\n    private readonly messageLoggers: MessageLogger[]\r\n    private readonly disableNewInteractionPopup: boolean\r\n\r\n    constructor(options: InitOptions = {}) {\r\n        this.adcFrame = null\r\n        this.adcFrameOrigin = ''\r\n        this.pendingMessages = []\r\n        this.integrationKey = options.integrationKey || uuid()\r\n        this.connectionEstablished = false\r\n        this.adcIsReady = false\r\n        this.messageLoggers = []\r\n        this.disableNewInteractionPopup = !!options.disableNewInteractionPopup\r\n\r\n        this.messageHandlers = fromPairs(\r\n            Object.keys(callbackMessages).map(messageType => [messageType, []]),\r\n        ) as unknown as MessagesHandlers\r\n\r\n        this.responseCallbacks = fromPairs(\r\n            requestMessages.map(messageType => [messageType + RESPONSE_SUFFIX, {}]),\r\n        ) as unknown as ResponseCallbacks\r\n\r\n        this.prepareAdcIframe(options)\r\n        this.registerListeners()\r\n\r\n        this.on('ON_WIDGET_MINIMIZED_CHANGE', (widgetMinimized: boolean) => {\r\n            if (this.adcFrame) {\r\n                if (widgetMinimized) {\r\n                    this.maximizedIframeWidth = this.adcFrame.getAttribute('width') ?? MAXIMIZED_WIDGET_WIDTH_DEFAULT\r\n                    this.adcFrame.setAttribute('width', MINIMIZED_WIDGET_WIDTH)\r\n                } else {\r\n                    this.adcFrame.setAttribute('width', this.maximizedIframeWidth)\r\n                }\r\n            }\r\n        })\r\n\r\n        this.on('ON_WEB_SCREEN_POP_CUSTOM', () => false)\r\n        this.on('ON_VALIDATE_ASSOCIATED_RECORDS', () => ({valid: true}))\r\n    }\r\n\r\n    injectMessageLogger(logger: MessageLogger) {\r\n        this.messageLoggers.push(logger)\r\n    }\r\n\r\n    private prepareAdcIframe(options: InitOptions) {\r\n        if (options.adcFrame) {\r\n            const potentialFrame = options.adcFrame\r\n            if (potentialFrame instanceof HTMLIFrameElement && potentialFrame.src) {\r\n                this.adcFrame = potentialFrame\r\n            } else {\r\n                console.error(\r\n                    '@@@ `adcFrame` is not HTMLIframeElement or it have no `src` attribute.\\n',\r\n                    'Valid Communicator iframe would be created automatically',\r\n                )\r\n            }\r\n        }\r\n        if (!this.adcFrame) {\r\n            let mountRoot: HTMLElement | null = null\r\n            if (options.mountRoot) {\r\n                const potentialMountRoot = options.mountRoot\r\n                if (potentialMountRoot instanceof HTMLElement) {\r\n                    mountRoot = potentialMountRoot\r\n                } else {\r\n                    console.error(\r\n                        '@@@ `mountRoot` is not HTMLElement.\\n',\r\n                        'Communicator iframe would be mounted to the `document.body` as a fallback scenario',\r\n                    )\r\n                }\r\n            }\r\n            if (!mountRoot) {\r\n                mountRoot = document.body\r\n            }\r\n            this.adcFrame = document.createElement('iframe')\r\n            this.adcFrame.title = 'Agent Desktop Communicator'\r\n            this.adcFrame.id = 'adc_frame'\r\n            this.adcFrame.style.border = 'none'\r\n            this.adcFrame.allow = 'microphone; camera; geolocation'\r\n            this.adcFrame.onerror = () => {\r\n                console.error('@@@ Adapter failure: unable to load AD Communicator')\r\n            }\r\n\r\n            if (options.standalone) {\r\n                this.adcFrame.width = '1px'\r\n                this.adcFrame.height = '1px'\r\n                this.adcFrame.style.zIndex = '-1000'\r\n                this.adcFrame.style.position = 'absolute'\r\n                this.adcFrame.style.top = '-1000px'\r\n                this.adcFrame.style.left = '-1000px'\r\n                this.adcFrame.src = adcOrigin + '/agent/communicator/no-ui/' + location.search\r\n            } else {\r\n                this.adcFrame.style.width = MAXIMIZED_WIDGET_WIDTH_DEFAULT\r\n                this.adcFrame.style.height = '100%'\r\n                this.adcFrame.src = adcOrigin + '/agent/communicator/' + location.search\r\n            }\r\n            mountRoot.appendChild(this.adcFrame)\r\n        }\r\n        this.adcFrameOrigin = (new URL(this.adcFrame.src)).origin\r\n    }\r\n\r\n    private handleIncomingMessage(type: CallbackMessage, uid: MessageUID, params: any[]) {\r\n        console.log('@@@ Handle: ', type, uid, params)\r\n        const handlers = this.messageHandlers[type]\r\n        if (!handlers.length) {\r\n            if (callbackMessages[type]?.needResponse) {\r\n                this.postMessageToAdc({\r\n                    uid,\r\n                    type: type + RESPONSE_SUFFIX,\r\n                    params: [],\r\n                    noHandlers: true,\r\n                })\r\n            }\r\n            return\r\n        }\r\n        const pendingResults = handlers.map(handler => {\r\n            try {\r\n                return handler(...params)\r\n            } catch (e) {\r\n                console.error(`@@@ Error in the event \"${type}\" handler:`, e)\r\n            }\r\n        })\r\n        if (callbackMessages[type]?.needResponse) {\r\n            utils.waitResolveAll(pendingResults).then(promiseResults => {\r\n                const positiveResults = promiseResults.reduce<any[]>((arr, result) => {\r\n                    if (\r\n                        result.status === 'fulfilled' &&\r\n                        result.value !== undefined\r\n                    ) {\r\n                        arr.push(result.value)\r\n                    }\r\n                    return arr\r\n                }, [])\r\n                const lastValue = positiveResults.length\r\n                    ? positiveResults[positiveResults.length - 1]\r\n                    : undefined\r\n                this.postMessageToAdc({\r\n                    uid,\r\n                    type: type + RESPONSE_SUFFIX,\r\n                    params: [lastValue],\r\n                })\r\n            })\r\n        }\r\n    }\r\n\r\n    private registerListeners() {\r\n        window.addEventListener('message', (e: MessageEvent) => {\r\n            if (e.origin !== this.adcFrameOrigin) {\r\n                return\r\n            }\r\n            const {type, uid, params} = e.data || {}\r\n            if (!type) {\r\n                return\r\n            }\r\n            e.stopImmediatePropagation()\r\n            try {\r\n                if (type === 'hello') {\r\n                    this.messageLoggers.forEach(log => log(type, params))\r\n                    this.connectionEstablished = true\r\n                    const pingResponse = {\r\n                        uid,\r\n                        type: 'hi',\r\n                        params: [\r\n                            this.integrationKey,\r\n                            location.search,\r\n                            this.disableNewInteractionPopup,\r\n                        ],\r\n                    }\r\n                    if (!this.adcFrame?.contentWindow) {\r\n                        throw new Error('adcFrame is not defined - that should not be possible')\r\n                    }\r\n                    this.messageLoggers.forEach(log => log(pingResponse.type, pingResponse.params))\r\n                    this.adcFrame.contentWindow.postMessage(pingResponse, this.adcFrameOrigin)\r\n                    return\r\n                }\r\n                if (type === 'ready') {\r\n                    this.messageLoggers.forEach(log => log(type, params))\r\n                    this.adcIsReady = true\r\n                    setTimeout(() => {\r\n                        this.pendingMessages.forEach(message => {\r\n                            this.postMessageToAdc(message)\r\n                        })\r\n                        this.pendingMessages = []\r\n                    })\r\n                    return\r\n                }\r\n\r\n                if (!this.adcIsReady) {\r\n                    return\r\n                }\r\n                if (Object.keys(callbackMessages).includes(type)) {\r\n                    this.messageLoggers.forEach(log => log(type, params))\r\n                    this.handleIncomingMessage(type, uid, params)\r\n\r\n                } else if (requestResponseMessages.includes(type)) {\r\n                    this.messageLoggers.forEach(log => log(type, params))\r\n                    const waiting = this.responseCallbacks[type]\r\n                    if (waiting && waiting[uid]) {\r\n                        const callback = waiting[uid]\r\n                        delete waiting[uid]\r\n                        Promise.resolve().then(() => callback(params))\r\n                    }\r\n                }\r\n            } catch (err) {\r\n                console.error('@@@ Error: ', (err instanceof Error) ? err.message : `${err}`)\r\n            }\r\n        })\r\n    }\r\n\r\n    private runResponseTimeoutWatch<Result>(\r\n        type: RequestMessage,\r\n        uid: MessageUID,\r\n        resolve: (value: (OperationResult<Result> | PromiseLike<OperationResult<Result>>)) => void,\r\n    ) {\r\n        setTimeout(() => {\r\n            const callbacksMap = this.responseCallbacks[type + RESPONSE_SUFFIX]\r\n            if (callbacksMap[uid]) {\r\n                delete callbacksMap[uid]\r\n                const errorText = (\r\n                    `Response from Communicator for event \"${type}\" ` +\r\n                    `wasn't received in the specified timeout ${RESPONSE_TIMEOUT} ms`\r\n                )\r\n                console.error(`@@@ ${errorText}`)\r\n                resolve({\r\n                    status: 'error',\r\n                    error: {\r\n                        code: 6,\r\n                        name: 'api_not_answer',\r\n                        message: errorText,\r\n                    },\r\n                })\r\n            }\r\n        }, RESPONSE_TIMEOUT)\r\n    }\r\n\r\n    private postMessageToAdc(data: MessagePackage) {\r\n        if (this.adcFrame !== null && this.adcFrame.contentWindow && this.adcIsReady) {\r\n            this.messageLoggers.forEach(log => log(data.type, data.params))\r\n            if (data.type === 'LOGIN') {\r\n                console.log('@@@ ADAPTER SEND MESSAGE: LOGIN')\r\n            } else {\r\n                console.log('@@@ ADAPTER SEND MESSAGE: ', data)\r\n            }\r\n            this.adcFrame.contentWindow.postMessage(data, this.adcFrameOrigin)\r\n        } else {\r\n            console.log('@@@ ADAPTER: ADC is not ready, add pending message:', data)\r\n            this.pendingMessages.push(data)\r\n        }\r\n    }\r\n\r\n    private apiCall<Result>(type: RequestMessage, params: any[] = []) {\r\n        return new Promise<OperationResult<Result>>(resolve => {\r\n            const uid = uuid()\r\n            this.postMessageToAdc({uid, type, params})\r\n\r\n            const waiting = this.responseCallbacks[type + RESPONSE_SUFFIX]\r\n            waiting[uid] = resolve\r\n            this.runResponseTimeoutWatch(type, uid, resolve)\r\n        })\r\n    }\r\n\r\n    getLoginState(): Promise<OperationResult<LoginStateData>> {\r\n        return this.apiCall('GET_LOGIN_STATE')\r\n    }\r\n\r\n    login(loginData: LoginData, force?: boolean): Promise<OperationResult> {\r\n        return this.apiCall('LOGIN', [loginData, force])\r\n    }\r\n\r\n    logout(): Promise<OperationResult> {\r\n        return this.apiCall('LOGOUT')\r\n    }\r\n\r\n    getAgentState(): Promise<OperationResult<AgentStateData>> {\r\n        return this.apiCall<AgentStateData>('GET_AGENT_STATE')\r\n    }\r\n\r\n    setAgentState(state: AgentState, notReadyReason?: string): Promise<OperationResult> {\r\n        return this.apiCall('SET_AGENT_STATE', [state, notReadyReason])\r\n    }\r\n\r\n    acceptInteraction(interactionId?: string): Promise<OperationResult> {\r\n        return this.apiCall('ACCEPT_INTERACTION', [interactionId])\r\n    }\r\n\r\n    rejectInteraction(interactionId?: string): Promise<OperationResult> {\r\n        return this.apiCall('REJECT_INTERACTION', [interactionId])\r\n    }\r\n\r\n    startCall(phonenumber: string, initialObjects?: InitialObjects): Promise<OperationResult<InitiateResult>> {\r\n        return this.apiCall('START_CALL', [\r\n            phonenumber,\r\n            !initialObjects\r\n                ? []\r\n                : initialObjects instanceof Array\r\n                    ? initialObjects\r\n                    : [initialObjects],\r\n        ])\r\n    }\r\n\r\n    startChat(channel: ChatChannelType, address: string, initialObjects?: InitialObjects): Promise<OperationResult<InitiateResult>> {\r\n        return this.apiCall('START_CHAT', [\r\n            channel,\r\n            address,\r\n            !initialObjects\r\n                ? []\r\n                : initialObjects instanceof Array\r\n                    ? initialObjects\r\n                    : [initialObjects],\r\n        ])\r\n    }\r\n\r\n    startEmail(email: string, initialObjects?: InitialObjects): Promise<OperationResult<InitiateResult>> {\r\n        return this.apiCall('START_EMAIL', [\r\n            email,\r\n            !initialObjects\r\n                ? []\r\n                : initialObjects instanceof Array\r\n                    ? initialObjects\r\n                    : [initialObjects],\r\n        ])\r\n    }\r\n\r\n    sendDtmf(dtmf: string, interactionId?: string): Promise<OperationResult> {\r\n        return this.apiCall('SEND_DTMF', [dtmf, interactionId])\r\n    }\r\n\r\n    consultCall(phone: string): Promise<OperationResult> {\r\n        return this.apiCall('CONSULT_CALL', [phone])\r\n    }\r\n\r\n    blindTransfer(phone: string, customTransferData?: CustomTransferData, integrationId?: string): Promise<OperationResult> {\r\n        return this.apiCall('BLIND_TRANSFER', [phone, customTransferData, integrationId])\r\n    }\r\n\r\n    transfer(customTransferData?: CustomTransferData): Promise<OperationResult> {\r\n        return this.apiCall('TRANSFER', [customTransferData])\r\n    }\r\n\r\n    leaveInteraction(interactionId?: string): Promise<OperationResult> {\r\n        return this.apiCall('LEAVE_INTERACTION', [interactionId])\r\n    }\r\n\r\n    completeInteraction(interactionId?: string): Promise<OperationResult> {\r\n        return this.apiCall('COMPLETE_INTERACTION', [interactionId])\r\n    }\r\n\r\n    leaveAndCompleteInteraction(disposition?: string, note?: string, interactionId?: string): Promise<OperationResult> {\r\n        return this.apiCall('LEAVE_AND_COMPLETE_INTERACTION', [disposition, note, interactionId])\r\n    }\r\n\r\n    switchActiveInteraction(interactionId: string): Promise<OperationResult> {\r\n        return this.apiCall('SWITCH_ACTIVE_INTERACTION', [interactionId])\r\n    }\r\n\r\n    inviteToCallConference(phone: string, customTransferData?: CustomTransferData, interactionId?: string): Promise<OperationResult> {\r\n        return this.apiCall('INVITE_TO_CALL_CONFERENCE', [phone, customTransferData, interactionId])\r\n    }\r\n\r\n\r\n    removeFromCallConference(partyId: string, interactionId?: string): Promise<OperationResult> {\r\n        return this.apiCall('REMOVE_FROM_CALL_CONFERENCE', [partyId, interactionId])\r\n    }\r\n\r\n    destroyCallConference(interactionId?: string): Promise<OperationResult> {\r\n        return this.apiCall('DESTROY_CALL_CONFERENCE', [interactionId])\r\n    }\r\n\r\n    inviteToChatConference(partyId: string, interactionId?: string): Promise<OperationResult> {\r\n        return this.apiCall('INVITE_TO_CHAT_CONFERENCE', [partyId, interactionId])\r\n    }\r\n\r\n    removeFromChatConference(partyId: string, interactionId?: string): Promise<OperationResult> {\r\n        return this.apiCall('REMOVE_FROM_CHAT_CONFERENCE', [partyId, interactionId])\r\n    }\r\n\r\n    mergeAllCallsIntoConference(customTransferData?: CustomTransferData): Promise<OperationResult> {\r\n        return this.apiCall('MERGE_ALL_CALLS_INTO_CONFERENCE', [customTransferData])\r\n    }\r\n\r\n    getTeams(): Promise<OperationResult<Team[]>> {\r\n        return this.apiCall('GET_TEAMS')\r\n    }\r\n\r\n    getTeamMembers(teamId: string): Promise<OperationResult<User[]>> {\r\n        return this.apiCall('GET_TEAM_MEMBERS', [teamId])\r\n    }\r\n\r\n    getServicesList(): Promise<OperationResult<ServiceData[]>> {\r\n        return this.apiCall('GET_SERVICES_LIST')\r\n    }\r\n\r\n    getService(): Promise<OperationResult<ServiceData | null>> {\r\n        return this.apiCall('GET_SERVICE')\r\n    }\r\n\r\n    setService(service: string | null): Promise<OperationResult> {\r\n        return this.apiCall('SET_SERVICE', [service])\r\n    }\r\n\r\n    getDIDNumbersList(): Promise<OperationResult<DIDNumber[]>> {\r\n        return this.apiCall('GET_DID_LIST')\r\n    }\r\n\r\n    getDIDNumber(): Promise<OperationResult<DIDNumber | null>> {\r\n        return this.apiCall('GET_DID')\r\n    }\r\n\r\n    setDIDNumber(did: string | null): Promise<OperationResult> {\r\n        return this.apiCall('SET_DID', [did])\r\n    }\r\n\r\n    getDispositionsList(target: DispositionTarget): Promise<OperationResult<DispositionData[]>> {\r\n        return this.apiCall('GET_DISPOSITIONS_LIST', [target])\r\n    }\r\n\r\n    setDisposition(disposition: string, interactionId?: string): Promise<OperationResult> {\r\n        return this.apiCall('SET_DISPOSITION', [disposition, interactionId])\r\n    }\r\n\r\n    addNote(note: string, interactionId?: string): Promise<OperationResult> {\r\n        return this.apiCall('ADD_NOTE', [note, interactionId])\r\n    }\r\n\r\n    updateNote(note: string, interactionId?: string): Promise<OperationResult> {\r\n        return this.apiCall('UPDATE_NOTE', [note, interactionId])\r\n    }\r\n\r\n    replaceNote(note: string, interactionId?: string): Promise<OperationResult> {\r\n        return this.apiCall('REPLACE_NOTE', [note, interactionId])\r\n    }\r\n\r\n    setRescheduleWindow(rescheduleData: RescheduleData, interactionId?: string): Promise<OperationResult> {\r\n        return this.apiCall('SET_RESCHEDULE', [rescheduleData, interactionId])\r\n    }\r\n\r\n    getConfig(): Promise<OperationResult<IntegrationConfig>> {\r\n        return this.apiCall('GET_CONFIG')\r\n    }\r\n\r\n    setVariable(key: string, value: string, interactionId?: string): Promise<OperationResult> {\r\n        return this.apiCall('SET_VARIABLE', [key, value, interactionId])\r\n    }\r\n\r\n    getVariables(keys: string[], interactionId?: string): Promise<OperationResult<Record<string, string>>> {\r\n        return this.apiCall('GET_VARIABLES', [keys, interactionId])\r\n    }\r\n\r\n    addInteractionAssociatedObject(object: InteractionAssociatedObjectData, interactionId?: string): Promise<OperationResult> {\r\n        return this.apiCall('ADD_INTERACTION_ASSOCIATED_OBJECT', [object, interactionId])\r\n    }\r\n\r\n    setInteractionActiveScreen(screenData: InteractionScreen, interactionId?: string): Promise<OperationResult> {\r\n        return this.apiCall('SET_INTERACTION_ACTIVE_SCREEN', [screenData, interactionId])\r\n    }\r\n\r\n    getPhoneDevicesList(): Promise<OperationResult<PhoneDevice[]>> {\r\n        return this.apiCall('GET_PHONE_DEVICES_LIST')\r\n    }\r\n\r\n    getPhoneDevice(): Promise<OperationResult<PhoneDeviceData>> {\r\n        return this.apiCall('GET_PHONE_DEVICE')\r\n    }\r\n\r\n    setPhoneDevice(phoneDevice: PhoneDeviceData): Promise<OperationResult> {\r\n        return this.apiCall('SET_PHONE_DEVICE', [phoneDevice])\r\n    }\r\n\r\n    setCallHold(state: boolean, interactionId?: string): Promise<OperationResult> {\r\n        return this.apiCall('SET_CALL_HOLD', [state, interactionId])\r\n    }\r\n\r\n    setCallRecording(state: boolean, interactionId?: string): Promise<OperationResult> {\r\n        return this.apiCall('SET_CALL_RECORDING', [state, interactionId])\r\n    }\r\n\r\n    setCallMute(state: boolean, interactionId?: string): Promise<OperationResult> {\r\n        return this.apiCall('SET_CALL_MUTE', [state, interactionId])\r\n    }\r\n\r\n    setScreenRecordingMute(state: boolean): Promise<OperationResult> {\r\n        return this.apiCall('SET_SCREEN_RECORDING_MUTE', [state])\r\n    }\r\n\r\n    getScreenRecordingState(): Promise<OperationResult<ScreenRecordingState>> {\r\n        return this.apiCall('GET_SCREEN_RECORDING_STATE')\r\n    }\r\n\r\n    setWidgetMinimized(state: boolean): Promise<OperationResult> {\r\n        return this.apiCall('SET_WIDGET_MINIMIZED', [state])\r\n    }\r\n\r\n    sendChatMessage(message: string, interactionId?: string): Promise<OperationResult> {\r\n        return this.apiCall('SEND_CHAT_MESSAGE', [message, interactionId])\r\n    }\r\n\r\n    suggestChatMessage(message: string, allowOverwrite?: boolean, interactionId?: string): Promise<OperationResult> {\r\n        return this.apiCall('SUGGEST_CHAT_MESSAGE', [message, allowOverwrite, interactionId])\r\n    }\r\n\r\n    getAgentNotReadyReasons(): Promise<OperationResult<string[]>> {\r\n        return this.apiCall('GET_AGENT_NOT_READY_REASONS')\r\n    }\r\n\r\n    activatePage(): Promise<OperationResult> {\r\n        return this.apiCall('ACTIVATE_PAGE', [])\r\n    }\r\n\r\n    getInteractionsState(): Promise<OperationResult<InteractionsState>> {\r\n        return this.apiCall('GET_INTERACTIONS_STATE', [])\r\n    }\r\n\r\n    setCallRecordingMute(state: boolean, interactionId?: string): Promise<OperationResult> {\r\n        return this.apiCall('SET_CALL_RECORDING_MUTE', [state, interactionId])\r\n    }\r\n\r\n    setDialCandidates(candidates: DialCandidate[]): Promise<OperationResult> {\r\n        return this.apiCall('SET_DIAL_CANDIDATES', [candidates])\r\n    }\r\n\r\n    on(message: 'ON_LOGIN', handler: OnLoginHandler): void\r\n    on(message: 'ON_LOGOUT', handler: OnLogoutHandler): void\r\n    on(message: 'ON_NEW_INTERACTION', handler: OnNewInteractionHandler): void\r\n    on(message: 'ON_INTERACTION_REMOVED', handler: OnInteractionRemovedHandler): void\r\n    on(message: 'ON_INTERACTION_STATE_CHANGE', handler: OnInteractionStateChangeHandler): void\r\n    on(message: 'ON_ACTIVE_INTERACTION_SWITCHED', handler: OnActiveInteractionSwitchHandler): void\r\n    on(message: 'ON_AGENT_STATE_CHANGE', handler: OnAgentStateChangeHandler): void\r\n    on(message: 'ON_REQUEST_TRANSFER_DATA', handler: OnRequestTransferDataHandler): void\r\n    on(message: 'ON_LOAD_TRANSFER_DATA', handler: OnLoadTransferDataHandler): void\r\n    on(message: 'ON_GET_KNOWLEDGE_BASE_FOLDER', handler: OnGetKnowledgeBaseFolderHandler): void\r\n    on(message: 'ON_SEARCH_KNOWLEDGE_BASE', handler: OnSearchKnowledgeBaseHandler): void\r\n    on(message: 'ON_GET_KNOWLEDGE_BASE_ARTICLE', handler: OnGetKnowledgeBaseArticleHandler): void\r\n    on(message: 'ON_OPEN_RECORD', handler: OnOpenRecordHandler): void\r\n    on(message: 'ON_SEARCH_RECORDS', handler: OnSearchRecordsHandler): void\r\n    on(message: 'ON_SHOW_SCREEN', handler: OnShowScreenHandler): void\r\n    on(message: 'ON_SCREEN_RECORDING_STATE_CHANGE', handler: OnScreenRecordingStateChangeHandler): void\r\n    on(message: 'ON_WIDGET_MINIMIZED_CHANGE', handler: OnWidgetMinimizedChangeHandler): void\r\n    on(message: 'ON_SERVER_ERROR', handler: OnServerErrorHandler): void\r\n    on(message: 'ON_SOFTPHONE_STATUS_CHANGE', handler: OnSoftphoneStatusChangeHandler): void\r\n    on(message: 'ON_AUDIO_DEVICE_CHANGE', handler: OnAudioDeviceChangeHandler): void\r\n    on(message: 'ON_PHONE_CAPABILITIES_CHANGE', handler: OnPhoneCapabilitiesChangeHandler): void\r\n    on(message: 'ON_CALL_AUDIO_QUALITY_ALERT', handler: OnCallAudioQualityAlertHandler): void\r\n    on(message: 'ON_WEB_SCREEN_POP_CUSTOM', handler: OnWebScreenPopCustomHandler): void\r\n    on(message: 'ON_SAVE_ACTIVITY_RECORD', handler: OnSaveActivityRecordHandler): void\r\n    on(message: 'ON_VALIDATE_ASSOCIATED_RECORDS', handler: OnValidateAssociatedRecordsHandler): void\r\n    on(message: 'ON_REQUEST_RECORD_INFO', handler: OnRequestRecordInfoHandler): void\r\n    on(message: 'ON_REQUEST_RECORD_ON_SCREEN', handler: OnRequestRecordOnScreenHandler): void\r\n    on(message: CallbackMessage, handler: AnyEventHandler): void {\r\n        this.messageHandlers[message].push(handler)\r\n    }\r\n\r\n    remove(message: 'ON_LOGIN', handler: OnLoginHandler): void\r\n    remove(message: 'ON_LOGOUT', handler: OnLogoutHandler): void\r\n    remove(message: 'ON_NEW_INTERACTION', handler: OnNewInteractionHandler): void\r\n    remove(message: 'ON_INTERACTION_REMOVED', handler: OnInteractionRemovedHandler): void\r\n    remove(message: 'ON_INTERACTION_STATE_CHANGE', handler: OnInteractionStateChangeHandler): void\r\n    remove(message: 'ON_ACTIVE_INTERACTION_SWITCHED', handler: OnActiveInteractionSwitchHandler): void\r\n    remove(message: 'ON_AGENT_STATE_CHANGE', handler: OnAgentStateChangeHandler): void\r\n    remove(message: 'ON_REQUEST_TRANSFER_DATA', handler: OnRequestTransferDataHandler): void\r\n    remove(message: 'ON_LOAD_TRANSFER_DATA', handler: OnLoadTransferDataHandler): void\r\n    remove(message: 'ON_GET_KNOWLEDGE_BASE_FOLDER', handler: OnGetKnowledgeBaseFolderHandler): void\r\n    remove(message: 'ON_SEARCH_KNOWLEDGE_BASE', handler: OnSearchKnowledgeBaseHandler): void\r\n    remove(message: 'ON_GET_KNOWLEDGE_BASE_ARTICLE', handler: OnGetKnowledgeBaseArticleHandler): void\r\n    remove(message: 'ON_OPEN_RECORD', handler: OnOpenRecordHandler): void\r\n    remove(message: 'ON_SEARCH_RECORDS', handler: OnSearchRecordsHandler): void\r\n    remove(message: 'ON_SHOW_SCREEN', handler: OnShowScreenHandler): void\r\n    remove(message: 'ON_SCREEN_RECORDING_STATE_CHANGE', handler: OnScreenRecordingStateChangeHandler): void\r\n    remove(message: 'ON_WIDGET_MINIMIZED_CHANGE', handler: OnWidgetMinimizedChangeHandler): void\r\n    remove(message: 'ON_SERVER_ERROR', handler: OnServerErrorHandler): void\r\n    remove(message: 'ON_SOFTPHONE_STATUS_CHANGE', handler: OnSoftphoneStatusChangeHandler): void\r\n    remove(message: 'ON_AUDIO_DEVICE_CHANGE', handler: OnAudioDeviceChangeHandler): void\r\n    remove(message: 'ON_PHONE_CAPABILITIES_CHANGE', handler: OnPhoneCapabilitiesChangeHandler): void\r\n    remove(message: 'ON_CALL_AUDIO_QUALITY_ALERT', handler: OnCallAudioQualityAlertHandler): void\r\n    remove(message: 'ON_WEB_SCREEN_POP_CUSTOM', handler: OnWebScreenPopCustomHandler): void\r\n    remove(message: 'ON_SAVE_ACTIVITY_RECORD', handler: OnSaveActivityRecordHandler): void\r\n    remove(message: 'ON_VALIDATE_ASSOCIATED_RECORDS', handler: OnValidateAssociatedRecordsHandler): void\r\n    remove(message: 'ON_REQUEST_RECORD_INFO', handler: OnRequestRecordInfoHandler): void\r\n    remove(message: 'ON_REQUEST_RECORD_ON_SCREEN', handler: OnRequestRecordOnScreenHandler): void\r\n    remove(message: CallbackMessage, handler: AnyEventHandler): void {\r\n        const delIndex = this.messageHandlers[message].indexOf(handler)\r\n        if (delIndex !== -1) {\r\n            this.messageHandlers[message].splice(delIndex, 1)\r\n        }\r\n    }\r\n}\r\n\r\nwindow.brightpattern = {\r\n    AdApi: AgentDesktopClientAPIImpl,\r\n}\r\n","\r\nconst extractURLParams = (url: string): Record<string, string> => {\r\n    const paramsMap: Record<string, string> = {}\r\n\r\n    if (url) {\r\n        try {\r\n            const paramUrl = url.split('?').slice(1).join('?')\r\n            if (paramUrl.length) {\r\n\r\n                const params = paramUrl.split('&')\r\n                params.reduce<Record<string, string>>((paramMap, param) => {\r\n\r\n                    const splits = param.split('=')\r\n                    if (splits.length) {\r\n                        const name = decodeURIComponent(splits.shift()!)\r\n                        paramMap[name] = decodeURIComponent(splits.join('='))\r\n                    }\r\n                    return paramMap\r\n                }, paramsMap)\r\n            }\r\n        } catch (e) {\r\n            console.error('Unable to parse URL parameters: ', url)\r\n        }\r\n    }\r\n    return paramsMap\r\n}\r\n\r\nconst capitalize = (str: string): string => str.replace(/^\\w/, c => c.toUpperCase())\r\n\r\nfunction findLast<T>(array: Array<T>, predicate: (item: T) => boolean): T | null {\r\n\r\n    for (let i = array.length - 1; i >= 0; i--) {\r\n        if (predicate(array[i])) {\r\n            return array[i]\r\n        }\r\n    }\r\n    return null\r\n}\r\n\r\nfunction shallowObjEqual<Obj extends Record<PropertyKey, unknown>>(obj1: Obj, obj2: Obj): boolean {\r\n\r\n    for (const key in obj1) {\r\n        if (!(key in obj2) || obj1[key] !== obj2[key]) {\r\n            return false\r\n        }\r\n    }\r\n    for (const key in obj2) {\r\n        if (!(key in obj1) || obj2[key] !== obj1[key]) {\r\n            return false\r\n        }\r\n    }\r\n    return true\r\n}\r\n\r\nexport type FulfilledResult<T> = {\r\n    status: 'fulfilled'\r\n    value: T\r\n}\r\n\r\nexport type RejectedResult<T> = {\r\n    status: 'rejected'\r\n    reason: any\r\n}\r\n\r\nexport type WaitResolveResult<T> = FulfilledResult<T> | RejectedResult<T>\r\n\r\nconst waitResolveAll = function<T>(targets: Array<T | Promise<T>>): Promise<WaitResolveResult<T>[]> {\r\n    return new Promise<WaitResolveResult<T>[]>((resolve, reject) => {\r\n\r\n        if (!targets.length) {\r\n            resolve([])\r\n            return\r\n        }\r\n        let numberOfResolved = 0\r\n        const results = new Array(targets.length)\r\n        const promises = targets.map(target => {\r\n            return (target instanceof Promise ? target : Promise.resolve(target))\r\n        }) as Promise<T>[]\r\n        promises.forEach((targetPromise, index) => {\r\n            targetPromise\r\n            .then(value => {\r\n                results[index] = {\r\n                    status: 'fulfilled',\r\n                    value,\r\n                }\r\n            })\r\n            .catch(reason => {\r\n                results[index] = {\r\n                    status: 'rejected',\r\n                    reason,\r\n                }\r\n            })\r\n            .finally(() => {\r\n                numberOfResolved++\r\n                if (numberOfResolved === targets.length) {\r\n                    resolve(results)\r\n                }\r\n            })\r\n        })\r\n    })\r\n}\r\n\r\nconst startsWithAny = (base: string, prefixes: string[]) => {\r\n    for (const prefix of prefixes) {\r\n        if (base.startsWith(prefix)) {\r\n            return true\r\n        }\r\n    }\r\n    return false\r\n}\r\n\r\nconst splitWords = (str: string): string => {\r\n    return str\r\n    .trim()\r\n    .split(/(?=[A-Z])/)\r\n    .map(word => word.trim())\r\n    .join(' ')\r\n}\r\n\r\nexport const utils = {\r\n    extractURLParams,\r\n    capitalize,\r\n    findLast,\r\n    shallowObjEqual,\r\n    waitResolveAll,\r\n    startsWithAny,\r\n    splitWords,\r\n}\r\n","/** Must not have dependencies (imports) */\r\n\r\nexport const requestMessages = [\r\n    'GET_LOGIN_STATE',\r\n    'LOGIN',\r\n    'LOGOUT',\r\n    'GET_AGENT_STATE',\r\n    'SET_AGENT_STATE',\r\n    'ACCEPT_INTERACTION',\r\n    'REJECT_INTERACTION',\r\n    'START_CALL',\r\n    'START_CHAT',\r\n    'START_EMAIL',\r\n    'SEND_DTMF',\r\n    'CONSULT_CALL',\r\n    'BLIND_TRANSFER',\r\n    'TRANSFER',\r\n    'LEAVE_INTERACTION',\r\n    'COMPLETE_INTERACTION',\r\n    'LEAVE_AND_COMPLETE_INTERACTION',\r\n    'SWITCH_ACTIVE_INTERACTION',\r\n    'INVITE_TO_CALL_CONFERENCE',\r\n    'REMOVE_FROM_CALL_CONFERENCE',\r\n    'DESTROY_CALL_CONFERENCE',\r\n    'INVITE_TO_CHAT_CONFERENCE',\r\n    'REMOVE_FROM_CHAT_CONFERENCE',\r\n    'MERGE_ALL_CALLS_INTO_CONFERENCE',\r\n    'GET_TEAMS',\r\n    'GET_TEAM_MEMBERS',\r\n    'GET_SERVICES_LIST',\r\n    'GET_SERVICE',\r\n    'SET_SERVICE',\r\n    'GET_DID_LIST',\r\n    'GET_DID',\r\n    'SET_DID',\r\n    'GET_DISPOSITIONS_LIST',\r\n    'SET_DISPOSITION',\r\n    'SET_RESCHEDULE',\r\n    'ADD_NOTE',\r\n    'UPDATE_NOTE',\r\n    'REPLACE_NOTE',\r\n    'GET_CONFIG',\r\n    'GET_VARIABLES',\r\n    'SET_VARIABLE',\r\n    'ADD_INTERACTION_ASSOCIATED_OBJECT',\r\n    'SET_INTERACTION_ACTIVE_SCREEN',\r\n    'GET_PHONE_DEVICES_LIST',\r\n    'GET_PHONE_DEVICE',\r\n    'SET_PHONE_DEVICE',\r\n    'SET_CALL_HOLD',\r\n    'SET_CALL_RECORDING',\r\n    'SET_CALL_MUTE',\r\n    'SET_SCREEN_RECORDING_MUTE',\r\n    'GET_SCREEN_RECORDING_STATE',\r\n    'SET_WIDGET_MINIMIZED',\r\n    'SEND_CHAT_MESSAGE',\r\n    'SUGGEST_CHAT_MESSAGE',\r\n    'GET_AGENT_NOT_READY_REASONS',\r\n    'ACTIVATE_PAGE',\r\n    'GET_INTERACTIONS_STATE',\r\n    'SET_CALL_RECORDING_MUTE',\r\n    'SET_DIAL_CANDIDATES',\r\n] as const\r\nexport type RequestMessage = typeof requestMessages[number]\r\n\r\nexport const callbackMessages = {\r\n    'ON_LOGIN': {needResponse: false},\r\n    'ON_LOGOUT': {needResponse: false},\r\n    'ON_NEW_INTERACTION': {needResponse: false},\r\n    'ON_INTERACTION_REMOVED': {needResponse: false},\r\n    'ON_INTERACTION_STATE_CHANGE': {needResponse: false},\r\n    'ON_ACTIVE_INTERACTION_SWITCHED': {needResponse: false},\r\n    'ON_AGENT_STATE_CHANGE': {needResponse: false},\r\n    'ON_REQUEST_TRANSFER_DATA': {needResponse: true},\r\n    'ON_LOAD_TRANSFER_DATA': {needResponse: false},\r\n    'ON_GET_KNOWLEDGE_BASE_FOLDER': {needResponse: true},\r\n    'ON_SEARCH_KNOWLEDGE_BASE': {needResponse: true},\r\n    'ON_GET_KNOWLEDGE_BASE_ARTICLE': {needResponse: true},\r\n    'ON_OPEN_RECORD': {needResponse: false},\r\n    'ON_SEARCH_RECORDS': {needResponse: false},\r\n    'ON_SHOW_SCREEN': {needResponse: false},\r\n    'ON_SCREEN_RECORDING_STATE_CHANGE': {needResponse: false},\r\n    'ON_WIDGET_MINIMIZED_CHANGE': {needResponse: false},\r\n    'ON_SERVER_ERROR': {needResponse: false},\r\n    'ON_SOFTPHONE_STATUS_CHANGE': {needResponse: false},\r\n    'ON_AUDIO_DEVICE_CHANGE': {needResponse: false},\r\n    'ON_PHONE_CAPABILITIES_CHANGE': {needResponse: false},\r\n    'ON_CALL_AUDIO_QUALITY_ALERT': {needResponse: false},\r\n    'ON_WEB_SCREEN_POP_CUSTOM': {needResponse: true},\r\n    'ON_SAVE_ACTIVITY_RECORD': {needResponse: false},\r\n    'ON_VALIDATE_ASSOCIATED_RECORDS': {needResponse: true},\r\n    'ON_REQUEST_RECORD_INFO': {needResponse: true},\r\n    'ON_REQUEST_RECORD_ON_SCREEN': {needResponse: true},\r\n} as const\r\nexport type CallbackMessage = keyof typeof callbackMessages\r\n\r\n\r\ntype FilterByHavingResponse<T> = {\r\n    [Key in keyof T]: T[Key] extends {needResponse: true} ? Key : never\r\n}\r\n\r\nconst typedKeys = <T extends {[key: string]: unknown}>(data: T): Array<keyof T> =>\r\n    Object.keys.call<typeof data, Array<typeof data>, Array<keyof T>>(data, data)\r\n\r\nexport type CallbackMessageWithResponse = FilterByHavingResponse<typeof callbackMessages>[keyof typeof callbackMessages]\r\n\r\nexport const RESPONSE_SUFFIX = '_RESPONSE' as const\r\n\r\nexport const requestResponseMessages = requestMessages.map<`${RequestMessage}${typeof RESPONSE_SUFFIX}`>(message => {\r\n    return `${message}${RESPONSE_SUFFIX}`\r\n})\r\nexport const callbackResponseMessages = typedKeys(callbackMessages)\r\n    .filter<CallbackMessageWithResponse>((message: CallbackMessage): message is CallbackMessageWithResponse => {\r\n        return callbackMessages[message].needResponse\r\n    })\r\n    .map<`${CallbackMessageWithResponse}${typeof RESPONSE_SUFFIX}`>(message => {\r\n        return `${message}${RESPONSE_SUFFIX}`\r\n    })\r\n\r\nexport type CallbackResponseMessage = keyof {\r\n    [Key in keyof typeof callbackMessages as typeof callbackMessages[Key] extends {needResponse: true} ? `${Key}${typeof RESPONSE_SUFFIX}` : never]: true\r\n}\r\n\r\nexport type CallbackMethodsReturnTypeMap = {\r\n    'ON_LOGIN': void\r\n    'ON_LOGOUT': void\r\n    'ON_NEW_INTERACTION': void\r\n    'ON_INTERACTION_REMOVED': void\r\n    'ON_INTERACTION_STATE_CHANGE': void\r\n    'ON_ACTIVE_INTERACTION_SWITCHED': void\r\n    'ON_AGENT_STATE_CHANGE': void\r\n    'ON_REQUEST_TRANSFER_DATA': CustomTransferData\r\n    'ON_LOAD_TRANSFER_DATA': void\r\n    'ON_GET_KNOWLEDGE_BASE_FOLDER': ExternalKBItemData[]\r\n    'ON_SEARCH_KNOWLEDGE_BASE': ExternalKBSearchResultData[]\r\n    'ON_GET_KNOWLEDGE_BASE_ARTICLE': ExternalKBArticleData | null\r\n    'ON_OPEN_RECORD': void\r\n    'ON_SEARCH_RECORDS': void\r\n    'ON_SHOW_SCREEN': void\r\n    'ON_SCREEN_RECORDING_STATE_CHANGE': void\r\n    'ON_WIDGET_MINIMIZED_CHANGE': void\r\n    'ON_SERVER_ERROR': void\r\n    'ON_SOFTPHONE_STATUS_CHANGE': void\r\n    'ON_AUDIO_DEVICE_CHANGE': void\r\n    'ON_PHONE_CAPABILITIES_CHANGE': void\r\n    'ON_CALL_AUDIO_QUALITY_ALERT': void\r\n    'ON_WEB_SCREEN_POP_CUSTOM': boolean\r\n    'ON_SAVE_ACTIVITY_RECORD': void\r\n    'ON_VALIDATE_ASSOCIATED_RECORDS': RecordsValidationResult\r\n    'ON_REQUEST_RECORD_INFO': InteractionAssociatedObjectData | null\r\n    'ON_REQUEST_RECORD_ON_SCREEN': InteractionAssociatedObjectData | null\r\n}\r\n\r\nconst resultStatus = ['error', 'success'] as const\r\nexport type ResultStatus = typeof resultStatus[number]\r\n\r\nexport const resultErrorCodes = {\r\n    not_enough_privileges: 1,\r\n    not_logged_in: 2,\r\n    invalid_args: 3,\r\n    logged_without_phone: 4,\r\n    banned: 5,\r\n    api_not_answer: 6,\r\n    invalid_request: 7,\r\n    timeout: 8,\r\n    no_chat_in_service: 9,\r\n    empty_number: 10,\r\n    no_service: 11,\r\n    self_call: 12,\r\n    no_interaction: 13,\r\n    api_method_not_implemented: 14,\r\n    not_suitable_state: 15,\r\n    no_disposition: 16,\r\n    object_not_found: 17,\r\n    no_permissions_did_sms: 18,\r\n    no_permissions_did_call: 19,\r\n    no_channel_in_service: 20,\r\n    unknown_error: 99,\r\n} as const\r\nexport type ResultErrorCodes = typeof resultErrorCodes\r\n\r\nexport const serverErrorCodes = {\r\n    forced_logout_by_other_client: 100,\r\n    forced_logout_by_supervisor: 101,\r\n    invalid_request: 102,\r\n    phone_not_registered: 103,\r\n    phone_not_in_dial_plan: 104,\r\n    tenant_disabled: 105,\r\n    destination_user_not_logged: 106,\r\n    user_disabled_or_deleted: 107,\r\n    user_already_logged_in: 108,\r\n    invalid_credentials: 109,\r\n    other_user_logged_with_phone: 110,\r\n    invalid_token: 111,\r\n    logged_users_limit_reached: 112,\r\n    already_logged_in_with_the_same_session: 113,\r\n    not_enough_privileges: 114,\r\n    sip_server_error: 200,\r\n    unknown_error: 300,\r\n} as const\r\nexport type ServerErrorCodes = typeof serverErrorCodes\r\n\r\nexport type ResultError = {\r\n    code: ResultErrorCodes[keyof ResultErrorCodes]\r\n    name: keyof ResultErrorCodes\r\n    message?: string\r\n}\r\n\r\nexport type OperationResult<ReturnType = null> =\r\n    {status: 'success'; data: ReturnType} |\r\n    {status: 'error'; error: ResultError}\r\n\r\nexport type SyncAsyncResult<ReturnType = void> = ReturnType | Promise<ReturnType>\r\n\r\nexport const agentStates = ['supervising', 'ready', 'not_ready', 'busy', 'after_call_work', 'reserved', 'ringing'] as const\r\nexport type AgentState = typeof agentStates[number]\r\n\r\nexport const interactionStates = [\r\n    'unknown',\r\n    'queued',\r\n    'ivr',\r\n    'wrap_up',\r\n    'wrap_up_hold',\r\n    'delivered',\r\n    'delivery_pending',\r\n    'hold',\r\n    'completed',\r\n] as const\r\nexport type InteractionState = typeof interactionStates[number]\r\n\r\nexport const interactionTypes = ['voice', 'chat', 'email'] as const\r\nexport type InteractionType = typeof interactionTypes[number]\r\n\r\nexport const chatChannelTypes = [\r\n    'telegram',\r\n    'line',\r\n    'facebook',\r\n    'web',\r\n    'nexmo',\r\n    'sms',\r\n    'viber',\r\n    'twitter',\r\n    'wechat',\r\n    'whatsapp',\r\n] as const\r\nexport type ChatChannelType = typeof chatChannelTypes[number]\r\n\r\nexport const callDirections = ['inbound', 'outbound'] as const\r\nexport type CallDirection = typeof callDirections[number]\r\n\r\nexport const phoneDevices = [\r\n    'phone_type_browser',\r\n    'phone_type_external',\r\n    'phone_type_hard_custom',\r\n    'phone_type_hard_default',\r\n    'phone_type_nailed',\r\n    'phone_type_none',\r\n    'phone_type_soft_secure',\r\n    'phone_type_microsoft_teams',\r\n    'phone_type_soft_unsecure',\r\n] as const\r\nexport type PhoneDevice = typeof phoneDevices[number]\r\n\r\nexport const dispositionTypes = [\r\n    'SUCCESS',\r\n    'FAILURE',\r\n    'CONTINUE',\r\n    'SPAM',\r\n    'DO_NOT_CALL',\r\n] as const\r\nexport type DispositionType = typeof dispositionTypes[number]\r\n\r\nexport type UserState = AgentState | 'offline'\r\n\r\nexport const chatPartyTypes = ['internal', 'external'] as const\r\nexport type ChatPartyType = typeof chatPartyTypes[number]\r\n\r\nexport type LoginStateData = {\r\n    isLoggedIn: boolean\r\n    agentId?: string\r\n    username?: string\r\n    sessionId?: string\r\n}\r\n\r\nexport type AgentStateData = {\r\n    state: AgentState\r\n    reservedForIncomingInteraction: boolean\r\n    notReadyReason?: string\r\n}\r\n\r\nexport type ServiceData = {\r\n    id: string\r\n    name: string\r\n    useDispositions: boolean\r\n    requireDisposition: boolean\r\n}\r\n\r\nexport type DispositionTarget = {\r\n    service?: string\r\n    interactionId?: string\r\n}\r\n\r\nexport type DispositionData = {\r\n    id: string\r\n    code: string\r\n    name: string\r\n    type: DispositionType\r\n}\r\n\r\nexport type IntegrationConfig = any\r\n\r\nexport type InteractionAssociatedObjectData = {\r\n    id: string\r\n    type: string\r\n    displayName: string\r\n    displayType: string\r\n    customFields: Record<string, string>\r\n}\r\nexport type InteractionAssociatedObject = {\r\n    source: string\r\n} & InteractionAssociatedObjectData\r\n\r\nexport type InteractionAssociatedObjectsData = {\r\n    list: InteractionAssociatedObject[]\r\n    selected: string[]\r\n}\r\n\r\nexport type AttachedData = Record<string, string>\r\n\r\nexport type InteractionData = {\r\n    interactionId: string\r\n    globalInteractionId?: string\r\n    state: InteractionState\r\n    type: InteractionType\r\n    callParties: CallParty[]\r\n    callMuted: boolean\r\n    callRecording: boolean\r\n    chatParties: ChatParty[]\r\n    attachedData: AttachedData\r\n    phoneNumber?: string\r\n    email?: string\r\n    callDirection?: CallDirection\r\n    startTime?: number\r\n    endTime?: number\r\n    duration?: number\r\n    description?: string\r\n    disposition?: string\r\n    service?: string\r\n    playbackUrl?: string\r\n    recordingUrl?: string\r\n    DNIS?: string\r\n    ANI?: string\r\n    origination?: InteractionOrigination\r\n\r\n    /** @deprecated */\r\n    subject: string\r\n    /** @deprecated */\r\n    associatedObjects: InteractionAssociatedObjectsData\r\n}\r\n\r\nexport type InteractionActivityData = {\r\n    interactionId: string\r\n    globalInteractionId?: string\r\n    state: InteractionState\r\n    type: InteractionType\r\n    associatedObjects: InteractionAssociatedObjectsData\r\n    attachedData: AttachedData\r\n    phoneNumber?: string\r\n    email?: string\r\n    callDirection?: CallDirection\r\n    startTime?: number\r\n    endTime?: number\r\n    duration?: number\r\n    description?: string\r\n    disposition?: string\r\n    service?: string\r\n    playbackUrl?: string\r\n    recordingUrl?: string\r\n    DNIS?: string\r\n    ANI?: string\r\n    origination?: InteractionOrigination\r\n\r\n    /** @deprecated */\r\n    subject: string\r\n    /** @deprecated */\r\n    callParties: CallParty[]\r\n    /** @deprecated */\r\n    callMuted: boolean\r\n    /** @deprecated */\r\n    callRecording: boolean\r\n    /** @deprecated */\r\n    chatParties: ChatParty[]\r\n}\r\n\r\nexport type InteractionScreen = Record<string, string | number | boolean | null | undefined>\r\n\r\nexport type CustomTransferData = Record<string, string | number | boolean | undefined | null>\r\n\r\nexport type ExternalKBArticleData = {\r\n    id: string\r\n    title: string\r\n    keywords: string\r\n    answer: string\r\n    notes: string\r\n    language: string\r\n    createdByUser: string\r\n    lastEditedByUser: string\r\n    customFields: string[]\r\n}\r\nexport type ExternalKBArticle = ExternalKBArticleData & {source: string}\r\n\r\nexport type ExternalKBArticleItem = {\r\n    id: string\r\n    type: 'article'\r\n    title: string\r\n    text: string\r\n}\r\nexport type ExternalKBFolderItem = {\r\n    id: string\r\n    type: 'folder'\r\n    title: string\r\n}\r\n\r\nexport type ExternalKBSearchResultData = ExternalKBArticleItem\r\nexport type ExternalKBSearchResult = ExternalKBSearchResultData & {source: string}\r\n\r\nexport type ExternalKBItemData = ExternalKBArticleItem | ExternalKBFolderItem\r\nexport type ExternalKBItem = ExternalKBItemData & {source: string}\r\n\r\nexport type KBFolderOptions = {\r\n    language?: string\r\n    folderId?: string\r\n}\r\n\r\nexport type SearchRecordsQuery = {\r\n    text: string\r\n    types: string[]\r\n}\r\n\r\nexport type RescheduleData = {\r\n    numberToDial: string\r\n    fromTime: string\r\n    untilTime: string\r\n    timezoneCode?: string\r\n}\r\n\r\nexport type PhoneDeviceData = {\r\n    type: PhoneDevice\r\n    phone?: string\r\n}\r\n\r\nexport type Team = {\r\n    id: string\r\n    displayName: string\r\n    isSupervised: boolean\r\n    usersCount?: number\r\n}\r\n\r\nexport type User = {\r\n    id: string\r\n    teamId: string\r\n    firstName: string\r\n    lastName: string\r\n    phone: string\r\n    state: UserState\r\n}\r\n\r\nexport type CallParty = {\r\n    id: string\r\n    name: string\r\n    phone: string\r\n    userId?: string\r\n}\r\n\r\nexport type ChatParty = {\r\n    id: string\r\n    type: ChatPartyType\r\n    name: string\r\n    userId?: string\r\n    contactId?: string\r\n    email?: string\r\n    phone?: string\r\n}\r\n\r\nexport type ScreenRecordingState = {\r\n    allowed: boolean\r\n    active: boolean\r\n    muted: boolean\r\n}\r\n\r\nexport type ServerErrorData = {\r\n    code: ServerErrorCodes[keyof ServerErrorCodes]\r\n    name: keyof ServerErrorCodes\r\n    timestamp: number // Date.now()\r\n    message?: string\r\n}\r\n\r\nexport type LoginData = {\r\n    username: string\r\n    password: string\r\n    tenant?: string\r\n}\r\n\r\nexport type PhoneCapabilities = {\r\n    canDial: boolean\r\n    canAnswer: boolean\r\n    canHold: boolean\r\n    canRetrieve: boolean\r\n}\r\n\r\nexport type DIDNumber = {\r\n    id: string\r\n    number: string\r\n    isSMS: boolean\r\n    isVoice: boolean\r\n}\r\n\r\nexport type WebScreenPopSecondaryUrl = {\r\n    label?: string\r\n    url?: string\r\n}\r\n\r\nexport type WebScreenPop = {\r\n    action: 'OPEN_WEB_PAGE' | 'DISPLAY_TEXT'\r\n    url: string\r\n    content: string\r\n    label: string\r\n    popUponAnswer: boolean\r\n    keepPopupOpenAfterFinish: boolean\r\n    popup: boolean\r\n    secondaryUrls?: {\r\n        [key: number]: WebScreenPopSecondaryUrl\r\n    }\r\n}\r\n\r\nexport const interactionOriginations = [\r\n    'dialpad',\r\n    'dialpad-search',\r\n    'directory',\r\n    'recent',\r\n    'favorites',\r\n    'workitem',\r\n    'interaction',\r\n    'contact-profile',\r\n    'help',\r\n    'conference',\r\n    'auto',\r\n    'integration-api',\r\n    'chat-center',\r\n    'topbar',\r\n] as const\r\nexport type InteractionOrigination = typeof interactionOriginations[number]\r\n\r\nexport type InteractionsState = {\r\n    activeInteractionId: string | null\r\n    interactions: InteractionData[]\r\n}\r\n\r\nexport type OpenRecordOptions = {\r\n    inNewTab: boolean\r\n    source: 'user' | 'scenario'\r\n}\r\n\r\nexport const phoneTypes = ['mobile', 'business', 'home', 'fax', 'other'] as const\r\ntype PhoneType = typeof phoneTypes[number]\r\n\r\nexport type PhoneData = {\r\n    number: string\r\n    type: PhoneType\r\n    displayType?: string\r\n}\r\n\r\nexport type DialCandidate = {\r\n    id: string\r\n    displayName: string\r\n    phones: PhoneData[]\r\n    associatedObjects: InteractionAssociatedObjectData[]\r\n    email?: string\r\n}\r\n\r\nexport type RecordsValidationResult = {\r\n    valid: boolean\r\n    message?: string\r\n}\r\n\r\nexport type RecordInfoRequest = {\r\n    id: string\r\n    type: string\r\n}\r\n\r\nexport type InitialObjects = InteractionAssociatedObjectData | InteractionAssociatedObjectData[]\r\n\r\n\r\nexport type InitiateResult = {\r\n    id: string | null\r\n    error?: string\r\n}\r\n\r\nexport type OnLoginHandler = (loginState: LoginStateData) => SyncAsyncResult\r\nexport type OnLogoutHandler = () => SyncAsyncResult\r\nexport type OnNewInteractionHandler = (newInteraction: InteractionData) => SyncAsyncResult\r\nexport type OnInteractionRemovedHandler = (interaction: InteractionData) => SyncAsyncResult\r\nexport type OnInteractionStateChangeHandler = (interaction: InteractionData) => SyncAsyncResult\r\nexport type OnActiveInteractionSwitchHandler = (activatedInteractionId: string | null) => SyncAsyncResult\r\nexport type OnAgentStateChangeHandler = (state: AgentState, notReadyReason?: string) => SyncAsyncResult\r\nexport type OnRequestTransferDataHandler = (interactionId: string) => SyncAsyncResult<CustomTransferData>\r\nexport type OnLoadTransferDataHandler = (interactionId: string, data: CustomTransferData) => SyncAsyncResult\r\nexport type OnWidgetMinimizedChangeHandler = (widgetMinimized: boolean) => SyncAsyncResult\r\nexport type OnGetKnowledgeBaseFolderHandler = (options: KBFolderOptions) => SyncAsyncResult<ExternalKBItemData[]>\r\nexport type OnSearchKnowledgeBaseHandler = (query: string, language?: string, folderId?: string) => SyncAsyncResult<ExternalKBSearchResultData[]>\r\nexport type OnGetKnowledgeBaseArticleHandler = (articleId: string) => SyncAsyncResult<ExternalKBArticleData | null>\r\nexport type OnOpenRecordHandler = (record: InteractionAssociatedObjectData, interactionId?: string, options?: OpenRecordOptions) => SyncAsyncResult\r\nexport type OnSearchRecordsHandler = (search: SearchRecordsQuery, interactionId?: string, inNewTab?: boolean) => SyncAsyncResult\r\nexport type OnShowScreenHandler = (screen: InteractionScreen, interactionId?: string) => SyncAsyncResult\r\nexport type OnScreenRecordingStateChangeHandler = (screenRecordingState: ScreenRecordingState) => SyncAsyncResult\r\nexport type OnServerErrorHandler = (error: ServerErrorData) => SyncAsyncResult\r\nexport type OnSoftphoneStatusChangeHandler = (ready: boolean, error?: string) => SyncAsyncResult\r\nexport type OnAudioDeviceChangeHandler = (inputDevice?: string, outputDevice?: string) => SyncAsyncResult\r\nexport type OnPhoneCapabilitiesChangeHandler = (caps: PhoneCapabilities) => SyncAsyncResult\r\nexport type OnCallAudioQualityAlertHandler = (callId: string, alert: boolean) => SyncAsyncResult\r\nexport type OnWebScreenPopCustomHandler = (interactionId: string, webScreenPop: WebScreenPop) => SyncAsyncResult<boolean>\r\nexport type OnSaveActivityRecordHandler = (activity: InteractionActivityData) => SyncAsyncResult\r\nexport type OnValidateAssociatedRecordsHandler = (interactionId: string, records: InteractionAssociatedObjectsData) => SyncAsyncResult<RecordsValidationResult>\r\nexport type OnRequestRecordInfoHandler = (payload: RecordInfoRequest) => SyncAsyncResult<InteractionAssociatedObjectData | null>\r\nexport type OnRequestRecordOnScreenHandler = () => SyncAsyncResult<InteractionAssociatedObjectData | null>\r\n\r\nexport type MessageLogger = (message: string, data: any) => void\r\n\r\n// TODO: resolve type issues\r\nexport type InitOptions = {\r\n    integrationKey?: string\r\n    adcFrame?: any // HTMLIFrameElement\r\n    mountRoot?: any // HTMLElement\r\n    standalone?: boolean\r\n    disableNewInteractionPopup?: boolean\r\n}\r\n\r\nexport declare class AgentDesktopClientAPI {\r\n    adcFrame: any // HTMLIFrameElement | null\r\n\r\n    constructor(options?: InitOptions)\r\n\r\n    injectMessageLogger(callback: MessageLogger): void\r\n\r\n    getLoginState(): Promise<OperationResult<LoginStateData>>\r\n    login(loginData: LoginData, force?: boolean): Promise<OperationResult>\r\n    logout(): Promise<OperationResult>\r\n    getAgentState(): Promise<OperationResult<AgentStateData>>\r\n    setAgentState(state: AgentState, notReadyReason?: string): Promise<OperationResult>\r\n    acceptInteraction(interactionId?: string): Promise<OperationResult>\r\n    rejectInteraction(interactionId?: string): Promise<OperationResult>\r\n    startCall(phonenumber: string, associatedObjects?: InitialObjects): Promise<OperationResult<InitiateResult>>\r\n    startChat(channel: ChatChannelType, address: string, associatedObjects?: InitialObjects): Promise<OperationResult<InitiateResult>>\r\n    startEmail(email: string, associatedObjects?: InitialObjects): Promise<OperationResult<InitiateResult>>\r\n    sendDtmf(dtmf: string, interactionId?: string): Promise<OperationResult>\r\n    consultCall(phone: string): Promise<OperationResult>\r\n    blindTransfer(phone: string, customTransferData?: CustomTransferData, interactionId?: string): Promise<OperationResult>\r\n    transfer(customTransferData?: CustomTransferData): Promise<OperationResult>\r\n    leaveInteraction(interactionId?: string): Promise<OperationResult>\r\n    completeInteraction(interactionId?: string): Promise<OperationResult>\r\n    leaveAndCompleteInteraction(disposition?: string, note?: string, interactionId?: string): Promise<OperationResult>\r\n    switchActiveInteraction(interactionId: string): Promise<OperationResult>\r\n    inviteToCallConference(phone: string, customTransferData?: CustomTransferData, interactionId?: string): Promise<OperationResult>\r\n    removeFromCallConference(partyId: string, interactionId?: string): Promise<OperationResult>\r\n    destroyCallConference(interactionId?: string): Promise<OperationResult>\r\n    mergeAllCallsIntoConference(customTransferData?: CustomTransferData): Promise<OperationResult>\r\n    inviteToChatConference(partyId: string, interactionId?: string): Promise<OperationResult>\r\n    removeFromChatConference(partyId: string, interactionId?: string): Promise<OperationResult>\r\n    getTeams(): Promise<OperationResult<Team[]>>\r\n    getTeamMembers(teamId: string): Promise<OperationResult<User[]>>\r\n    getServicesList(): Promise<OperationResult<ServiceData[]>>\r\n    getService(): Promise<OperationResult<ServiceData | null>>\r\n    setService(service: string | null): Promise<OperationResult>\r\n    getDIDNumbersList(): Promise<OperationResult<DIDNumber[]>>\r\n    getDIDNumber(): Promise<OperationResult<DIDNumber | null>>\r\n    setDIDNumber(did: string | null): Promise<OperationResult>\r\n    getDispositionsList(target: DispositionTarget): Promise<OperationResult<DispositionData[]>>\r\n    setDisposition(disposition: string, interactionId?: string): Promise<OperationResult>\r\n    setRescheduleWindow(rescheduleData: RescheduleData, interactionId?: string): Promise<OperationResult>\r\n    addNote(note: string, interactionId?: string): Promise<OperationResult>\r\n    updateNote(note: string, interactionId?: string): Promise<OperationResult>\r\n    replaceNote(note: string, interactionId?: string): Promise<OperationResult>\r\n    getConfig(): Promise<OperationResult<IntegrationConfig>>\r\n    setVariable(key: string, value: string, interactionId?: string): Promise<OperationResult>\r\n    getVariables(keys: string[], interactionId?: string): Promise<OperationResult<Record<string, string>>>\r\n    addInteractionAssociatedObject(object: InteractionAssociatedObjectData, interactionId?: string): Promise<OperationResult>\r\n    setInteractionActiveScreen(screenData: InteractionScreen, interactionId?: string): Promise<OperationResult>\r\n    getPhoneDevicesList(): Promise<OperationResult<PhoneDevice[]>>\r\n    getPhoneDevice(): Promise<OperationResult<PhoneDeviceData>>\r\n    setPhoneDevice(phoneDevice: PhoneDeviceData): Promise<OperationResult>\r\n    setCallHold(state: boolean, interactionId?: string): Promise<OperationResult>\r\n    setCallRecording(state: boolean, interactionId?: string): Promise<OperationResult>\r\n    setCallMute(state: boolean, interactionId?: string): Promise<OperationResult>\r\n    setScreenRecordingMute(state: boolean): Promise<OperationResult>\r\n    getScreenRecordingState(): Promise<OperationResult<ScreenRecordingState>>\r\n    setWidgetMinimized(state: boolean): Promise<OperationResult>\r\n    sendChatMessage(message: string, interactionId?: string): Promise<OperationResult>\r\n    suggestChatMessage(message: string, allowOverwrite?: boolean, interactionId?: string): Promise<OperationResult>\r\n    getAgentNotReadyReasons(): Promise<OperationResult<string[]>>\r\n    activatePage(): Promise<OperationResult>\r\n    getInteractionsState(): Promise<OperationResult<InteractionsState>>\r\n    setCallRecordingMute(state: boolean, interactionId?: string): Promise<OperationResult>\r\n    setDialCandidates(candidates: DialCandidate[]): Promise<OperationResult>\r\n\r\n    on(message: 'ON_LOGIN', handler: OnLoginHandler): void\r\n    on(message: 'ON_LOGOUT', handler: OnLogoutHandler): void\r\n    on(message: 'ON_NEW_INTERACTION', handler: OnNewInteractionHandler): void\r\n    on(message: 'ON_INTERACTION_REMOVED', handler: OnInteractionRemovedHandler): void\r\n    on(message: 'ON_INTERACTION_STATE_CHANGE', handler: OnInteractionStateChangeHandler): void\r\n    on(message: 'ON_ACTIVE_INTERACTION_SWITCHED', handler: OnActiveInteractionSwitchHandler): void\r\n    on(message: 'ON_AGENT_STATE_CHANGE', handler: OnAgentStateChangeHandler): void\r\n    on(message: 'ON_REQUEST_TRANSFER_DATA', handler: OnRequestTransferDataHandler): void\r\n    on(message: 'ON_LOAD_TRANSFER_DATA', handler: OnLoadTransferDataHandler): void\r\n    on(message: 'ON_GET_KNOWLEDGE_BASE_FOLDER', handler: OnGetKnowledgeBaseFolderHandler): void\r\n    on(message: 'ON_SEARCH_KNOWLEDGE_BASE', handler: OnSearchKnowledgeBaseHandler): void\r\n    on(message: 'ON_GET_KNOWLEDGE_BASE_ARTICLE', handler: OnGetKnowledgeBaseArticleHandler): void\r\n    on(message: 'ON_OPEN_RECORD', handler: OnOpenRecordHandler): void\r\n    on(message: 'ON_SEARCH_RECORDS', handler: OnSearchRecordsHandler): void\r\n    on(message: 'ON_SHOW_SCREEN', handler: OnShowScreenHandler): void\r\n    on(message: 'ON_SCREEN_RECORDING_STATE_CHANGE', handler: OnScreenRecordingStateChangeHandler): void\r\n    on(message: 'ON_WIDGET_MINIMIZED_CHANGE', handler: OnWidgetMinimizedChangeHandler): void\r\n    on(message: 'ON_SERVER_ERROR', handler: OnServerErrorHandler): void\r\n    on(message: 'ON_SOFTPHONE_STATUS_CHANGE', handler: OnSoftphoneStatusChangeHandler): void\r\n    on(message: 'ON_AUDIO_DEVICE_CHANGE', handler: OnAudioDeviceChangeHandler): void\r\n    on(message: 'ON_PHONE_CAPABILITIES_CHANGE', handler: OnPhoneCapabilitiesChangeHandler): void\r\n    on(message: 'ON_CALL_AUDIO_QUALITY_ALERT', handler: OnCallAudioQualityAlertHandler): void\r\n    on(message: 'ON_WEB_SCREEN_POP_CUSTOM', handler: OnWebScreenPopCustomHandler): void\r\n    on(message: 'ON_SAVE_ACTIVITY_RECORD', handler: OnSaveActivityRecordHandler): void\r\n    on(message: 'ON_VALIDATE_ASSOCIATED_RECORDS', handler: OnValidateAssociatedRecordsHandler): void\r\n    on(message: 'ON_REQUEST_RECORD_INFO', handler: OnRequestRecordInfoHandler): void\r\n    on(message: 'ON_REQUEST_RECORD_ON_SCREEN', handler: OnRequestRecordOnScreenHandler): void\r\n\r\n    remove(message: 'ON_LOGIN', handler: OnLoginHandler): void\r\n    remove(message: 'ON_LOGOUT', handler: OnLogoutHandler): void\r\n    remove(message: 'ON_NEW_INTERACTION', handler: OnNewInteractionHandler): void\r\n    remove(message: 'ON_INTERACTION_REMOVED', handler: OnInteractionRemovedHandler): void\r\n    remove(message: 'ON_INTERACTION_STATE_CHANGE', handler: OnInteractionStateChangeHandler): void\r\n    remove(message: 'ON_ACTIVE_INTERACTION_SWITCHED', handler: OnActiveInteractionSwitchHandler): void\r\n    remove(message: 'ON_AGENT_STATE_CHANGE', handler: OnAgentStateChangeHandler): void\r\n    remove(message: 'ON_REQUEST_TRANSFER_DATA', handler: OnRequestTransferDataHandler): void\r\n    remove(message: 'ON_LOAD_TRANSFER_DATA', handler: OnLoadTransferDataHandler): void\r\n    remove(message: 'ON_GET_KNOWLEDGE_BASE_FOLDER', handler: OnGetKnowledgeBaseFolderHandler): void\r\n    remove(message: 'ON_SEARCH_KNOWLEDGE_BASE', handler: OnSearchKnowledgeBaseHandler): void\r\n    remove(message: 'ON_GET_KNOWLEDGE_BASE_ARTICLE', handler: OnGetKnowledgeBaseArticleHandler): void\r\n    remove(message: 'ON_OPEN_RECORD', handler: OnOpenRecordHandler): void\r\n    remove(message: 'ON_SEARCH_RECORDS', handler: OnSearchRecordsHandler): void\r\n    remove(message: 'ON_SHOW_SCREEN', handler: OnShowScreenHandler): void\r\n    remove(message: 'ON_SCREEN_RECORDING_STATE_CHANGE', handler: OnScreenRecordingStateChangeHandler): void\r\n    remove(message: 'ON_WIDGET_MINIMIZED_CHANGE', handler: OnWidgetMinimizedChangeHandler): void\r\n    remove(message: 'ON_SERVER_ERROR', handler: OnServerErrorHandler): void\r\n    remove(message: 'ON_SOFTPHONE_STATUS_CHANGE', handler: OnSoftphoneStatusChangeHandler): void\r\n    remove(message: 'ON_AUDIO_DEVICE_CHANGE', handler: OnAudioDeviceChangeHandler): void\r\n    remove(message: 'ON_PHONE_CAPABILITIES_CHANGE', handler: OnPhoneCapabilitiesChangeHandler): void\r\n    remove(message: 'ON_CALL_AUDIO_QUALITY_ALERT', handler: OnCallAudioQualityAlertHandler): void\r\n    remove(message: 'ON_WEB_SCREEN_POP_CUSTOM', handler: OnWebScreenPopCustomHandler): void\r\n    remove(message: 'ON_SAVE_ACTIVITY_RECORD', handler: OnSaveActivityRecordHandler): void\r\n    remove(message: 'ON_VALIDATE_ASSOCIATED_RECORDS', handler: OnValidateAssociatedRecordsHandler): void\r\n    remove(message: 'ON_REQUEST_RECORD_INFO', handler: OnRequestRecordInfoHandler): void\r\n    remove(message: 'ON_REQUEST_RECORD_ON_SCREEN', handler: OnRequestRecordOnScreenHandler): void\r\n}\r\n\r\ninterface AgentDesktopClientAPIClassType {\r\n    prototype: AgentDesktopClientAPI\r\n    new (options?: InitOptions): AgentDesktopClientAPI\r\n}\r\n\r\ndeclare global {\r\n    interface Window {\r\n        brightpattern: {\r\n            AdApi: AgentDesktopClientAPIClassType\r\n        }\r\n    }\r\n}\r\n","var v1 = require('./v1');\nvar v4 = require('./v4');\n\nvar uuid = v4;\nuuid.v1 = v1;\nuuid.v4 = v4;\n\nmodule.exports = uuid;\n","/**\n * Convert array of 16 byte values to UUID string format of the form:\n * XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX\n */\nvar byteToHex = [];\nfor (var i = 0; i < 256; ++i) {\n  byteToHex[i] = (i + 0x100).toString(16).substr(1);\n}\n\nfunction bytesToUuid(buf, offset) {\n  var i = offset || 0;\n  var bth = byteToHex;\n  // join used to fix memory issue caused by concatenation: https://bugs.chromium.org/p/v8/issues/detail?id=3175#c4\n  return ([bth[buf[i++]], bth[buf[i++]], \n\tbth[buf[i++]], bth[buf[i++]], '-',\n\tbth[buf[i++]], bth[buf[i++]], '-',\n\tbth[buf[i++]], bth[buf[i++]], '-',\n\tbth[buf[i++]], bth[buf[i++]], '-',\n\tbth[buf[i++]], bth[buf[i++]],\n\tbth[buf[i++]], bth[buf[i++]],\n\tbth[buf[i++]], bth[buf[i++]]]).join('');\n}\n\nmodule.exports = bytesToUuid;\n","// Unique ID creation requires a high quality random # generator.  In the\n// browser this is a little complicated due to unknown quality of Math.random()\n// and inconsistent support for the `crypto` API.  We do the best we can via\n// feature-detection\n\n// getRandomValues needs to be invoked in a context where \"this\" is a Crypto\n// implementation. Also, find the complete implementation of crypto on IE11.\nvar getRandomValues = (typeof(crypto) != 'undefined' && crypto.getRandomValues && crypto.getRandomValues.bind(crypto)) ||\n                      (typeof(msCrypto) != 'undefined' && typeof window.msCrypto.getRandomValues == 'function' && msCrypto.getRandomValues.bind(msCrypto));\n\nif (getRandomValues) {\n  // WHATWG crypto RNG - http://wiki.whatwg.org/wiki/Crypto\n  var rnds8 = new Uint8Array(16); // eslint-disable-line no-undef\n\n  module.exports = function whatwgRNG() {\n    getRandomValues(rnds8);\n    return rnds8;\n  };\n} else {\n  // Math.random()-based (RNG)\n  //\n  // If all else fails, use Math.random().  It's fast, but is of unspecified\n  // quality.\n  var rnds = new Array(16);\n\n  module.exports = function mathRNG() {\n    for (var i = 0, r; i < 16; i++) {\n      if ((i & 0x03) === 0) r = Math.random() * 0x100000000;\n      rnds[i] = r >>> ((i & 0x03) << 3) & 0xff;\n    }\n\n    return rnds;\n  };\n}\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\n// **`v1()` - Generate time-based UUID**\n//\n// Inspired by https://github.com/LiosK/UUID.js\n// and http://docs.python.org/library/uuid.html\n\nvar _nodeId;\nvar _clockseq;\n\n// Previous uuid creation time\nvar _lastMSecs = 0;\nvar _lastNSecs = 0;\n\n// See https://github.com/broofa/node-uuid for API details\nfunction v1(options, buf, offset) {\n  var i = buf && offset || 0;\n  var b = buf || [];\n\n  options = options || {};\n  var node = options.node || _nodeId;\n  var clockseq = options.clockseq !== undefined ? options.clockseq : _clockseq;\n\n  // node and clockseq need to be initialized to random values if they're not\n  // specified.  We do this lazily to minimize issues related to insufficient\n  // system entropy.  See #189\n  if (node == null || clockseq == null) {\n    var seedBytes = rng();\n    if (node == null) {\n      // Per 4.5, create and 48-bit node id, (47 random bits + multicast bit = 1)\n      node = _nodeId = [\n        seedBytes[0] | 0x01,\n        seedBytes[1], seedBytes[2], seedBytes[3], seedBytes[4], seedBytes[5]\n      ];\n    }\n    if (clockseq == null) {\n      // Per 4.2.2, randomize (14 bit) clockseq\n      clockseq = _clockseq = (seedBytes[6] << 8 | seedBytes[7]) & 0x3fff;\n    }\n  }\n\n  // UUID timestamps are 100 nano-second units since the Gregorian epoch,\n  // (1582-10-15 00:00).  JSNumbers aren't precise enough for this, so\n  // time is handled internally as 'msecs' (integer milliseconds) and 'nsecs'\n  // (100-nanoseconds offset from msecs) since unix epoch, 1970-01-01 00:00.\n  var msecs = options.msecs !== undefined ? options.msecs : new Date().getTime();\n\n  // Per 4.2.1.2, use count of uuid's generated during the current clock\n  // cycle to simulate higher resolution clock\n  var nsecs = options.nsecs !== undefined ? options.nsecs : _lastNSecs + 1;\n\n  // Time since last uuid creation (in msecs)\n  var dt = (msecs - _lastMSecs) + (nsecs - _lastNSecs)/10000;\n\n  // Per 4.2.1.2, Bump clockseq on clock regression\n  if (dt < 0 && options.clockseq === undefined) {\n    clockseq = clockseq + 1 & 0x3fff;\n  }\n\n  // Reset nsecs if clock regresses (new clockseq) or we've moved onto a new\n  // time interval\n  if ((dt < 0 || msecs > _lastMSecs) && options.nsecs === undefined) {\n    nsecs = 0;\n  }\n\n  // Per 4.2.1.2 Throw error if too many uuids are requested\n  if (nsecs >= 10000) {\n    throw new Error('uuid.v1(): Can\\'t create more than 10M uuids/sec');\n  }\n\n  _lastMSecs = msecs;\n  _lastNSecs = nsecs;\n  _clockseq = clockseq;\n\n  // Per 4.1.4 - Convert from unix epoch to Gregorian epoch\n  msecs += 12219292800000;\n\n  // `time_low`\n  var tl = ((msecs & 0xfffffff) * 10000 + nsecs) % 0x100000000;\n  b[i++] = tl >>> 24 & 0xff;\n  b[i++] = tl >>> 16 & 0xff;\n  b[i++] = tl >>> 8 & 0xff;\n  b[i++] = tl & 0xff;\n\n  // `time_mid`\n  var tmh = (msecs / 0x100000000 * 10000) & 0xfffffff;\n  b[i++] = tmh >>> 8 & 0xff;\n  b[i++] = tmh & 0xff;\n\n  // `time_high_and_version`\n  b[i++] = tmh >>> 24 & 0xf | 0x10; // include version\n  b[i++] = tmh >>> 16 & 0xff;\n\n  // `clock_seq_hi_and_reserved` (Per 4.2.2 - include variant)\n  b[i++] = clockseq >>> 8 | 0x80;\n\n  // `clock_seq_low`\n  b[i++] = clockseq & 0xff;\n\n  // `node`\n  for (var n = 0; n < 6; ++n) {\n    b[i + n] = node[n];\n  }\n\n  return buf ? buf : bytesToUuid(b);\n}\n\nmodule.exports = v1;\n","var rng = require('./lib/rng');\nvar bytesToUuid = require('./lib/bytesToUuid');\n\nfunction v4(options, buf, offset) {\n  var i = buf && offset || 0;\n\n  if (typeof(options) == 'string') {\n    buf = options === 'binary' ? new Array(16) : null;\n    options = null;\n  }\n  options = options || {};\n\n  var rnds = options.random || (options.rng || rng)();\n\n  // Per 4.4, set bits for version and `clock_seq_hi_and_reserved`\n  rnds[6] = (rnds[6] & 0x0f) | 0x40;\n  rnds[8] = (rnds[8] & 0x3f) | 0x80;\n\n  // Copy bytes to buffer, if provided\n  if (buf) {\n    for (var ii = 0; ii < 16; ++ii) {\n      buf[i + ii] = rnds[ii];\n    }\n  }\n\n  return buf || bytesToUuid(rnds);\n}\n\nmodule.exports = v4;\n","// The module cache\nvar __webpack_module_cache__ = {};\n\n// The require function\nfunction __webpack_require__(moduleId) {\n\t// Check if module is in cache\n\tvar cachedModule = __webpack_module_cache__[moduleId];\n\tif (cachedModule !== undefined) {\n\t\treturn cachedModule.exports;\n\t}\n\t// Create a new module (and put it into the cache)\n\tvar module = __webpack_module_cache__[moduleId] = {\n\t\t// no module.id needed\n\t\t// no module.loaded needed\n\t\texports: {}\n\t};\n\n\t// Execute the module function\n\t__webpack_modules__[moduleId](module, module.exports, __webpack_require__);\n\n\t// Return the exports of the module\n\treturn module.exports;\n}\n\n","// define getter functions for harmony exports\n__webpack_require__.d = (exports, definition) => {\n\tfor(var key in definition) {\n\t\tif(__webpack_require__.o(definition, key) && !__webpack_require__.o(exports, key)) {\n\t\t\tObject.defineProperty(exports, key, { enumerable: true, get: definition[key] });\n\t\t}\n\t}\n};","__webpack_require__.o = (obj, prop) => (Object.prototype.hasOwnProperty.call(obj, prop))","\r\nexport const loadCrmApi = new Promise((resolve, reject) => {\r\n    const script = document.createElement('script')\r\n    document.head.insertAdjacentElement('beforeend', script)\r\n    script.addEventListener('load', resolve)\r\n    script.addEventListener('error', reject)\r\n    script.type = 'text/javascript'\r\n    script.src = 'libs/opencti_v47.js'\r\n})\r\n","import {Salesforce} from './libs/typings'\r\n\r\ntype SalesforceMethod<T = null> = (args: Salesforce.CallbackArgs<Salesforce.ApiResponse<T>>) => void\r\n\r\ntype NavigationChangeHandler = (response: Salesforce.NavigationChangePayload) => void\r\ntype ClickToDialHandler = (response: Salesforce.ClickToDialPayload | null, error?: string) => void\r\ntype WorkStartHandler = (response: Salesforce.WorkStartPayload) => void\r\n\r\ntype RunApex = {\r\n    runApex: string\r\n}\r\n\r\ntype ApexResult<T> = {\r\n    result: string | T\r\n}\r\n\r\nexport type SFPhoneDataResult = Record<string, string> & {\r\n    Id: string\r\n    attributes: {\r\n        type: string\r\n        url: string\r\n    }\r\n}\r\n\r\nconst apexClass = 'CSIMIntegrationTest'\r\nconst apexMethods = {\r\n    saveActivityObject: 'saveActivityObject',\r\n    saveActivityAttribute: 'saveActivityAttribute',\r\n    getCredentials: 'getCredentials',\r\n    requestPhoneData: 'requestPhoneData',\r\n} as const\r\n\r\nexport class LightningAPI {\r\n\r\n    clickToDialHandlers: ClickToDialHandler[]\r\n    focusHandlers: NavigationChangeHandler[]\r\n    workStartHandlers: WorkStartHandler[]\r\n\r\n    constructor() {\r\n        this.clickToDialHandlers = []\r\n        this.focusHandlers = []\r\n        this.focusHandlers = []\r\n        this.workStartHandlers = []\r\n        this.registerHandlers()\r\n        this.notifyInitializationComplete()\r\n    }\r\n\r\n    private registerHandlers() {\r\n        window.sforce.opencti.onClickToDial({\r\n            listener: resp => {\r\n                if ('error' in resp) {\r\n                    console.error('clickToDial return error: ', resp.error)\r\n                    this.onClickToDial(null, resp.error)\r\n                } else {\r\n                    this.onClickToDial(resp)\r\n                }\r\n            },\r\n        })\r\n\r\n        window.sforce.opencti.onNavigationChange({\r\n            listener: resp => {\r\n                this.onNavigationChange(resp)\r\n            },\r\n        })\r\n\r\n        window.sforce.opencti.hvs.onWorkStart({\r\n            listener: resp => {\r\n                this.onWorkStart(resp)\r\n            },\r\n        })\r\n    }\r\n\r\n    private onClickToDial(dialEntity: Salesforce.ClickToDialPayload | null, error?: string) {\r\n        this.clickToDialHandlers.forEach(handler => handler(dialEntity, error))\r\n    }\r\n\r\n    private onNavigationChange(navigationEntity: Salesforce.NavigationChangePayload) {\r\n        this.focusHandlers.forEach(handler => handler(navigationEntity))\r\n    }\r\n\r\n    private onWorkStart(workData: Salesforce.WorkStartPayload) {\r\n        this.workStartHandlers.forEach(handler => handler(workData))\r\n    }\r\n\r\n    addOnClickToDialHandler(handler: ClickToDialHandler) {\r\n        this.clickToDialHandlers.push(handler)\r\n    }\r\n\r\n    addOnNavigationChangeHandler(handler: NavigationChangeHandler) {\r\n        this.focusHandlers.push(handler)\r\n    }\r\n\r\n    addOnWorkStartHandler(handler: WorkStartHandler) {\r\n        this.workStartHandlers.push(handler)\r\n    }\r\n\r\n    private notifyInitializationComplete() {\r\n        window.sforce.opencti.notifyInitializationComplete({\r\n            callback: resp => {\r\n                if (resp.success) {\r\n                    console.log('notifyInitializationComplete: successful')\r\n                } else {\r\n                    console.error('notifyInitializationComplete: error')\r\n                }\r\n            },\r\n        })\r\n    }\r\n\r\n    private apiCall<Payload, Result>(\r\n        apiFn: SalesforceMethod<Result>,\r\n        payload?: Payload,\r\n    ) {\r\n        return new Promise<Result>((res, rej) => {\r\n            apiFn({\r\n                callback: resp => {\r\n                    if (resp.success) {\r\n                        res(resp.returnValue!)\r\n                    } else {\r\n                        rej(resp.errors)\r\n                    }\r\n                },\r\n                ...payload,\r\n            })\r\n        })\r\n    }\r\n\r\n    async disableClickToDial() {\r\n        return this.apiCall(window.sforce.opencti.disableClickToDial)\r\n    }\r\n\r\n    async enableClickToDial() {\r\n        return this.apiCall(window.sforce.opencti.enableClickToDial)\r\n    }\r\n\r\n    async getCallCenterSettings() {\r\n        return this.apiCall(window.sforce.opencti.getCallCenterSettings)\r\n    }\r\n\r\n    async getAppViewInfo() {\r\n        return this.apiCall(window.sforce.opencti.getAppViewInfo)\r\n    }\r\n\r\n    async getSoftphoneLayout() {\r\n        return this.apiCall(window.sforce.opencti.getSoftphoneLayout)\r\n    }\r\n\r\n    async completeWork(workItem: Salesforce.WorkItem) {\r\n        return this.apiCall(window.sforce.opencti.hvs.completeWork as SalesforceMethod, workItem)\r\n    }\r\n\r\n    async isSoftphonePanelVisible() {\r\n        return this.apiCall(window.sforce.opencti.isSoftphonePanelVisible).then(result => result.visible)\r\n    }\r\n\r\n    async refreshView() {\r\n        return this.apiCall(window.sforce.opencti.refreshView)\r\n    }\r\n\r\n    async saveLog(entity: Partial<Record<string, Salesforce.PrimitiveType>>) {\r\n        return this.apiCall(window.sforce.opencti.saveLog as SalesforceMethod, {value: entity})\r\n    }\r\n\r\n    async screenPop(type: Salesforce.ScreenPopType, params: Salesforce.ScreenPopParams, defaultValues?: Salesforce.DefaultFieldValues) {\r\n        return this.apiCall(\r\n            window.sforce.opencti.screenPop as SalesforceMethod,\r\n            {\r\n                type,\r\n                params,\r\n                defaultFieldValues: defaultValues,\r\n            },\r\n        )\r\n    }\r\n\r\n    async searchAndScreenPop(params: Salesforce.SearchAndScreenPopParams) {\r\n        return this.apiCall(window.sforce.opencti.searchAndScreenPop as SalesforceMethod<Salesforce.SearchPopResult>, params)\r\n    }\r\n\r\n    async setSoftphoneItemIcon(icon: string) {\r\n        return this.apiCall(window.sforce.opencti.setSoftphoneItemIcon as SalesforceMethod, {key: icon})\r\n    }\r\n\r\n    async setSoftphoneItemLabel(label: string) {\r\n        return this.apiCall(window.sforce.opencti.setSoftphoneItemLabel as SalesforceMethod, {label})\r\n    }\r\n\r\n    async setSoftphonePanelHeight(height: number) {\r\n        return this.apiCall(window.sforce.opencti.setSoftphonePanelHeight as SalesforceMethod, {heightPX: height})\r\n    }\r\n\r\n    async setSoftphonePanelIcon(icon: string) {\r\n        return this.apiCall(window.sforce.opencti.setSoftphonePanelIcon as SalesforceMethod, {key: icon})\r\n    }\r\n\r\n    async setSoftphonePanelLabel(label: string) {\r\n        return this.apiCall(window.sforce.opencti.setSoftphonePanelLabel as SalesforceMethod, {label})\r\n    }\r\n\r\n    async setSoftphonePanelVisibility(visible: boolean) {\r\n        return this.apiCall(window.sforce.opencti.setSoftphonePanelVisibility as SalesforceMethod, {visible})\r\n    }\r\n\r\n    async setSoftphonePanelWidth(width: number) {\r\n        return this.apiCall(window.sforce.opencti.setSoftphonePanelWidth as SalesforceMethod, {widthPX: width})\r\n    }\r\n\r\n    async subscribe(channel: string, listener: (message: any) => void) {\r\n\r\n        return new Promise<Salesforce.Subscription>((res, rej) => {\r\n\r\n            window.sforce.opencti.subscribe({\r\n                channelName: channel,\r\n                listener,\r\n                callback: resp => {\r\n                    if (resp.success) {\r\n                        res(resp.subscription)\r\n                    } else {\r\n                        rej(resp.errors)\r\n                    }\r\n                },\r\n            })\r\n        })\r\n    }\r\n\r\n    async unsubscribe(subscription: Salesforce.Subscription) {\r\n        return this.apiCall(window.sforce.opencti.unsubscribe as SalesforceMethod, {subscription})\r\n    }\r\n\r\n    async publish(channel: string, message: any) {\r\n        return this.apiCall(\r\n            window.sforce.opencti.publish as SalesforceMethod,\r\n            {\r\n                channelName: channel,\r\n                message,\r\n            },\r\n        )\r\n    }\r\n\r\n    private async runApex<Result>(apexData: Salesforce.ApexData): Promise<string | Result> {\r\n        return this.apiCall<Salesforce.ApexData, RunApex>(\r\n            window.sforce.opencti.runApex as SalesforceMethod<RunApex>,\r\n            apexData,\r\n        )\r\n        .then(({runApex}: RunApex) => {\r\n            const data: ApexResult<Result> = JSON.parse(runApex.replaceAll('\\'', '\"'))\r\n            return data.result\r\n        })\r\n    }\r\n\r\n    apex = {\r\n        saveActivity: (methodParams: string) => {\r\n            return this.runApex({\r\n                apexClass,\r\n                methodName: apexMethods.saveActivityObject,\r\n                methodParams,\r\n            })\r\n        },\r\n\r\n        saveActivityAttribute: (objectId: string, key: string, value: string) => {\r\n            const methodParams = `objectId=${objectId}&key=${key}&value=${value}`\r\n            return this.runApex({\r\n                apexClass,\r\n                methodName: apexMethods.saveActivityAttribute,\r\n                methodParams,\r\n            })\r\n        },\r\n\r\n        geContactDetails: (methodParams: string) => {\r\n            return this.runApex({\r\n                apexClass,\r\n                methodName: apexMethods.getCredentials,\r\n                methodParams,\r\n            })\r\n        },\r\n\r\n        requestPhoneData: (objectType: string, objectId: string): Promise<SFPhoneDataResult | string> => {\r\n            const methodParams = `objectType=${objectType}&objectId=${objectId}`\r\n            return this.runApex<SFPhoneDataResult>({\r\n                apexClass,\r\n                methodName: apexMethods.requestPhoneData,\r\n                methodParams,\r\n            })\r\n        },\r\n    }\r\n}\r\n","import {\r\n    CallDirection,\r\n    DialCandidate,\r\n    InteractionActivityData,\r\n    InteractionAssociatedObjectData,\r\n    InteractionType,\r\n    InteractionAssociatedObject,\r\n    InteractionScreen,\r\n    PhoneData,\r\n    RecordsValidationResult,\r\n    SyncAsyncResult,\r\n} from '@bpinc/adapters-public-api-types'\r\n\r\nimport {loadCrmApi} from './loadExternalApi'\r\nimport {LightningAPI} from './LightningAPIWrapper'\r\nimport {AgentDesktopClientAPIImpl} from '../../adc-client-api'\r\nimport {Salesforce} from './libs/typings'\r\nimport {utils} from '../../utils'\r\nimport {assertUrlData} from './guards'\r\n\r\n\r\nconst integrationKey = 'salesforce'\r\n\r\nconst allowedCaseTypes = [\r\n    'Contract',\r\n    'Campaign',\r\n    'Account',\r\n    'Asset',\r\n    'Case',\r\n    'Solution',\r\n    'Opportunity',\r\n]\r\n\r\nconst allowedContactTypes = [\r\n    'Contact',\r\n    'Lead',\r\n]\r\n\r\nconst sfCallDirectionMapping: Record<CallDirection, string> = {\r\n    'inbound': 'Inbound',\r\n    'outbound': 'Outbound',\r\n}\r\n\r\nconst sfInteractionTypeMapping: Record<InteractionType, string> = {\r\n    'voice': 'Call',\r\n    'chat': 'Chat',\r\n    'email': 'Email',\r\n}\r\n\r\nconst sfPhoneTypeMap: Record<string, PhoneData['type']> = {\r\n    'Phone': 'business',\r\n    'BusinessPhone': 'business',\r\n    'MobilePhone': 'mobile',\r\n    'HomePhone': 'home',\r\n    'Fax': 'fax',\r\n    'OtherPhone': 'other',\r\n}\r\n\r\nconst logPrefix = '@ADAPTER'\r\nconst logger = {\r\n    log: (...args: unknown[]) => console.log(logPrefix, ...args),\r\n    info: (...args: unknown[]) => console.info(logPrefix, ...args),\r\n    warn: (...args: unknown[]) => console.warn(logPrefix, ...args),\r\n    error: (...args: unknown[]) => console.error(logPrefix, ...args),\r\n}\r\n\r\nexport const registerSalesforceIntegration = () => {\r\n\r\n    loadCrmApi.then(() => {\r\n\r\n        logger.log('Salesforce OpenCTI API object:', window.sforce.opencti)\r\n\r\n        let activeInteractionId: string | null = null\r\n        let currentObjectOnScreen: InteractionAssociatedObjectData | null = null\r\n        let isLoggedIn = false\r\n        let initialLoginDataLoaded = false\r\n        let initialInteractionDataLoaded = false\r\n\r\n        let sfConfig: Salesforce.CallCenterSettings | null = null\r\n\r\n        const sfApi = new LightningAPI()\r\n        const adApi = new AgentDesktopClientAPIImpl({integrationKey})\r\n        logger.info('Initialize Adapter')\r\n\r\n        sfApi.setSoftphonePanelHeight(800).catch(e => logger.error('setSoftphonePanelHeight error:', e))\r\n        sfApi.setSoftphonePanelWidth(502).catch(e => logger.error('setSoftphonePanelWidth error:', e))\r\n        sfApi.setSoftphonePanelVisibility(true).catch(e => logger.error('setSoftphonePanelVisibility error:', e))\r\n\r\n        sfApi.getCallCenterSettings().then(config => {\r\n            sfConfig = config\r\n            logger.info('sfConfig:', sfConfig)\r\n        }).catch(e => logger.error('getCallCenterSettings error:', e))\r\n\r\n        function getConfigMutedUrls() {\r\n            if (!sfConfig) {\r\n                return []\r\n            }\r\n            const urls = sfConfig['/reqGeneralInfo/muteRecordingUrls']\r\n            if (!urls) {\r\n                return []\r\n            }\r\n            return urls.split(',').map(url => url.trim()).filter(url => url)\r\n        }\r\n\r\n        adApi.on('ON_LOGIN', data => {\r\n            isLoggedIn = data.isLoggedIn\r\n            sfApi.enableClickToDial().catch(e => logger.error('enableClickToDial error:', e))\r\n        })\r\n        adApi.on('ON_LOGOUT', () => {\r\n            isLoggedIn = false\r\n            sfApi.disableClickToDial().catch(e => logger.error('disableClickToDial error:', e))\r\n        })\r\n\r\n        adApi.getLoginState().then(data => {\r\n            if (data.status === 'success') {\r\n                logger.info('Initial login state:', data.data)\r\n                isLoggedIn = data.data.isLoggedIn\r\n                initialLoginDataLoaded = true\r\n            } else {\r\n                logger.warn('Unable to get login state:', data.error)\r\n            }\r\n        })\r\n        adApi.getInteractionsState().then(data => {\r\n            if (data.status === 'success') {\r\n                logger.info('Initial interactions state:', data.data)\r\n                activeInteractionId = data.data.activeInteractionId\r\n                initialInteractionDataLoaded = true\r\n            } else {\r\n                if (data.error.name === 'not_logged_in') {\r\n                    activeInteractionId = null\r\n                    initialInteractionDataLoaded = true\r\n                }\r\n                logger.warn('Unable to get interactions state:', data.error)\r\n            }\r\n        })\r\n\r\n        function isInitialDataLoaded() {\r\n            return initialLoginDataLoaded && initialInteractionDataLoaded\r\n        }\r\n\r\n        adApi.on('ON_OPEN_RECORD', async ({id}) => {\r\n            logger.info('object screen pop:', id)\r\n            try {\r\n                const result = await sfApi.screenPop('sobject', {recordId: id})\r\n                logger.info('screenPop[\"sobject\"] result:', result)\r\n            } catch (e) {\r\n                logger.error('screenPop[\"sobject\"] error', e)\r\n            }\r\n        })\r\n\r\n        adApi.on('ON_SEARCH_RECORDS', async ({text}) => {\r\n            logger.info('search screen pop:', text)\r\n            try {\r\n                const result = await sfApi.screenPop('search', {searchString: text})\r\n                logger.info('screenPop[\"search\"] result:', result)\r\n            } catch (e) {\r\n                logger.error('screenPop[\"search\"] error:', e)\r\n            }\r\n        })\r\n\r\n        adApi.on('ON_SHOW_SCREEN', async (screen: InteractionScreen) => {\r\n            assertUrlData(screen)\r\n            logger.info('show screen:', screen.url)\r\n            try {\r\n                const result = await sfApi.screenPop('url', {url: screen.url})\r\n                logger.info('screenPop[\"url\"] result:', result)\r\n            } catch (e) {\r\n                logger.error('screenPop[\"url\"] error:', e)\r\n            }\r\n        })\r\n\r\n        adApi.on('ON_VALIDATE_ASSOCIATED_RECORDS', (_, data): SyncAsyncResult<RecordsValidationResult> => {\r\n            return {valid: true}\r\n        })\r\n\r\n        // adApi.on('ON_REQUEST_RECORD_INFO', async ({id}: RecordInfoRequest) => {\r\n        //     try {\r\n        //         const searchResult = await sfApi.runApex()\r\n        //         return null\r\n        //     } catch (e) {\r\n        //         logger.error('searchAndScreenPop error:', e)\r\n        //         return null\r\n        //     }\r\n        // })\r\n\r\n        adApi.on('ON_REQUEST_RECORD_ON_SCREEN', async () => {\r\n            return currentObjectOnScreen ?? null\r\n        })\r\n\r\n        /** Required format is YYYY-MM-DD HH:MM:SS in GMT */\r\n        const formatDateForSF = (date: Date) => {\r\n            const tzOffset = date.getTimezoneOffset()\r\n            const gmtDate = new Date(date.getTime() + (60_000 * tzOffset))\r\n            return (\r\n                gmtDate.getFullYear() + '-' +\r\n                ('0' + (gmtDate.getMonth() + 1)).slice(-2) + '-' +\r\n                ('0' + gmtDate.getDate()).slice(-2) + ' ' +\r\n                ('0' + gmtDate.getHours()).slice(-2) + ':' +\r\n                ('0' + gmtDate.getMinutes()).slice(-2) + ':' +\r\n                ('0' + gmtDate.getSeconds()).slice(-2)\r\n            )\r\n        }\r\n\r\n        const saveActivity = async (activity: InteractionActivityData) => {\r\n            logger.info('save activity:', activity)\r\n            const {\r\n                selected: selectedObjectIds,\r\n                list: allAssociatedObjects,\r\n            } = activity.associatedObjects\r\n\r\n            const selectedObjects = selectedObjectIds.reduce<InteractionAssociatedObject[]>((list, id) => {\r\n                const existingObject = allAssociatedObjects.find(object => object.id === id)\r\n                if (existingObject) {\r\n                    list.push(existingObject)\r\n                }\r\n                return list\r\n            }, [])\r\n\r\n            const selectedContactObject = selectedObjects.find(crmObject => {\r\n                return allowedContactTypes.includes(crmObject.type ?? '')\r\n            })\r\n            const anyContactObject = utils.findLast(\r\n                allAssociatedObjects,\r\n                crmObject => allowedContactTypes.includes(crmObject.type ?? ''),\r\n            )\r\n            const contactObject = selectedContactObject || anyContactObject\r\n\r\n            const selectedCaseObject = selectedObjects.find(crmObject => {\r\n                return allowedCaseTypes.includes(crmObject.type ?? '')\r\n            })\r\n            const anyCaseObject = utils.findLast(\r\n                allAssociatedObjects,\r\n                crmObject => allowedCaseTypes.includes(crmObject.type ?? ''),\r\n            )\r\n            const caseObject = selectedCaseObject || anyCaseObject\r\n\r\n            const primaryObjectType = caseObject?.displayType || contactObject?.displayType\r\n            const subject = primaryObjectType\r\n                ? `${primaryObjectType}: ${activity.service}`\r\n                : activity.service ?? ''\r\n\r\n            const sfActivityRecord = {\r\n                'entityApiName': 'Task',\r\n                'ActivityDate': formatDateForSF(new Date(activity.startTime ?? Date.now())),\r\n                'CallDisposition': activity.disposition,\r\n                'CallDurationInSeconds': activity.duration,\r\n                'CallObject': activity.globalInteractionId,\r\n                'CallType': activity.callDirection && sfCallDirectionMapping[activity.callDirection] || undefined,\r\n                'Description': activity.description,\r\n                'Priority': 'Normal',\r\n                'Status': 'Completed',\r\n                'Subject': subject,\r\n                'Type': sfInteractionTypeMapping[activity.type],\r\n                'WhatId': caseObject?.id ?? undefined,\r\n                'WhoId': contactObject?.id ?? undefined,\r\n                // BP Custom fields:\r\n                'BrightPattern__SPRecordingOrTranscriptURL__c': activity.recordingUrl,\r\n            }\r\n            logger.info('SF activity record:', sfActivityRecord)\r\n\r\n            try {\r\n                await sfApi.saveLog(sfActivityRecord)\r\n                await sfApi.refreshView()\r\n            } catch (e) {\r\n                logger.error('saveLog error:', e)\r\n            }\r\n        }\r\n\r\n        adApi.on('ON_SAVE_ACTIVITY_RECORD', interaction => {\r\n            return saveActivity(interaction)\r\n        })\r\n\r\n        adApi.on('ON_ACTIVE_INTERACTION_SWITCHED', interactionId => {\r\n            activeInteractionId = interactionId\r\n        })\r\n\r\n        function handleOpenedObject(value: InteractionAssociatedObjectData) {\r\n            if (!isInitialDataLoaded()) {\r\n                logger.info('Skip opened object: adapter not initialized')\r\n                return\r\n            }\r\n            if (!isLoggedIn) {\r\n                logger.info('Skip opened object: user is not logged in')\r\n                return\r\n            }\r\n            if (!activeInteractionId) {\r\n                logger.info('Skip opened object: no interaction')\r\n                return\r\n            }\r\n            adApi.addInteractionAssociatedObject(value)\r\n        }\r\n\r\n        function handleDialCandidate(value: InteractionAssociatedObjectData) {\r\n            const dialCandidates: DialCandidate[] = []\r\n            sfApi.apex.requestPhoneData(value.type, value.id)\r\n            .then(result => {\r\n                logger.info('APEX:requestPhoneData result:', result)\r\n                if (typeof result === 'string') {\r\n                    return\r\n                }\r\n                const {Id, attributes, ...phones} = result\r\n                if (!Object.values(phones).some(number => !!number)) {\r\n                    return\r\n                }\r\n                dialCandidates.push({\r\n                    id: Id,\r\n                    displayName: value.displayName,\r\n                    associatedObjects: [value],\r\n                    phones: Object.keys(phones)\r\n                    .filter(phoneName => !!phones[phoneName].trim())\r\n                    .map(phoneName => ({\r\n                        number: phones[phoneName],\r\n                        type: sfPhoneTypeMap[phoneName] ?? 'other',\r\n                        displayType: utils.splitWords(phoneName),\r\n                    })),\r\n                })\r\n            })\r\n            .catch(error => {\r\n                logger.error('APEX:requestPhoneData catch:', error)\r\n            })\r\n            .finally(() => {\r\n                adApi.setDialCandidates(dialCandidates)\r\n            })\r\n        }\r\n\r\n        sfApi.addOnNavigationChangeHandler(async (navigationData: Salesforce.NavigationChangePayload) => {\r\n            logger.info('SF navigation:', navigationData)\r\n\r\n            if (activeInteractionId) {\r\n                adApi.setInteractionActiveScreen({url: navigationData.url})\r\n            }\r\n\r\n            if (navigationData.recordId) {\r\n                currentObjectOnScreen = {\r\n                    id: navigationData.recordId,\r\n                    type: navigationData.objectType,\r\n                    displayName: `${navigationData.objectType}: ${navigationData.recordName}`,\r\n                    displayType: navigationData.objectType,\r\n                    customFields: {\r\n                        isCase: '' + allowedCaseTypes.includes(navigationData.objectType),\r\n                        isContact: '' + allowedContactTypes.includes(navigationData.objectType),\r\n                    },\r\n                }\r\n                handleOpenedObject(currentObjectOnScreen)\r\n                handleDialCandidate(currentObjectOnScreen)\r\n            } else {\r\n                currentObjectOnScreen = null\r\n            }\r\n\r\n            if (getConfigMutedUrls().some(mutedUrl => navigationData.url.includes(mutedUrl))) {\r\n                adApi.setCallRecordingMute(true, 'all')\r\n            } else {\r\n                adApi.setCallRecordingMute(false, 'all')\r\n            }\r\n        })\r\n\r\n        sfApi.addOnClickToDialHandler(async (data: Salesforce.ClickToDialPayload | null, error?: string) => {\r\n            logger.info('SF click-to-dial data:', data)\r\n            if (error) {\r\n                logger.error('SF click-to-dial error:', error)\r\n                return\r\n            }\r\n            if (!data) {\r\n                logger.warn('SF click-to-dial has empty data!')\r\n                return\r\n            }\r\n            if (!isLoggedIn) {\r\n                return\r\n            }\r\n\r\n            const clickedObject: InteractionAssociatedObjectData = {\r\n                id: data.recordId,\r\n                type: data.objectType,\r\n                displayName: `${data.objectType}: ${data.recordName}`,\r\n                displayType: data.objectType,\r\n                customFields: {\r\n                    isCase: '' + allowedCaseTypes.includes(data.objectType),\r\n                    isContact: '' + allowedContactTypes.includes(data.objectType),\r\n                },\r\n            }\r\n            try {\r\n                await adApi.startCall(data.number, clickedObject)\r\n            } catch (e) {\r\n                logger.error('adApi.startCall return error:', e)\r\n            }\r\n        })\r\n\r\n        adApi.on('ON_NEW_INTERACTION', async item => {\r\n            sfApi.isSoftphonePanelVisible().then(visible => {\r\n                if (!visible) {\r\n                    sfApi.setSoftphonePanelVisibility(true).catch(e => logger.error('setSoftphonePanelVisibility error:', e))\r\n                }\r\n            }).catch(e => logger.error('isSoftphonePanelVisible error:', e))\r\n\r\n            if (item.origination === 'dialpad') {\r\n                console.log('manual call handler for:', item.phoneNumber)\r\n                try {\r\n                    const searchResult = await sfApi.searchAndScreenPop({\r\n                        searchParams: item.phoneNumber,\r\n                        callType: 'outbound',\r\n                        deferred: true,\r\n                    })\r\n                    console.log('SF search result:', searchResult)\r\n                    if (searchResult.SCREEN_POP_DATA) {\r\n                        await sfApi.screenPop(\r\n                            searchResult.SCREEN_POP_DATA.type,\r\n                            searchResult.SCREEN_POP_DATA.params,\r\n                            searchResult.SCREEN_POP_DATA.defaultFieldValues,\r\n                        )\r\n                    }\r\n                } catch (e) {\r\n                    logger.error('searchAndScreenPop or screenPop error:', e)\r\n                }\r\n            }\r\n        })\r\n\r\n    }).catch((e: Error) => {\r\n        logger.error('Can\\'t initialize OpenCTI Salesforce Lightning API library:', e)\r\n    })\r\n}\r\n","import type {SFUrlData} from './types'\r\n\r\n\r\nfunction isObject(data: unknown): data is Record<string, unknown> {\r\n    return typeof data === 'object' && data !== null\r\n}\r\n\r\nexport function assertUrlData(data: unknown): asserts data is SFUrlData {\r\n    if (!(isObject(data) && 'url' in data)) {\r\n        throw Error(`Data is not url data: ${JSON.stringify(data)}`)\r\n    }\r\n}\r\n"],"names":["pairs","index","length","result","pair","MINIMIZED_WIDGET_WIDTH","MAXIMIZED_WIDGET_WIDTH_DEFAULT","selfScriptUrl","window","document","currentScript","src","scripts","getElementsByTagName","adcOrigin","utils","location","href","URL","origin","AgentDesktopClientAPIImpl","options","adcFrame","adcFrameOrigin","pendingMessages","connectionEstablished","adcIsReady","maximizedIframeWidth","messageHandlers","responseCallbacks","integrationKey","messageLoggers","disableNewInteractionPopup","this","uuid","fromPairs","Object","keys","callbackMessages","map","messageType","requestMessages","RESPONSE_SUFFIX","prepareAdcIframe","registerListeners","on","widgetMinimized","getAttribute","setAttribute","valid","injectMessageLogger","logger","push","potentialFrame","HTMLIFrameElement","console","error","mountRoot","potentialMountRoot","HTMLElement","body","createElement","title","id","style","border","allow","onerror","standalone","width","height","zIndex","position","top","left","search","appendChild","handleIncomingMessage","type","uid","params","log","handlers","pendingResults","handler","e","needResponse","then","promiseResults","positiveResults","reduce","arr","status","undefined","value","lastValue","postMessageToAdc","noHandlers","addEventListener","data","stopImmediatePropagation","forEach","pingResponse","contentWindow","Error","postMessage","setTimeout","message","includes","requestResponseMessages","waiting","callback","Promise","resolve","err","runResponseTimeoutWatch","callbacksMap","errorText","code","name","apiCall","getLoginState","login","loginData","force","logout","getAgentState","setAgentState","state","notReadyReason","acceptInteraction","interactionId","rejectInteraction","startCall","phonenumber","initialObjects","Array","startChat","channel","address","startEmail","email","sendDtmf","dtmf","consultCall","phone","blindTransfer","customTransferData","integrationId","transfer","leaveInteraction","completeInteraction","leaveAndCompleteInteraction","disposition","note","switchActiveInteraction","inviteToCallConference","removeFromCallConference","partyId","destroyCallConference","inviteToChatConference","removeFromChatConference","mergeAllCallsIntoConference","getTeams","getTeamMembers","teamId","getServicesList","getService","setService","service","getDIDNumbersList","getDIDNumber","setDIDNumber","did","getDispositionsList","target","setDisposition","addNote","updateNote","replaceNote","setRescheduleWindow","rescheduleData","getConfig","setVariable","key","getVariables","addInteractionAssociatedObject","object","setInteractionActiveScreen","screenData","getPhoneDevicesList","getPhoneDevice","setPhoneDevice","phoneDevice","setCallHold","setCallRecording","setCallMute","setScreenRecordingMute","getScreenRecordingState","setWidgetMinimized","sendChatMessage","suggestChatMessage","allowOverwrite","getAgentNotReadyReasons","activatePage","getInteractionsState","setCallRecordingMute","setDialCandidates","candidates","remove","delIndex","indexOf","splice","brightpattern","AdApi","extractURLParams","url","paramsMap","paramUrl","split","slice","join","paramMap","param","splits","decodeURIComponent","shift","capitalize","str","replace","c","toUpperCase","findLast","array","predicate","i","shallowObjEqual","obj1","obj2","waitResolveAll","targets","reject","numberOfResolved","results","targetPromise","catch","reason","finally","startsWithAny","base","prefixes","prefix","startsWith","splitWords","trim","word","call","filter","v1","v4","module","exports","byteToHex","toString","substr","buf","offset","bth","getRandomValues","crypto","bind","msCrypto","rnds8","Uint8Array","rnds","r","Math","random","_nodeId","_clockseq","rng","bytesToUuid","_lastMSecs","_lastNSecs","b","node","clockseq","seedBytes","msecs","Date","getTime","nsecs","dt","tl","tmh","n","ii","__webpack_module_cache__","__webpack_require__","moduleId","cachedModule","__webpack_modules__","d","definition","o","defineProperty","enumerable","get","obj","prop","prototype","hasOwnProperty","loadCrmApi","script","head","insertAdjacentElement","apexClass","apexMethods","LightningAPI","clickToDialHandlers","focusHandlers","workStartHandlers","apex","saveActivity","methodParams","runApex","methodName","saveActivityAttribute","objectId","geContactDetails","requestPhoneData","objectType","registerHandlers","notifyInitializationComplete","sforce","opencti","onClickToDial","listener","resp","onNavigationChange","hvs","onWorkStart","dialEntity","navigationEntity","workData","addOnClickToDialHandler","addOnNavigationChangeHandler","addOnWorkStartHandler","success","apiFn","payload","res","rej","returnValue","errors","disableClickToDial","enableClickToDial","getCallCenterSettings","getAppViewInfo","getSoftphoneLayout","completeWork","workItem","isSoftphonePanelVisible","visible","refreshView","saveLog","entity","screenPop","defaultValues","defaultFieldValues","searchAndScreenPop","setSoftphoneItemIcon","icon","setSoftphoneItemLabel","label","setSoftphonePanelHeight","heightPX","setSoftphonePanelIcon","setSoftphonePanelLabel","setSoftphonePanelVisibility","setSoftphonePanelWidth","widthPX","subscribe","channelName","subscription","unsubscribe","publish","apexData","JSON","parse","replaceAll","allowedCaseTypes","allowedContactTypes","sfCallDirectionMapping","sfInteractionTypeMapping","sfPhoneTypeMap","logPrefix","args","info","warn","handleOpenedObject","initialLoginDataLoaded","initialInteractionDataLoaded","isLoggedIn","activeInteractionId","adApi","currentObjectOnScreen","sfConfig","sfApi","config","recordId","text","searchString","screen","isObject","stringify","assertUrlData","_","activity","selectedObjectIds","allAssociatedObjects","selectedObjects","selectedContactObject","anyContactObject","contactObject","selectedCaseObject","anyCaseObject","caseObject","primaryObjectType","subject","sfActivityRecord","associatedObjects","selected","list","existingObject","find","crmObject","displayType","date","startTime","now","tzOffset","getTimezoneOffset","gmtDate","getFullYear","getMonth","getDate","getHours","getMinutes","getSeconds","duration","globalInteractionId","callDirection","description","recordingUrl","interaction","navigationData","dialCandidates","displayName","recordName","customFields","isCase","isContact","Id","phones","attributes","values","some","number","phoneName","urls","getConfigMutedUrls","mutedUrl","clickedObject","item","searchResult","origination","phoneNumber","searchParams","callType","deferred","SCREEN_POP_DATA"],"sourceRoot":""}