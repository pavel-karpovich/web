(()=>{var e={281:(e,t,n)=>{"use strict";n.d(t,{O:()=>T});const r=function(e){for(var t=-1,n=null==e?0:e.length,r={};++t<n;){var a=e[t];r[a[0]]=a[1]}return r};var a=n(700),i=n(22),o=n(773);function s(e,t){(null==t||t>e.length)&&(t=e.length);for(var n=0,r=new Array(t);n<t;n++)r[n]=e[n];return r}function c(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function l(e,t){for(var n=0;n<t.length;n++){var r=t[n];r.enumerable=r.enumerable||!1,r.configurable=!0,"value"in r&&(r.writable=!0),Object.defineProperty(e,r.key,r)}}function u(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function d(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function E(e){return function(e){if(Array.isArray(e))return s(e)}(e)||function(e){if("undefined"!=typeof Symbol&&null!=e[Symbol.iterator]||null!=e["@@iterator"])return Array.from(e)}(e)||function(e,t){if(!e)return;if("string"==typeof e)return s(e,t);var n=Object.prototype.toString.call(e).slice(8,-1);"Object"===n&&e.constructor&&(n=e.constructor.name);if("Map"===n||"Set"===n)return Array.from(n);if("Arguments"===n||/^(?:Ui|I)nt(?:8|16|32)(?:Clamped)?Array$/.test(n))return s(e,t)}(e)||function(){throw new TypeError("Invalid attempt to spread non-iterable instance.\\nIn order to be iterable, non-array objects must have a [Symbol.iterator]() method.")}()}var f="44px",p="500px",_=function(){if(window.document.currentScript)return window.document.currentScript.src;var e=document.getElementsByTagName("script");return e[e.length-1].src}(),h=o.P.extractURLParams(window.location.href).adcUrl||new URL(_).origin,T=function(){function e(){var t=this,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};c(this,e),u(this,"adcFrame",void 0),u(this,"adcFrameOrigin",void 0),u(this,"pendingMessages",void 0),u(this,"connectionEstablished",void 0),u(this,"adcIsReady",void 0),u(this,"maximizedIframeWidth",p),u(this,"messageHandlers",void 0),u(this,"responseCallbacks",void 0),u(this,"integrationKey",void 0),u(this,"messageLoggers",void 0),u(this,"disableNewInteractionPopup",void 0),this.adcFrame=null,this.adcFrameOrigin="",this.pendingMessages=[],this.integrationKey=n.integrationKey||(0,i.v4)(),this.connectionEstablished=!1,this.adcIsReady=!1,this.messageLoggers=[],this.disableNewInteractionPopup=!!n.disableNewInteractionPopup,this.messageHandlers=r(Object.keys(a.Jt).map((function(e){return[e,[]]}))),this.responseCallbacks=r(a.$4.map((function(e){return[e+a.el,{}]}))),this.prepareAdcIframe(n),this.registerListeners(),this.on("ON_WIDGET_MINIMIZED_CHANGE",(function(e){var n;t.adcFrame&&(e?(t.maximizedIframeWidth=null!==(n=t.adcFrame.getAttribute("width"))&&void 0!==n?n:p,t.adcFrame.setAttribute("width",f)):t.adcFrame.setAttribute("width",t.maximizedIframeWidth))})),this.on("ON_WEB_SCREEN_POP_CUSTOM",(function(){return!1})),this.on("ON_VALIDATE_ASSOCIATED_RECORDS",(function(){return{valid:!0}}))}var t,n,s;return t=e,n=[{key:"injectMessageLogger",value:function(e){this.messageLoggers.push(e)}},{key:"prepareAdcIframe",value:function(e){if(e.adcFrame){var t=e.adcFrame;d(t,HTMLIFrameElement)&&t.src?this.adcFrame=t:console.error("@@@ `adcFrame` is not HTMLIframeElement or it have no `src` attribute.\n","Valid Communicator iframe would be created automatically")}if(!this.adcFrame){var n=null;if(e.mountRoot){var r=e.mountRoot;d(r,HTMLElement)?n=r:console.error("@@@ `mountRoot` is not HTMLElement.\n","Communicator iframe would be mounted to the `document.body` as a fallback scenario")}n||(n=document.body),this.adcFrame=document.createElement("iframe"),this.adcFrame.title="Agent Desktop Communicator",this.adcFrame.id="adc_frame",this.adcFrame.style.border="none",this.adcFrame.allow="microphone; camera; geolocation",this.adcFrame.onerror=function(){console.error("@@@ Adapter failure: unable to load AD Communicator")},e.standalone?(this.adcFrame.width="1px",this.adcFrame.height="1px",this.adcFrame.style.zIndex="-1000",this.adcFrame.style.position="absolute",this.adcFrame.style.top="-1000px",this.adcFrame.style.left="-1000px",this.adcFrame.src=h+"/agent/communicator/no-ui/"+location.search):(this.adcFrame.style.width=p,this.adcFrame.style.height="100%",this.adcFrame.src=h+"/agent/communicator/"+location.search),n.appendChild(this.adcFrame)}this.adcFrameOrigin=new URL(this.adcFrame.src).origin}},{key:"handleIncomingMessage",value:function(e,t,n){var r,i=this;console.log("@@@ Handle: ",e,t,n);var s=this.messageHandlers[e];if(s.length){var c=s.map((function(t){try{return t.apply(void 0,E(n))}catch(r){console.error('@@@ Error in the event "'.concat(e,'" handler:'),r)}}));(null===(r=a.Jt[e])||void 0===r?void 0:r.needResponse)&&o.P.waitResolveAll(c).then((function(n){var r=n.reduce((function(e,t){return"fulfilled"===t.status&&void 0!==t.value&&e.push(t.value),e}),[]),o=r.length?r[r.length-1]:void 0;i.postMessageToAdc({uid:t,type:e+a.el,params:[o]})}))}else{var l;(null===(l=a.Jt[e])||void 0===l?void 0:l.needResponse)&&this.postMessageToAdc({uid:t,type:e+a.el,params:[],noHandlers:!0})}}},{key:"registerListeners",value:function(){var e=this;window.addEventListener("message",(function(t){if(t.origin===e.adcFrameOrigin){var n=t.data||{},r=n.type,i=n.uid,o=n.params;if(r){t.stopImmediatePropagation();try{if("hello"===r){var s;e.messageLoggers.forEach((function(e){return e(r,o)})),e.connectionEstablished=!0;var c={uid:i,type:"hi",params:[e.integrationKey,location.search,e.disableNewInteractionPopup]};if(!(null===(s=e.adcFrame)||void 0===s?void 0:s.contentWindow))throw new Error("adcFrame is not defined - that should not be possible");return e.messageLoggers.forEach((function(e){return e(c.type,c.params)})),void e.adcFrame.contentWindow.postMessage(c,e.adcFrameOrigin)}if("ready"===r)return e.messageLoggers.forEach((function(e){return e(r,o)})),e.adcIsReady=!0,void setTimeout((function(){e.pendingMessages.forEach((function(t){e.postMessageToAdc(t)})),e.pendingMessages=[]}));if(!e.adcIsReady)return;if(Object.keys(a.Jt).includes(r))e.messageLoggers.forEach((function(e){return e(r,o)})),e.handleIncomingMessage(r,i,o);else if(a.w0.includes(r)){e.messageLoggers.forEach((function(e){return e(r,o)}));var l=e.responseCallbacks[r];if(l&&l[i]){var u=l[i];delete l[i],Promise.resolve().then((function(){return u(o)}))}}}catch(E){console.error("@@@ Error: ",d(E,Error)?E.message:"".concat(E))}}}}))}},{key:"runResponseTimeoutWatch",value:function(e,t,n){var r=this;setTimeout((function(){var i=r.responseCallbacks[e+a.el];if(i[t]){delete i[t];var o='Response from Communicator for event "'.concat(e,'" ')+"wasn't received in the specified timeout ".concat(2e4," ms");console.error("@@@ ".concat(o)),n({status:"error",error:{code:6,name:"api_not_answer",message:o}})}}),2e4)}},{key:"postMessageToAdc",value:function(e){null!==this.adcFrame&&this.adcFrame.contentWindow&&this.adcIsReady?(this.messageLoggers.forEach((function(t){return t(e.type,e.params)})),"LOGIN"===e.type?console.log("@@@ ADAPTER SEND MESSAGE: LOGIN"):console.log("@@@ ADAPTER SEND MESSAGE: ",e),this.adcFrame.contentWindow.postMessage(e,this.adcFrameOrigin)):(console.log("@@@ ADAPTER: ADC is not ready, add pending message:",e),this.pendingMessages.push(e))}},{key:"apiCall",value:function(e){var t=this,n=arguments.length>1&&void 0!==arguments[1]?arguments[1]:[];return new Promise((function(r){var o=(0,i.v4)();t.postMessageToAdc({uid:o,type:e,params:n}),t.responseCallbacks[e+a.el][o]=r,t.runResponseTimeoutWatch(e,o,r)}))}},{key:"getLoginState",value:function(){return this.apiCall("GET_LOGIN_STATE")}},{key:"login",value:function(e,t){return this.apiCall("LOGIN",[e,t])}},{key:"logout",value:function(){return this.apiCall("LOGOUT")}},{key:"getAgentState",value:function(){return this.apiCall("GET_AGENT_STATE")}},{key:"setAgentState",value:function(e,t){return this.apiCall("SET_AGENT_STATE",[e,t])}},{key:"acceptInteraction",value:function(e){return this.apiCall("ACCEPT_INTERACTION",[e])}},{key:"rejectInteraction",value:function(e){return this.apiCall("REJECT_INTERACTION",[e])}},{key:"startCall",value:function(e,t){return this.apiCall("START_CALL",[e,t?d(t,Array)?t:[t]:[]])}},{key:"startChat",value:function(e,t,n){return this.apiCall("START_CHAT",[e,t,n?d(n,Array)?n:[n]:[]])}},{key:"startEmail",value:function(e,t){return this.apiCall("START_EMAIL",[e,t?d(t,Array)?t:[t]:[]])}},{key:"sendDtmf",value:function(e,t){return this.apiCall("SEND_DTMF",[e,t])}},{key:"consultCall",value:function(e){return this.apiCall("CONSULT_CALL",[e])}},{key:"blindTransfer",value:function(e,t,n){return this.apiCall("BLIND_TRANSFER",[e,t,n])}},{key:"transfer",value:function(e){return this.apiCall("TRANSFER",[e])}},{key:"leaveInteraction",value:function(e){return this.apiCall("LEAVE_INTERACTION",[e])}},{key:"completeInteraction",value:function(e){return this.apiCall("COMPLETE_INTERACTION",[e])}},{key:"leaveAndCompleteInteraction",value:function(e,t,n){return this.apiCall("LEAVE_AND_COMPLETE_INTERACTION",[e,t,n])}},{key:"switchActiveInteraction",value:function(e){return this.apiCall("SWITCH_ACTIVE_INTERACTION",[e])}},{key:"inviteToCallConference",value:function(e,t,n){return this.apiCall("INVITE_TO_CALL_CONFERENCE",[e,t,n])}},{key:"removeFromCallConference",value:function(e,t){return this.apiCall("REMOVE_FROM_CALL_CONFERENCE",[e,t])}},{key:"destroyCallConference",value:function(e){return this.apiCall("DESTROY_CALL_CONFERENCE",[e])}},{key:"inviteToChatConference",value:function(e,t){return this.apiCall("INVITE_TO_CHAT_CONFERENCE",[e,t])}},{key:"removeFromChatConference",value:function(e,t){return this.apiCall("REMOVE_FROM_CHAT_CONFERENCE",[e,t])}},{key:"mergeAllCallsIntoConference",value:function(e){return this.apiCall("MERGE_ALL_CALLS_INTO_CONFERENCE",[e])}},{key:"getTeams",value:function(){return this.apiCall("GET_TEAMS")}},{key:"getTeamMembers",value:function(e){return this.apiCall("GET_TEAM_MEMBERS",[e])}},{key:"getServicesList",value:function(){return this.apiCall("GET_SERVICES_LIST")}},{key:"getService",value:function(){return this.apiCall("GET_SERVICE")}},{key:"setService",value:function(e){return this.apiCall("SET_SERVICE",[e])}},{key:"getDIDNumbersList",value:function(){return this.apiCall("GET_DID_LIST")}},{key:"getDIDNumber",value:function(){return this.apiCall("GET_DID")}},{key:"setDIDNumber",value:function(e){return this.apiCall("SET_DID",[e])}},{key:"getDispositionsList",value:function(e){return this.apiCall("GET_DISPOSITIONS_LIST",[e])}},{key:"setDisposition",value:function(e,t){return this.apiCall("SET_DISPOSITION",[e,t])}},{key:"addNote",value:function(e,t){return this.apiCall("ADD_NOTE",[e,t])}},{key:"updateNote",value:function(e,t){return this.apiCall("UPDATE_NOTE",[e,t])}},{key:"replaceNote",value:function(e,t){return this.apiCall("REPLACE_NOTE",[e,t])}},{key:"setRescheduleWindow",value:function(e,t){return this.apiCall("SET_RESCHEDULE",[e,t])}},{key:"getConfig",value:function(){return this.apiCall("GET_CONFIG")}},{key:"setVariable",value:function(e,t,n){return this.apiCall("SET_VARIABLE",[e,t,n])}},{key:"getVariables",value:function(e,t){return this.apiCall("GET_VARIABLES",[e,t])}},{key:"addInteractionAssociatedObject",value:function(e,t){return this.apiCall("ADD_INTERACTION_ASSOCIATED_OBJECT",[e,t])}},{key:"setInteractionActiveScreen",value:function(e,t){return this.apiCall("SET_INTERACTION_ACTIVE_SCREEN",[e,t])}},{key:"getPhoneDevicesList",value:function(){return this.apiCall("GET_PHONE_DEVICES_LIST")}},{key:"getPhoneDevice",value:function(){return this.apiCall("GET_PHONE_DEVICE")}},{key:"setPhoneDevice",value:function(e){return this.apiCall("SET_PHONE_DEVICE",[e])}},{key:"setCallHold",value:function(e,t){return this.apiCall("SET_CALL_HOLD",[e,t])}},{key:"setCallRecording",value:function(e,t){return this.apiCall("SET_CALL_RECORDING",[e,t])}},{key:"setCallMute",value:function(e,t){return this.apiCall("SET_CALL_MUTE",[e,t])}},{key:"setScreenRecordingMute",value:function(e){return this.apiCall("SET_SCREEN_RECORDING_MUTE",[e])}},{key:"getScreenRecordingState",value:function(){return this.apiCall("GET_SCREEN_RECORDING_STATE")}},{key:"setWidgetMinimized",value:function(e){return this.apiCall("SET_WIDGET_MINIMIZED",[e])}},{key:"sendChatMessage",value:function(e,t){return this.apiCall("SEND_CHAT_MESSAGE",[e,t])}},{key:"suggestChatMessage",value:function(e,t,n){return this.apiCall("SUGGEST_CHAT_MESSAGE",[e,t,n])}},{key:"getAgentNotReadyReasons",value:function(){return this.apiCall("GET_AGENT_NOT_READY_REASONS")}},{key:"activatePage",value:function(){return this.apiCall("ACTIVATE_PAGE",[])}},{key:"getInteractionsState",value:function(){return this.apiCall("GET_INTERACTIONS_STATE",[])}},{key:"setCallRecordingMute",value:function(e,t){return this.apiCall("SET_CALL_RECORDING_MUTE",[e,t])}},{key:"setDialCandidates",value:function(e){return this.apiCall("SET_DIAL_CANDIDATES",[e])}},{key:"on",value:function(e,t){this.messageHandlers[e].push(t)}},{key:"remove",value:function(e,t){var n=this.messageHandlers[e].indexOf(t);-1!==n&&this.messageHandlers[e].splice(n,1)}}],n&&l(t.prototype,n),s&&l(t,s),e}();window.brightpattern={AdApi:T}},773:(e,t,n)=>{"use strict";n.d(t,{P:()=>r});var r={extractURLParams:function(e){var t={};if(e)try{var n=e.split("?").slice(1).join("?");if(n.length)n.split("&").reduce((function(e,t){var n=t.split("=");n.length&&(e[decodeURIComponent(n.shift())]=decodeURIComponent(n.join("=")));return e}),t)}catch(r){console.error("Unable to parse URL parameters: ",e)}return t},capitalize:function(e){return e.replace(/^\w/,(function(e){return e.toUpperCase()}))},findLast:function(e,t){for(var n=e.length-1;n>=0;n--)if(t(e[n]))return e[n];return null},shallowObjEqual:function(e,t){for(var n in e)if(!(n in t)||e[n]!==t[n])return!1;for(var r in t)if(!(r in e)||t[r]!==e[r])return!1;return!0},waitResolveAll:function(e){return new Promise((function(t,n){if(e.length){var r=0,a=new Array(e.length);e.map((function(e){return t=e,(null!=(n=Promise)&&"undefined"!=typeof Symbol&&n[Symbol.hasInstance]?n[Symbol.hasInstance](t):t instanceof n)?e:Promise.resolve(e);var t,n})).forEach((function(n,i){n.then((function(e){a[i]={status:"fulfilled",value:e}})).catch((function(e){a[i]={status:"rejected",reason:e}})).finally((function(){++r===e.length&&t(a)}))}))}else t([])}))},startsWithAny:function(e,t){var n=!0,r=!1,a=void 0;try{for(var i,o=t[Symbol.iterator]();!(n=(i=o.next()).done);n=!0){var s=i.value;if(e.startsWith(s))return!0}}catch(c){r=!0,a=c}finally{try{n||null==o.return||o.return()}finally{if(r)throw a}}return!1},splitWords:function(e){return e.trim().split(/(?=[A-Z])/).map((function(e){return e.trim()})).join(" ")}}},700:(e,t,n)=>{"use strict";n.d(t,{$4:()=>a,Jt:()=>i,S7:()=>c,el:()=>o,w0:()=>s});var r,a=["GET_LOGIN_STATE","LOGIN","LOGOUT","GET_AGENT_STATE","SET_AGENT_STATE","ACCEPT_INTERACTION","REJECT_INTERACTION","START_CALL","START_CHAT","START_EMAIL","SEND_DTMF","CONSULT_CALL","BLIND_TRANSFER","TRANSFER","LEAVE_INTERACTION","COMPLETE_INTERACTION","LEAVE_AND_COMPLETE_INTERACTION","SWITCH_ACTIVE_INTERACTION","INVITE_TO_CALL_CONFERENCE","REMOVE_FROM_CALL_CONFERENCE","DESTROY_CALL_CONFERENCE","INVITE_TO_CHAT_CONFERENCE","REMOVE_FROM_CHAT_CONFERENCE","MERGE_ALL_CALLS_INTO_CONFERENCE","GET_TEAMS","GET_TEAM_MEMBERS","GET_SERVICES_LIST","GET_SERVICE","SET_SERVICE","GET_DID_LIST","GET_DID","SET_DID","GET_DISPOSITIONS_LIST","SET_DISPOSITION","SET_RESCHEDULE","ADD_NOTE","UPDATE_NOTE","REPLACE_NOTE","GET_CONFIG","GET_VARIABLES","SET_VARIABLE","ADD_INTERACTION_ASSOCIATED_OBJECT","SET_INTERACTION_ACTIVE_SCREEN","GET_PHONE_DEVICES_LIST","GET_PHONE_DEVICE","SET_PHONE_DEVICE","SET_CALL_HOLD","SET_CALL_RECORDING","SET_CALL_MUTE","SET_SCREEN_RECORDING_MUTE","GET_SCREEN_RECORDING_STATE","SET_WIDGET_MINIMIZED","SEND_CHAT_MESSAGE","SUGGEST_CHAT_MESSAGE","GET_AGENT_NOT_READY_REASONS","ACTIVATE_PAGE","GET_INTERACTIONS_STATE","SET_CALL_RECORDING_MUTE","SET_DIAL_CANDIDATES"],i={ON_LOGIN:{needResponse:!1},ON_LOGOUT:{needResponse:!1},ON_NEW_INTERACTION:{needResponse:!1},ON_INTERACTION_REMOVED:{needResponse:!1},ON_INTERACTION_STATE_CHANGE:{needResponse:!1},ON_ACTIVE_INTERACTION_SWITCHED:{needResponse:!1},ON_AGENT_STATE_CHANGE:{needResponse:!1},ON_REQUEST_TRANSFER_DATA:{needResponse:!0},ON_LOAD_TRANSFER_DATA:{needResponse:!1},ON_GET_KNOWLEDGE_BASE_FOLDER:{needResponse:!0},ON_SEARCH_KNOWLEDGE_BASE:{needResponse:!0},ON_GET_KNOWLEDGE_BASE_ARTICLE:{needResponse:!0},ON_OPEN_RECORD:{needResponse:!1},ON_SEARCH_RECORDS:{needResponse:!1},ON_SHOW_SCREEN:{needResponse:!1},ON_SCREEN_RECORDING_STATE_CHANGE:{needResponse:!1},ON_WIDGET_MINIMIZED_CHANGE:{needResponse:!1},ON_SERVER_ERROR:{needResponse:!1},ON_SOFTPHONE_STATUS_CHANGE:{needResponse:!1},ON_AUDIO_DEVICE_CHANGE:{needResponse:!1},ON_PHONE_CAPABILITIES_CHANGE:{needResponse:!1},ON_CALL_AUDIO_QUALITY_ALERT:{needResponse:!1},ON_WEB_SCREEN_POP_CUSTOM:{needResponse:!0},ON_SAVE_ACTIVITY_RECORD:{needResponse:!1},ON_VALIDATE_ASSOCIATED_RECORDS:{needResponse:!0},ON_REQUEST_RECORD_INFO:{needResponse:!0},ON_REQUEST_RECORD_ON_SCREEN:{needResponse:!0}},o="_RESPONSE",s=a.map((function(e){return"".concat(e).concat(o)})),c=((r=i,Object.keys.call(r,r)).filter((function(e){return i[e].needResponse})).map((function(e){return"".concat(e).concat(o)})),["telegram","line","facebook","web","nexmo","sms","viber","twitter","wechat","whatsapp"])},22:(e,t,n)=>{var r=n(481),a=n(426),i=a;i.v1=r,i.v4=a,e.exports=i},725:e=>{for(var t=[],n=0;n<256;++n)t[n]=(n+256).toString(16).substr(1);e.exports=function(e,n){var r=n||0,a=t;return[a[e[r++]],a[e[r++]],a[e[r++]],a[e[r++]],"-",a[e[r++]],a[e[r++]],"-",a[e[r++]],a[e[r++]],"-",a[e[r++]],a[e[r++]],"-",a[e[r++]],a[e[r++]],a[e[r++]],a[e[r++]],a[e[r++]],a[e[r++]]].join("")}},157:e=>{var t="undefined"!=typeof crypto&&crypto.getRandomValues&&crypto.getRandomValues.bind(crypto)||"undefined"!=typeof msCrypto&&"function"==typeof window.msCrypto.getRandomValues&&msCrypto.getRandomValues.bind(msCrypto);if(t){var n=new Uint8Array(16);e.exports=function(){return t(n),n}}else{var r=new Array(16);e.exports=function(){for(var e,t=0;t<16;t++)0==(3&t)&&(e=4294967296*Math.random()),r[t]=e>>>((3&t)<<3)&255;return r}}},481:(e,t,n)=>{var r,a,i=n(157),o=n(725),s=0,c=0;e.exports=function(e,t,n){var l=t&&n||0,u=t||[],d=(e=e||{}).node||r,E=void 0!==e.clockseq?e.clockseq:a;if(null==d||null==E){var f=i();null==d&&(d=r=[1|f[0],f[1],f[2],f[3],f[4],f[5]]),null==E&&(E=a=16383&(f[6]<<8|f[7]))}var p=void 0!==e.msecs?e.msecs:(new Date).getTime(),_=void 0!==e.nsecs?e.nsecs:c+1,h=p-s+(_-c)/1e4;if(h<0&&void 0===e.clockseq&&(E=E+1&16383),(h<0||p>s)&&void 0===e.nsecs&&(_=0),_>=1e4)throw new Error("uuid.v1(): Can't create more than 10M uuids/sec");s=p,c=_,a=E;var T=(1e4*(268435455&(p+=122192928e5))+_)%4294967296;u[l++]=T>>>24&255,u[l++]=T>>>16&255,u[l++]=T>>>8&255,u[l++]=255&T;var C=p/4294967296*1e4&268435455;u[l++]=C>>>8&255,u[l++]=255&C,u[l++]=C>>>24&15|16,u[l++]=C>>>16&255,u[l++]=E>>>8|128,u[l++]=255&E;for(var v=0;v<6;++v)u[l+v]=d[v];return t||o(u)}},426:(e,t,n)=>{var r=n(157),a=n(725);e.exports=function(e,t,n){var i=t&&n||0;"string"==typeof e&&(t="binary"===e?new Array(16):null,e=null);var o=(e=e||{}).random||(e.rng||r)();if(o[6]=15&o[6]|64,o[8]=63&o[8]|128,t)for(var s=0;s<16;++s)t[i+s]=o[s];return t||a(o)}}},t={};function n(r){var a=t[r];if(void 0!==a)return a.exports;var i=t[r]={exports:{}};return e[r](i,i.exports,n),i.exports}n.d=(e,t)=>{for(var r in t)n.o(t,r)&&!n.o(e,r)&&Object.defineProperty(e,r,{enumerable:!0,get:t[r]})},n.o=(e,t)=>Object.prototype.hasOwnProperty.call(e,t),(()=>{"use strict";var e=n(700),t=n(281),r=n(773),a=window.location.href,i=r.P.extractURLParams(a).crmDomain;i.startsWith("https://")||(i="https://"+i);var o=new Promise((function(e,t){i||t("Missing required URL parameter 'crmDomain'");var n=document.createElement("script");document.head.insertAdjacentElement("beforeend",n),n.addEventListener("load",e),n.addEventListener("error",t),n.dataset.crmurl=i,n.dataset.cifid="CIFMainLibrary",n.type="text/javascript",n.src=i+"/webresources/Widget/msdyn_ciLibrary.js"}));function s(e,t,n,r,a,i,o){try{var s=e[i](o),c=s.value}catch(l){return void n(l)}s.done?t(c):Promise.resolve(c).then(r,a)}function c(e){return function(){var t=this,n=arguments;return new Promise((function(r,a){var i=e.apply(t,n);function o(e){s(i,r,a,o,c,"next",e)}function c(e){s(i,r,a,o,c,"throw",e)}o(void 0)}))}}function l(e,t,n){return t in e?Object.defineProperty(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}function u(e,t){return null!=t&&"undefined"!=typeof Symbol&&t[Symbol.hasInstance]?!!t[Symbol.hasInstance](e):e instanceof t}function d(e,t){var n,r,a,i,o={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;o;)try{if(n=1,r&&(a=2&i[0]?r.return:i[0]?r.throw||((a=r.return)&&a.call(r),0):r.next)&&!(a=a.call(r,i[1])).done)return a;switch(r=0,a&&(i=[2&i[0],a.value]),i[0]){case 0:case 1:a=i;break;case 4:return o.label++,{value:i[1],done:!1};case 5:o.label++,r=i[1],i=[0];continue;case 7:i=o.ops.pop(),o.trys.pop();continue;default:if(!(a=o.trys,(a=a.length>0&&a[a.length-1])||6!==i[0]&&2!==i[0])){o=0;continue}if(3===i[0]&&(!a||i[1]>a[0]&&i[1]<a[3])){o.label=i[1];break}if(6===i[0]&&o.label<a[1]){o.label=a[1],a=i;break}if(a&&o.label<a[2]){o.label=a[2],o.ops.push(i);break}a[2]&&o.ops.pop(),o.trys.pop();continue}i=t.call(e,o)}catch(s){i=[6,s],r=0}finally{n=a=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}}var E,f,p,_={voice:"phonecall",chat:"bpattern_messaging_session",email:"email"},h=function(e){return e.filter((function(e){return!!e.content})).map((function(e){return{id:e.knowledgearticleid,type:"article",title:e.title,text:e.content}}))},T={};f=new t.O({integrationKey:"omnichannel"}),p=[],o.then((function(){console.log("##############Microsoft.CIFramework: ",window.Microsoft),console.log("###READY!STEADY!GO!");var t,n=window.Microsoft.CIFramework,a=null,i=function(e){if("string"==typeof e){try{var t=JSON.parse(e);if(t&&t.message)return t.message}catch(n){}return e}return u(e,Error)?e.message:"".concat(e)};n.setMode(1).catch((function(e){return console.error("#ERROR-CRM-SET-MODE: ",i(e))})),n.setWidth(500).catch((function(e){return console.error("#ERROR-CRM-SET-WIDTH: ",i(e))})),f.on("ON_LOGIN",(t=c((function(e){return d(this,(function(t){switch(t.label){case 0:return a=e,[4,n.setClickToAct(!0)];case 1:return t.sent(),[2]}}))})),function(e){return t.apply(this,arguments)})),f.on("ON_LOGOUT",c((function(){return d(this,(function(e){switch(e.label){case 0:return[4,n.setClickToAct(!1)];case 1:return e.sent(),[2]}}))}))),f.getLoginState().then((function(e){"success"===e.status?a=e.data:console.warn("### Cannot get login state data:",e.error)}));var o=function(){var e=c((function(e,t){var r,a;return d(this,(function(i){switch(i.label){case 0:console.log("#SCREEN-POP (CREATE-TAB):",t,", id: ",e),i.label=1;case 1:return i.trys.push([1,3,,4]),[4,n.createTab({templateName:"entityrecord",templateParameters:{entityName:t,entityId:e},isFocused:!0})];case 2:return r=i.sent(),console.log("#Result: ",r),[3,4];case 3:return a=i.sent(),console.error("#ERROR-SCREEN-POP: ",u(a,Error)?a.message:"".concat(a)),[3,4];case 4:return[2]}}))}));return function(t,n){return e.apply(this,arguments)}}(),s="contact",C=function(){var e=c((function(e){var t,r,a,o=arguments;return d(this,(function(c){switch(c.label){case 0:t=o.length>1&&void 0!==o[1]?o[1]:s,console.log("#PREY!PREY! This is the search for: ",e),c.label=1;case 1:return c.trys.push([1,3,,4]),[4,n.renderSearchPage(t,e)];case 2:return r=c.sent(),console.log("#CrmSearchResult: ",r),[3,4];case 3:return a=c.sent(),console.error("#ERROR-CRM-SEARCH: ",i(a)),[3,4];case 4:return[2]}}))}));return function(t){return e.apply(this,arguments)}}();f.on("ON_OPEN_RECORD",(function(e){return o(e.id,e.type)})),f.on("ON_SEARCH_RECORDS",(function(e){var t;return C(e.text,(null===(t=e.types)||void 0===t?void 0:t.length)?e.types[0]:void 0)}));var v=function(e,t){var n={subject:"Bright Pattern ".concat(t.type),description:t.description,actualstart:t.startTime?new Date(t.startTime).toUTCString():void 0,actualend:t.endTime?new Date(t.endTime).toUTCString():void 0,actualdurationminutes:t.duration?Math.ceil(t.duration/60):0,bpattern_interaction_id:t.interactionId,bpattern_global_interaction_id:t.globalInteractionId||"",bpattern_agent:a?a.username:void 0,bpattern_service:t.service,bpattern_disposition:t.disposition,bpattern_recording_url:t.playbackUrl,bpattern_dnis:t.DNIS,bpattern_ani:t.ANI};return e===_.voice&&(n.phonenumber=t.phoneNumber,n.directioncode=t.callDirection&&("outbound"===t.callDirection?"true":"false")),n},m=function(){var e=c((function(e,t){var r,a,i,o,s,c,u,E,f,p,h,C,m,y;return d(this,(function(d){switch(d.label){case 0:return[4,n.getEntityMetadata(t.type)];case 1:if(r=d.sent(),a=JSON.parse(r),i=_[e.type],o={},console.log("#METADATA: ",a),T[t.type]=a.DisplayName,s=null,c=a.EntitySetName,u=a.LogicalName,(E=a.OneToManyRelationships)&&E._collection)try{s=E._collection.find((function(e){var t=e.ReferencingEntity,n=e.ReferencingAttribute;return t===i&&"regardingobjectid"===n}))}catch(R){console.log("#Error in the potentially dangerous place!")}return c&&s?(f=s.ReferencingEntityNavigationPropertyName,p="".concat(f,"@odata.bind"),h="/".concat(c,"(").concat(t.id,")"),o[p]=h):u?(C="regardingobjectid_".concat(u,"_").concat(i,"@odata.bind"),m="/".concat(c,"(").concat(t.id,")"),o[C]=m):console.warn("#regardingobjectid reference is note detected"),y=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{},r=Object.keys(n);"function"==typeof Object.getOwnPropertySymbols&&(r=r.concat(Object.getOwnPropertySymbols(n).filter((function(e){return Object.getOwnPropertyDescriptor(n,e).enumerable})))),r.forEach((function(t){l(e,t,n[t])}))}return e}({},v(i,e),o),console.log("#ACTIVITY OBJECT: ",y),[2,n.createRecord(i,JSON.stringify(y))]}}))}));return function(t,n){return e.apply(this,arguments)}}(),y=function(){var e=c((function(e){var t,r,a,i,o,s,c;return d(this,(function(l){switch(l.label){case 0:console.log("# SAVE-ACTIVITY-HISTORY: ",e),r=null!==(t=e.associatedObjects.selected[0])&&void 0!==t?t:void 0,a=r&&e.associatedObjects.list.find((function(e){return e.id===r})),console.log("# regarding to object: ",a),l.label=1;case 1:return l.trys.push([1,5,,6]),a?[4,m(e,a)]:[3,3];case 2:return l.sent(),[3,4];case 3:i=_[e.type],o=v(i,e),console.log("#Activity without regarding obj: ",o),n.createRecord(i,JSON.stringify(o)),l.label=4;case 4:return[3,6];case 5:return s=l.sent(),console.warn("Error while saving activity history record with regarding object: ",s),c=_[e.type],n.createRecord(c,JSON.stringify(v(c,e))),[3,6];case 6:return[2]}}))}));return function(t){return e.apply(this,arguments)}}();f.on("ON_INTERACTION_REMOVED",(function(e){E&&e.interactionId===E.interactionId&&(E.interactionId=null)})),f.on("ON_SAVE_ACTIVITY_RECORD",(function(e){return y(e)})),f.on("ON_ACTIVE_INTERACTION_SWITCHED",(function(e){console.log("# Interaction switched, id: ",e),console.log("# sessions:",p);var t=p.find((function(t){return t.interactionId===e}));t?E!==t&&(E=t,console.log("# REQUEST FOCUS SESSION"),n.requestFocusSession(t.sessionId)):E=null}));var R="",N=function(){var e=c((function(){var e;return d(this,(function(t){return e=R,[2,new Promise((function(t,r){var a=1,i=function(){var o=c((function(){var o,s,c,l,u,p,_,h;return d(this,(function(d){switch(d.label){case 0:return R!==e?(t(),[2]):(null==E?void 0:E.interactionId)?[4,n.getEnvironment()]:(console.warn("No need to get entity: currentInteraction is undefined"),t(),[2]);case 1:return o=d.sent(),s=JSON.parse(o),console.log("#ENTITY-ENVIRONMENT ATTEMPT #".concat(a,": "),s),s.dashboardType||s.pagetype&&"entityrecord"!==s.pagetype?(t(),[2]):s.id&&s.etn?(s.id,s.etn,f.setInteractionActiveScreen({recordId:s.id,recordType:s.etn}),[4,n.retrieveRecord(s.etn,s.id)]):[3,5];case 2:return c=d.sent(),l=JSON.parse(c),console.log("#obj-entity: ",l),u=l.title||l.fullname||l.name||l.subject||s.id,T[s.etn]?[3,4]:[4,n.getEntityMetadata(s.etn)];case 3:p=d.sent(),_=JSON.parse(p),T[s.etn]=_.DisplayName,d.label=4;case 4:return h=T[s.etn],f.addInteractionAssociatedObject({id:s.id,type:s.etn,displayName:u,displayType:h,customFields:{}}),E&&E.objectList.push({objectId:s.id,objectType:s.etn,displayName:u}),t(),[3,6];case 5:++a>10?r("ERROR: Can't get CRM entity data"):setTimeout(i,1e3),d.label=6;case 6:return[2]}}))}));return function(){return o.apply(this,arguments)}}();i()}))]}))}));return function(){return e.apply(this,arguments)}}();n.addHandler("onpagenavigate",function(){var e=c((function(e){var t;return d(this,(function(n){return a?((null==E?void 0:E.interactionId)&&(t=JSON.parse(e),console.log("#NAVIGATION: ",t),E.urlHistory.push(t.value),R=t.value),[2,Promise.resolve()]):[2,Promise.resolve()]}))}));return function(t){return e.apply(this,arguments)}}()),n.addHandler("onclicktoact",function(){var t=c((function(t){var i,o,s,c,l,u,E,p,_,h,C,v;return d(this,(function(d){switch(d.label){case 0:if(console.log("#CLICK"),!a)return[2,Promise.resolve()];i=JSON.parse(t),console.log("#CLICK-TO-ACT: ",i),d.label=1;case 1:return d.trys.push([1,9,,10]),(o=i.entityId).length&&"{"===o[0]&&(o=o.slice(1)),o.length&&"}"===o[o.length-1]&&(o=o.slice(0,o.length-1)),[4,n.createSession({templateName:"bpo_call_session",templateParameters:{omnichannel_customer360:{entityId:o,entityName:i.entityLogicalName}}})];case 2:s=d.sent(),console.log("#SESSION ID: ",s),n.setWidth(500),c=null,d.label=3;case 3:return d.trys.push([3,5,,6]),[4,n.retrieveRecord(i.entityLogicalName,o)];case 4:return l=d.sent(),c=JSON.parse(l),[3,6];case 5:return u=d.sent(),console.error("#RETRIEVE-RECORD-ERROR: ",u),[3,6];case 6:return console.log("#entity: ",c),E=c&&(c.title||c.fullname||c.name||c.subject)||o,n.setSessionTitle({sessionId:s,customer:E}),T[i.entityLogicalName]?[3,8]:[4,n.getEntityMetadata(i.entityLogicalName)];case 7:p=d.sent(),_=JSON.parse(p),T[i.entityLogicalName]=_.DisplayName,d.label=8;case 8:return h=T[i.entityLogicalName],C={id:o,type:i.entityLogicalName,displayName:E,displayType:h,customFields:{}},function(t,n){var a=!1,i=!0,o=!1,s=void 0;try{for(var c,l=e.S7[Symbol.iterator]();!(i=(c=l.next()).done);i=!0){var u=c.value;t.value.startsWith("".concat(u,":"))&&(f.startChat(u,t.value.substring(u.length+1)),a=!0)}}catch(v){o=!0,s=v}finally{try{i||null==l.return||l.return()}finally{if(o)throw s}}if(!a){if(r.P.startsWithAny(t.name,["phone_","new_phone_","bpattern_phone_"]))f.startCall(t.value,n),a=!0;else{var d=!0,E=!1,p=void 0;try{for(var _,h=e.S7[Symbol.iterator]();!(d=(_=h.next()).done);d=!0){var T=_.value;r.P.startsWithAny(t.name,["".concat(T,"_"),"new_".concat(T,"_"),"bpattern_".concat(T,"_")])&&(f.startChat(T,t.value,n),a=!0)}}catch(v){E=!0,p=v}finally{try{d||null==h.return||h.return()}finally{if(E)throw p}}}if(!a)switch(t.format){case"Phone":default:f.startCall(t.value,n);break;case"SMS":f.startChat("sms",t.value,n);break;case"Email":f.startEmail(t.value,n)}}}(i,C),n.setAgentPresence("busy"),[3,10];case 9:return v=d.sent(),console.log("#click-to-act Error: ",v),[3,10];case 10:return[2,Promise.resolve()]}}))}));return function(e){return t.apply(this,arguments)}}()),f.on("ON_NEW_INTERACTION",(function(){n.getMode().then((function(e){0===e&&n.setMode(1).catch((function(e){return console.error("#ERROR-CRM-SET-MODE: ",i(e))}))})).catch((function(e){return console.error("#ERROR-CRM-GET-MODE: ",i(e))})),R="pseudo-url",N().then((function(){}))})),f.on("ON_GET_KNOWLEDGE_BASE_FOLDER",function(){var e=c((function(e){var t,r,a,o;return d(this,(function(s){switch(s.label){case 0:t=e.language,s.label=1;case 1:return s.trys.push([1,3,,4]),[4,n.searchAndOpenRecords("knowledgearticle","?$select=content,title&$expand=languagelocaleid($select=code)&$filter=statecode eq 3"+(void 0===t||"none"===t?"":" and startswith(languagelocaleid/code, '".concat(t,"')")),!0)];case 2:return r=s.sent(),a=Object.values(JSON.parse(r)),console.log("KB folder content:",a),[2,h(a)];case 3:return o=s.sent(),console.error("KB Folder: cif.searchAndOpenRecords error:",i(o)),[3,4];case 4:return[2,[]]}}))}));return function(t){return e.apply(this,arguments)}}()),f.on("ON_SEARCH_KNOWLEDGE_BASE",function(){var e=c((function(e,t){var r,a,o;return d(this,(function(s){switch(s.label){case 0:return s.trys.push([0,2,,3]),[4,n.searchAndOpenRecords("knowledgearticle","?$select=content,title&$expand=languagelocaleid($select=code)&$filter=statecode eq 3 "+(void 0===t||"none"===t?"":"and startswith(languagelocaleid/code, '".concat(t,"') "))+"and ("+"contains(content, '".concat(e,"') or ")+"contains(keywords, '".concat(e,"') or ")+"contains(description, '".concat(e,"') or ")+"contains(title, '".concat(e,"')")+")",!0)];case 1:return r=s.sent(),a=Object.values(JSON.parse(r)),console.log("#CRM-SEARCH-RESULT: ",a),[2,h(a)];case 2:return o=s.sent(),console.error("#ERROR-CRM-ODATA-KB-SEARCH: ",i(o)),[3,3];case 3:return[2,[]]}}))}));return function(t,n){return e.apply(this,arguments)}}()),f.on("ON_GET_KNOWLEDGE_BASE_ARTICLE",function(){var e=c((function(e){var t,r,a;return d(this,(function(o){switch(o.label){case 0:return o.trys.push([0,2,,3]),[4,n.searchAndOpenRecords("knowledgearticle","?$select=articlepublicnumber,createdon,content,description,isinternal,keywords,modifiedon,statecode,statuscode,title,versionnumber,createdby,modifiedby,_createdby_value,_modifiedby_value,_ownerid_value,_parentarticlecontentid_value,_rootarticleid_value,_subjectid_value&$expand=languagelocaleid($select=code),transactioncurrencyid($select=isocurrencycode),owningbusinessunit($select=name)"+"&$filter=knowledgearticleid eq '".concat(e,"'"),!0)];case 1:return t=o.sent(),(r=Object.values(JSON.parse(t))).length?(console.log("#CRM-KB-ARTICLE: ",r[0]),[2,(s=r[0],s.content?{id:s.knowledgearticleid,title:s.title,keywords:s.keywords||"",answer:s.content,notes:s.description||"",language:s.languagelocaleid.code,createdByUser:s["_createdby_value@OData.Community.Display.V1.FormattedValue"],lastEditedByUser:s["_modifiedby_value@OData.Community.Display.V1.FormattedValue"],customFields:[]}:null)]):[2,null];case 2:return a=o.sent(),console.error("#ERROR-CRM-ODATA-KB-ARTICLE: ",i(a)),[3,3];case 3:return[2,null]}var s}))}));return function(t){return e.apply(this,arguments)}}()),n.addHandler("onSessionSwitched",function(){var e=c((function(e){var t,n;return d(this,(function(r){switch(r.label){case 0:return t=JSON.parse(e),console.log("### ON-SESSION-SWITCHED: ",t),console.log("### current session: ",E?E.sessionId:"NO"),t.focused&&E&&E.sessionId!==t.sessionId?(null==(n=p.find((function(e){return e.sessionId===t.sessionId})))?void 0:n.interactionId)?(console.log("#call switchActiveInteraction (middle) for session: ",n),[4,f.switchActiveInteraction(n.interactionId)]):[3,2]:[3,3];case 1:return"success"===r.sent().status&&(E=n),[3,3];case 2:console.error("### SMTHG GOES WRONG"),r.label=3;case 3:return[2]}}))}));return function(t){return e.apply(this,arguments)}}()),n.addHandler("onSessionClosed",function(){var e=c((function(e){var t,n,r;return d(this,(function(a){switch(a.label){case 0:return t=JSON.parse(e),console.log("### ON-SESSION-CLOSED: ",t),(null==(n=p.find((function(e){return e.sessionId===t.sessionId})))?void 0:n.interactionId)?[4,f.completeInteraction(n.interactionId)]:[3,2];case 1:"success"===a.sent().status&&(r=p.indexOf(n),p.splice(r,1),E===n&&(E=p.length?p[p.length-1]:null)),a.label=2;case 2:return[2]}}))}));return function(t){return e.apply(this,arguments)}}()),n.addHandler("onmodechanged",(function(e){if(f.adcFrame){switch(JSON.parse(e).value){case 0:f.setWidgetMinimized(!0);break;case 1:f.setWidgetMinimized(!1)}return Promise.resolve()}})),f.on("ON_WIDGET_MINIMIZED_CHANGE",(function(e){n.setMode(e?0:1).catch((function(e){console.error("#ERROR-CRM-SET-MODE: ",i(e))}))})),f.on("ON_SHOW_SCREEN",(function(e){e&&e.recordId&&e.recordType&&o(e.recordId,e.recordType)}))})).catch((function(e){console.error("Can't load Channel Integration Framework client API library: ",e)}))})()})();
//# sourceMappingURL=omnichannel-8806419f9a1df83cbd6f.js.map